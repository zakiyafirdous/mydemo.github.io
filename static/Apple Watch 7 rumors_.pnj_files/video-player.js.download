/* eslint-disable */
/**
 * video-player v3.2.1
 * Built 08/18/2021 at 8:22:12 PM (GMT+0000)
 * Includes:
 *   - hls.js v1.0.7
 *   - cvui v
 */
(function(){var define, require;
!function(){var a,b;(function(){function b(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)}function c(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&&!1!==b(a[c],c,a););return a}function d(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function e(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}function f(a,b){return!!(null==a?0:a.length)&&n(a,b,0)>-1}function g(a,b,c){for(var d=-1,e=null==a?0:a.length;++d<e;)if(c(b,a[d]))return!0;return!1}function h(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e}function i(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}function j(a,b,c,d){var e=-1,f=null==a?0:a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function k(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function l(a){return a.split("")}function m(a,b,c,d){for(var e=a.length,f=c+(d?1:-1);d?f--:++f<e;)if(b(a[f],f,a))return f;return-1}function n(a,b,c){return b===b?G(a,b,c):m(a,p,c)}function o(a,b,c,d){for(var e=c-1,f=a.length;++e<f;)if(d(a[e],b))return e;return-1}function p(a){return a!==a}function q(a){return function(b){return null==b?Yd:b[a]}}function r(a){return function(b){return null==a?Yd:a[b]}}function s(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].value;return a}function t(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}function u(a){return function(b){return a(b)}}function v(a,b){return h(b,function(b){return a[b]})}function w(a,b){return a.has(b)}function x(a,b){for(var c=a.length,d=0;c--;)a[c]===b&&++d;return d}function y(a){return"\\"+fg[a]}function z(a,b){return null==a?Yd:a[b]}function A(a){return ag.test(a)}function B(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}function C(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function D(a,b){return function(c){return a(b(c))}}function E(a,b){for(var c=-1,d=a.length,e=0,f=[];++c<d;){var g=a[c];g!==b&&g!==ce||(a[c]=ce,f[e++]=c)}return f}function F(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}function G(a,b,c){for(var d=c-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function H(a){return A(a)?J(a):tg(a)}function I(a){return A(a)?K(a):l(a)}function J(a){for(var b=_f.lastIndex=0;_f.test(a);)++b;return b}function K(a){return a.match(_f)||[]}function L(a){if(ld(a)&&!Hh(a)&&!(a instanceof O)){if(a instanceof N)return a;if(Ag.call(a,"__wrapped__"))return Ac(a)}return new N(a)}function M(){}function N(a,b){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=Yd}function O(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Be,this.__views__=[]}function P(){var a=new O(this.__wrapped__);return a.__actions__=yb(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=yb(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=yb(this.__views__),a}function Q(){if(this.__filtered__){var a=new O(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function R(){var a=this.__wrapped__.value(),b=this.__dir__,c=Hh(a),d=b<0,e=c?a.length:0,f=$b(0,e,this.__views__),g=f.start,h=f.end,i=h-g,j=d?h:g-1,k=this.__iteratees__,l=k.length,m=0,n=Yg(i,this.__takeCount__);if(!c||!d&&e==i&&n==i)return lb(a,this.__actions__);var o=[];a:for(;i--&&m<n;){j+=b;for(var p=-1,q=a[j];++p<l;){var r=k[p],s=r.iteratee,t=r.type,u=s(q);if(t==ve)q=u;else if(!u){if(t==ue)continue a;break a}}o[m++]=q}return o}function S(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function T(){this.__data__=eh?eh(null):{},this.size=0}function U(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b}function V(a){var b=this.__data__;if(eh){var c=b[a];return c===ae?Yd:c}return Ag.call(b,a)?b[a]:Yd}function W(a){var b=this.__data__;return eh?b[a]!==Yd:Ag.call(b,a)}function X(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=eh&&b===Yd?ae:b,this}function Y(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function Z(){this.__data__=[],this.size=0}function $(a){var b=this.__data__,c=ta(b,a);return!(c<0)&&(c==b.length-1?b.pop():Ng.call(b,c,1),--this.size,!0)}function _(a){var b=this.__data__,c=ta(b,a);return c<0?Yd:b[c][1]}function aa(a){return ta(this.__data__,a)>-1}function ba(a,b){var c=this.__data__,d=ta(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this}function ca(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function da(){this.size=0,this.__data__={hash:new S,map:new(ah||Y),string:new S}}function ea(a){var b=Wb(this,a).delete(a);return this.size-=b?1:0,b}function fa(a){return Wb(this,a).get(a)}function ga(a){return Wb(this,a).has(a)}function ha(a,b){var c=Wb(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this}function ia(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new ca;++b<c;)this.add(a[b])}function ja(a){return this.__data__.set(a,ae),this}function ka(a){return this.__data__.has(a)}function la(a){var b=this.__data__=new Y(a);this.size=b.size}function ma(){this.__data__=new Y,this.size=0}function na(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c}function oa(a){return this.__data__.get(a)}function pa(a){return this.__data__.has(a)}function qa(a,b){var c=this.__data__;if(c instanceof Y){var d=c.__data__;if(!ah||d.length<$d-1)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new ca(d)}return c.set(a,b),this.size=c.size,this}function ra(a,b){var c=Hh(a),d=!c&&Gh(a),e=!c&&!d&&Ih(a),f=!c&&!d&&!e&&Mh(a),g=c||d||e||f,h=g?t(a.length,String):[],i=h.length;for(var j in a)!b&&!Ag.call(a,j)||g&&("length"==j||e&&("offset"==j||"parent"==j)||f&&("buffer"==j||"byteLength"==j||"byteOffset"==j)||gc(j,i))||h.push(j);return h}function sa(a,b,c){var d=a[b];Ag.call(a,b)&&cd(d,c)&&(c!==Yd||b in a)||wa(a,b,c)}function ta(a,b){for(var c=a.length;c--;)if(cd(a[c][0],b))return c;return-1}function ua(a,b){return a&&zb(b,Cd(b),a)}function va(a,b){return a&&zb(b,Dd(b),a)}function wa(a,b,c){"__proto__"==b&&Rg?Rg(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0}):a[b]=c}function xa(a,b){for(var c=-1,d=b.length,e=Array(d),f=null==a;++c<d;)e[c]=f?Yd:zd(a,b[c]);return e}function ya(a,b,c){return a===a&&(c!==Yd&&(a=a<=c?a:c),b!==Yd&&(a=a>=b?a:b)),a}function za(a,b,d,e,f,g){var h,i=b&de,j=b&ee,k=b&fe;if(d&&(h=f?d(a,e,f,g):d(a)),h!==Yd)return h;if(!kd(a))return a;var l=Hh(a);if(l){if(h=bc(a),!i)return yb(a,h)}else{var m=xh(a),n=m==Ke||m==Le;if(Ih(a))return ob(a,i);if(m==Pe||m==De||n&&!f){if(h=j||n?{}:cc(a),!i)return j?Bb(a,va(h,a)):Ab(a,ua(h,a))}else{if(!dg[m])return f?a:{};h=dc(a,m,i)}}g||(g=new la);var o=g.get(a);if(o)return o;if(g.set(a,h),Lh(a))return a.forEach(function(c){h.add(za(c,b,d,c,a,g))}),h;if(Kh(a))return a.forEach(function(c,e){h.set(e,za(c,b,d,e,a,g))}),h;var p=k?j?Sb:Rb:j?Dd:Cd,q=l?Yd:p(a);return c(q||a,function(c,e){q&&(e=c,c=a[e]),sa(h,e,za(c,b,d,e,a,g))}),h}function Aa(a,b,c,d){var e=-1,i=f,j=!0,k=a.length,l=[],m=b.length;if(!k)return l;c&&(b=h(b,u(c))),d?(i=g,j=!1):b.length>=$d&&(i=w,j=!1,b=new ia(b));a:for(;++e<k;){var n=a[e],o=null==c?n:c(n);if(n=d||0!==n?n:0,j&&o===o){for(var p=m;p--;)if(b[p]===o)continue a;l.push(n)}else i(b,o,d)||l.push(n)}return l}function Ba(a,b){var c=!0;return qh(a,function(a,d,e){return c=!!b(a,d,e)}),c}function Ca(a,b,c){for(var d=-1,e=a.length;++d<e;){var f=a[d],g=b(f);if(null!=g&&(h===Yd?g===g&&!rd(g):c(g,h)))var h=g,i=f}return i}function Da(a,b,c,d,e){var f=-1,g=a.length;for(c||(c=fc),e||(e=[]);++f<g;){var h=a[f];b>0&&c(h)?b>1?Da(h,b-1,c,d,e):i(e,h):d||(e[e.length]=h)}return e}function Ea(a,b){return a&&rh(a,b,Cd)}function Fa(a,b){return e(b,function(b){return id(a[b])})}function Ga(a,b){b=mb(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[xc(b[c++])];return c&&c==d?a:Yd}function Ha(a,b,c){var d=b(a);return Hh(a)?d:i(d,c(a))}function Ia(a){return null==a?a===Yd?We:Oe:Qg&&Qg in Object(a)?Zb(a):rc(a)}function Ja(a,b){return null!=a&&Ag.call(a,b)}function Ka(a,b){return null!=a&&b in Object(a)}function La(a,b,c){return a>=Yg(b,c)&&a<Xg(b,c)}function Ma(a,c,d){c=mb(c,a),a=tc(a,c);var e=null==a?a:a[xc(Gc(c))];return null==e?Yd:b(e,a,d)}function Na(a){return ld(a)&&Ia(a)==De}function Oa(a){return ld(a)&&Ia(a)==He}function Pa(a,b,c,d,e){return a===b||(null==a||null==b||!ld(a)&&!ld(b)?a!==a&&b!==b:Qa(a,b,c,d,Pa,e))}function Qa(a,b,c,d,e,f){var g=Hh(a),h=Hh(b),i=g?Ee:xh(a),j=h?Ee:xh(b);i=i==De?Pe:i,j=j==De?Pe:j;var k=i==Pe,l=j==Pe,m=i==j;if(m&&Ih(a)){if(!Ih(b))return!1;g=!0,k=!1}if(m&&!k)return f||(f=new la),g||Mh(a)?Nb(a,b,c,d,e,f):Ob(a,b,i,c,d,e,f);if(!(c&ge)){var n=k&&Ag.call(a,"__wrapped__"),o=l&&Ag.call(b,"__wrapped__");if(n||o){var p=n?a.value():a,q=o?b.value():b;return f||(f=new la),e(p,q,c,d,f)}}return!!m&&(f||(f=new la),Pb(a,b,c,d,e,f))}function Ra(a){return ld(a)&&xh(a)==Me}function Sa(a,b,c,d){var e=c.length,f=e,g=!d;if(null==a)return!f;for(a=Object(a);e--;){var h=c[e];if(g&&h[2]?h[1]!==a[h[0]]:!(h[0]in a))return!1}for(;++e<f;){h=c[e];var i=h[0],j=a[i],k=h[1];if(g&&h[2]){if(j===Yd&&!(i in a))return!1}else{var l=new la;if(d)var m=d(j,k,i,a,b,l);if(!(m===Yd?Pa(k,j,ge|he,d,l):m))return!1}}return!0}function Ta(a){return!(!kd(a)||lc(a))&&(id(a)?Fg:Df).test(yc(a))}function Ua(a){return ld(a)&&xh(a)==Te}function Va(a){return ld(a)&&jd(a.length)&&!!cg[Ia(a)]}function Wa(a){return"function"==typeof a?a:null==a?Pd:"object"==typeof a?Hh(a)?ab(a[0],a[1]):_a(a):Ud(a)}function Xa(a){if(!mc(a))return Wg(a);var b=[];for(var c in Object(a))Ag.call(a,c)&&"constructor"!=c&&b.push(c);return b}function Ya(a){if(!kd(a))return qc(a);var b=mc(a),c=[];for(var d in a)("constructor"!=d||!b&&Ag.call(a,d))&&c.push(d);return c}function Za(a,b){return a<b}function $a(a,b){var c=-1,d=dd(a)?Array(a.length):[];return qh(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function _a(a){var b=Xb(a);return 1==b.length&&b[0][2]?oc(b[0][0],b[0][1]):function(c){return c===a||Sa(c,a,b)}}function ab(a,b){return ic(a)&&nc(b)?oc(xc(a),b):function(c){var d=zd(c,a);return d===Yd&&d===b?Bd(c,a):Pa(b,d,ge|he)}}function bb(a,b,c){var d=-1;return b=h(b.length?b:[Pd],u(Vb())),s($a(a,function(a,c,e){return{criteria:h(b,function(b){return b(a)}),index:++d,value:a}}),function(a,b){return vb(a,b,c)})}function cb(a,b,c){for(var d=-1,e=b.length,f={};++d<e;){var g=b[d],h=Ga(a,g);c(h,g)&&hb(f,mb(g,a),h)}return f}function db(a){return function(b){return Ga(b,a)}}function eb(a,b,c,d){var e=d?o:n,f=-1,g=b.length,i=a;for(a===b&&(b=yb(b)),c&&(i=h(a,u(c)));++f<g;)for(var j=0,k=b[f],l=c?c(k):k;(j=e(i,l,j,d))>-1;)i!==a&&Ng.call(i,j,1),Ng.call(a,j,1);return a}function fb(a,b){var c="";if(!a||b<1||b>ye)return c;do{b%2&&(c+=a),(b=Tg(b/2))&&(a+=a)}while(b);return c}function gb(a,b){return zh(sc(a,b,Pd),a+"")}function hb(a,b,c,d){if(!kd(a))return a;b=mb(b,a);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&&++e<f;){var i=xc(b[e]),j=c;if(e!=g){var k=h[i];j=d?d(k,i,h):Yd,j===Yd&&(j=kd(k)?k:gc(b[e+1])?[]:{})}sa(h,i,j),h=h[i]}return a}function ib(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),c=c>e?e:c,c<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function jb(a,b){var c;return qh(a,function(a,d,e){return!(c=b(a,d,e))}),!!c}function kb(a){if("string"==typeof a)return a;if(Hh(a))return h(a,kb)+"";if(rd(a))return oh?oh.call(a):"";var b=a+"";return"0"==b&&1/a==-xe?"-0":b}function lb(a,b){var c=a;return c instanceof O&&(c=c.value()),j(b,function(a,b){return b.func.apply(b.thisArg,i([a],b.args))},c)}function mb(a,b){return Hh(a)?a:ic(a,b)?[a]:Ah(xd(a))}function nb(a,b,c){var d=a.length;return c=c===Yd?d:c,!b&&c>=d?a:ib(a,b,c)}function ob(a,b){if(b)return a.slice();var c=a.length,d=Jg?Jg(c):new a.constructor(c);return a.copy(d),d}function pb(a){var b=new a.constructor(a.byteLength);return new Ig(b).set(new Ig(a)),b}function qb(a,b){var c=b?pb(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.byteLength)}function rb(a){var b=new a.constructor(a.source,Af.exec(a));return b.lastIndex=a.lastIndex,b}function sb(a){return nh?Object(nh.call(a)):{}}function tb(a,b){var c=b?pb(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.length)}function ub(a,b){if(a!==b){var c=a!==Yd,d=null===a,e=a===a,f=rd(a),g=b!==Yd,h=null===b,i=b===b,j=rd(b);if(!h&&!j&&!f&&a>b||f&&g&&i&&!h&&!j||d&&g&&i||!c&&i||!e)return 1;if(!d&&!f&&!j&&a<b||j&&c&&e&&!d&&!f||h&&c&&e||!g&&e||!i)return-1}return 0}function vb(a,b,c){for(var d=-1,e=a.criteria,f=b.criteria,g=e.length,h=c.length;++d<g;){var i=ub(e[d],f[d]);if(i){if(d>=h)return i;return i*("desc"==c[d]?-1:1)}}return a.index-b.index}function wb(a,b,c,d){for(var e=-1,f=a.length,g=c.length,h=-1,i=b.length,j=Xg(f-g,0),k=Array(i+j),l=!d;++h<i;)k[h]=b[h];for(;++e<g;)(l||e<f)&&(k[c[e]]=a[e]);for(;j--;)k[h++]=a[e++];return k}function xb(a,b,c,d){for(var e=-1,f=a.length,g=-1,h=c.length,i=-1,j=b.length,k=Xg(f-h,0),l=Array(k+j),m=!d;++e<k;)l[e]=a[e];for(var n=e;++i<j;)l[n+i]=b[i];for(;++g<h;)(m||e<f)&&(l[n+c[g]]=a[e++]);return l}function yb(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b}function zb(a,b,c,d){var e=!c;c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):Yd;i===Yd&&(i=a[h]),e?wa(c,h,i):sa(c,h,i)}return c}function Ab(a,b){return zb(a,vh(a),b)}function Bb(a,b){return zb(a,wh(a),b)}function Cb(a){return gb(function(b,c){var d=-1,e=c.length,f=e>1?c[e-1]:Yd,g=e>2?c[2]:Yd;for(f=a.length>3&&"function"==typeof f?(e--,f):Yd,g&&hc(c[0],c[1],g)&&(f=e<3?Yd:f,e=1),b=Object(b);++d<e;){var h=c[d];h&&a(b,h,d,f)}return b})}function Db(a,b){return function(c,d){if(null==c)return c;if(!dd(c))return a(c,d);for(var e=c.length,f=b?e:-1,g=Object(c);(b?f--:++f<e)&&!1!==d(g[f],f,g););return c}}function Eb(a){return function(b,c,d){for(var e=-1,f=Object(b),g=d(b),h=g.length;h--;){var i=g[a?h:++e];if(!1===c(f[i],i,f))break}return b}}function Fb(a){return function(b){b=xd(b);var c=A(b)?I(b):Yd,d=c?c[0]:b.charAt(0),e=c?nb(c,1).join(""):b.slice(1);return d[a]()+e}}function Gb(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var c=ph(a.prototype),d=a.apply(c,b);return kd(d)?d:c}}function Hb(a){return function(b,c,d){var e=Object(b);if(!dd(b)){var f=Vb(c,3);b=Cd(b),c=function(a){return f(e[a],a,e)}}var g=a(b,c,d);return g>-1?e[f?b[g]:g]:Yd}}function Ib(a,b,c,d,e,f,g,h,i,j){function k(){for(var r=arguments.length,s=Array(r),t=r;t--;)s[t]=arguments[t];if(o)var u=Ub(k),v=x(s,u);if(d&&(s=wb(s,d,e,o)),f&&(s=xb(s,f,g,o)),r-=v,o&&r<j){var w=E(s,u);return Kb(a,b,Ib,k.placeholder,c,s,w,h,i,j-r)}var y=m?c:this,z=n?y[a]:a;return r=s.length,h?s=uc(s,h):p&&r>1&&s.reverse(),l&&i<r&&(s.length=i),this&&this!==jg&&this instanceof k&&(z=q||Gb(z)),z.apply(y,s)}var l=b&pe,m=b&ie,n=b&je,o=b&(le|me),p=b&re,q=n?Yd:Gb(a);return k}function Jb(a,b){b=b===Yd?" ":kb(b);var c=b.length;if(c<2)return c?fb(b,a):b;var d=fb(b,Sg(a/H(b)));return A(b)?nb(I(d),0,a).join(""):d.slice(0,a)}function Kb(a,b,c,d,e,f,g,h,i,j){var k=b&le,l=k?g:Yd,m=k?Yd:g,n=k?f:Yd,o=k?Yd:f;b|=k?ne:oe,(b&=~(k?oe:ne))&ke||(b&=~(ie|je));var p=[a,b,e,n,l,o,m,h,i,j],q=c.apply(Yd,p);return kc(a)&&yh(q,p),q.placeholder=d,vc(q,a,b)}function Lb(a){var b=Math[a];return function(a,c){if(a=wd(a),c=null==c?0:Yg(vd(c),292)){var d=(xd(a)+"e").split("e");return d=(xd(b(d[0]+"e"+(+d[1]+c)))+"e").split("e"),+(d[0]+"e"+(+d[1]-c))}return b(a)}}function Mb(a,b,c,d){return a===Yd||cd(a,xg[c])&&!Ag.call(d,c)?b:a}function Nb(a,b,c,d,e,f){var g=c&ge,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var l=-1,m=!0,n=c&he?new ia:Yd;for(f.set(a,b),f.set(b,a);++l<h;){var o=a[l],p=b[l];if(d)var q=g?d(p,o,l,b,a,f):d(o,p,l,a,b,f);if(q!==Yd){if(q)continue;m=!1;break}if(n){if(!k(b,function(a,b){if(!w(n,b)&&(o===a||e(o,a,c,d,f)))return n.push(b)})){m=!1;break}}else if(o!==p&&!e(o,p,c,d,f)){m=!1;break}}return f.delete(a),f.delete(b),m}function Ob(a,b,c,d,e,f,g){switch(c){case Ze:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)return!1;a=a.buffer,b=b.buffer;case Ye:return!(a.byteLength!=b.byteLength||!f(new Ig(a),new Ig(b)));case Ge:case He:case Ne:return cd(+a,+b);case Je:return a.name==b.name&&a.message==b.message;case Se:case Ue:return a==b+"";case Me:var h=C;case Te:var i=d&ge;if(h||(h=F),a.size!=b.size&&!i)return!1;var j=g.get(a);if(j)return j==b;d|=he,g.set(a,b);var k=Nb(h(a),h(b),d,e,f,g);return g.delete(a),k;case Ve:if(nh)return nh.call(a)==nh.call(b)}return!1}function Pb(a,b,c,d,e,f){var g=c&ge,h=Rb(a),i=h.length;if(i!=Rb(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:Ag.call(b,k)))return!1}var l=f.get(a);if(l&&f.get(b))return l==b;var m=!0;f.set(a,b),f.set(b,a);for(var n=g;++j<i;){k=h[j];var o=a[k],p=b[k];if(d)var q=g?d(p,o,k,b,a,f):d(o,p,k,a,b,f);if(!(q===Yd?o===p||e(o,p,c,d,f):q)){m=!1;break}n||(n="constructor"==k)}if(m&&!n){var r=a.constructor,s=b.constructor;r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s)&&(m=!1)}return f.delete(a),f.delete(b),m}function Qb(a){return zh(sc(a,Yd,Ec),a+"")}function Rb(a){return Ha(a,Cd,vh)}function Sb(a){return Ha(a,Dd,wh)}function Tb(a){for(var b=a.name+"",c=gh[b],d=Ag.call(gh,b)?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}function Ub(a){return(Ag.call(L,"placeholder")?L:a).placeholder}function Vb(){var a=L.iteratee||Qd;return a=a===Qd?Wa:a,arguments.length?a(arguments[0],arguments[1]):a}function Wb(a,b){var c=a.__data__;return jc(b)?c["string"==typeof b?"string":"hash"]:c.map}function Xb(a){for(var b=Cd(a),c=b.length;c--;){var d=b[c],e=a[d];b[c]=[d,e,nc(e)]}return b}function Yb(a,b){var c=z(a,b);return Ta(c)?c:Yd}function Zb(a){var b=Ag.call(a,Qg),c=a[Qg];try{a[Qg]=Yd;var d=!0}catch(a){}var e=Cg.call(a);return d&&(b?a[Qg]=c:delete a[Qg]),e}function $b(a,b,c){for(var d=-1,e=c.length;++d<e;){var f=c[d],g=f.size;switch(f.type){case"drop":a+=g;break;case"dropRight":b-=g;break;case"take":b=Yg(b,a+g);break;case"takeRight":a=Xg(a,b-g)}}return{start:a,end:b}}function _b(a){var b=a.match(wf);return b?b[1].split(xf):[]}function ac(a,b,c){b=mb(b,a);for(var d=-1,e=b.length,f=!1;++d<e;){var g=xc(b[d]);if(!(f=null!=a&&c(a,g)))break;a=a[g]}return f||++d!=e?f:!!(e=null==a?0:a.length)&&jd(e)&&gc(g,e)&&(Hh(a)||Gh(a))}function bc(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&Ag.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function cc(a){return"function"!=typeof a.constructor||mc(a)?{}:ph(Kg(a))}function dc(a,b,c){var d=a.constructor;switch(b){case Ye:return pb(a);case Ge:case He:return new d(+a);case Ze:return qb(a,c);case $e:case _e:case af:case bf:case cf:case df:case ef:case ff:case gf:return tb(a,c);case Me:return new d;case Ne:case Ue:return new d(a);case Se:return rb(a);case Te:return new d;case Ve:return sb(a)}}function ec(a,b){var c=b.length;if(!c)return a;var d=c-1;return b[d]=(c>1?"& ":"")+b[d],b=b.join(c>2?", ":" "),a.replace(vf,"{\n/* [wrapped with "+b+"] */\n")}function fc(a){return Hh(a)||Gh(a)||!!(Og&&a&&a[Og])}function gc(a,b){var c=typeof a;return!!(b=null==b?ye:b)&&("number"==c||"symbol"!=c&&Ff.test(a))&&a>-1&&a%1==0&&a<b}function hc(a,b,c){if(!kd(c))return!1;var d=typeof b;return!!("number"==d?dd(c)&&gc(b,c.length):"string"==d&&b in c)&&cd(c[b],a)}function ic(a,b){if(Hh(a))return!1;var c=typeof a;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=a&&!rd(a))||(rf.test(a)||!qf.test(a)||null!=b&&a in Object(b))}function jc(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a}function kc(a){var b=Tb(a),c=L[b];if("function"!=typeof c||!(b in O.prototype))return!1;if(a===c)return!0;var d=uh(c);return!!d&&a===d[0]}function lc(a){return!!Bg&&Bg in a}function mc(a){var b=a&&a.constructor;return a===("function"==typeof b&&b.prototype||xg)}function nc(a){return a===a&&!kd(a)}function oc(a,b){return function(c){return null!=c&&(c[a]===b&&(b!==Yd||a in Object(c)))}}function pc(a){var b=Zc(a,function(a){return c.size===be&&c.clear(),a}),c=b.cache;return b}function qc(a){var b=[];if(null!=a)for(var c in Object(a))b.push(c);return b}function rc(a){return Cg.call(a)}function sc(a,c,d){return c=Xg(c===Yd?a.length-1:c,0),function(){for(var e=arguments,f=-1,g=Xg(e.length-c,0),h=Array(g);++f<g;)h[f]=e[c+f];f=-1;for(var i=Array(c+1);++f<c;)i[f]=e[f];return i[c]=d(h),b(a,this,i)}}function tc(a,b){return b.length<2?a:Ga(a,ib(b,0,-1))}function uc(a,b){for(var c=a.length,d=Yg(b.length,c),e=yb(a);d--;){var f=b[d];a[d]=gc(f,c)?e[f]:Yd}return a}function vc(a,b,c){var d=b+"";return zh(a,ec(d,zc(_b(d),c)))}function wc(a){var b=0,c=0;return function(){var d=Zg(),e=te-(d-c);if(c=d,e>0){if(++b>=se)return arguments[0]}else b=0;return a.apply(Yd,arguments)}}function xc(a){if("string"==typeof a||rd(a))return a;var b=a+"";return"0"==b&&1/a==-xe?"-0":b}function yc(a){if(null!=a){try{return zg.call(a)}catch(a){}try{return a+""}catch(a){}}return""}function zc(a,b){return c(Ce,function(c){var d="_."+c[0];b&c[1]&&!f(a,d)&&a.push(d)}),a.sort()}function Ac(a){if(a instanceof O)return a.clone();var b=new N(a.__wrapped__,a.__chain__);return b.__actions__=yb(a.__actions__),b.__index__=a.__index__,b.__values__=a.__values__,b}function Bc(a){for(var b=-1,c=null==a?0:a.length,d=0,e=[];++b<c;){var f=a[b];f&&(e[d++]=f)}return e}function Cc(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===Yd?1:vd(b),ib(a,b<0?0:b,d)):[]}function Dc(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:vd(c);return e<0&&(e=Xg(d+e,0)),m(a,Vb(b,3),e)}function Ec(a){return(null==a?0:a.length)?Da(a,1):[]}function Fc(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:vd(c);return e<0&&(e=Xg(d+e,0)),n(a,b,e)}function Gc(a){var b=null==a?0:a.length;return b?a[b-1]:Yd}function Hc(a,b){return a&&a.length&&b&&b.length?eb(a,b):a}function Ic(a){return null==a?a:$g.call(a)}function Jc(a){var b=L(a);return b.__chain__=!0,b}function Kc(a,b){return b(a),a}function Lc(a,b){return b(a)}function Mc(){return Jc(this)}function Nc(){return new N(this.value(),this.__chain__)}function Oc(){this.__values__===Yd&&(this.__values__=td(this.value()));var a=this.__index__>=this.__values__.length;return{done:a,value:a?Yd:this.__values__[this.__index__++]}}function Pc(){return this}function Qc(a){for(var b,c=this;c instanceof M;){var d=Ac(c);d.__index__=0,d.__values__=Yd,b?e.__wrapped__=d:b=d;var e=d;c=c.__wrapped__}return e.__wrapped__=a,b}function Rc(){var a=this.__wrapped__;if(a instanceof O){var b=a;return this.__actions__.length&&(b=new O(this)),b=b.reverse(),b.__actions__.push({func:Lc,args:[Ic],thisArg:Yd}),new N(b,this.__chain__)}return this.thru(Ic)}function Sc(){return lb(this.__wrapped__,this.__actions__)}function Tc(a,b,c){var e=Hh(a)?d:Ba;return c&&hc(a,b,c)&&(b=Yd),e(a,Vb(b,3))}function Uc(a,b){return(Hh(a)?c:qh)(a,Vb(b,3))}function Vc(a,b,c,d){a=dd(a)?a:Gd(a),c=c&&!d?vd(c):0;var e=a.length;return c<0&&(c=Xg(e+c,0)),qd(a)?c<=e&&a.indexOf(b,c)>-1:!!e&&n(a,b,c)>-1}function Wc(a,b){return(Hh(a)?h:$a)(a,Vb(b,3))}function Xc(a,b,c){var d=Hh(a)?k:jb;return c&&hc(a,b,c)&&(b=Yd),d(a,Vb(b,3))}function Yc(a,b,c){function d(b){var c=m,d=n;return m=n=Yd,s=b,p=a.apply(d,c)}function e(a){return s=a,q=setTimeout(h,b),t?d(a):p}function f(a){var c=a-r,d=a-s,e=b-c;return u?Yg(e,o-d):e}function g(a){var c=a-r,d=a-s;return r===Yd||c>=b||c<0||u&&d>=o}function h(){var a=Fh();if(g(a))return i(a);q=setTimeout(h,f(a))}function i(a){return q=Yd,v&&m?d(a):(m=n=Yd,p)}function j(){q!==Yd&&clearTimeout(q),s=0,m=r=n=q=Yd}function k(){return q===Yd?p:i(Fh())}function l(){var a=Fh(),c=g(a);if(m=arguments,n=this,r=a,c){if(q===Yd)return e(r);if(u)return q=setTimeout(h,b),d(r)}return q===Yd&&(q=setTimeout(h,b)),p}var m,n,o,p,q,r,s=0,t=!1,u=!1,v=!0;if("function"!=typeof a)throw new TypeError(_d);return b=wd(b)||0,kd(c)&&(t=!!c.leading,u="maxWait"in c,o=u?Xg(wd(c.maxWait)||0,b):o,v="trailing"in c?!!c.trailing:v),l.cancel=j,l.flush=k,l}function Zc(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new TypeError(_d);var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(Zc.Cache||ca),c}function $c(a){if("function"!=typeof a)throw new TypeError(_d);return function(){var b=arguments;switch(b.length){case 0:return!a.call(this);case 1:return!a.call(this,b[0]);case 2:return!a.call(this,b[0],b[1]);case 3:return!a.call(this,b[0],b[1],b[2])}return!a.apply(this,b)}}function _c(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new TypeError(_d);return kd(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),Yc(a,b,{leading:d,maxWait:b,trailing:e})}function ad(a){return za(a,fe)}function bd(a){return za(a,de|fe)}function cd(a,b){return a===b||a!==a&&b!==b}function dd(a){return null!=a&&jd(a.length)&&!id(a)}function ed(a){return ld(a)&&dd(a)}function fd(a){return!0===a||!1===a||ld(a)&&Ia(a)==Ge}function gd(a){if(null==a)return!0;if(dd(a)&&(Hh(a)||"string"==typeof a||"function"==typeof a.splice||Ih(a)||Mh(a)||Gh(a)))return!a.length;var b=xh(a);if(b==Me||b==Te)return!a.size;if(mc(a))return!Xa(a).length;for(var c in a)if(Ag.call(a,c))return!1;return!0}function hd(a){if(!ld(a))return!1;var b=Ia(a);return b==Je||b==Ie||"string"==typeof a.message&&"string"==typeof a.name&&!pd(a)}function id(a){if(!kd(a))return!1;var b=Ia(a);return b==Ke||b==Le||b==Fe||b==Re}function jd(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=ye}function kd(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function ld(a){return null!=a&&"object"==typeof a}function md(a){return od(a)&&a!=+a}function nd(a){return null===a}function od(a){return"number"==typeof a||ld(a)&&Ia(a)==Ne}function pd(a){if(!ld(a)||Ia(a)!=Pe)return!1;var b=Kg(a);if(null===b)return!0;var c=Ag.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c instanceof c&&zg.call(c)==Dg}function qd(a){return"string"==typeof a||!Hh(a)&&ld(a)&&Ia(a)==Ue}function rd(a){return"symbol"==typeof a||ld(a)&&Ia(a)==Ve}function sd(a){return a===Yd}function td(a){if(!a)return[];if(dd(a))return qd(a)?I(a):yb(a);if(Pg&&a[Pg])return B(a[Pg]());var b=xh(a);return(b==Me?C:b==Te?F:Gd)(a)}function ud(a){if(!a)return 0===a?a:0;if((a=wd(a))===xe||a===-xe){return(a<0?-1:1)*ze}return a===a?a:0}function vd(a){var b=ud(a),c=b%1;return b===b?c?b-c:b:0}function wd(a){if("number"==typeof a)return a;if(rd(a))return Ae;if(kd(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=kd(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(uf,"");var c=Cf.test(a);return c||Ef.test(a)?gg(a.slice(2),c?2:8):Bf.test(a)?Ae:+a}function xd(a){return null==a?"":kb(a)}function yd(a,b){return a&&Ea(a,Vb(b,3))}function zd(a,b,c){var d=null==a?Yd:Ga(a,b);return d===Yd?c:d}function Ad(a,b){return null!=a&&ac(a,b,Ja)}function Bd(a,b){return null!=a&&ac(a,b,Ka)}function Cd(a){return dd(a)?ra(a):Xa(a)}function Dd(a){return dd(a)?ra(a,!0):Ya(a)}function Ed(a,b){return Fd(a,$c(Vb(b)))}function Fd(a,b){if(null==a)return{};var c=h(Sb(a),function(a){return[a]});return b=Vb(b),cb(a,c,function(a,c){return b(a,c[0])})}function Gd(a){return null==a?[]:v(a,Cd(a))}function Hd(a,b,c){return b=ud(b),c===Yd?(c=b,b=0):c=ud(c),a=wd(a),La(a,b,c)}function Id(a){return Qh(xd(a).toLowerCase())}function Jd(a,b,c){a=xd(a),b=kb(b);var d=a.length;c=c===Yd?d:ya(vd(c),0,d);var e=c;return(c-=b.length)>=0&&a.slice(c,e)==b}function Kd(a){return a=xd(a),a&&mf.test(a)?a.replace(lf,ug):a}function Ld(a,b,c){a=xd(a),b=vd(b);var d=b?H(a):0;return b&&d<b?Jb(b-d,c)+a:a}function Md(a,b,c){return a=xd(a),c=null==c?0:ya(vd(c),0,a.length),b=kb(b),a.slice(c,c+b.length)==b}function Nd(a,b,c){var d=L.templateSettings;c&&hc(a,b,c)&&(b=Yd),a=xd(a),b=Ph({},b,d,Mb);var e,f,g=Ph({},b.imports,d.imports,Mb),h=Cd(g),i=v(g,h),j=0,k=b.interpolate||Gf,l="__p += '",m=RegExp((b.escape||Gf).source+"|"+k.source+"|"+(k===pf?zf:Gf).source+"|"+(b.evaluate||Gf).source+"|$","g"),n="//# sourceURL="+("sourceURL"in b?b.sourceURL:"lodash.templateSources["+ ++bg+"]")+"\n";a.replace(m,function(b,c,d,g,h,i){return d||(d=g),l+=a.slice(j,i).replace(Hf,y),c&&(e=!0,l+="' +\n__e("+c+") +\n'"),h&&(f=!0,l+="';\n"+h+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var o=b.variable;o||(l="with (obj) {\n"+l+"\n}\n"),l=(f?l.replace(hf,""):l).replace(jf,"$1").replace(kf,"$1;"),l="function("+(o||"obj")+") {\n"+(o?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(e?", __e = _.escape":"")+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var p=Rh(function(){return Function(h,n+"return "+l).apply(Yd,i)});if(p.source=l,hd(p))throw p;return p}function Od(a){return function(){return a}}function Pd(a){return a}function Qd(a){return Wa("function"==typeof a?a:za(a,de))}function Rd(a,b,d){var e=Cd(b),f=Fa(b,e);null!=d||kd(b)&&(f.length||!e.length)||(d=b,b=a,a=this,f=Fa(b,Cd(b)));var g=!(kd(d)&&"chain"in d&&!d.chain),h=id(a);return c(f,function(c){var d=b[c];a[c]=d,h&&(a.prototype[c]=function(){var b=this.__chain__;if(g||b){var c=a(this.__wrapped__);return(c.__actions__=yb(this.__actions__)).push({func:d,args:arguments,thisArg:a}),c.__chain__=b,c}return d.apply(a,i([this.value()],arguments))})}),a}function Sd(){return jg._===this&&(jg._=Eg),this}function Td(){}function Ud(a){return ic(a)?q(xc(a)):db(a)}function Vd(){return[]}function Wd(){return!1}function Xd(a){return a&&a.length?Ca(a,Pd,Za):Yd}var Yd,Zd="4.17.5",$d=200,_d="Expected a function",ae="__lodash_hash_undefined__",be=500,ce="__lodash_placeholder__",de=1,ee=2,fe=4,ge=1,he=2,ie=1,je=2,ke=4,le=8,me=16,ne=32,oe=64,pe=128,qe=256,re=512,se=800,te=16,ue=1,ve=2,we=3,xe=1/0,ye=9007199254740991,ze=1.7976931348623157e308,Ae=NaN,Be=4294967295,Ce=[["ary",pe],["bind",ie],["bindKey",je],["curry",le],["curryRight",me],["flip",re],["partial",ne],["partialRight",oe],["rearg",qe]],De="[object Arguments]",Ee="[object Array]",Fe="[object AsyncFunction]",Ge="[object Boolean]",He="[object Date]",Ie="[object DOMException]",Je="[object Error]",Ke="[object Function]",Le="[object GeneratorFunction]",Me="[object Map]",Ne="[object Number]",Oe="[object Null]",Pe="[object Object]",Qe="[object Promise]",Re="[object Proxy]",Se="[object RegExp]",Te="[object Set]",Ue="[object String]",Ve="[object Symbol]",We="[object Undefined]",Xe="[object WeakMap]",Ye="[object ArrayBuffer]",Ze="[object DataView]",$e="[object Float32Array]",_e="[object Float64Array]",af="[object Int8Array]",bf="[object Int16Array]",cf="[object Int32Array]",df="[object Uint8Array]",ef="[object Uint8ClampedArray]",ff="[object Uint16Array]",gf="[object Uint32Array]",hf=/\b__p \+= '';/g,jf=/\b(__p \+=) '' \+/g,kf=/(__e\(.*?\)|\b__t\)) \+\n'';/g,lf=/[&<>"']/g,mf=RegExp(lf.source),nf=/<%-([\s\S]+?)%>/g,of=/<%([\s\S]+?)%>/g,pf=/<%=([\s\S]+?)%>/g,qf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rf=/^\w*$/,sf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tf=/[\\^$.*+?()[\]{}|]/g,uf=/^\s+|\s+$/g,vf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,wf=/\{\n\/\* \[wrapped with (.+)\] \*/,xf=/,? & /,yf=/\\(\\)?/g,zf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Af=/\w*$/,Bf=/^[-+]0x[0-9a-f]+$/i,Cf=/^0b[01]+$/i,Df=/^\[object .+?Constructor\]$/,Ef=/^0o[0-7]+$/i,Ff=/^(?:0|[1-9]\d*)$/,Gf=/($^)/,Hf=/['\n\r\u2028\u2029\\]/g,If="\\ud800-\\udfff",Jf="\\u0300-\\u036f",Kf="\\ufe20-\\ufe2f",Lf="\\u20d0-\\u20ff",Mf=Jf+Kf+Lf,Nf="\\ufe0e\\ufe0f",Of="["+If+"]",Pf="["+Mf+"]",Qf="\\ud83c[\\udffb-\\udfff]",Rf="(?:"+Pf+"|"+Qf+")",Sf="[^"+If+"]",Tf="(?:\\ud83c[\\udde6-\\uddff]){2}",Uf="[\\ud800-\\udbff][\\udc00-\\udfff]",Vf="\\u200d",Wf=Rf+"?",Xf="["+Nf+"]?",Yf="(?:"+Vf+"(?:"+[Sf,Tf,Uf].join("|")+")"+Xf+Wf+")*",Zf=Xf+Wf+Yf,$f="(?:"+[Sf+Pf+"?",Pf,Tf,Uf,Of].join("|")+")",_f=RegExp(Qf+"(?="+Qf+")|"+$f+Zf,"g"),ag=RegExp("["+Vf+If+Mf+Nf+"]"),bg=-1,cg={};cg[$e]=cg[_e]=cg[af]=cg[bf]=cg[cf]=cg[df]=cg[ef]=cg[ff]=cg[gf]=!0,cg[De]=cg[Ee]=cg[Ye]=cg[Ge]=cg[Ze]=cg[He]=cg[Je]=cg[Ke]=cg[Me]=cg[Ne]=cg[Pe]=cg[Se]=cg[Te]=cg[Ue]=cg[Xe]=!1;var dg={};dg[De]=dg[Ee]=dg[Ye]=dg[Ze]=dg[Ge]=dg[He]=dg[$e]=dg[_e]=dg[af]=dg[bf]=dg[cf]=dg[Me]=dg[Ne]=dg[Pe]=dg[Se]=dg[Te]=dg[Ue]=dg[Ve]=dg[df]=dg[ef]=dg[ff]=dg[gf]=!0,dg[Je]=dg[Ke]=dg[Xe]=!1;var eg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},fg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},gg=parseInt,hg="object"==typeof global&&global&&global.Object===Object&&global,ig="object"==typeof self&&self&&self.Object===Object&&self,jg=hg||ig||Function("return this")(),kg="object"==typeof exports&&exports&&!exports.nodeType&&exports,lg=kg&&"object"==typeof module&&module&&!module.nodeType&&module,mg=lg&&lg.exports===kg,ng=mg&&hg.process,og=function(){try{return ng&&ng.binding&&ng.binding("util")}catch(a){}}(),pg=og&&og.isDate,qg=og&&og.isMap,rg=og&&og.isSet,sg=og&&og.isTypedArray,tg=q("length"),ug=r(eg),vg=Array.prototype,wg=Function.prototype,xg=Object.prototype,yg=jg["__core-js_shared__"],zg=wg.toString,Ag=xg.hasOwnProperty,Bg=function(){var a=/[^.]+$/.exec(yg&&yg.keys&&yg.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),Cg=xg.toString,Dg=zg.call(Object),Eg=jg._,Fg=RegExp("^"+zg.call(Ag).replace(tf,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gg=mg?jg.Buffer:Yd,Hg=jg.Symbol,Ig=jg.Uint8Array,Jg=Gg?Gg.allocUnsafe:Yd,Kg=D(Object.getPrototypeOf,Object),Lg=Object.create,Mg=xg.propertyIsEnumerable,Ng=vg.splice,Og=Hg?Hg.isConcatSpreadable:Yd,Pg=Hg?Hg.iterator:Yd,Qg=Hg?Hg.toStringTag:Yd,Rg=function(){try{var a=Yb(Object,"defineProperty");return a({},"",{}),a}catch(a){}}(),Sg=Math.ceil,Tg=Math.floor,Ug=Object.getOwnPropertySymbols,Vg=Gg?Gg.isBuffer:Yd,Wg=D(Object.keys,Object),Xg=Math.max,Yg=Math.min,Zg=Date.now,$g=vg.reverse,_g=Yb(jg,"DataView"),ah=Yb(jg,"Map"),bh=Yb(jg,"Promise"),ch=Yb(jg,"Set"),dh=Yb(jg,"WeakMap"),eh=Yb(Object,"create"),fh=dh&&new dh,gh={},hh=yc(_g),ih=yc(ah),jh=yc(bh),kh=yc(ch),lh=yc(dh),mh=Hg?Hg.prototype:Yd,nh=mh?mh.valueOf:Yd,oh=mh?mh.toString:Yd,ph=function(){function a(){}return function(b){if(!kd(b))return{};if(Lg)return Lg(b);a.prototype=b;var c=new a;return a.prototype=Yd,c}}();L.templateSettings={escape:nf,evaluate:of,interpolate:pf,variable:"",imports:{_:L}},L.prototype=M.prototype,L.prototype.constructor=L,N.prototype=ph(M.prototype),N.prototype.constructor=N,O.prototype=ph(M.prototype),O.prototype.constructor=O,S.prototype.clear=T,S.prototype.delete=U,S.prototype.get=V,S.prototype.has=W,S.prototype.set=X,Y.prototype.clear=Z,Y.prototype.delete=$,Y.prototype.get=_,Y.prototype.has=aa,Y.prototype.set=ba,ca.prototype.clear=da,ca.prototype.delete=ea,ca.prototype.get=fa,ca.prototype.has=ga,ca.prototype.set=ha,ia.prototype.add=ia.prototype.push=ja,ia.prototype.has=ka,la.prototype.clear=ma,la.prototype.delete=na,la.prototype.get=oa,la.prototype.has=pa,la.prototype.set=qa;var qh=Db(Ea),rh=Eb(),sh=fh?function(a,b){return fh.set(a,b),a}:Pd,th=Rg?function(a,b){return Rg(a,"toString",{configurable:!0,enumerable:!1,value:Od(b),writable:!0})}:Pd,uh=fh?function(a){return fh.get(a)}:Td,vh=Ug?function(a){return null==a?[]:(a=Object(a),e(Ug(a),function(b){return Mg.call(a,b)}))}:Vd,wh=Ug?function(a){for(var b=[];a;)i(b,vh(a)),a=Kg(a);return b}:Vd,xh=Ia;(_g&&xh(new _g(new ArrayBuffer(1)))!=Ze||ah&&xh(new ah)!=Me||bh&&xh(bh.resolve())!=Qe||ch&&xh(new ch)!=Te||dh&&xh(new dh)!=Xe)&&(xh=function(a){var b=Ia(a),c=b==Pe?a.constructor:Yd,d=c?yc(c):"";if(d)switch(d){case hh:return Ze;case ih:return Me;case jh:return Qe;case kh:return Te;case lh:return Xe}return b});var yh=wc(sh),zh=wc(th),Ah=pc(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(sf,function(a,c,d,e){b.push(d?e.replace(yf,"$1"):c||a)}),b}),Bh=gb(Hc),Ch=gb(function(a,b){return ed(a)?Aa(a,b):[]}),Dh=(Qb(function(a){var b=a.length,c=b?a[0]:0,d=this.__wrapped__,e=function(b){return xa(b,a)};return!(b>1||this.__actions__.length)&&d instanceof O&&gc(c)?(d=d.slice(c,+c+(b?1:0)),d.__actions__.push({func:Lc,args:[e],thisArg:Yd}),new N(d,this.__chain__).thru(function(a){return b&&!a.length&&a.push(Yd),a})):this.thru(e)}),Hb(Dc)),Eh=gb(function(a,b){if(null==a)return[];var c=b.length;return c>1&&hc(a,b[0],b[1])?b=[]:c>2&&hc(b[0],b[1],b[2])&&(b=[b[0]]),bb(a,Da(b,1),[])}),Fh=function(){return jg.Date.now()};Zc.Cache=ca;var Gh=Na(function(){return arguments}())?Na:function(a){return ld(a)&&Ag.call(a,"callee")&&!Mg.call(a,"callee")},Hh=Array.isArray,Ih=Vg||Wd,Jh=pg?u(pg):Oa,Kh=qg?u(qg):Ra,Lh=rg?u(rg):Ua,Mh=sg?u(sg):Va,Nh=Cb(function(a,b){if(mc(b)||dd(b))return void zb(b,Cd(b),a);for(var c in b)Ag.call(b,c)&&sa(a,c,b[c])}),Oh=Cb(function(a,b){zb(b,Dd(b),a)}),Ph=Cb(function(a,b,c,d){zb(b,Dd(b),a,d)}),Qh=Fb("toUpperCase"),Rh=gb(function(a,c){try{return b(a,Yd,c)}catch(a){return hd(a)?a:new Error(a)}}),Sh=Lb("round");L.assign=Nh,L.assignIn=Oh,L.assignInWith=Ph,L.chain=Jc,L.compact=Bc,L.constant=Od,L.debounce=Yc,L.drop=Cc,L.flatten=Ec,L.iteratee=Qd,L.keys=Cd,L.keysIn=Dd,L.map=Wc,L.memoize=Zc,L.mixin=Rd,L.negate=$c,L.omitBy=Ed,L.pickBy=Fd,L.property=Ud,L.pull=Bh,L.pullAll=Hc,L.reverse=Ic,L.sortBy=Eh,L.tap=Kc,L.throttle=_c,L.thru=Lc,L.toArray=td,L.values=Gd,L.without=Ch,L.extend=Oh,L.extendWith=Ph,Rd(L,L),L.attempt=Rh,L.capitalize=Id,L.clone=ad,L.cloneDeep=bd,L.endsWith=Jd,L.eq=cd,L.escape=Kd,L.every=Tc,L.find=Dh,L.findIndex=Dc,L.forEach=Uc,L.forOwn=yd,L.get=zd,L.has=Ad,L.hasIn=Bd,L.identity=Pd,L.includes=Vc,L.indexOf=Fc,L.inRange=Hd,L.isArguments=Gh,L.isArray=Hh,L.isArrayLike=dd,L.isArrayLikeObject=ed,L.isBoolean=fd,L.isBuffer=Ih,L.isDate=Jh,L.isEmpty=gd,L.isError=hd,L.isFunction=id,L.isLength=jd,L.isMap=Kh,L.isNaN=md,L.isNull=nd,L.isNumber=od,L.isObject=kd,L.isObjectLike=ld,L.isPlainObject=pd,L.isSet=Lh,L.isString=qd,L.isSymbol=rd,L.isTypedArray=Mh,L.isUndefined=sd,L.last=Gc,L.min=Xd,L.stubArray=Vd,L.stubFalse=Wd,L.noConflict=Sd,L.noop=Td,L.now=Fh,L.padStart=Ld,L.round=Sh,L.some=Xc,L.startsWith=Md,L.template=Nd,L.toFinite=ud,L.toInteger=vd,L.toNumber=wd,L.toString=xd,L.upperFirst=Qh,L.each=Uc,Rd(L,function(){var a={};return Ea(L,function(b,c){Ag.call(L.prototype,c)||(a[c]=b)}),a}(),{chain:!1}),L.VERSION=Zd,c(["drop","take"],function(a,b){O.prototype[a]=function(c){c=c===Yd?1:Xg(vd(c),0);var d=this.__filtered__&&!b?new O(this):this.clone();return d.__filtered__?d.__takeCount__=Yg(c,d.__takeCount__):d.__views__.push({size:Yg(c,Be),type:a+(d.__dir__<0?"Right":"")}),d},O.prototype[a+"Right"]=function(b){return this.reverse()[a](b).reverse()}}),c(["filter","map","takeWhile"],function(a,b){var c=b+1,d=c==ue||c==we;O.prototype[a]=function(a){var b=this.clone();return b.__iteratees__.push({iteratee:Vb(a,3),type:c}),b.__filtered__=b.__filtered__||d,b}}),c(["head","last"],function(a,b){var c="take"+(b?"Right":"");O.prototype[a]=function(){return this[c](1).value()[0]}}),c(["initial","tail"],function(a,b){var c="drop"+(b?"":"Right");O.prototype[a]=function(){return this.__filtered__?new O(this):this[c](1)}}),O.prototype.compact=function(){return this.filter(Pd)},O.prototype.find=function(a){return this.filter(a).head()},O.prototype.findLast=function(a){return this.reverse().find(a)},O.prototype.invokeMap=gb(function(a,b){return"function"==typeof a?new O(this):this.map(function(c){return Ma(c,a,b)})}),O.prototype.reject=function(a){return this.filter($c(Vb(a)))},O.prototype.slice=function(a,b){a=vd(a);var c=this;return c.__filtered__&&(a>0||b<0)?new O(c):(a<0?c=c.takeRight(-a):a&&(c=c.drop(a)),b!==Yd&&(b=vd(b),c=b<0?c.dropRight(-b):c.take(b-a)),c)},O.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},O.prototype.toArray=function(){return this.take(Be)},Ea(O.prototype,function(a,b){var c=/^(?:filter|find|map|reject)|While$/.test(b),d=/^(?:head|last)$/.test(b),e=L[d?"take"+("last"==b?"Right":""):b],f=d||/^find/.test(b);e&&(L.prototype[b]=function(){var b=this.__wrapped__,g=d?[1]:arguments,h=b instanceof O,j=g[0],k=h||Hh(b),l=function(a){var b=e.apply(L,i([a],g));return d&&m?b[0]:b};k&&c&&"function"==typeof j&&1!=j.length&&(h=k=!1);var m=this.__chain__,n=!!this.__actions__.length,o=f&&!m,p=h&&!n;if(!f&&k){b=p?b:new O(this);var q=a.apply(b,g);return q.__actions__.push({func:Lc,args:[l],thisArg:Yd}),new N(q,m)}return o&&p?a.apply(this,g):(q=this.thru(l),o?d?q.value()[0]:q.value():q)})}),c(["pop","push","shift","sort","splice","unshift"],function(a){var b=vg[a],c=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",d=/^(?:pop|shift)$/.test(a);L.prototype[a]=function(){var a=arguments;if(d&&!this.__chain__){var e=this.value();return b.apply(Hh(e)?e:[],a)}return this[c](function(c){return b.apply(Hh(c)?c:[],a)})}}),Ea(O.prototype,function(a,b){var c=L[b];if(c){var d=c.name+"";(gh[d]||(gh[d]=[])).push({name:b,func:c})}}),gh[Ib(Yd,je).name]=[{name:"wrapper",func:Yd}],O.prototype.clone=P,O.prototype.reverse=Q,O.prototype.value=R,L.prototype.chain=Mc,L.prototype.commit=Nc,L.prototype.next=Oc,L.prototype.plant=Qc,L.prototype.reverse=Rc,L.prototype.toJSON=L.prototype.valueOf=L.prototype.value=Sc,L.prototype.first=L.prototype.head,Pg&&(L.prototype[Pg]=Pc),"function"==typeof a&&"object"==typeof a.amd&&a.amd?(jg._=L,a(function(){return L})):lg?((lg.exports=L)._=L,kg._=L):jg._=L}).call(this),"undefined"!=typeof window&&function(b,c){"object"==typeof exports&&"object"==typeof module?module.exports=c():"function"==typeof a&&a.amd?a([],c):"object"==typeof exports?exports.Hls=c():b.Hls=c()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:d})},b.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},b.t=function(a,c){if(1&c&&(a=b(a)),8&c)return a;if(4&c&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(b.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&c&&"string"!=typeof a)for(var e in a)b.d(d,e,function(b){return a[b]}.bind(null,e));return d},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/dist/",b(b.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(a,b,c){"use strict";function d(){}function e(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function f(a,b,c,d,f){if("function"!=typeof c)throw new TypeError("The listener must be a function");var g=new e(c,d||a,f),h=j?j+b:b;return a._events[h]?a._events[h].fn?a._events[h]=[a._events[h],g]:a._events[h].push(g):(a._events[h]=g,a._eventsCount++),a}function g(a,b){0==--a._eventsCount?a._events=new d:delete a._events[b]}function h(){this._events=new d,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,j="~";Object.create&&(d.prototype=Object.create(null),(new d).__proto__||(j=!1)),h.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)i.call(a,b)&&c.push(j?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},h.prototype.listeners=function(a){var b=j?j+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=new Array(e);d<e;d++)f[d]=c[d].fn;return f},h.prototype.listenerCount=function(a){var b=j?j+a:a,c=this._events[b];return c?c.fn?1:c.length:0},h.prototype.emit=function(a,b,c,d,e,f){var g=j?j+a:a;if(!this._events[g])return!1;var h,i,k=this._events[g],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,e),!0;case 6:return k.fn.call(k.context,b,c,d,e,f),!0}for(i=1,h=new Array(l-1);i<l;i++)h[i-1]=arguments[i];k.fn.apply(k.context,h)}else{var m,n=k.length;for(i=0;i<n;i++)switch(k[i].once&&this.removeListener(a,k[i].fn,void 0,!0),l){case 1:k[i].fn.call(k[i].context);break;case 2:k[i].fn.call(k[i].context,b);break;case 3:k[i].fn.call(k[i].context,b,c);break;case 4:k[i].fn.call(k[i].context,b,c,d);break;default:if(!h)for(m=1,h=new Array(l-1);m<l;m++)h[m-1]=arguments[m];k[i].fn.apply(k[i].context,h)}}return!0},h.prototype.on=function(a,b,c){return f(this,a,b,c,!1)},h.prototype.once=function(a,b,c){return f(this,a,b,c,!0)},h.prototype.removeListener=function(a,b,c,d){var e=j?j+a:a;if(!this._events[e])return this;if(!b)return g(this,e),this;var f=this._events[e];if(f.fn)f.fn!==b||d&&!f.once||c&&f.context!==c||g(this,e);else{for(var h=0,i=[],k=f.length;h<k;h++)(f[h].fn!==b||d&&!f[h].once||c&&f[h].context!==c)&&i.push(f[h]);i.length?this._events[e]=1===i.length?i[0]:i:g(this,e)}return this},h.prototype.removeAllListeners=function(a){var b;return a?(b=j?j+a:a,this._events[b]&&g(this,b)):(this._events=new d,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=j,h.EventEmitter=h,a.exports=h},"./node_modules/url-toolkit/src/url-toolkit.js":function(a,b,c){!function(b){var c=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,d=/^([^\/?#]*)([^]*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,g={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),!(b=b.trim())){if(!c.alwaysNormalize)return a;var e=g.parseURL(a);if(!e)throw new Error("Error trying to parse base URL.");return e.path=g.normalizePath(e.path),g.buildURLFromParts(e)}var f=g.parseURL(b);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=g.normalizePath(f.path),g.buildURLFromParts(f)):b;var h=g.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var i=d.exec(h.path);h.netLoc=i[1],h.path=i[2]}h.netLoc&&!h.path&&(h.path="/");var j={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(j.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var k=h.path,l=k.substring(0,k.lastIndexOf("/")+1)+f.path;j.path=g.normalizePath(l)}else j.path=h.path,f.params||(j.params=h.params,f.query||(j.query=h.query));return null===j.path&&(j.path=c.alwaysNormalize?g.normalizePath(f.path):f.path),g.buildURLFromParts(j)},parseURL:function(a){var b=c.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};a.exports=g}()},"./node_modules/webworkify-webpack/index.js":function(a,b,c){function d(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/",b.oe=function(a){throw console.error(a),a};var d=b(b.s=ENTRY_MODULE);return d.default||d}function e(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(a){return!isNaN(1*a)}function g(a,b,d){var g={};g[d]=[];var h=b.toString(),i=h.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return g;for(var l,m=i[1],n=new RegExp("(\\\\n|\\W)"+e(m)+k,"g");l=n.exec(h);)"dll-reference"!==l[3]&&g[d].push(l[3]);for(n=new RegExp("\\("+e(m)+'\\("(dll-reference\\s('+j+'))"\\)\\)'+k,"g");l=n.exec(h);)a[l[2]]||(g[d].push(l[1]),a[l[2]]=c(l[1]).m),g[l[2]]=g[l[2]]||[],g[l[2]].push(l[4]);for(var o=Object.keys(g),p=0;p<o.length;p++)for(var q=0;q<g[o[p]].length;q++)f(g[o[p]][q])&&(g[o[p]][q]=1*g[o[p]][q]);return g}function h(a){return Object.keys(a).reduce(function(b,c){return b||a[c].length>0},!1)}function i(a,b){for(var c={main:[b]},d={main:[]},e={main:{}};h(c);)for(var f=Object.keys(c),i=0;i<f.length;i++){var j=f[i],k=c[j],l=k.pop();if(e[j]=e[j]||{},!e[j][l]&&a[j][l]){e[j][l]=!0,d[j]=d[j]||[],d[j].push(l);for(var m=g(a,a[j][l],j),n=Object.keys(m),o=0;o<n.length;o++)c[n[o]]=c[n[o]]||[],c[n[o]]=c[n[o]].concat(m[n[o]])}}return d}var j="[\\.|\\-|\\+|\\w|/|@]+",k="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+j+").*?\\)";a.exports=function(a,b){b=b||{};var e={main:c.m},f=b.all?{main:Object.keys(e.main)}:i(e,a),g="";Object.keys(f).filter(function(a){return"main"!==a}).forEach(function(a){for(var b=0;f[a][b];)b++;f[a].push(b),e[a][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+a+" = ("+d.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+f[a].map(function(b){return JSON.stringify(b)+": "+e[a][b].toString()}).join(",")+"});\n"}),g=g+"new (("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.main.map(function(a){return JSON.stringify(a)+": "+e.main[a].toString()}).join(",")+"}))(self);";var h=new window.Blob([g],{type:"text/javascript"});if(b.bare)return h;var j=window.URL||window.webkitURL||window.mozURL||window.msURL,k=j.createObjectURL(h),l=new window.Worker(k);return l.objectURL=k,l}},"./src/config.ts":function(a,b,c){"use strict";function d(){return d=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},d.apply(this,arguments)}function e(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function f(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?e(Object(c),!0).forEach(function(b){g(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):e(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function g(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function h(){return{cueHandler:w.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function i(a,b){if((b.liveSyncDurationCount||b.liveMaxLatencyDurationCount)&&(b.liveSyncDuration||b.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==b.liveMaxLatencyDurationCount&&(void 0===b.liveSyncDurationCount||b.liveMaxLatencyDurationCount<=b.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==b.liveMaxLatencyDuration&&(void 0===b.liveSyncDuration||b.liveMaxLatencyDuration<=b.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return d({},a,b)}function j(a){var b=a.loader;if(b!==v.default&&b!==u.default)y.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{Object(v.fetchSupported)()&&(a.loader=v.default,a.progressive=!0,a.enableSoftwareAES=!0,y.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}c.r(b),c.d(b,"hlsDefaultConfig",function(){return z}),c.d(b,"mergeConfig",function(){return i}),c.d(b,"enableStreamingMode",function(){return j});var k=c("./src/controller/abr-controller.ts"),l=c("./src/controller/audio-stream-controller.ts"),m=c("./src/controller/audio-track-controller.ts"),n=c("./src/controller/subtitle-stream-controller.ts"),o=c("./src/controller/subtitle-track-controller.ts"),p=c("./src/controller/buffer-controller.ts"),q=c("./src/controller/timeline-controller.ts"),r=c("./src/controller/cap-level-controller.ts"),s=c("./src/controller/fps-controller.ts"),t=c("./src/controller/eme-controller.ts"),u=c("./src/utils/xhr-loader.ts"),v=c("./src/utils/fetch-loader.ts"),w=c("./src/utils/cues.ts"),x=c("./src/utils/mediakeys-helper.ts"),y=c("./src/utils/logger.ts"),z=f(f({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:u.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:k.default,bufferController:p.default,capLevelController:r.default,fpsController:s.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:x.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},h()),{},{subtitleStreamController:n.SubtitleStreamController,subtitleTrackController:o.default,timelineController:q.TimelineController,audioStreamController:l.default,audioTrackController:m.default,emeController:t.default})},"./src/controller/abr-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}c.r(b);var f=c("./src/polyfills/number.ts"),g=c("./src/utils/ewma-bandwidth-estimator.ts"),h=c("./src/events.ts"),i=c("./src/utils/buffer-helper.ts"),j=c("./src/errors.ts"),k=c("./src/types/loader.ts"),l=c("./src/utils/logger.ts"),m=function(){function a(a){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=a;var b=a.config;this.bwEstimator=new g.default(b.abrEwmaSlowVoD,b.abrEwmaFastVoD,b.abrEwmaDefaultEstimate),this.registerListeners()}var b=a.prototype;return b.registerListeners=function(){var a=this.hls;a.on(h.Events.FRAG_LOADING,this.onFragLoading,this),a.on(h.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(h.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(h.Events.ERROR,this.onError,this)},b.unregisterListeners=function(){var a=this.hls;a.off(h.Events.FRAG_LOADING,this.onFragLoading,this),a.off(h.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(h.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(h.Events.ERROR,this.onError,this)},b.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},b.onFragLoading=function(a,b){var c=b.frag;if(c.type===k.PlaylistLevelType.MAIN&&!this.timer){var d;this.fragCurrent=c,this.partCurrent=null!=(d=b.part)?d:null,this.timer=self.setInterval(this.onCheck,100)}},b.onLevelLoaded=function(a,b){var c=this.hls.config;b.details.live?this.bwEstimator.update(c.abrEwmaSlowLive,c.abrEwmaFastLive):this.bwEstimator.update(c.abrEwmaSlowVoD,c.abrEwmaFastVoD)},b._abandonRulesCheck=function(){var a=this.fragCurrent,b=this.partCurrent,c=this.hls,d=c.autoLevelEnabled,e=c.config,g=c.media;if(a&&g){var j=b?b.stats:a.stats,k=b?b.duration:a.duration;if(j.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(d&&!g.paused&&g.playbackRate&&g.readyState){var m=performance.now()-j.loading.start,n=Math.abs(g.playbackRate);if(!(m<=500*k/n)){var o=c.levels,p=c.minAutoLevel,q=o[a.level],r=j.total||Math.max(j.loaded,Math.round(k*q.maxBitrate/8)),s=Math.max(1,j.bwEstimate?j.bwEstimate/8:1e3*j.loaded/m),t=(r-j.loaded)/s,u=g.currentTime,v=(i.BufferHelper.bufferInfo(g,u,e.maxBufferHole).end-u)/n;if(!(v>=2*k/n||t<=v)){var w,x=Number.POSITIVE_INFINITY;for(w=a.level-1;w>p;w--){if((x=k*o[w].maxBitrate/(6.4*s))<v)break}if(!(x>=t)){var y=this.bwEstimator.getEstimate();l.logger.warn("Fragment "+a.sn+(b?" part "+b.index:"")+" of level "+a.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+w+"\n      Current BW estimate: "+(Object(f.isFiniteNumber)(y)?(y/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+t.toFixed(3)+" s\n      Estimated load time for the next fragment: "+x.toFixed(3)+" s\n      Time to underbuffer: "+v.toFixed(3)+" s"),c.nextLoadLevel=w,this.bwEstimator.sample(m,j.loaded),this.clearTimer(),a.loader&&(this.fragCurrent=this.partCurrent=null,a.loader.abort()),c.trigger(h.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:b,stats:j})}}}}}},b.onFragLoaded=function(a,b){var c=b.frag,d=b.part;if(c.type===k.PlaylistLevelType.MAIN&&Object(f.isFiniteNumber)(c.sn)){var e=d?d.stats:c.stats,g=d?d.duration:c.duration;if(this.clearTimer(),this.lastLoadedFragLevel=c.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[c.level],j=(i.loaded?i.loaded.bytes:0)+e.loaded,l=(i.loaded?i.loaded.duration:0)+g;i.loaded={bytes:j,duration:l},i.realBitrate=Math.round(8*j/l)}if(c.bitrateTest){var m={stats:e,frag:c,part:d,id:c.type};this.onFragBuffered(h.Events.FRAG_BUFFERED,m),c.bitrateTest=!1}}},b.onFragBuffered=function(a,b){var c=b.frag,d=b.part,e=d?d.stats:c.stats;if(!e.aborted&&c.type===k.PlaylistLevelType.MAIN&&"initSegment"!==c.sn){var f=e.parsing.end-e.loading.start;this.bwEstimator.sample(f,e.loaded),e.bwEstimate=this.bwEstimator.getEstimate(),c.bitrateTest?this.bitrateTestDelay=f/1e3:this.bitrateTestDelay=0}},b.onError=function(a,b){switch(b.details){case j.ErrorDetails.FRAG_LOAD_ERROR:case j.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},b.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},b.getNextABRAutoLevel=function(){var a=this.fragCurrent,b=this.partCurrent,c=this.hls,d=c.maxAutoLevel,e=c.config,f=c.minAutoLevel,g=c.media,h=b?b.duration:a?a.duration:0,j=g?g.currentTime:0,k=g&&0!==g.playbackRate?Math.abs(g.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():e.abrEwmaDefaultEstimate,n=(i.BufferHelper.bufferInfo(g,j,e.maxBufferHole).end-j)/k,o=this.findBestLevel(m,f,d,n,e.abrBandWidthFactor,e.abrBandWidthUpFactor);if(o>=0)return o;l.logger.trace((n?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=h?Math.min(h,e.maxStarvationDelay):e.maxStarvationDelay,q=e.abrBandWidthFactor,r=e.abrBandWidthUpFactor;if(!n){var s=this.bitrateTestDelay;if(s){p=(h?Math.min(h,e.maxLoadingDelay):e.maxLoadingDelay)-s,l.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),q=r=1}}return o=this.findBestLevel(m,f,d,n+p,q,r),Math.max(o,0)},b.findBestLevel=function(a,b,c,d,e,f){for(var g,h=this.fragCurrent,i=this.partCurrent,j=this.lastLoadedFragLevel,k=this.hls.levels,m=k[j],n=!(null===m||void 0===m||null===(g=m.details)||void 0===g||!g.live),o=null===m||void 0===m?void 0:m.codecSet,p=i?i.duration:h?h.duration:0,q=c;q>=b;q--){var r=k[q];if(r&&(!o||r.codecSet===o)){var s=r.details,t=(i?null===s||void 0===s?void 0:s.partTarget:null===s||void 0===s?void 0:s.averagetargetduration)||p,u=void 0;u=q<=j?e*a:f*a;var v=k[q].maxBitrate,w=v*t/u;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+q+"/"+Math.round(u)+"/"+v+"/"+t+"/"+d+"/"+w),u>v&&(!w||n&&!this.bitrateTestDelay||w<d))return q}}return-1},e(a,[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this.bwEstimator;if(!(-1===a||b&&b.canEstimate()))return a;var c=this.getNextABRAutoLevel();return-1!==a&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a}}]),a}();b.default=m},"./src/controller/audio-stream-controller.ts":function(a,b,c){"use strict";function d(){return d=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},d.apply(this,arguments)}function e(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,f(a,b)}function f(a,b){return(f=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b);var g=c("./src/polyfills/number.ts"),h=c("./src/controller/base-stream-controller.ts"),i=c("./src/events.ts"),j=c("./src/utils/buffer-helper.ts"),k=c("./src/controller/fragment-tracker.ts"),l=c("./src/types/level.ts"),m=c("./src/types/loader.ts"),n=c("./src/loader/fragment.ts"),o=c("./src/demux/chunk-cache.ts"),p=c("./src/demux/transmuxer-interface.ts"),q=c("./src/types/transmuxer.ts"),r=c("./src/controller/fragment-finders.ts"),s=c("./src/utils/discontinuities.ts"),t=c("./src/errors.ts"),u=c("./src/utils/logger.ts"),v=100,w=function(a){function b(b,c){var d;return d=a.call(this,b,c,"[audio-stream-controller]")||this,d.videoBuffer=null,d.videoTrackCC=-1,d.waitingVideoCC=-1,d.audioSwitch=!1,d.trackId=-1,d.waitingData=null,d.mainDetails=null,d.bufferFlushed=!1,d._registerListeners(),d}e(b,a);var c=b.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var a=this.hls;a.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(i.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(i.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(i.Events.ERROR,this.onError,this),a.on(i.Events.BUFFER_RESET,this.onBufferReset,this),a.on(i.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(i.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c._unregisterListeners=function(){var a=this.hls;a.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(i.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(i.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(i.Events.ERROR,this.onError,this),a.off(i.Events.BUFFER_RESET,this.onBufferReset,this),a.off(i.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(i.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c.onInitPtsFound=function(a,b){var c=b.frag,d=b.id,e=b.initPTS;if("main"===d){var f=c.cc;this.initPTS[c.cc]=e,this.log("InitPTS for cc: "+f+" found from main: "+e),this.videoTrackCC=f,this.state===h.State.WAITING_INIT_PTS&&this.tick()}},c.startLoad=function(a){if(!this.levels)return this.startPosition=a,void(this.state=h.State.STOPPED);var b=this.lastCurrentTime;this.stopLoad(),this.setInterval(v),this.fragLoadError=0,b>0&&-1===a?(this.log("Override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=h.State.IDLE):(this.loadedmetadata=!1,this.state=h.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},c.doTick=function(){switch(this.state){case h.State.IDLE:this.doTickIdle();break;case h.State.WAITING_TRACK:var b,c=this.levels,d=this.trackId,e=null===c||void 0===c?void 0:null===(b=c[d])||void 0===b?void 0:b.details;if(e){if(this.waitForCdnTuneIn(e))break;this.state=h.State.WAITING_INIT_PTS}break;case h.State.FRAG_LOADING_WAITING_RETRY:var f,g=performance.now(),i=this.retryDate;(!i||g>=i||null!==(f=this.media)&&void 0!==f&&f.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=h.State.IDLE);break;case h.State.WAITING_INIT_PTS:var k=this.waitingData;if(k){var l=k.frag,m=k.part,n=k.cache,o=k.complete;if(void 0!==this.initPTS[l.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=h.State.FRAG_LOADING;var p=n.flush(),q={frag:l,part:m,payload:p,networkDetails:null};this._handleFragmentLoadProgress(q),o&&a.prototype._handleFragmentLoadComplete.call(this,q)}else if(this.videoTrackCC!==this.waitingVideoCC)u.logger.log("Waiting fragment cc ("+l.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var s=this.getLoadPosition(),t=j.BufferHelper.bufferInfo(this.mediaBuffer,s,this.config.maxBufferHole),v=Object(r.fragmentWithinToleranceTest)(t.end,this.config.maxFragLookUpTolerance,l);v<0&&(u.logger.log("Waiting fragment cc ("+l.cc+") @ "+l.start+" cancelled because another fragment at "+t.end+" is needed"),this.clearWaitingFragment())}}else this.state=h.State.IDLE}this.onTickEnd()},c.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=h.State.IDLE)},c.onTickEnd=function(){var a=this.media;if(a&&a.readyState){var b=this.mediaBuffer?this.mediaBuffer:a,c=b.buffered;!this.loadedmetadata&&c.length&&(this.loadedmetadata=!0),this.lastCurrentTime=a.currentTime}},c.doTickIdle=function(){var a,b,c=this.hls,d=this.levels,e=this.media,f=this.trackId,g=c.config;if(d&&d[f]&&(e||!this.startFragRequested&&g.startFragPrefetch)){var j=d[f],k=j.details;if(!k||k.live&&this.levelLastLoaded!==f||this.waitForCdnTuneIn(k))return void(this.state=h.State.WAITING_TRACK);this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,n.ElementaryStreamTypes.AUDIO,m.PlaylistLevelType.AUDIO));var l=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,m.PlaylistLevelType.AUDIO);if(null!==l){var o=l.len,p=this.getMaxBufferLength(),q=this.audioSwitch;if(!(o>=p)||q){if(!q&&this._streamEnded(l,k))return c.trigger(i.Events.BUFFER_EOS,{type:"audio"}),void(this.state=h.State.ENDED);var r=k.fragments,s=r[0].start,t=l.end;if(q){var u=this.getLoadPosition();t=u,k.PTSKnown&&u<s&&(l.end>s||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=s+.05)}var v=this.getNextFragment(t,k);if(!v)return void(this.bufferFlushed=!0);"identity"!==(null===(a=v.decryptdata)||void 0===a?void 0:a.keyFormat)||null!==(b=v.decryptdata)&&void 0!==b&&b.key?this.loadFragment(v,k,t):this.loadKey(v,k)}}}},c.getMaxBufferLength=function(){var b=a.prototype.getMaxBufferLength.call(this),c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,m.PlaylistLevelType.MAIN);return null===c?b:Math.max(b,c.len)},c.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},c.onAudioTracksUpdated=function(a,b){var c=b.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(a){return new l.Level(a)})},c.onAudioTrackSwitching=function(a,b){var c=!!b.url;this.trackId=b.id;var d=this.fragCurrent;null!==d&&void 0!==d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(v):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=h.State.IDLE):this.state=h.State.STOPPED,this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},c.onLevelLoaded=function(a,b){this.mainDetails=b.details},c.onAudioTrackLoaded=function(a,b){var c,d=this.levels,e=b.details,f=b.id;if(!d)return void this.warn("Audio tracks were reset while loading level "+f);this.log("Track "+f+" loaded ["+e.startSN+","+e.endSN+"],duration:"+e.totalduration);var g=d[f],i=0;if(e.live||null!==(c=g.details)&&void 0!==c&&c.live){var j=this.mainDetails;if(e.fragments[0]||(e.deltaUpdateFailed=!0),e.deltaUpdateFailed||!j)return;!g.details&&e.hasProgramDateTime&&j.hasProgramDateTime?(Object(s.alignPDT)(e,j),i=e.fragments[0].start):i=this.alignPlaylists(e,g.details)}g.details=e,this.levelLastLoaded=f,this.startFragRequested||!this.mainDetails&&e.live||this.setStartPosition(g.details,i),this.state!==h.State.WAITING_TRACK||this.waitForCdnTuneIn(e)||(this.state=h.State.IDLE),this.tick()},c._handleFragmentLoadProgress=function(a){var b,c=a.frag,d=a.part,e=a.payload,f=this.config,g=this.trackId,i=this.levels;if(!i)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");var j=i[g];console.assert(j,"Audio track is defined on fragment load progress");var k=j.details;console.assert(k,"Audio track details are defined on fragment load progress");var l=f.defaultAudioCodec||j.audioCodec||"mp4a.40.2",n=this.transmuxer;n||(n=this.transmuxer=new p.default(this.hls,m.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var r=this.initPTS[c.cc],s=null===(b=c.initSegment)||void 0===b?void 0:b.data;if(void 0!==r){var t=d?d.index:-1,v=-1!==t,w=new q.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,e.byteLength,t,v);n.push(e,s,l,"",c,d,k.totalduration,!1,w,r)}else{u.logger.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+k.startSN+" ,"+k.endSN+"],track "+g);(this.waitingData=this.waitingData||{frag:c,part:d,cache:new o.default,complete:!1}).cache.push(new Uint8Array(e)),this.waitingVideoCC=this.videoTrackCC,this.state=h.State.WAITING_INIT_PTS}},c._handleFragmentLoadComplete=function(b){if(this.waitingData)return void(this.waitingData.complete=!0);a.prototype._handleFragmentLoadComplete.call(this,b)},c.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},c.onBufferCreated=function(a,b){var c=b.tracks.audio;c&&(this.mediaBuffer=c.buffer),b.tracks.video&&(this.videoBuffer=b.tracks.video.buffer)},c.onFragBuffered=function(a,b){var c=b.frag,d=b.part;if(c.type===m.PlaylistLevelType.AUDIO){if(this.fragContextChanged(c))return void this.warn("Fragment "+c.sn+(d?" p: "+d.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);"initSegment"!==c.sn&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(i.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,d)}},c.onError=function(b,c){switch(c.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(m.PlaylistLevelType.AUDIO,c);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==h.State.ERROR&&this.state!==h.State.STOPPED&&(this.state=c.fatal?h.State.ERROR:h.State.IDLE,this.warn(c.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===c.parent&&(this.state===h.State.PARSING||this.state===h.State.PARSED)){var d=!0,e=this.getFwdBufferInfo(this.mediaBuffer,m.PlaylistLevelType.AUDIO);e&&e.len>.5&&(d=!this.reduceMaxBufferLength(e.len)),d&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},c.onBufferFlushed=function(a,b){b.type===n.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},c._handleTransmuxComplete=function(a){var b,c="audio",e=this.hls,f=a.remuxResult,g=a.chunkMeta,j=this.getCurrentContext(g);if(!j)return this.warn("The loading context changed while buffering fragment "+g.sn+" of level "+g.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(g.level);var k=j.frag,l=j.part,m=f.audio,o=f.text,p=f.id3,q=f.initSegment;if(!this.fragContextChanged(k)){if(this.state=h.State.PARSING,this.audioSwitch&&m&&this.completeAudioSwitch(),null!==q&&void 0!==q&&q.tracks&&(this._bufferInitSegment(q.tracks,k,g),e.trigger(i.Events.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:c,tracks:q.tracks})),m){var r=m.startPTS,s=m.endPTS,t=m.startDTS,u=m.endDTS;l&&(l.elementaryStreams[n.ElementaryStreamTypes.AUDIO]={startPTS:r,endPTS:s,startDTS:t,endDTS:u}),k.setElementaryStreamInfo(n.ElementaryStreamTypes.AUDIO,r,s,t,u),this.bufferFragmentData(m,k,l,g)}if(null!==p&&void 0!==p&&null!==(b=p.samples)&&void 0!==b&&b.length){var v=d({frag:k,id:c},p);e.trigger(i.Events.FRAG_PARSING_METADATA,v)}if(o){var w=d({frag:k,id:c},o);e.trigger(i.Events.FRAG_PARSING_USERDATA,w)}}},c._bufferInitSegment=function(a,b,c){if(this.state===h.State.PARSING){a.video&&delete a.video;var d=a.audio;if(d){d.levelCodec=d.codec,d.id="audio",this.log("Init audio buffer, container:"+d.container+", codecs[parsed]=["+d.codec+"]"),this.hls.trigger(i.Events.BUFFER_CODECS,a);var e=d.initSegment;if(null!==e&&void 0!==e&&e.byteLength){var f={type:"audio",frag:b,part:null,chunkMeta:c,parent:b.type,data:e};this.hls.trigger(i.Events.BUFFER_APPENDING,f)}this.tick()}}},c.loadFragment=function(b,c,d){var e=this.fragmentTracker.getState(b);this.fragCurrent=b,(this.audioSwitch||e===k.FragmentState.NOT_LOADED||e===k.FragmentState.PARTIAL)&&("initSegment"===b.sn?this._loadInitSegment(b):c.live&&!Object(g.isFiniteNumber)(this.initPTS[b.cc])?(this.log("Waiting for video PTS in continuity counter "+b.cc+" of live stream before loading audio fragment "+b.sn+" of level "+this.trackId),this.state=h.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,b,c,d)))},c.completeAudioSwitch=function(){var b=this.hls,c=this.media,d=this.trackId;c&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,b.trigger(i.Events.AUDIO_TRACK_SWITCHED,{id:d})},b}(h.default);b.default=w},"./src/controller/audio-track-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,g(a,b)}function g(a,b){return(g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b);var h=c("./src/events.ts"),i=c("./src/errors.ts"),j=c("./src/controller/base-playlist-controller.ts"),k=c("./src/types/loader.ts"),l=function(a){function b(b){var c;return c=a.call(this,b,"[audio-track-controller]")||this,c.tracks=[],c.groupId=null,c.tracksInGroup=[],c.trackId=-1,c.trackName="",c.selectDefaultTrack=!0,c.registerListeners(),c}f(b,a);var c=b.prototype;return c.registerListeners=function(){var a=this.hls;a.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(h.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(h.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(h.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(h.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var a=this.hls;a.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(h.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(h.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(h.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(h.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,a.prototype.destroy.call(this)},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},c.onManifestParsed=function(a,b){this.tracks=b.audioTracks||[]},c.onAudioTrackLoaded=function(a,b){var c=b.id,d=b.details,e=this.tracksInGroup[c];if(!e)return void this.warn("Invalid audio track id "+c);var f=e.details;e.details=b.details,this.log("audioTrack "+c+" loaded ["+d.startSN+"-"+d.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,b,f))},c.onLevelLoading=function(a,b){this.switchLevel(b.level)},c.onLevelSwitching=function(a,b){this.switchLevel(b.level)},c.switchLevel=function(a){var b=this.hls.levels[a];if(null!==b&&void 0!==b&&b.audioGroupIds){var c=b.audioGroupIds[b.urlId];if(this.groupId!==c){this.groupId=c;var d=this.tracks.filter(function(a){return!c||a.groupId===c});this.selectDefaultTrack&&!d.some(function(a){return a.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=d;var e={audioTracks:d};this.log("Updating audio tracks, "+d.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(h.Events.AUDIO_TRACKS_UPDATED,e),this.selectInitialTrack()}}},c.onError=function(b,c){a.prototype.onError.call(this,b,c),!c.fatal&&c.context&&c.context.type===k.PlaylistContextType.AUDIO_TRACK&&c.context.id===this.trackId&&c.context.groupId===this.groupId&&this.retryLoadingOrFail(c)},c.setAudioTrack=function(a){var b=this.tracksInGroup;if(a<0||a>=b.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();var c=b[this.trackId];this.log("Now switching to audio-track index "+a);var d=b[a],e=d.id,f=d.groupId,g=void 0===f?"":f,i=d.name,j=d.type,k=d.url;if(this.trackId=a,this.trackName=i,this.selectDefaultTrack=!1,this.hls.trigger(h.Events.AUDIO_TRACK_SWITCHING,{id:e,groupId:g,name:i,type:j,url:k}),!d.details||d.details.live){var l=this.switchParams(d.url,null===c||void 0===c?void 0:c.details);this.loadPlaylist(l)}},c.selectInitialTrack=function(){var a=this.tracksInGroup;console.assert(a.length,"Initial audio track should be selected when tracks are known");var b=this.trackName,c=this.findTrackId(b)||this.findTrackId();-1!==c?this.setAudioTrack(c):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(h.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},c.findTrackId=function(a){for(var b=this.tracksInGroup,c=0;c<b.length;c++){var d=b[c];if((!this.selectDefaultTrack||d.default)&&(!a||a===d.name))return d.id}return-1},c.loadPlaylist=function(a){var b=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(b)){var c=b.id,d=b.groupId,e=b.url;if(a)try{e=a.addDirectives(e)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("loading audio-track playlist for id: "+c),this.clearTimer(),this.hls.trigger(h.Events.AUDIO_TRACK_LOADING,{url:e,id:c,groupId:d,deliveryDirectives:a||null})}},e(b,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}]),b}(j.default);b.default=l},"./src/controller/base-playlist-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return i});var d=c("./src/polyfills/number.ts"),e=c("./src/types/level.ts"),f=c("./src/controller/level-helper.ts"),g=c("./src/utils/logger.ts"),h=c("./src/errors.ts"),i=function(){function a(a,b){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=g.logger.log.bind(g.logger,b+":"),this.warn=g.logger.warn.bind(g.logger,b+":"),this.hls=a}var b=a.prototype;return b.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},b.onError=function(a,b){b.fatal&&b.type===h.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},b.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},b.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},b.stopLoad=function(){this.canLoad=!1,this.clearTimer()},b.switchParams=function(a,b){var c=null===b||void 0===b?void 0:b.renditionReports;if(c)for(var f=0;f<c.length;f++){var g=c[f],h=""+g.URI;if(h===a.substr(-h.length)){var i=parseInt(g["LAST-MSN"]),j=parseInt(g["LAST-PART"]);if(b&&this.hls.config.lowLatencyMode){var k=Math.min(b.age-b.partTarget,b.targetduration);void 0!==j&&k>b.partTarget&&(j+=1)}if(Object(d.isFiniteNumber)(i))return new e.HlsUrlParameters(i,Object(d.isFiniteNumber)(j)?j:void 0,e.HlsSkip.No)}}},b.loadPlaylist=function(a){},b.shouldLoadTrack=function(a){return this.canLoad&&a&&!!a.url&&(!a.details||a.details.live)},b.playlistLoaded=function(a,b,c){var d=this,e=b.details,g=b.stats,h=g.loading.end?Math.max(0,self.performance.now()-g.loading.end):0;if(e.advancedDateTime=Date.now()-h,e.live||null!==c&&void 0!==c&&c.live){if(e.reloaded(c),c&&this.log("live playlist "+a+" "+(e.advanced?"REFRESHED "+e.lastPartSn+"-"+e.lastPartIndex:"MISSED")),c&&e.fragments.length>0&&Object(f.mergeDetails)(c,e),!this.canLoad||!e.live)return;var i,j=void 0,k=void 0;if(e.canBlockReload&&e.endSN&&e.advanced){var l=this.hls.config.lowLatencyMode,m=e.lastPartSn,n=e.endSN,o=e.lastPartIndex,p=-1!==o,q=m===n,r=l?0:o;p?(j=q?n+1:m,k=q?r:o+1):j=n+1;var s=e.age,t=s+e.ageHeader,u=Math.min(t-e.partTarget,1.5*e.targetduration);if(u>0){if(c&&u>c.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+c.tuneInGoal+" to: "+u+" with playlist age: "+e.age),u=0;else{var v=Math.floor(u/e.targetduration);if(j+=v,void 0!==k){k+=Math.round(u%e.targetduration/e.partTarget)}this.log("CDN Tune-in age: "+e.ageHeader+"s last advanced "+s.toFixed(2)+"s goal: "+u+" skip sn "+v+" to part "+k)}e.tuneInGoal=u}if(i=this.getDeliveryDirectives(e,b.deliveryDirectives,j,k),l||!q)return void this.loadPlaylist(i)}else i=this.getDeliveryDirectives(e,b.deliveryDirectives,j,k);var w=Object(f.computeReloadInterval)(e,g);void 0!==j&&e.canBlockReload&&(w-=e.partTarget||1),this.log("reload live playlist "+a+" in "+Math.round(w)+" ms"),this.timer=self.setTimeout(function(){return d.loadPlaylist(i)},w)}else this.clearTimer()},b.getDeliveryDirectives=function(a,b,c,d){var f=Object(e.getSkipValue)(a,c);return null!==b&&void 0!==b&&b.skip&&a.deltaUpdateFailed&&(c=b.msn,d=b.part,f=e.HlsSkip.No),new e.HlsUrlParameters(c,d,f)},b.retryLoadingOrFail=function(a){var b=this,c=this.hls.config,d=this.retryCount<c.levelLoadingMaxRetry;if(d){var e;if(this.retryCount++,a.details.indexOf("LoadTimeOut")>-1&&null!==(e=a.context)&&void 0!==e&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+a.details+'"'),this.loadPlaylist();else{var f=Math.min(Math.pow(2,this.retryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return b.loadPlaylist()},f),this.warn("retry playlist loading #"+this.retryCount+" in "+f+' ms after "'+a.details+'"')}}else this.warn('cannot recover from error "'+a.details+'"'),this.clearTimer(),a.fatal=!0;return d},a}()},"./src/controller/base-stream-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function g(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,h(a,b)}function h(a,b){return(h=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b),c.d(b,"State",function(){return y}),c.d(b,"default",function(){return z});var i=c("./src/polyfills/number.ts"),j=c("./src/task-loop.ts"),k=c("./src/controller/fragment-tracker.ts"),l=c("./src/utils/buffer-helper.ts"),m=c("./src/utils/logger.ts"),n=c("./src/events.ts"),o=c("./src/errors.ts"),p=c("./src/types/transmuxer.ts"),q=c("./src/utils/mp4-tools.ts"),r=c("./src/utils/discontinuities.ts"),s=c("./src/controller/fragment-finders.ts"),t=c("./src/controller/level-helper.ts"),u=c("./src/loader/fragment-loader.ts"),v=c("./src/crypt/decrypter.ts"),w=c("./src/utils/time-ranges.ts"),x=c("./src/types/loader.ts"),y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},z=function(a){function b(b,c,d){var e;return e=a.call(this)||this,e.hls=void 0,e.fragPrevious=null,e.fragCurrent=null,e.fragmentTracker=void 0,e.transmuxer=null,e._state=y.STOPPED,e.media=void 0,e.mediaBuffer=void 0,e.config=void 0,e.bitrateTest=!1,e.lastCurrentTime=0,e.nextLoadPosition=0,e.startPosition=0,e.loadedmetadata=!1,e.fragLoadError=0,e.retryDate=0,e.levels=null,e.fragmentLoader=void 0,e.levelLastLoaded=null,e.startFragRequested=!1,e.decrypter=void 0,e.initPTS=[],e.onvseeking=null,e.onvended=null,e.logPrefix="",e.log=void 0,e.warn=void 0,e.logPrefix=d,e.log=m.logger.log.bind(m.logger,d+":"),e.warn=m.logger.warn.bind(m.logger,d+":"),e.hls=b,e.fragmentLoader=new u.default(b.config),e.fragmentTracker=c,e.config=b.config,e.decrypter=new v.default(b,b.config),b.on(n.Events.KEY_LOADED,e.onKeyLoaded,f(e)),e}g(b,a);var c=b.prototype;return c.doTick=function(){this.onTickEnd()},c.onTickEnd=function(){},c.startLoad=function(a){},c.stopLoad=function(){this.fragmentLoader.abort();var a=this.fragCurrent;a&&this.fragmentTracker.removeFragment(a),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=y.STOPPED},c._streamEnded=function(a,b){var c=this.fragCurrent,d=this.fragmentTracker;if(!b.live&&c&&c.sn===b.endSN&&!a.nextStart){var e=d.getState(c);return e===k.FragmentState.PARTIAL||e===k.FragmentState.OK}return!1},c.onMediaAttached=function(a,b){var c=this.media=this.mediaBuffer=b.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),c.addEventListener("seeking",this.onvseeking),c.addEventListener("ended",this.onvended);var d=this.config;this.levels&&d.autoStartLoad&&this.state===y.STOPPED&&this.startLoad(d.startPosition)},c.onMediaDetaching=function(){var a=this.media;null!==a&&void 0!==a&&a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},c.onMediaSeeking=function(){var a=this.config,b=this.fragCurrent,c=this.media,d=this.mediaBuffer,e=this.state,f=c?c.currentTime:0,g=l.BufferHelper.bufferInfo(d||c,f,a.maxBufferHole);if(this.log("media seeking to "+(Object(i.isFiniteNumber)(f)?f.toFixed(3):f)+", state: "+e),e===y.ENDED)this.resetLoadingState();else if(b&&!g.len){var h=a.maxFragLookUpTolerance,j=b.start-h,k=b.start+b.duration+h,m=f>k;(f<j||m)&&(m&&b.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),b.loader.abort()),this.resetLoadingState())}c&&(this.lastCurrentTime=f),this.loadedmetadata||g.len||(this.nextLoadPosition=this.startPosition=f),this.tickImmediate()},c.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},c.onKeyLoaded=function(a,b){if(this.state===y.KEY_LOADING&&b.frag===this.fragCurrent&&this.levels){this.state=y.IDLE;var c=this.levels[b.frag.level].details;c&&this.loadFragment(b.frag,c,b.frag.start)}},c.onHandlerDestroying=function(){this.stopLoad(),a.prototype.onHandlerDestroying.call(this)},c.onHandlerDestroyed=function(){this.state=y.STOPPED,this.hls.off(n.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,a.prototype.onHandlerDestroyed.call(this)},c.loadKey=function(a,b){this.log("Loading key for "+a.sn+" of ["+b.startSN+"-"+b.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+a.level),this.state=y.KEY_LOADING,this.fragCurrent=a,this.hls.trigger(n.Events.KEY_LOADING,{frag:a})},c.loadFragment=function(a,b,c){this._loadFragForPlayback(a,b,c)},c._loadFragForPlayback=function(a,b,c){var d=this,e=function(b){if(d.fragContextChanged(a))return d.warn("Fragment "+a.sn+(b.part?" p: "+b.part.index:"")+" of level "+a.level+" was dropped during download."),void d.fragmentTracker.removeFragment(a);a.stats.chunkCount++,d._handleFragmentLoadProgress(b)};this._doFragLoad(a,b,c,e).then(function(b){if(b){d.fragLoadError=0;var c=d.state;return d.fragContextChanged(a)?void((c===y.FRAG_LOADING||c===y.BACKTRACKING||!d.fragCurrent&&c===y.PARSING)&&(d.fragmentTracker.removeFragment(a),d.state=y.IDLE)):"payload"in b&&(d.log("Loaded fragment "+a.sn+" of level "+a.level),d.hls.trigger(n.Events.FRAG_LOADED,b),d.state===y.BACKTRACKING)?(d.fragmentTracker.backtrack(a,b),void d.resetFragmentLoading(a)):void d._handleFragmentLoadComplete(b)}}).catch(function(b){d.warn(b),d.resetFragmentLoading(a)})},c.flushMainBuffer=function(a,b,c){if(void 0===c&&(c=null),a-b){var d={startOffset:a,endOffset:b,type:c};this.fragLoadError=0,this.hls.trigger(n.Events.BUFFER_FLUSHING,d)}},c._loadInitSegment=function(a){var b=this;this._doFragLoad(a).then(function(c){if(!c||b.fragContextChanged(a)||!b.levels)throw new Error("init load aborted");return c}).then(function(c){var d=b.hls,e=c.payload,f=a.decryptdata;if(e&&e.byteLength>0&&f&&f.key&&f.iv&&"AES-128"===f.method){var g=self.performance.now();return b.decrypter.webCryptoDecrypt(new Uint8Array(e),f.key.buffer,f.iv.buffer).then(function(b){var e=self.performance.now();return d.trigger(n.Events.FRAG_DECRYPTED,{frag:a,payload:b,stats:{tstart:g,tdecrypt:e}}),c.payload=b,c})}return c}).then(function(c){var d=b.fragCurrent,e=b.hls,f=b.levels;if(!f)throw new Error("init load aborted, missing levels");var g=f[a.level].details;console.assert(g,"Level details are defined when init segment is loaded");var h=a.stats;b.state=y.IDLE,b.fragLoadError=0,a.data=new Uint8Array(c.payload),h.parsing.start=h.buffering.start=self.performance.now(),h.parsing.end=h.buffering.end=self.performance.now(),c.frag===d&&e.trigger(n.Events.FRAG_BUFFERED,{stats:h,frag:d,part:null,id:a.type}),b.tick()}).catch(function(c){b.warn(c),b.resetFragmentLoading(a)})},c.fragContextChanged=function(a){var b=this.fragCurrent;return!a||!b||a.level!==b.level||a.sn!==b.sn||a.urlId!==b.urlId},c.fragBufferedComplete=function(a,b){var c=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+a.type+" sn: "+a.sn+(b?" part: "+b.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+a.level+" "+w.default.toString(l.BufferHelper.getBuffered(c))),this.state=y.IDLE,this.tick()},c._handleFragmentLoadComplete=function(a){var b=this.transmuxer;if(b){var c=a.frag,d=a.part,e=a.partsLoaded,f=!e||0===e.length||e.some(function(a){return!a}),g=new p.ChunkMetadata(c.level,c.sn,c.stats.chunkCount+1,0,d?d.index:-1,!f);b.flush(g)}},c._handleFragmentLoadProgress=function(a){},c._doFragLoad=function(a,b,c,d){var e=this;if(void 0===c&&(c=null),!this.levels)throw new Error("frag load aborted, missing levels");if(c=Math.max(a.start,c||0),this.config.lowLatencyMode&&b){var f=b.partList;if(f&&d){c>a.end&&b.fragmentHint&&(a=b.fragmentHint);var g=this.getNextPart(f,a,c);if(g>-1){var h=f[g];return this.log("Loading part sn: "+a.sn+" p: "+h.index+" cc: "+a.cc+" of playlist ["+b.startSN+"-"+b.endSN+"] parts [0-"+g+"-"+(f.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+a.level+", target: "+parseFloat(c.toFixed(3))),this.nextLoadPosition=h.start+h.duration,this.state=y.FRAG_LOADING,this.hls.trigger(n.Events.FRAG_LOADING,{frag:a,part:f[g],targetBufferTime:c}),this.doFragPartsLoad(a,f,g,d).catch(function(a){return e.handleFragLoadError(a)})}if(!a.url||this.loadedEndOfParts(f,c))return Promise.resolve(null)}}return this.log("Loading fragment "+a.sn+" cc: "+a.cc+" "+(b?"of ["+b.startSN+"-"+b.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+a.level+", target: "+parseFloat(c.toFixed(3))),Object(i.isFiniteNumber)(a.sn)&&!this.bitrateTest&&(this.nextLoadPosition=a.start+a.duration),this.state=y.FRAG_LOADING,this.hls.trigger(n.Events.FRAG_LOADING,{frag:a,targetBufferTime:c}),this.fragmentLoader.load(a,d).catch(function(a){return e.handleFragLoadError(a)})},c.doFragPartsLoad=function(a,b,c,d){var e=this;return new Promise(function(f,g){var h=[];!function c(i){var j=b[i];e.fragmentLoader.loadPart(a,j,d).then(function(d){h[j.index]=d;var g=d.part;e.hls.trigger(n.Events.FRAG_LOADED,d);var k=b[i+1];if(!k||k.fragment!==a)return f({frag:a,part:g,partsLoaded:h});c(i+1)}).catch(g)}(c)})},c.handleFragLoadError=function(a){var b=a.data;return b&&b.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(b.frag,b.part):this.hls.trigger(n.Events.ERROR,b),null},c._handleTransmuxerFlush=function(a){var b=this.getCurrentContext(a);if(!b||this.state!==y.PARSING)return void(this.fragCurrent||(this.state=y.IDLE));var c=b.frag,d=b.part,e=b.level,f=self.performance.now();c.stats.parsing.end=f,d&&(d.stats.parsing.end=f),this.updateLevelTiming(c,d,e,a.partial)},c.getCurrentContext=function(a){var b=this.levels,c=a.level,d=a.sn,e=a.part;if(!b||!b[c])return this.warn("Levels object was unset while buffering fragment "+d+" of level "+c+". The current chunk will not be buffered."),null;var f=b[c],g=e>-1?Object(t.getPartWith)(f,d,e):null,h=g?g.fragment:Object(t.getFragmentWithSN)(f,d,this.fragCurrent);return h?{frag:h,part:g,level:f}:null},c.bufferFragmentData=function(a,b,c,d){if(a&&this.state===y.PARSING){var e=a.data1,f=a.data2,g=e;if(e&&f&&(g=Object(q.appendUint8Array)(e,f)),g&&g.length){var h={type:a.type,frag:b,part:c,chunkMeta:d,parent:b.type,data:g};this.hls.trigger(n.Events.BUFFER_APPENDING,h),a.dropped&&a.independent&&!c&&this.flushBufferGap(b)}}},c.flushBufferGap=function(a){var b=this.media;if(b){if(!l.BufferHelper.isBuffered(b,b.currentTime))return void this.flushMainBuffer(0,a.start);var c=b.currentTime,d=l.BufferHelper.bufferInfo(b,c,0),e=a.duration,f=Math.min(2*this.config.maxFragLookUpTolerance,.25*e),g=Math.max(Math.min(a.start-f,d.end-f),c+f);a.start-g>f&&this.flushMainBuffer(g,a.start)}},c.getFwdBufferInfo=function(a,b){var c=this.config,d=this.getLoadPosition();if(!Object(i.isFiniteNumber)(d))return null;var e=l.BufferHelper.bufferInfo(a,d,c.maxBufferHole);if(0===e.len&&void 0!==e.nextStart){var f=this.fragmentTracker.getBufferedFrag(d,b);if(f&&e.nextStart<f.end)return l.BufferHelper.bufferInfo(a,d,Math.max(e.nextStart,c.maxBufferHole))}return e},c.getMaxBufferLength=function(a){var b,c=this.config;return b=a?Math.max(8*c.maxBufferSize/a,c.maxBufferLength):c.maxBufferLength,Math.min(b,c.maxMaxBufferLength)},c.reduceMaxBufferLength=function(a){var b=this.config,c=a||b.maxBufferLength;return b.maxMaxBufferLength>=c&&(b.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+b.maxMaxBufferLength+"s"),!0)},c.getNextFragment=function(a,b){var c,d,e=b.fragments,f=e.length;if(!f)return null;var g,h=this.config,i=e[0].start;if(b.live){var j=h.initialLiveManifestSize;if(f<j)return this.warn("Not enough fragments to start playback (have: "+f+", need: "+j+")"),null;b.PTSKnown||this.startFragRequested||-1!==this.startPosition||(g=this.getInitialLiveFragment(b,e),this.startPosition=g?this.hls.liveSyncPosition||g.start:a)}else a<=i&&(g=e[0]);if(!g){var k=h.lowLatencyMode?b.partEnd:b.fragmentEnd;g=this.getFragmentAtPosition(a,k,b)}return null===(c=g)||void 0===c||!c.initSegment||null!==(d=g)&&void 0!==d&&d.initSegment.data||this.bitrateTest||(g=g.initSegment),g},c.getNextPart=function(a,b,c){for(var d=-1,e=!1,f=!0,g=0,h=a.length;g<h;g++){var i=a[g];if(f=f&&!i.independent,d>-1&&c<i.start)break;var j=i.loaded;!j&&(e||i.independent||f)&&i.fragment===b&&(d=g),e=j}return d},c.loadedEndOfParts=function(a,b){var c=a[a.length-1];return c&&b>c.start&&c.loaded},c.getInitialLiveFragment=function(a,b){var c=this.fragPrevious,d=null;if(c){if(a.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+c.programDateTime),d=Object(s.findFragmentByPDT)(b,c.endProgramDateTime,this.config.maxFragLookUpTolerance)),!d){var e=c.sn+1;if(e>=a.startSN&&e<=a.endSN){var f=b[e-a.startSN];c.cc===f.cc&&(d=f,this.log("Live playlist, switching playlist, load frag with next SN: "+d.sn))}d||(d=Object(s.findFragWithCC)(b,c.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+d.sn)}}else{var g=this.hls.liveSyncPosition;null!==g&&(d=this.getFragmentAtPosition(g,this.bitrateTest?a.fragmentEnd:a.edge,a))}return d},c.getFragmentAtPosition=function(a,b,c){var d=this.config,e=this.fragPrevious,f=c.fragments,g=c.endSN,h=c.fragmentHint,i=d.maxFragLookUpTolerance,j=!!(d.lowLatencyMode&&c.partList&&h);j&&h&&!this.bitrateTest&&(f=f.concat(h),g=h.sn);var l;if(a<b){var m=a>b-i?0:i;l=Object(s.findFragmentByPTS)(e,f,a,m)}else l=f[f.length-1];if(l){var n=l.sn-c.startSN,o=e&&l.level===e.level,p=f[n+1];if(this.fragmentTracker.getState(l)===k.FragmentState.BACKTRACKED){l=null;for(var q=n;f[q]&&this.fragmentTracker.getState(f[q])===k.FragmentState.BACKTRACKED;)l=e?f[q--]:f[--q];l||(l=p)}else e&&l.sn===e.sn&&!j&&o&&(l.sn<g&&this.fragmentTracker.getState(p)!==k.FragmentState.OK?(this.log("SN "+l.sn+" just loaded, load next one: "+p.sn),l=p):l=null)}return l},c.synchronizeToLiveEdge=function(a){var b=this.config,c=this.media;if(c){var d=this.hls.liveSyncPosition,e=c.currentTime,f=a.fragments[0].start,g=a.edge,h=e>=f-b.maxFragLookUpTolerance&&e<=g;if(null!==d&&c.duration>d&&(e<d||!h)){var i=void 0!==b.liveMaxLatencyDuration?b.liveMaxLatencyDuration:b.liveMaxLatencyDurationCount*a.targetduration;(!h&&c.readyState<4||e<g-i)&&(this.loadedmetadata||(this.nextLoadPosition=d),c.readyState&&(this.warn("Playback: "+e.toFixed(3)+" is located too far from the end of live sliding playlist: "+g+", reset currentTime to : "+d.toFixed(3)),c.currentTime=d))}}},c.alignPlaylists=function(a,b){var c=this.levels,d=this.levelLastLoaded,e=this.fragPrevious,f=null!==d?c[d]:null,g=a.fragments.length;if(!g)return this.warn("No fragments in live playlist"),0;var h=a.fragments[0].start,j=!b,k=a.alignedSliding&&Object(i.isFiniteNumber)(h);if(j||!k&&!h){Object(r.alignStream)(e,f,a);var l=a.fragments[0].start;return this.log("Live playlist sliding: "+l.toFixed(2)+" start-sn: "+(b?b.startSN:"na")+"->"+a.startSN+" prev-sn: "+(e?e.sn:"na")+" fragments: "+g),l}return h},c.waitForCdnTuneIn=function(a){return a.live&&a.canBlockReload&&a.tuneInGoal>Math.max(a.partHoldBack,3*a.partTarget)},c.setStartPosition=function(a,b){var c=this.startPosition;if(c<b&&(c=-1),-1===c||-1===this.lastCurrentTime){var d=a.startTimeOffset;Object(i.isFiniteNumber)(d)?(c=b+d,d<0&&(c+=a.totalduration),c=Math.min(Math.max(b,c),b+a.totalduration),this.log("Start time offset "+d+" found in playlist, adjust startPosition to "+c),this.startPosition=c):a.live?c=this.hls.liveSyncPosition||b:this.startPosition=c=0,this.lastCurrentTime=c}this.nextLoadPosition=c},c.getLoadPosition=function(){var a=this.media,b=0;return this.loadedmetadata&&a?b=a.currentTime:this.nextLoadPosition&&(b=this.nextLoadPosition),b},c.handleFragLoadAborted=function(a,b){this.transmuxer&&"initSegment"!==a.sn&&a.stats.aborted&&(this.warn("Fragment "+a.sn+(b?" part"+b.index:"")+" of level "+a.level+" was aborted"),this.resetFragmentLoading(a))},c.resetFragmentLoading=function(a){this.fragCurrent&&this.fragContextChanged(a)||(this.state=y.IDLE)},c.onFragmentOrKeyLoadError=function(a,b){if(!b.fatal){var c=b.frag;if(c&&c.type===a){var d=this.fragCurrent;console.assert(d&&c.sn===d.sn&&c.level===d.level&&c.urlId===d.urlId,"Frag load error must match current frag to retry");var e=this.config;if(this.fragLoadError+1<=e.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(c.level))return;var f=Math.min(Math.pow(2,this.fragLoadError)*e.fragLoadingRetryDelay,e.fragLoadingMaxRetryTimeout);this.warn("Fragment "+c.sn+" of "+a+" "+c.level+" failed to load, retrying in "+f+"ms"),this.retryDate=self.performance.now()+f,this.fragLoadError++,this.state=y.FRAG_LOADING_WAITING_RETRY}else b.levelRetry?(a===x.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=y.IDLE):(m.logger.error(b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.hls.stopLoad(),this.state=y.ERROR)}}},c.afterBufferFlushed=function(a,b,c){if(a){var d=l.BufferHelper.getBuffered(a);this.fragmentTracker.detectEvictedFragments(b,d,c),this.state===y.ENDED&&this.resetLoadingState()}},c.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE},c.resetLiveStartWhenNotLoaded=function(a){if(!this.loadedmetadata){this.startFragRequested=!1;var b=this.levels?this.levels[a].details:null;if(null!==b&&void 0!==b&&b.live)return this.startPosition=-1,this.setStartPosition(b,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},c.updateLevelTiming=function(a,b,c,d){var e=this,f=c.details;console.assert(!!f,"level.details must be defined"),Object.keys(a.elementaryStreams).reduce(function(b,g){var h=a.elementaryStreams[g];if(h){var i=h.endPTS-h.startPTS;if(i<=0)return e.warn("Could not parse fragment "+a.sn+" "+g+" duration reliably ("+i+") resetting transmuxer to fallback to playlist timing"),e.resetTransmuxer(),b||!1;var j=d?0:Object(t.updateFragPTSDTS)(f,a,h.startPTS,h.endPTS,h.startDTS,h.endDTS);return e.hls.trigger(n.Events.LEVEL_PTS_UPDATED,{details:f,level:c,drift:j,type:g,frag:a,start:h.startPTS,end:h.endPTS}),!0}return b},!1)?(this.state=y.PARSED,this.hls.trigger(n.Events.FRAG_PARSED,{frag:a,part:b})):this.resetLoadingState()},c.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e(b,[{key:"state",get:function(){return this._state},set:function(a){var b=this._state;b!==a&&(this._state=a,this.log(b+"->"+a))}}]),b}(j.default)},"./src/controller/buffer-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return n});var d=c("./src/polyfills/number.ts"),e=c("./src/events.ts"),f=c("./src/utils/logger.ts"),g=c("./src/errors.ts"),h=c("./src/utils/buffer-helper.ts"),i=c("./src/utils/mediasource-helper.ts"),j=c("./src/loader/fragment.ts"),k=c("./src/controller/buffer-operation-queue.ts"),l=Object(i.getMediaSource)(),m=/([ha]vc.)(?:\.[^.,]+)+/,n=function(){function a(a){var b=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var a=b.hls,c=b.media,d=b.mediaSource;f.logger.log("[buffer-controller]: Media source opened"),c&&(b.updateMediaElementDuration(),a.trigger(e.Events.MEDIA_ATTACHED,{media:c})),d&&d.removeEventListener("sourceopen",b._onMediaSourceOpen),b.checkPendingTracks()},this._onMediaSourceClose=function(){f.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){f.logger.log("[buffer-controller]: Media source ended")},this.hls=a,this._initSourceBuffer(),this.registerListeners()}var b=a.prototype;return b.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},b.destroy=function(){this.unregisterListeners(),this.details=null},b.registerListeners=function(){var a=this.hls;a.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(e.Events.BUFFER_RESET,this.onBufferReset,this),a.on(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.on(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(e.Events.BUFFER_EOS,this.onBufferEos,this),a.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.on(e.Events.FRAG_PARSED,this.onFragParsed,this),a.on(e.Events.FRAG_CHANGED,this.onFragChanged,this)},b.unregisterListeners=function(){var a=this.hls;a.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(e.Events.BUFFER_RESET,this.onBufferReset,this),a.off(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.off(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(e.Events.BUFFER_EOS,this.onBufferEos,this),a.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.off(e.Events.FRAG_PARSED,this.onFragParsed,this),a.off(e.Events.FRAG_CHANGED,this.onFragChanged,this)},b._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new k.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},b.onManifestParsed=function(a,b){var c=2;(b.audio&&!b.video||!b.altAudio)&&(c=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=c,this.details=null,f.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},b.onMediaAttaching=function(a,b){var c=this.media=b.media;if(c&&l){var d=this.mediaSource=new l;d.addEventListener("sourceopen",this._onMediaSourceOpen),d.addEventListener("sourceended",this._onMediaSourceEnded),d.addEventListener("sourceclose",this._onMediaSourceClose),c.src=self.URL.createObjectURL(d),this._objectUrl=c.src}},b.onMediaDetaching=function(){var a=this.media,b=this.mediaSource,c=this._objectUrl;if(b){if(f.logger.log("[buffer-controller]: media source detaching"),"open"===b.readyState)try{b.endOfStream()}catch(a){f.logger.warn("[buffer-controller]: onMediaDetaching: "+a.message+" while calling endOfStream")}this.onBufferReset(),b.removeEventListener("sourceopen",this._onMediaSourceOpen),b.removeEventListener("sourceended",this._onMediaSourceEnded),b.removeEventListener("sourceclose",this._onMediaSourceClose),a&&(c&&self.URL.revokeObjectURL(c),a.src===c?(a.removeAttribute("src"),a.load()):f.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(e.Events.MEDIA_DETACHED,void 0)},b.onBufferReset=function(){var a=this;this.getSourceBufferTypes().forEach(function(b){var c=a.sourceBuffer[b];try{c&&(a.removeBufferListeners(b),a.mediaSource&&a.mediaSource.removeSourceBuffer(c),a.sourceBuffer[b]=void 0)}catch(a){f.logger.warn("[buffer-controller]: Failed to reset the "+b+" buffer",a)}}),this._initSourceBuffer()},b.onBufferCodecs=function(a,b){var c=this,d=this.getSourceBufferTypes().length;Object.keys(b).forEach(function(a){if(d){var e=c.tracks[a];if(e&&"function"==typeof e.buffer.changeType){var f=b[a],g=f.codec,h=f.levelCodec,i=f.container;if((e.levelCodec||e.codec).replace(m,"$1")!==(h||g).replace(m,"$1")){var j=i+";codecs="+(h||g);c.appendChangeType(a,j)}}}else c.pendingTracks[a]=b[a]}),d||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},b.appendChangeType=function(a,b){var c=this,d=this.operationQueue,e={execute:function(){var e=c.sourceBuffer[a];e&&(f.logger.log("[buffer-controller]: changing "+a+" sourceBuffer type to "+b),e.changeType(b)),d.shiftAndExecuteNext(a)},onStart:function(){},onComplete:function(){},onError:function(b){f.logger.warn("[buffer-controller]: Failed to change "+a+" SourceBuffer type",b)}};d.append(e,a)},b.onBufferAppending=function(a,b){var c=this,d=this.hls,i=this.operationQueue,j=this.tracks,k=b.data,l=b.type,m=b.frag,n=b.part,o=b.chunkMeta,p=o.buffering[l],q=self.performance.now();p.start=q;var r=m.stats.buffering,s=n?n.stats.buffering:null;0===r.start&&(r.start=q),s&&0===s.start&&(s.start=q);var t=j.audio,u="audio"===l&&1===o.id&&"audio/mpeg"===(null===t||void 0===t?void 0:t.container),v={execute:function(){if(p.executeStart=self.performance.now(),u){var a=c.sourceBuffer[l];if(a){var b=m.start-a.timestampOffset;Math.abs(b)>=.1&&(f.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+m.start+" (delta: "+b+") sn: "+m.sn+")"),a.timestampOffset=m.start)}}c.appendExecutor(k,l)},onStart:function(){},onComplete:function(){var a=self.performance.now();p.executeEnd=p.end=a,0===r.first&&(r.first=a),s&&0===s.first&&(s.first=a);var b=c.sourceBuffer,d={};for(var f in b)d[f]=h.BufferHelper.getBuffered(b[f]);c.appendError=0,c.hls.trigger(e.Events.BUFFER_APPENDED,{type:l,frag:m,part:n,chunkMeta:o,parent:m.type,timeRanges:d})},onError:function(a){f.logger.error("[buffer-controller]: Error encountered while trying to append to the "+l+" SourceBuffer",a);var b={type:g.ErrorTypes.MEDIA_ERROR,parent:m.type,details:g.ErrorDetails.BUFFER_APPEND_ERROR,err:a,fatal:!1};a.code===DOMException.QUOTA_EXCEEDED_ERR?b.details=g.ErrorDetails.BUFFER_FULL_ERROR:(c.appendError++,b.details=g.ErrorDetails.BUFFER_APPEND_ERROR,c.appendError>d.config.appendErrorMaxRetry&&(f.logger.error("[buffer-controller]: Failed "+d.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),b.fatal=!0)),d.trigger(e.Events.ERROR,b)}};i.append(v,l)},b.onBufferFlushing=function(a,b){var c=this,d=this.operationQueue,g=function(a){return{execute:c.removeExecutor.bind(c,a,b.startOffset,b.endOffset),onStart:function(){},onComplete:function(){c.hls.trigger(e.Events.BUFFER_FLUSHED,{type:a})},onError:function(b){f.logger.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",b)}}};b.type?d.append(g(b.type),b.type):this.getSourceBufferTypes().forEach(function(a){d.append(g(a),a)})},b.onFragParsed=function(a,b){var c=this,d=b.frag,g=b.part,h=[],i=g?g.elementaryStreams:d.elementaryStreams;i[j.ElementaryStreamTypes.AUDIOVIDEO]?h.push("audiovideo"):(i[j.ElementaryStreamTypes.AUDIO]&&h.push("audio"),i[j.ElementaryStreamTypes.VIDEO]&&h.push("video"));var k=function(){var a=self.performance.now();d.stats.buffering.end=a,g&&(g.stats.buffering.end=a);var b=g?g.stats:d.stats;c.hls.trigger(e.Events.FRAG_BUFFERED,{frag:d,part:g,stats:b,id:d.type})};0===h.length&&f.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+d.type+" level: "+d.level+" sn: "+d.sn),this.blockBuffers(k,h)},b.onFragChanged=function(a,b){this.flushBackBuffer()},b.onBufferEos=function(a,b){var c=this;this.getSourceBufferTypes().reduce(function(a,d){var e=c.sourceBuffer[d];return b.type&&b.type!==d||e&&!e.ended&&(e.ended=!0,f.logger.log("[buffer-controller]: "+d+" sourceBuffer now EOS")),a&&!(e&&!e.ended)},!0)&&this.blockBuffers(function(){var a=c.mediaSource;a&&"open"===a.readyState&&a.endOfStream()})},b.onLevelUpdated=function(a,b){var c=b.details;c.fragments.length&&(this.details=c,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},b.flushBackBuffer=function(){var a=this.hls,b=this.details,c=this.media,f=this.sourceBuffer;if(c&&null!==b){var g=this.getSourceBufferTypes();if(g.length){var i=b.live&&null!==a.config.liveBackBufferLength?a.config.liveBackBufferLength:a.config.backBufferLength;if(Object(d.isFiniteNumber)(i)&&!(i<0)){var j=c.currentTime,k=b.levelTargetDuration,l=Math.max(i,k),m=Math.floor(j/k)*k-l;g.forEach(function(c){var d=f[c];if(d){var g=h.BufferHelper.getBuffered(d);g.length>0&&m>g.start(0)&&(a.trigger(e.Events.BACK_BUFFER_REACHED,{bufferEnd:m}),b.live&&a.trigger(e.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:m}),a.trigger(e.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:m,type:c}))}})}}}},b.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var a=this.details,b=this.hls,c=this.media,e=this.mediaSource,g=a.fragments[0].start+a.totalduration,h=c.duration,i=Object(d.isFiniteNumber)(e.duration)?e.duration:0;a.live&&b.config.liveDurationInfinity?(f.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),e.duration=1/0,this.updateSeekableRange(a)):(g>i&&g>h||!Object(d.isFiniteNumber)(h))&&(f.logger.log("[buffer-controller]: Updating Media Source duration to "+g.toFixed(3)),e.duration=g)}},b.updateSeekableRange=function(a){var b=this.mediaSource,c=a.fragments;if(c.length&&a.live&&null!==b&&void 0!==b&&b.setLiveSeekableRange){var d=Math.max(0,c[0].start),e=Math.max(d,d+a.totalduration);b.setLiveSeekableRange(d,e)}},b.checkPendingTracks=function(){var a=this.bufferCodecEventsExpected,b=this.operationQueue,c=this.pendingTracks,d=Object.keys(c).length;if(d&&!a||2===d){this.createSourceBuffers(c),this.pendingTracks={};var f=this.getSourceBufferTypes();if(0===f.length)return void this.hls.trigger(e.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});f.forEach(function(a){b.executeNext(a)})}},b.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;if(!c)throw Error("createSourceBuffers called when mediaSource was null");var d=0;for(var h in a)if(!b[h]){var i=a[h];if(!i)throw Error("source buffer exists for track "+h+", however track does not");var j=i.levelCodec||i.codec,k=i.container+";codecs="+j;f.logger.log("[buffer-controller]: creating sourceBuffer("+k+")");try{var l=b[h]=c.addSourceBuffer(k),m=h;this.addBufferListener(m,"updatestart",this._onSBUpdateStart),this.addBufferListener(m,"updateend",this._onSBUpdateEnd),this.addBufferListener(m,"error",this._onSBUpdateError),this.tracks[h]={buffer:l,codec:j,container:i.container,levelCodec:i.levelCodec,id:i.id},d++}catch(a){f.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+a.message),this.hls.trigger(e.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:k})}}d&&this.hls.trigger(e.Events.BUFFER_CREATED,{tracks:this.tracks})},b._onSBUpdateStart=function(a){this.operationQueue.current(a).onStart()},b._onSBUpdateEnd=function(a){var b=this.operationQueue;b.current(a).onComplete(),b.shiftAndExecuteNext(a)},b._onSBUpdateError=function(a,b){f.logger.error("[buffer-controller]: "+a+" SourceBuffer error",b),this.hls.trigger(e.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var c=this.operationQueue.current(a);c&&c.onError(b)},b.removeExecutor=function(a,b,c){var e=this.media,g=this.mediaSource,h=this.operationQueue,i=this.sourceBuffer,j=i[a];if(!e||!g||!j)return f.logger.warn("[buffer-controller]: Attempting to remove from the "+a+" SourceBuffer, but it does not exist"),void h.shiftAndExecuteNext(a);var k=Object(d.isFiniteNumber)(e.duration)?e.duration:1/0,l=Object(d.isFiniteNumber)(g.duration)?g.duration:1/0,m=Math.max(0,b),n=Math.min(c,k,l);n>m?(f.logger.log("[buffer-controller]: Removing ["+m+","+n+"] from the "+a+" SourceBuffer"),console.assert(!j.updating,a+" sourceBuffer must not be updating"),j.remove(m,n)):h.shiftAndExecuteNext(a)},b.appendExecutor=function(a,b){var c=this.operationQueue,d=this.sourceBuffer,e=d[b];if(!e)return f.logger.warn("[buffer-controller]: Attempting to append to the "+b+" SourceBuffer, but it does not exist"),void c.shiftAndExecuteNext(b);e.ended=!1,console.assert(!e.updating,b+" sourceBuffer must not be updating"),e.appendBuffer(a)},b.blockBuffers=function(a,b){var c=this;if(void 0===b&&(b=this.getSourceBufferTypes()),!b.length)return f.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(a);var d=this.operationQueue,e=b.map(function(a){return d.appendBlocker(a)});Promise.all(e).then(function(){a(),b.forEach(function(a){var b=c.sourceBuffer[a];b&&b.updating||d.shiftAndExecuteNext(a)})})},b.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},b.addBufferListener=function(a,b,c){var d=this.sourceBuffer[a];if(d){var e=c.bind(this,a);this.listeners[a].push({event:b,listener:e}),d.addEventListener(b,e)}},b.removeBufferListeners=function(a){var b=this.sourceBuffer[a];b&&this.listeners[a].forEach(function(a){b.removeEventListener(a.event,a.listener)})},a}()},"./src/controller/buffer-operation-queue.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return e});var d=c("./src/utils/logger.ts"),e=function(){function a(a){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=a}var b=a.prototype;return b.append=function(a,b){var c=this.queues[b];c.push(a),1===c.length&&this.buffers[b]&&this.executeNext(b)},b.insertAbort=function(a,b){this.queues[b].unshift(a),this.executeNext(b)},b.appendBlocker=function(a){var b,c=new Promise(function(a){b=a}),d={execute:b,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(d,a),c},b.executeNext=function(a){var b=this.buffers,c=this.queues,e=b[a],f=c[a];if(f.length){var g=f[0];try{g.execute()}catch(b){d.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(b),e&&e.updating||(f.shift(),this.executeNext(a))}}},b.shiftAndExecuteNext=function(a){this.queues[a].shift(),this.executeNext(a)},b.current=function(a){return this.queues[a][0]},a}()},"./src/controller/cap-level-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}c.r(b);var f=c("./src/events.ts"),g=function(){function a(a){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=a,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var b=a.prototype;return b.setStreamController=function(a){this.streamController=a},b.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},b.registerListeners=function(){var a=this.hls;a.on(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),a.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.unregisterListener=function(){var a=this.hls;a.off(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),a.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.onFpsDropLevelCapping=function(b,c){a.isLevelAllowed(c.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(c.droppedLevel)},b.onMediaAttaching=function(a,b){this.media=b.media instanceof HTMLVideoElement?b.media:null},b.onManifestParsed=function(a,b){var c=this.hls;this.restrictedLevels=[],this.firstLevel=b.firstLevel,c.config.capLevelToPlayerSize&&b.video&&this.startCapping()},b.onBufferCodecs=function(a,b){this.hls.config.capLevelToPlayerSize&&b.video&&this.startCapping()},b.onMediaDetaching=function(){this.stopCapping()},b.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var a=this.hls.levels;if(a.length){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a.length-1),b.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},b.getMaxLevel=function(b){var c=this,d=this.hls.levels;if(!d.length)return-1;var e=d.filter(function(d,e){return a.isLevelAllowed(e,c.restrictedLevels)&&e<=b});return this.clientRect=null,a.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},b.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},b.getDimensions=function(){if(this.clientRect)return this.clientRect;var a=this.media,b={width:0,height:0};if(a){var c=a.getBoundingClientRect();b.width=c.width,b.height=c.height,b.width||b.height||(b.width=c.right-c.left||a.width||0,b.height=c.bottom-c.top||a.height||0)}return this.clientRect=b,b},a.isLevelAllowed=function(a,b){return void 0===b&&(b=[]),-1===b.indexOf(a)},a.getMaxLevelByMediaSize=function(a,b,c){if(!a||!a.length)return-1;for(var d=function(a,b){return!b||(a.width!==b.width||a.height!==b.height)},e=a.length-1,f=0;f<a.length;f+=1){var g=a[f];if((g.width>=b||g.height>=c)&&d(g,a[f+1])){e=f;break}}return e},e(a,[{key:"mediaWidth",get:function(){return this.getDimensions().width*a.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*a.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var a=1;try{a=self.devicePixelRatio}catch(a){}return a}}]),a}();b.default=g},"./src/controller/eme-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}c.r(b);var f=c("./src/events.ts"),g=c("./src/errors.ts"),h=c("./src/utils/logger.ts"),i=c("./src/utils/mediakeys-helper.ts"),j=3,k=function(a,b,c){var d={audioCapabilities:[],videoCapabilities:[]};return a.forEach(function(a){d.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:c.audioRobustness||""})}),b.forEach(function(a){d.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:c.videoRobustness||""})}),[d]},l=function(a,b,c,d){switch(a){case i.KeySystems.WIDEVINE:return k(b,c,d);default:throw new Error("Unknown key-system: "+a)}},m=function(){function a(a){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=a,this._config=a.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var b=a.prototype;return b.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},b._registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this)},b._unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this)},b.getLicenseServerUrl=function(a){switch(a){case i.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+a+'"')},b._attemptKeySystemAccess=function(a,b,c){var d=this,e=l(a,b,c,this._drmSystemOptions);h.logger.log("Requesting encrypted media key-system access");var f=this.requestMediaKeySystemAccess(a,e);this.mediaKeysPromise=f.then(function(b){return d._onMediaKeySystemAccessObtained(a,b)}),f.catch(function(b){h.logger.error('Failed to obtain key-system "'+a+'" access:',b)})},b._onMediaKeySystemAccessObtained=function(a,b){var c=this;h.logger.log('Access for key-system "'+a+'" obtained');var d={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:b,mediaKeySystemDomain:a};this._mediaKeysList.push(d);var e=Promise.resolve().then(function(){return b.createMediaKeys()}).then(function(b){return d.mediaKeys=b,h.logger.log('Media-keys created for key-system "'+a+'"'),c._onMediaKeysCreated(),b});return e.catch(function(a){h.logger.error("Failed to create media-keys:",a)}),e},b._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),a._onNewMediaKeySession(b.mediaKeysSession))})},b._onNewMediaKeySession=function(a){var b=this;h.logger.log("New key-system session "+a.sessionId),a.addEventListener("message",function(c){b._onKeySessionMessage(a,c.message)},!1)},b._onKeySessionMessage=function(a,b){h.logger.log("Got EME message event, creating license request"),this._requestLicense(b,function(b){h.logger.log("Received license data (length: "+(b?b.byteLength:b)+"), updating key-session"),a.update(b)})},b.onMediaEncrypted=function(a){var b=this;if(h.logger.log('Media is encrypted using "'+a.initDataType+'" init data type'),!this.mediaKeysPromise)return h.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var c=function(c){b._media&&(b._attemptSetMediaKeys(c),b._generateRequestWithPreferredKeySession(a.initDataType,a.initData))};this.mediaKeysPromise.then(c).catch(c)},b._attemptSetMediaKeys=function(a){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var b=this._mediaKeysList[0];if(!b||!b.mediaKeys)return h.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});h.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(b.mediaKeys),this._hasSetMediaKeys=!0}},b._generateRequestWithPreferredKeySession=function(a,b){var c=this,d=this._mediaKeysList[0];if(!d)return h.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(d.mediaKeysSessionInitialized)return void h.logger.warn("Key-Session already initialized but requested again");var e=d.mediaKeysSession;return e?b?(h.logger.log('Generating key-session request for "'+a+'" init data type'),d.mediaKeysSessionInitialized=!0,void e.generateRequest(a,b).then(function(){h.logger.debug("Key-session generation succeeded")}).catch(function(a){h.logger.error("Error generating key-session request:",a),c.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})):(h.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(h.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}))},b._createLicenseXhr=function(a,b,c){var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,d,a,b,c);var e=this._licenseXhrSetup;if(e)try{e.call(this.hls,d,a),e=void 0}catch(a){h.logger.error(a)}try{d.readyState||d.open("POST",a,!0),e&&e.call(this.hls,d,a)}catch(a){throw new Error("issue setting up KeySystem license XHR "+a)}return d},b._onLicenseRequestReadyStageChange=function(a,b,c,d){switch(a.readyState){case 4:if(200===a.status){this._requestLicenseFailureCount=0,h.logger.log("License request succeeded");var e=a.response,i=this._licenseResponseCallback;if(i)try{e=i.call(this.hls,a,b)}catch(a){h.logger.error(a)}d(e)}else{if(h.logger.error("License Request XHR failed ("+b+"). Status: "+a.status+" ("+a.statusText+")"),++this._requestLicenseFailureCount>j)return void this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var k=j-this._requestLicenseFailureCount+1;h.logger.warn("Retrying license request, "+k+" attempts left"),this._requestLicense(c,d)}}},b._generateLicenseRequestChallenge=function(a,b){switch(a.mediaKeySystemDomain){case i.KeySystems.WIDEVINE:return b}throw new Error("unsupported key-system: "+a.mediaKeySystemDomain)},b._requestLicense=function(a,b){h.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c)return h.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var d=this.getLicenseServerUrl(c.mediaKeySystemDomain),e=this._createLicenseXhr(d,a,b);h.logger.log("Sending license request to URL: "+d);var i=this._generateLicenseRequestChallenge(c,a);e.send(i)}catch(a){h.logger.error("Failure requesting DRM license: "+a),this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},b.onMediaAttached=function(a,b){if(this._emeEnabled){var c=b.media;this._media=c,c.addEventListener("encrypted",this._onMediaEncrypted)}},b.onMediaDetached=function(){var a=this._media,b=this._mediaKeysList;a&&(a.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(b.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return a.setMediaKeys(null)}).catch(function(){}))},b.onManifestParsed=function(a,b){if(this._emeEnabled){var c=b.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),d=b.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(i.KeySystems.WIDEVINE,c,d)}},e(a,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),a}();b.default=m},"./src/controller/fps-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/events.ts"),e=c("./src/utils/logger.ts"),f=function(){function a(a){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=a,this.registerListeners()}var b=a.prototype;return b.setStreamController=function(a){this.streamController=a},b.registerListeners=function(){this.hls.on(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},b.unregisterListeners=function(){this.hls.off(d.Events.MEDIA_ATTACHING,this.onMediaAttaching)},b.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},b.onMediaAttaching=function(a,b){var c=this.hls.config;if(c.capLevelOnFPSDrop){var d=b.media instanceof self.HTMLVideoElement?b.media:null;this.media=d,d&&"function"==typeof d.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),c.fpsDroppedMonitoringPeriod)}},b.checkFPS=function(a,b,c){var f=performance.now();if(b){if(this.lastTime){var g=f-this.lastTime,h=c-this.lastDroppedFrames,i=b-this.lastDecodedFrames,j=1e3*h/g,k=this.hls;if(k.trigger(d.Events.FPS_DROP,{currentDropped:h,currentDecoded:i,totalDroppedFrames:c}),j>0&&h>k.config.fpsDroppedMonitoringThreshold*i){var l=k.currentLevel;e.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(-1===k.autoLevelCapping||k.autoLevelCapping>=l)&&(l-=1,k.trigger(d.Events.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:k.currentLevel}),k.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=f,this.lastDroppedFrames=c,this.lastDecodedFrames=b}},b.checkFPSInterval=function(){var a=this.media;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)},a}();b.default=f},"./src/controller/fragment-finders.ts":function(a,b,c){"use strict";function d(a,b,c){if(null===b||!Array.isArray(a)||!a.length||!Object(i.isFiniteNumber)(b))return null;if(b<(a[0].programDateTime||0))return null;if(b>=(a[a.length-1].endProgramDateTime||0))return null;c=c||0;for(var d=0;d<a.length;++d){var e=a[d];if(g(b,c,e))return e}return null}function e(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0);var e=null;if(a?e=b[a.sn-b[0].sn+1]||null:0===c&&0===b[0].start&&(e=b[0]),e&&0===f(c,d,e))return e;var g=j.default.search(b,f.bind(null,c,d));return g||e}function f(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0);var d=Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-d<=a?1:c.start-d>a&&c.start?-1:0}function g(a,b,c){var d=1e3*Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return(c.endProgramDateTime||0)-d>a}function h(a,b){return j.default.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}c.r(b),c.d(b,"findFragmentByPDT",function(){return d}),c.d(b,"findFragmentByPTS",function(){return e}),c.d(b,"fragmentWithinToleranceTest",function(){return f}),c.d(b,"pdtWithinToleranceTest",function(){return g}),c.d(b,"findFragWithCC",function(){return h});var i=c("./src/polyfills/number.ts"),j=c("./src/utils/binary-search.ts")},"./src/controller/fragment-tracker.ts":function(a,b,c){"use strict";function d(a){var b,c;return a.buffered&&((null===(b=a.range.video)||void 0===b?void 0:b.partial)||(null===(c=a.range.audio)||void 0===c?void 0:c.partial))}function e(a){return a.type+"_"+a.level+"_"+a.urlId+"_"+a.sn}c.r(b),c.d(b,"FragmentState",function(){return f}),c.d(b,"FragmentTracker",function(){return i});var f,g=c("./src/events.ts"),h=c("./src/types/loader.ts");!function(a){a.NOT_LOADED="NOT_LOADED",a.BACKTRACKED="BACKTRACKED",a.APPENDING="APPENDING",a.PARTIAL="PARTIAL",a.OK="OK"}(f||(f={}));var i=function(){function a(a){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=a,this._registerListeners()}var b=a.prototype;return b._registerListeners=function(){var a=this.hls;a.on(g.Events.BUFFER_APPENDED,this.onBufferAppended,this),a.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(g.Events.FRAG_LOADED,this.onFragLoaded,this)},b._unregisterListeners=function(){var a=this.hls;a.off(g.Events.BUFFER_APPENDED,this.onBufferAppended,this),a.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(g.Events.FRAG_LOADED,this.onFragLoaded,this)},b.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},b.getAppendedFrag=function(a,b){if(b===h.PlaylistLevelType.MAIN){var c=this.activeFragment,d=this.activeParts;if(!c)return null;if(d)for(var e=d.length;e--;){var f=d[e],g=f?f.end:c.appendedPTS;if(f.start<=a&&void 0!==g&&a<=g)return e>9&&(this.activeParts=d.slice(e-9)),f}else if(c.start<=a&&void 0!==c.appendedPTS&&a<=c.appendedPTS)return c}return this.getBufferedFrag(a,b)},b.getBufferedFrag=function(a,b){for(var c=this.fragments,d=Object.keys(c),e=d.length;e--;){var f=c[d[e]];if((null===f||void 0===f?void 0:f.body.type)===b&&f.buffered){var g=f.body;if(g.start<=a&&a<=g.end)return g}}return null},b.detectEvictedFragments=function(a,b,c){var d=this;Object.keys(this.fragments).forEach(function(e){var f=d.fragments[e];if(f){if(!f.buffered)return void(f.body.type===c&&d.removeFragment(f.body));var g=f.range[a];g&&g.time.some(function(a){var c=!d.isTimeBuffered(a.startPTS,a.endPTS,b);return c&&d.removeFragment(f.body),c})}})},b.detectPartialFragments=function(a){var b=this,c=this.timeRanges,d=a.frag,f=a.part;if(c&&"initSegment"!==d.sn){var g=e(d),h=this.fragments[g];h&&(Object.keys(c).forEach(function(a){var e=d.elementaryStreams[a];if(e){var g=c[a],i=null!==f||!0===e.partial;h.range[a]=b.getBufferedTimes(d,f,i,g)}}),h.backtrack=h.loaded=null,Object.keys(h.range).length?h.buffered=!0:this.removeFragment(h.body))}},b.fragBuffered=function(a){var b=e(a),c=this.fragments[b];c&&(c.backtrack=c.loaded=null,c.buffered=!0)},b.getBufferedTimes=function(a,b,c,d){for(var e={time:[],partial:c},f=b?b.start:a.start,g=b?b.end:a.end,h=a.minEndPTS||g,i=a.maxStartPTS||f,j=0;j<d.length;j++){var k=d.start(j)-this.bufferPadding,l=d.end(j)+this.bufferPadding;if(i>=k&&h<=l){e.time.push({startPTS:Math.max(f,d.start(j)),endPTS:Math.min(g,d.end(j))});break}if(f<l&&g>k)e.partial=!0,e.time.push({startPTS:Math.max(f,d.start(j)),endPTS:Math.min(g,d.end(j))});else if(g<=k)break}return e},b.getPartialFragment=function(a){var b,c,e,f=null,g=0,h=this.bufferPadding,i=this.fragments;return Object.keys(i).forEach(function(j){var k=i[j];k&&d(k)&&(c=k.body.start-h,e=k.body.end+h,a>=c&&a<=e&&(b=Math.min(a-c,e-a),g<=b&&(f=k.body,g=b)))}),f},b.getState=function(a){var b=e(a),c=this.fragments[b];return c?c.buffered?d(c)?f.PARTIAL:f.OK:c.backtrack?f.BACKTRACKED:f.APPENDING:f.NOT_LOADED},b.backtrack=function(a,b){var c=e(a),d=this.fragments[c];if(!d||d.backtrack)return null;var f=d.backtrack=b||d.loaded;return d.loaded=null,f},b.getBacktrackData=function(a){var b=e(a),c=this.fragments[b];if(c){var d,f=c.backtrack;if(null!==f&&void 0!==f&&null!==(d=f.payload)&&void 0!==d&&d.byteLength)return f;this.removeFragment(a)}return null},b.isTimeBuffered=function(a,b,c){for(var d,e,f=0;f<c.length;f++){if(d=c.start(f)-this.bufferPadding,e=c.end(f)+this.bufferPadding,a>=d&&b<=e)return!0;if(b<=d)return!1}return!1},b.onFragLoaded=function(a,b){var c=b.frag,d=b.part;if("initSegment"!==c.sn&&!c.bitrateTest&&!d){var f=e(c);this.fragments[f]={body:c,loaded:b,backtrack:null,buffered:!1,range:Object.create(null)}}},b.onBufferAppended=function(a,b){var c=this,d=b.frag,e=b.part,f=b.timeRanges;if(d.type===h.PlaylistLevelType.MAIN)if(this.activeFragment=d,e){var g=this.activeParts;g||(this.activeParts=g=[]),g.push(e)}else this.activeParts=null;this.timeRanges=f,Object.keys(f).forEach(function(a){var b=f[a];if(c.detectEvictedFragments(a,b),!e)for(var g=0;g<b.length;g++)d.appendedPTS=Math.max(b.end(g),d.appendedPTS||0)})},b.onFragBuffered=function(a,b){this.detectPartialFragments(b)},b.hasFragment=function(a){var b=e(a);return!!this.fragments[b]},b.removeFragmentsInRange=function(a,b,c){var d=this;Object.keys(this.fragments).forEach(function(e){var f=d.fragments[e];if(f&&f.buffered){var g=f.body;g.type===c&&g.start<b&&g.end>a&&d.removeFragment(g)}})},b.removeFragment=function(a){var b=e(a);a.stats.loaded=0,a.clearElementaryStreamInfo(),delete this.fragments[b]},b.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},a}()},"./src/controller/gap-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"STALL_MINIMUM_DURATION_MS",function(){return h}),c.d(b,"MAX_START_GAP_JUMP",function(){return i}),c.d(b,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return j}),c.d(b,"SKIP_BUFFER_RANGE_START",function(){return k}),c.d(b,"default",function(){return l});var d=c("./src/utils/buffer-helper.ts"),e=c("./src/errors.ts"),f=c("./src/events.ts"),g=c("./src/utils/logger.ts"),h=250,i=2,j=.1,k=.05,l=function(){function a(a,b,c,d){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=a,this.media=b,this.fragmentTracker=c,this.hls=d}var b=a.prototype;return b.destroy=function(){this.hls=this.fragmentTracker=this.media=null},b.poll=function(a){var b=this.config,c=this.media,e=this.stalled,f=c.currentTime,j=c.seeking,k=this.seeking&&!j,l=!this.seeking&&j;if(this.seeking=j,f===a){if((l||k)&&(this.stalled=null),!c.paused&&!c.ended&&0!==c.playbackRate&&d.BufferHelper.getBuffered(c).length){var m=d.BufferHelper.bufferInfo(c,f,0),n=m.len>0,o=m.nextStart||0;if(n||o){if(j){var p=m.len>i,q=!o||o-f>i&&!this.fragmentTracker.getPartialFragment(f);if(p||q)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var r,s=Math.max(o,m.start||0)-f,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,u=null===t||void 0===t?void 0:null===(r=t.details)||void 0===r?void 0:r.live,v=u?2*t.details.targetduration:i;if(s>0&&s<=v)return void this._trySkipBufferHole(null)}var w=self.performance.now();if(null===e)return void(this.stalled=w);var x=w-e;!j&&x>=h&&this._reportStall(m.len);var y=d.BufferHelper.bufferInfo(c,f,b.maxBufferHole);this._tryFixBufferStall(y,x)}}}else if(this.moved=!0,null!==e){if(this.stallReported){var z=self.performance.now()-e;g.logger.warn("playback not stuck anymore @"+f+", after "+Math.round(z)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},b._tryFixBufferStall=function(a,b){var c=this.config,d=this.fragmentTracker,e=this.media,f=e.currentTime,h=d.getPartialFragment(f);if(h){if(this._trySkipBufferHole(h))return}a.len>c.maxBufferHole&&b>1e3*c.highBufferWatchdogPeriod&&(g.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},b._reportStall=function(a){var b=this.hls,c=this.media;this.stallReported||(this.stallReported=!0,g.logger.warn("Playback stalling at @"+c.currentTime+" due to low buffer (buffer="+a+")"),b.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))},b._trySkipBufferHole=function(a){for(var b=this.config,c=this.hls,h=this.media,i=h.currentTime,l=0,m=d.BufferHelper.getBuffered(h),n=0;n<m.length;n++){var o=m.start(n);if(i+b.maxBufferHole>=l&&i<o){var p=Math.max(o+k,h.currentTime+j);return g.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+p),this.moved=!0,this.stalled=null,h.currentTime=p,a&&c.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+p,frag:a}),p}l=m.end(n)}return 0},b._tryNudgeBuffer=function(){var a=this.config,b=this.hls,c=this.media,d=c.currentTime,h=(this.nudgeRetry||0)+1;if(this.nudgeRetry=h,h<a.nudgeMaxRetry){var i=d+h*a.nudgeOffset;g.logger.warn("Nudging 'currentTime' from "+d+" to "+i),c.currentTime=i,b.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else g.logger.error("Playhead still not moving while enough data buffered @"+d+" after "+a.nudgeMaxRetry+" nudges"),b.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},a}()},"./src/controller/id3-track-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/events.ts"),e=c("./src/utils/texttrack-utils.ts"),f=c("./src/demux/id3.ts"),g=.25,h=function(){function a(a){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=a,this._registerListeners()}var b=a.prototype;return b.destroy=function(){this._unregisterListeners()},b._registerListeners=function(){var a=this.hls;a.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(d.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},b._unregisterListeners=function(){var a=this.hls;a.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(d.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},b.onMediaAttached=function(a,b){this.media=b.media},b.onMediaDetaching=function(){this.id3Track&&(Object(e.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},b.getID3Track=function(a){if(this.media){for(var b=0;b<a.length;b++){var c=a[b];if("metadata"===c.kind&&"id3"===c.label)return Object(e.sendAddTrackEvent)(c,this.media),c}return this.media.addTextTrack("metadata","id3")}},b.onFragParsingMetadata=function(a,b){if(this.media){var c=b.frag,d=b.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var e=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,h=0;h<d.length;h++){var i=f.getID3Frames(d[h].data);if(i){var j=d[h].pts,k=h<d.length-1?d[h+1].pts:c.end;k-j<=0&&(k=j+g);for(var l=0;l<i.length;l++){var m=i[l];if(!f.isTimeStampFrame(m)){var n=new e(j,k,"");n.value=m,this.id3Track.addCue(n)}}}}}},b.onBufferFlushing=function(a,b){var c=b.startOffset,d=b.endOffset,f=b.type;if(!f||"audio"===f){var g=this.id3Track;g&&Object(e.removeCuesInRange)(g,c,d)}},a}();b.default=h},"./src/controller/latency-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}c.r(b),c.d(b,"default",function(){return i});var f=c("./src/errors.ts"),g=c("./src/events.ts"),h=c("./src/utils/logger.ts"),i=function(){function a(a){var b=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return b.timeupdate()},this.hls=a,this.config=a.config,this.registerListeners()}var b=a.prototype;return b.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},b.registerListeners=function(){this.hls.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(g.Events.ERROR,this.onError,this)},b.unregisterListeners=function(){this.hls.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(g.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(g.Events.ERROR,this.onError)},b.onMediaAttached=function(a,b){this.media=b.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},b.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},b.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},b.onLevelUpdated=function(a,b){var c=b.details;this.levelDetails=c,c.advanced&&this.timeupdate(),!c.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},b.onError=function(a,b){b.details===f.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,h.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},b.timeupdate=function(){var a=this.media,b=this.levelDetails;if(a&&b){this.currentTime=a.currentTime;var c=this.computeLatency();if(null!==c){this._latency=c;var d=this.config,e=d.lowLatencyMode,f=d.maxLiveSyncPlaybackRate;if(e&&1!==f){var g=this.targetLatency;if(null!==g){var h=c-g,i=Math.min(this.maxLatency,g+b.targetduration),j=h<i;if(b.live&&j&&h>.05&&this.forwardBufferLength>1){var k=Math.min(2,Math.max(1,f)),l=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;a.playbackRate=Math.min(k,Math.max(1,l))}else 1!==a.playbackRate&&0!==a.playbackRate&&(a.playbackRate=1)}}}}},b.estimateLiveEdge=function(){var a=this.levelDetails;return null===a?null:a.edge+a.age},b.computeLatency=function(){var a=this.estimateLiveEdge();return null===a?null:a-this.currentTime},e(a,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var a=this.config,b=this.levelDetails;return void 0!==a.liveMaxLatencyDuration?a.liveMaxLatencyDuration:b?a.liveMaxLatencyDurationCount*b.targetduration:0}},{key:"targetLatency",get:function(){var a=this.levelDetails;if(null===a)return null;var b=a.holdBack,c=a.partHoldBack,d=a.targetduration,e=this.config,f=e.liveSyncDuration,g=e.liveSyncDurationCount,h=e.lowLatencyMode,i=this.hls.userConfig,j=h?c||b:b;(i.liveSyncDuration||i.liveSyncDurationCount||0===j)&&(j=void 0!==f?f:g*d);var k=d;return j+Math.min(1*this.stallCount,k)}},{key:"liveSyncPosition",get:function(){var a=this.estimateLiveEdge(),b=this.targetLatency,c=this.levelDetails;if(null===a||null===b||null===c)return null;var d=c.edge,e=a-b-this.edgeStalled,f=d-c.totalduration,g=d-(this.config.lowLatencyMode&&c.partTarget||c.targetduration);return Math.min(Math.max(f,e),g)}},{key:"drift",get:function(){var a=this.levelDetails;return null===a?1:a.drift}},{key:"edgeStalled",get:function(){var a=this.levelDetails;if(null===a)return 0;var b=3*(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.max(a.age-b,0)}},{key:"forwardBufferLength",get:function(){var a=this.media,b=this.levelDetails;if(!a||!b)return 0;var c=a.buffered.length;return c?a.buffered.end(c-1):b.edge-this.currentTime}}]),a}()},"./src/controller/level-controller.ts":function(a,b,c){"use strict";function d(){return d=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},d.apply(this,arguments)}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}function g(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,h(a,b)}function h(a,b){return(h=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b),c.d(b,"default",function(){return q});var i=c("./src/types/level.ts"),j=c("./src/events.ts"),k=c("./src/errors.ts"),l=c("./src/utils/codecs.ts"),m=c("./src/controller/level-helper.ts"),n=c("./src/controller/base-playlist-controller.ts"),o=c("./src/types/loader.ts"),p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),q=function(a){function b(b){var c;return c=a.call(this,b,"[level-controller]")||this,c._levels=[],c._firstLevel=-1,c._startLevel=void 0,c.currentLevelIndex=-1,c.manualLevelIndex=-1,c.onParsedComplete=void 0,c._registerListeners(),c}g(b,a);var c=b.prototype;return c._registerListeners=function(){var a=this.hls;a.on(j.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(j.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(j.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(j.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(j.Events.ERROR,this.onError,this)},c._unregisterListeners=function(){var a=this.hls;a.off(j.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(j.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(j.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(j.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(j.Events.ERROR,this.onError,this)},c.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,a.prototype.destroy.call(this)},c.startLoad=function(){this._levels.forEach(function(a){a.loadError=0}),a.prototype.startLoad.call(this)},c.onManifestLoaded=function(a,b){var c,d,e=[],f=[],g=[],h={},n=!1,o=!1,q=!1;if(b.levels.forEach(function(a){var b=a.attrs;n=n||!(!a.width||!a.height),o=o||!!a.videoCodec,q=q||!!a.audioCodec,p&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0);var c=a.bitrate+"-"+a.attrs.RESOLUTION+"-"+a.attrs.CODECS;d=h[c],d?d.url.push(a.url):(d=new i.Level(a),h[c]=d,e.push(d)),b&&(b.AUDIO&&Object(m.addGroupId)(d,"audio",b.AUDIO),b.SUBTITLES&&Object(m.addGroupId)(d,"text",b.SUBTITLES))}),(n||o)&&q&&(e=e.filter(function(a){var b=a.videoCodec,c=a.width,d=a.height;return!!b||!(!c||!d)})),e=e.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||Object(l.isCodecSupportedInMp4)(b,"audio"))&&(!c||Object(l.isCodecSupportedInMp4)(c,"video"))}),b.audioTracks&&(f=b.audioTracks.filter(function(a){return!a.audioCodec||Object(l.isCodecSupportedInMp4)(a.audioCodec,"audio")}),Object(m.assignTrackIdsByGroup)(f)),b.subtitles&&(g=b.subtitles,Object(m.assignTrackIdsByGroup)(g)),e.length>0){c=e[0].bitrate,e.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=e;for(var r=0;r<e.length;r++)if(e[r].bitrate===c){this._firstLevel=r,this.log("manifest loaded, "+e.length+" level(s) found, first bitrate: "+c);break}var s=q&&!o,t={levels:e,audioTracks:f,subtitleTracks:g,firstLevel:this._firstLevel,stats:b.stats,audio:q,video:o,altAudio:!s&&f.some(function(a){return!!a.url})};this.hls.trigger(j.Events.MANIFEST_PARSED,t),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(j.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:b.url,reason:"no level with compatible codecs found in manifest"})},c.onError=function(b,c){if(a.prototype.onError.call(this,b,c),!c.fatal){var d=c.context,e=this._levels[this.currentLevelIndex];if(d&&(d.type===o.PlaylistContextType.AUDIO_TRACK&&e.audioGroupIds&&d.groupId===e.audioGroupIds[e.urlId]||d.type===o.PlaylistContextType.SUBTITLE_TRACK&&e.textGroupIds&&d.groupId===e.textGroupIds[e.urlId]))return void this.redundantFailover(this.currentLevelIndex);var f,g=!1,h=!0;switch(c.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:if(c.frag){var i=this._levels[c.frag.level];i?++i.fragmentError>this.hls.config.fragLoadingMaxRetry&&(f=c.frag.level):f=c.frag.level}break;case k.ErrorDetails.LEVEL_LOAD_ERROR:case k.ErrorDetails.LEVEL_LOAD_TIMEOUT:d&&(d.deliveryDirectives&&(h=!1),f=d.level),g=!0;break;case k.ErrorDetails.REMUX_ALLOC_ERROR:f=c.level,g=!0}void 0!==f&&this.recoverLevel(c,f,g,h)}},c.recoverLevel=function(a,b,c,d){var e=a.details,f=this._levels[b];if(f.loadError++,c){if(!this.retryLoadingOrFail(a))return void(this.currentLevelIndex=-1);a.levelRetry=!0}if(d){var g=f.url.length;if(g>1&&f.loadError<g)a.levelRetry=!0,this.redundantFailover(b);else if(-1===this.manualLevelIndex){var h=0===b?this._levels.length-1:b-1;this.currentLevelIndex!==h&&0===this._levels[h].loadError&&(this.warn(e+": switch to "+h),a.levelRetry=!0,this.hls.nextAutoLevel=h)}}},c.redundantFailover=function(a){var b=this._levels[a],c=b.url.length;if(c>1){var d=(b.urlId+1)%c;this.warn("Switching to redundant URL-id "+d),this._levels.forEach(function(a){a.urlId=d}),this.level=a}},c.onFragLoaded=function(a,b){var c=b.frag;if(void 0!==c&&c.type===o.PlaylistLevelType.MAIN){var d=this._levels[c.level];void 0!==d&&(d.fragmentError=0,d.loadError=0)}},c.onLevelLoaded=function(a,b){var c,d=b.level,e=b.details,f=this._levels[d];if(!f){var g;return this.warn("Invalid level index "+d),void(null!==(g=b.deliveryDirectives)&&void 0!==g&&g.skip&&(e.deltaUpdateFailed=!0))}d===this.currentLevelIndex?(0===f.fragmentError&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(d,b,f.details)):null!==(c=b.deliveryDirectives)&&void 0!==c&&c.skip&&(e.deltaUpdateFailed=!0)},c.onAudioTrackSwitched=function(a,b){var c=this.hls.levels[this.currentLevelIndex];if(c&&c.audioGroupIds){for(var d=-1,e=this.hls.audioTracks[b.id].groupId,f=0;f<c.audioGroupIds.length;f++)if(c.audioGroupIds[f]===e){d=f;break}d!==c.urlId&&(c.urlId=d,this.startLoad())}},c.loadPlaylist=function(a){var b=this.currentLevelIndex,c=this._levels[b];if(this.canLoad&&c&&c.url.length>0){var d=c.urlId,e=c.url[d];if(a)try{e=a.addDirectives(e)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Attempt loading level index "+b+(a?" at sn "+a.msn+" part "+a.part:"")+" with URL-id "+d+" "+e),this.clearTimer(),this.hls.trigger(j.Events.LEVEL_LOADING,{url:e,level:b,id:d,deliveryDirectives:a||null})}},c.removeLevel=function(a,b){var c=function(a,c){return c!==b},d=this._levels.filter(function(d,e){return e!==a||d.url.length>1&&void 0!==b&&(d.url=d.url.filter(c),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(c)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(c)),d.urlId=0,!0)}).map(function(a,b){var c=a.details;return null!==c&&void 0!==c&&c.fragments&&c.fragments.forEach(function(a){a.level=b}),a});this._levels=d,this.hls.trigger(j.Events.LEVELS_UPDATED,{levels:d})},f(b,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var b,c=this._levels;if(0!==c.length&&(this.currentLevelIndex!==a||null===(b=c[a])||void 0===b||!b.details)){if(a<0||a>=c.length){var e=a<0;if(this.hls.trigger(j.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:e,reason:"invalid level idx"}),e)return;a=Math.min(a,c.length-1)}this.clearTimer();var f=this.currentLevelIndex,g=c[f],h=c[a];this.log("switching to level "+a+" from "+f),this.currentLevelIndex=a;var i=d({},h,{level:a,maxBitrate:h.maxBitrate,uri:h.uri,urlId:h.urlId});delete i._urlId,this.hls.trigger(j.Events.LEVEL_SWITCHING,i);var l=h.details;if(!l||l.live){var m=this.switchParams(h.uri,null===g||void 0===g?void 0:g.details);this.loadPlaylist(m)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)}}]),b}(n.default)},"./src/controller/level-helper.ts":function(a,b,c){"use strict";function d(a,b,c){switch(b){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(c);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(c)}}function e(a){var b={};a.forEach(function(a){var c=a.groupId||"";a.id=b[c]=b[c]||0,b[c]++})}function f(a,b,c){g(a[b],a[c])}function g(a,b){var c=b.startPTS;if(Object(q.isFiniteNumber)(c)){var d,e=0;b.sn>a.sn?(e=c-a.start,d=a):(e=a.start-c,d=b),d.duration!==e&&(d.duration=e)}else if(b.sn>a.sn){var f=a.cc===b.cc;f&&a.minEndPTS?b.start=a.start+(a.minEndPTS-a.start):b.start=a.start+a.duration}else b.start=Math.max(a.start-b.duration,0)}function h(a,b,c,d,e,f){d-c<=0&&(r.logger.warn("Fragment should have a positive duration",b),d=c+b.duration,f=e+b.duration);var h=c,i=d,j=b.startPTS,k=b.endPTS;if(Object(q.isFiniteNumber)(j)){var l=Math.abs(j-c);Object(q.isFiniteNumber)(b.deltaPTS)?b.deltaPTS=Math.max(l,b.deltaPTS):b.deltaPTS=l,h=Math.max(c,j),c=Math.min(c,j),e=Math.min(e,b.startDTS),i=Math.min(d,k),d=Math.max(d,k),f=Math.max(f,b.endDTS)}b.duration=d-c;var m=c-b.start;b.appendedPTS=d,b.start=b.startPTS=c,b.maxStartPTS=h,b.startDTS=e,b.endPTS=d,b.minEndPTS=i,b.endDTS=f;var n=b.sn;if(!a||n<a.startSN||n>a.endSN)return 0;var o,p=n-a.startSN,s=a.fragments;for(s[p]=b,o=p;o>0;o--)g(s[o],s[o-1]);for(o=p;o<s.length-1;o++)g(s[o],s[o+1]);return a.fragmentHint&&g(s[s.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,m}function i(a,b){for(var c=null,d=a.fragments,e=d.length-1;e>=0;e--){var f=d[e].initSegment;if(f){c=f;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;var g,i=0;if(k(a,b,function(a,d){var e;a.relurl&&(i=a.cc-d.cc),Object(q.isFiniteNumber)(a.startPTS)&&Object(q.isFiniteNumber)(a.endPTS)&&(d.start=d.startPTS=a.startPTS,d.startDTS=a.startDTS,d.appendedPTS=a.appendedPTS,d.maxStartPTS=a.maxStartPTS,d.endPTS=a.endPTS,d.endDTS=a.endDTS,d.minEndPTS=a.minEndPTS,d.duration=a.endPTS-a.startPTS,d.duration&&(g=d),b.PTSKnown=b.alignedSliding=!0),d.elementaryStreams=a.elementaryStreams,d.loader=a.loader,d.stats=a.stats,d.urlId=a.urlId,a.initSegment?(d.initSegment=a.initSegment,c=a.initSegment):d.initSegment&&d.initSegment.relurl!=(null===(e=c)||void 0===e?void 0:e.relurl)||(d.initSegment=c)}),b.skippedSegments&&(b.deltaUpdateFailed=b.fragments.some(function(a){return!a}),b.deltaUpdateFailed)){r.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var m=b.skippedSegments;m--;)b.fragments.shift();b.startSN=b.fragments[0].sn,b.startCC=b.fragments[0].cc}var n=b.fragments;if(i){r.logger.warn("discontinuity sliding from playlist, take drift into account");for(var o=0;o<n.length;o++)n[o].cc+=i}b.skippedSegments&&(b.startCC=b.fragments[0].cc),j(a.partList,b.partList,function(a,b){b.elementaryStreams=a.elementaryStreams,b.stats=a.stats}),g?h(b,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):l(a,b),n.length&&(b.totalduration=b.edge-n[0].start),b.driftStartTime=a.driftStartTime,b.driftStart=a.driftStart;var p=b.advancedDateTime;if(b.advanced&&p){var s=b.edge;b.driftStart||(b.driftStartTime=p,b.driftStart=s),b.driftEndTime=p,b.driftEnd=s}else b.driftEndTime=a.driftEndTime,b.driftEnd=a.driftEnd,b.advancedDateTime=a.advancedDateTime}function j(a,b,c){if(a&&b)for(var d=0,e=0,f=a.length;e<=f;e++){var g=a[e],h=b[e+d];g&&h&&g.index===h.index&&g.fragment.sn===h.fragment.sn?c(g,h):d--}}function k(a,b,c){for(var d=b.skippedSegments,e=Math.max(a.startSN,b.startSN)-b.startSN,f=(a.fragmentHint?1:0)+(d?b.endSN:Math.min(a.endSN,b.endSN))-b.startSN,g=b.startSN-a.startSN,h=b.fragmentHint?b.fragments.concat(b.fragmentHint):b.fragments,i=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,j=e;j<=f;j++){var k=i[g+j],l=h[j];d&&!l&&j<d&&(l=b.fragments[j]=k),k&&l&&c(k,l)}}function l(a,b){var c=b.startSN+b.skippedSegments-a.startSN,d=a.fragments;c<0||c>=d.length||m(b,d[c].start)}function m(a,b){if(b){for(var c=a.fragments,d=a.skippedSegments;d<c.length;d++)c[d].start+=b;a.fragmentHint&&(a.fragmentHint.start+=b)}}function n(a,b){var c,d=1e3*a.levelTargetDuration,e=d/2,f=a.age,g=f>0&&f<3*d,h=b.loading.end-b.loading.start,i=a.availabilityDelay;if(!1===a.updated)if(g){var j=333*a.misses;c=Math.max(Math.min(e,2*h),j),a.availabilityDelay=(a.availabilityDelay||0)+c}else c=e;else g?(i=Math.min(i||d/2,f),a.availabilityDelay=i,c=i+d-f):c=d-h;return Math.round(c)}function o(a,b,c){if(!a||!a.details)return null;var d=a.details,e=d.fragments[b-d.startSN];return e||(e=d.fragmentHint,e&&e.sn===b?e:b<d.startSN&&c&&c.sn===b?c:null)}function p(a,b,c){if(!a||!a.details)return null;var d=a.details.partList;if(d)for(var e=d.length;e--;){var f=d[e];if(f.index===c&&f.fragment.sn===b)return f}return null}c.r(b),c.d(b,"addGroupId",function(){return d}),c.d(b,"assignTrackIdsByGroup",function(){return e}),c.d(b,"updatePTS",function(){return f}),c.d(b,"updateFragPTSDTS",function(){return h}),c.d(b,"mergeDetails",function(){return i}),c.d(b,"mapPartIntersection",function(){return j}),c.d(b,"mapFragmentIntersection",function(){return k}),c.d(b,"adjustSliding",function(){return l}),c.d(b,"addSliding",function(){return m}),c.d(b,"computeReloadInterval",function(){return n}),c.d(b,"getFragmentWithSN",function(){return o}),c.d(b,"getPartWith",function(){return p});var q=c("./src/polyfills/number.ts"),r=c("./src/utils/logger.ts")},"./src/controller/stream-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,g(a,b)}function g(a,b){return(g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b),c.d(b,"default",function(){return v});var h=c("./src/polyfills/number.ts"),i=c("./src/controller/base-stream-controller.ts"),j=c("./src/is-supported.ts"),k=c("./src/events.ts"),l=c("./src/utils/buffer-helper.ts"),m=c("./src/controller/fragment-tracker.ts"),n=c("./src/types/loader.ts"),o=c("./src/loader/fragment.ts"),p=c("./src/demux/transmuxer-interface.ts"),q=c("./src/types/transmuxer.ts"),r=c("./src/controller/gap-controller.ts"),s=c("./src/errors.ts"),t=c("./src/utils/logger.ts"),u=100,v=function(a){function b(b,c){var d;return d=a.call(this,b,c,"[stream-controller]")||this,d.audioCodecSwap=!1,d.gapController=null,d.level=-1,d._forceStartLoad=!1,d.altAudio=!1,d.audioOnly=!1,d.fragPlaying=null,d.onvplaying=null,d.onvseeked=null,d.fragLastKbps=0,d.stalled=!1,d.couldBacktrack=!1,d.audioCodecSwitch=!1,d.videoBuffer=null,d._registerListeners(),d}f(b,a);var c=b.prototype;return c._registerListeners=function(){var a=this.hls;a.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(k.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.on(k.Events.ERROR,this.onError,this),a.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c._unregisterListeners=function(){var a=this.hls;a.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.off(k.Events.ERROR,this.onError,this),a.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},c.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(u),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;-1===d&&(c.config.testBandwidth?(d=0,this.bitrateTest=!0):d=c.nextAutoLevel),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&-1===a&&(this.log("Override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=i.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this._forceStartLoad=!0,this.state=i.State.STOPPED},c.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},c.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_LEVEL:var a,b=this.levels,c=this.level,d=null===b||void 0===b?void 0:null===(a=b[c])||void 0===a?void 0:a.details;if(d&&(!d.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(d))break;this.state=i.State.IDLE;break}break;case i.State.FRAG_LOADING_WAITING_RETRY:var e,f=self.performance.now(),g=this.retryDate;(!g||f>=g||null!==(e=this.media)&&void 0!==e&&e.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=i.State.IDLE)}this.onTickEnd()},c.onTickEnd=function(){a.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},c.doTickIdle=function(){var a,b,c=this.hls,d=this.levelLastLoaded,e=this.levels,f=this.media,g=c.config,h=c.nextLoadLevel;if(null!==d&&(f||!this.startFragRequested&&g.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&e&&e[h]){var j=e[h];this.level=c.nextLoadLevel=h;var l=j.details;if(!l||this.state===i.State.WAITING_LEVEL||l.live&&this.levelLastLoaded!==h)return void(this.state=i.State.WAITING_LEVEL);var p=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:f,n.PlaylistLevelType.MAIN);if(null!==p){if(!(p.len>=this.getMaxBufferLength(j.maxBitrate))){if(this._streamEnded(p,l)){var q={};return this.altAudio&&(q.type="video"),this.hls.trigger(k.Events.BUFFER_EOS,q),void(this.state=i.State.ENDED)}var r=p.end,s=this.getNextFragment(r,l);if(this.couldBacktrack&&!this.fragPrevious&&s&&"initSegment"!==s.sn){var t=s.sn-l.startSN;t>1&&(s=l.fragments[t-1],this.fragmentTracker.removeFragment(s))}if(s&&this.fragmentTracker.getState(s)===m.FragmentState.OK&&this.nextLoadPosition>r){var u=this.audioOnly&&!this.altAudio?o.ElementaryStreamTypes.AUDIO:o.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(f,u,n.PlaylistLevelType.MAIN),s=this.getNextFragment(this.nextLoadPosition,l)}s&&(!s.initSegment||s.initSegment.data||this.bitrateTest||(s=s.initSegment),"identity"!==(null===(a=s.decryptdata)||void 0===a?void 0:a.keyFormat)||null!==(b=s.decryptdata)&&void 0!==b&&b.key?this.loadFragment(s,l,r):this.loadKey(s,l))}}}},c.loadFragment=function(b,c,d){var e,f=this.fragmentTracker.getState(b);if(this.fragCurrent=b,f===m.FragmentState.BACKTRACKED){var g=this.fragmentTracker.getBacktrackData(b);if(g)return this._handleFragmentLoadProgress(g),void this._handleFragmentLoadComplete(g);f=m.FragmentState.NOT_LOADED}f===m.FragmentState.NOT_LOADED||f===m.FragmentState.PARTIAL?"initSegment"===b.sn?this._loadInitSegment(b):this.bitrateTest?(b.bitrateTest=!0,this.log("Fragment "+b.sn+" of level "+b.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(b)):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,b,c,d)):f===m.FragmentState.APPENDING?this.reduceMaxBufferLength(b.duration)&&this.fragmentTracker.removeFragment(b):0===(null===(e=this.media)||void 0===e?void 0:e.buffered.length)&&this.fragmentTracker.removeAllFragments()},c.getAppendedFrag=function(a){var b=this.fragmentTracker.getAppendedFrag(a,n.PlaylistLevelType.MAIN);return b&&"fragment"in b?b.fragment:b},c.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,n.PlaylistLevelType.MAIN)},c.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.end+.5):null},c.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},c.nextLevelSwitch=function(){var a=this.levels,b=this.media;if(null!==b&&void 0!==b&&b.readyState){var c,d=this.getAppendedFrag(b.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!b.paused&&a){var e=this.hls.nextLoadLevel,f=a[e],g=this.fragLastKbps;c=g&&this.fragCurrent?this.fragCurrent.duration*f.maxBitrate/(1e3*g)+1:0}else c=0;var h=this.getBufferedFrag(b.currentTime+c);if(h){var i=this.followingBufferedFrag(h);if(i){this.abortCurrentFrag();var j=i.maxStartPTS?i.maxStartPTS:i.start,k=i.duration,l=Math.max(h.end,j+Math.min(Math.max(k-this.config.maxFragLookUpTolerance,.5*k),.75*k));this.flushMainBuffer(l,Number.POSITIVE_INFINITY)}}}},c.abortCurrentFrag=function(){var a=this.fragCurrent;this.fragCurrent=null,null!==a&&void 0!==a&&a.loader&&a.loader.abort(),this.state===i.State.KEY_LOADING&&(this.state=i.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},c.flushMainBuffer=function(b,c){a.prototype.flushMainBuffer.call(this,b,c,this.altAudio?"video":null)},c.onMediaAttached=function(b,c){a.prototype.onMediaAttached.call(this,b,c);var d=c.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),d.addEventListener("playing",this.onvplaying),d.addEventListener("seeked",this.onvseeked),this.gapController=new r.default(this.config,d,this.fragmentTracker,this.hls)},c.onMediaDetaching=function(){var b=this.media;b&&(b.removeEventListener("playing",this.onvplaying),b.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),a.prototype.onMediaDetaching.call(this)},c.onMediaPlaying=function(){this.tick()},c.onMediaSeeked=function(){var a=this.media,b=a?a.currentTime:null;Object(h.isFiniteNumber)(b)&&this.log("Media seeked to "+b.toFixed(3)),this.tick()},c.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(k.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},c.onManifestParsed=function(a,b){var c,d=!1,e=!1;b.levels.forEach(function(a){(c=a.audioCodec)&&(-1!==c.indexOf("mp4a.40.2")&&(d=!0),-1!==c.indexOf("mp4a.40.5")&&(e=!0))}),this.audioCodecSwitch=d&&e&&!Object(j.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=b.levels,this.startFragRequested=!1},c.onLevelLoading=function(a,b){var c=this.levels;if(c&&this.state===i.State.IDLE){var d=c[b.level];(!d.details||d.details.live&&this.levelLastLoaded!==b.level||this.waitForCdnTuneIn(d.details))&&(this.state=i.State.WAITING_LEVEL)}},c.onLevelLoaded=function(a,b){var c,d=this.levels,e=b.level,f=b.details,g=f.totalduration;if(!d)return void this.warn("Levels were reset while loading level "+e);this.log("Level "+e+" loaded ["+f.startSN+","+f.endSN+"], cc ["+f.startCC+", "+f.endCC+"] duration:"+g);var h=this.fragCurrent;!h||this.state!==i.State.FRAG_LOADING&&this.state!==i.State.FRAG_LOADING_WAITING_RETRY||h.level!==b.level&&h.loader&&(this.state=i.State.IDLE,h.loader.abort());var j=d[e],l=0;if(f.live||null!==(c=j.details)&&void 0!==c&&c.live){if(f.fragments[0]||(f.deltaUpdateFailed=!0),f.deltaUpdateFailed)return;l=this.alignPlaylists(f,j.details)}if(j.details=f,this.levelLastLoaded=e,this.hls.trigger(k.Events.LEVEL_UPDATED,{details:f,level:e}),this.state===i.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=i.State.IDLE}this.startFragRequested?f.live&&this.synchronizeToLiveEdge(f):this.setStartPosition(f,l),this.tick()},c._handleFragmentLoadProgress=function(a){var b,c=a.frag,d=a.part,e=a.payload,f=this.levels;if(!f)return void this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");var g=f[c.level],h=g.details;if(!h)return void this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset");var i=g.videoCodec,j=h.PTSKnown||!h.live,k=null===(b=c.initSegment)||void 0===b?void 0:b.data,l=this._getAudioCodec(g),m=this.transmuxer=this.transmuxer||new p.default(this.hls,n.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),o=d?d.index:-1,r=-1!==o,s=new q.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,e.byteLength,o,r),t=this.initPTS[c.cc];m.push(e,k,l,i,c,d,h.totalduration,j,s,t)},c.onAudioTrackSwitching=function(a,b){var c=this.altAudio,d=!!b.url,e=b.id;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;null!==f&&void 0!==f&&f.loader&&(this.log("Switching to main audio track, cancel main fragment load"),f.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var g=this.hls;c&&g.trigger(k.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),g.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:e})}},c.onAudioTrackSwitched=function(a,b){var c=b.id,d=!!this.hls.audioTracks[c].url;if(d){var e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=d,this.tick()},c.onBufferCreated=function(a,b){var c,d,e=b.tracks,f=!1;for(var g in e){var h=e[g];if("main"===h.id){if(d=g,c=h,"video"===g){var i=e[g];i&&(this.videoBuffer=i.buffer)}}else f=!0}f&&c?(this.log("Alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},c.onFragBuffered=function(a,b){var c=b.frag,d=b.part;if(!c||c.type===n.PlaylistLevelType.MAIN){if(this.fragContextChanged(c))return this.warn("Fragment "+c.sn+(d?" p: "+d.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===i.State.PARSED&&(this.state=i.State.IDLE));var e=d?d.stats:c.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),"initSegment"!==c.sn&&(this.fragPrevious=c),this.fragBufferedComplete(c,d)}},c.onError=function(a,b){switch(b.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(n.PlaylistLevelType.MAIN,b);break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==i.State.ERROR&&(b.fatal?(this.warn(""+b.details),this.state=i.State.ERROR):b.levelRetry||this.state!==i.State.WAITING_LEVEL||(this.state=i.State.IDLE));break;case s.ErrorDetails.BUFFER_FULL_ERROR:if("main"===b.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var c=!0,d=this.getFwdBufferInfo(this.media,n.PlaylistLevelType.MAIN);d&&d.len>.5&&(c=!this.reduceMaxBufferLength(d.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},c.checkBuffer=function(){var a=this.media,b=this.gapController;if(a&&b&&a.readyState){var c=l.BufferHelper.getBuffered(a);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):b.poll(this.lastCurrentTime),this.lastCurrentTime=a.currentTime}},c.onFragLoadEmergencyAborted=function(){this.state=i.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},c.onBufferFlushed=function(a,b){var c=b.type;if(c!==o.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var d=(c===o.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(d,c,n.PlaylistLevelType.MAIN)}},c.onLevelsUpdated=function(a,b){this.levels=b.levels},c.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},c.seekToStartPos=function(){var a=this.media,b=a.currentTime,c=this.startPosition;if(c>=0&&b<c){if(a.seeking)return void t.logger.log("could not seek to "+c+", already seeking at "+b);var d=l.BufferHelper.getBuffered(a),e=d.length?d.start(0):0,f=e-c;f>0&&f<this.config.maxBufferHole&&(t.logger.log("adjusting start position by "+f+" to match buffer start"),c+=f,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+b),a.currentTime=c}},c._getAudioCodec=function(a){var b=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&b&&(this.log("Swapping audio codec"),b=-1!==b.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),b},c._loadBitrateTestFrag=function(a){var b=this;this._doFragLoad(a).then(function(c){var d=b.hls;if(c&&!d.nextLoadLevel&&!b.fragContextChanged(a)){b.fragLoadError=0,b.state=i.State.IDLE,b.startFragRequested=!1,b.bitrateTest=!1;var e=a.stats;e.parsing.start=e.parsing.end=e.buffering.start=e.buffering.end=self.performance.now(),d.trigger(k.Events.FRAG_LOADED,c)}})},c._handleTransmuxComplete=function(a){var b,c="main",d=this.hls,e=a.remuxResult,f=a.chunkMeta,g=this.getCurrentContext(f);if(!g)return this.warn("The loading context changed while buffering fragment "+f.sn+" of level "+f.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(f.level);var j=g.frag,l=g.part,m=g.level,n=e.video,p=e.text,q=e.id3,r=e.initSegment,s=this.altAudio?void 0:e.audio;if(!this.fragContextChanged(j)){if(this.state=i.State.PARSING,r){r.tracks&&(this._bufferInitSegment(m,r.tracks,j,f),d.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:j,id:c,tracks:r.tracks}));var t=r.initPTS,u=r.timescale;Object(h.isFiniteNumber)(t)&&(this.initPTS[j.cc]=t,d.trigger(k.Events.INIT_PTS_FOUND,{frag:j,id:c,initPTS:t,timescale:u}))}if(n&&!1!==e.independent){if(m.details){var v=n.startPTS,w=n.endPTS,x=n.startDTS,y=n.endDTS;if(l)l.elementaryStreams[n.type]={startPTS:v,endPTS:w,startDTS:x,endDTS:y};else if(n.firstKeyFrame&&n.independent&&(this.couldBacktrack=!0),n.dropped&&n.independent){var z=this.getLoadPosition()+this.config.maxBufferHole;if(z<v)return void this.backtrack(j);j.setElementaryStreamInfo(n.type,j.start,w,j.start,y,!0)}j.setElementaryStreamInfo(n.type,v,w,x,y),this.bufferFragmentData(n,j,l,f)}}else if(!1===e.independent)return void this.backtrack(j);if(s){var A=s.startPTS,B=s.endPTS,C=s.startDTS,D=s.endDTS;l&&(l.elementaryStreams[o.ElementaryStreamTypes.AUDIO]={startPTS:A,endPTS:B,startDTS:C,endDTS:D}),j.setElementaryStreamInfo(o.ElementaryStreamTypes.AUDIO,A,B,C,D),this.bufferFragmentData(s,j,l,f)}if(null!==q&&void 0!==q&&null!==(b=q.samples)&&void 0!==b&&b.length){var E={frag:j,id:c,samples:q.samples};d.trigger(k.Events.FRAG_PARSING_METADATA,E)}if(p){var F={frag:j,id:c,samples:p.samples};d.trigger(k.Events.FRAG_PARSING_USERDATA,F)}}},c._bufferInitSegment=function(a,b,c,d){var e=this;if(this.state===i.State.PARSING){this.audioOnly=!!b.audio&&!b.video,this.altAudio&&!this.audioOnly&&delete b.audio;var f=b.audio,g=b.video,h=b.audiovideo;if(f){var j=a.audioCodec,l=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(j&&(j=-1!==j.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==f.metadata.channelCount&&-1===l.indexOf("firefox")&&(j="mp4a.40.5")),-1!==l.indexOf("android")&&"audio/mpeg"!==f.container&&(j="mp4a.40.2",this.log("Android: force audio codec to "+j)),a.audioCodec&&a.audioCodec!==j&&this.log('Swapping manifest audio codec "'+a.audioCodec+'" for "'+j+'"'),f.levelCodec=j,f.id="main",this.log("Init audio buffer, container:"+f.container+", codecs[selected/level/parsed]=["+(j||"")+"/"+(a.audioCodec||"")+"/"+f.codec+"]")}g&&(g.levelCodec=a.videoCodec,g.id="main",this.log("Init video buffer, container:"+g.container+", codecs[level/parsed]=["+(a.videoCodec||"")+"/"+g.codec+"]")),h&&this.log("Init audiovideo buffer, container:"+h.container+", codecs[level/parsed]=["+(a.attrs.CODECS||"")+"/"+h.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,b),Object.keys(b).forEach(function(a){var f=b[a],g=f.initSegment;null!==g&&void 0!==g&&g.byteLength&&e.hls.trigger(k.Events.BUFFER_APPENDING,{type:a,data:g,frag:c,part:null,chunkMeta:d,parent:c.type})}),this.tick()}},c.backtrack=function(a){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(a);var b=this.fragmentTracker.backtrack(a);this.fragPrevious=null,this.nextLoadPosition=a.start,b?this.resetFragmentLoading(a):this.state=i.State.BACKTRACKING},c.checkFragmentChanged=function(){var a=this.media,b=null;if(a&&a.readyState>1&&!1===a.seeking){var c=a.currentTime;if(l.BufferHelper.isBuffered(a,c)?b=this.getAppendedFrag(c):l.BufferHelper.isBuffered(a,c+.1)&&(b=this.getAppendedFrag(c+.1)),b){var d=this.fragPlaying,e=b.level;d&&b.sn===d.sn&&d.level===e&&b.urlId===d.urlId||(this.hls.trigger(k.Events.FRAG_CHANGED,{frag:b}),d&&d.level===e||this.hls.trigger(k.Events.LEVEL_SWITCHED,{level:e}),this.fragPlaying=b)}}},e(b,[{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getAppendedFrag(a.currentTime);if(b)return b.level}return-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;if(a){var b=this.getAppendedFrag(a.currentTime);return this.followingBufferedFrag(b)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),b}(i.default)},"./src/controller/subtitle-stream-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,g(a,b)}function g(a,b){return(g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b),c.d(b,"SubtitleStreamController",function(){return s});var h=c("./src/events.ts"),i=c("./src/utils/logger.ts"),j=c("./src/utils/buffer-helper.ts"),k=c("./src/controller/fragment-finders.ts"),l=c("./src/utils/discontinuities.ts"),m=c("./src/controller/level-helper.ts"),n=c("./src/controller/fragment-tracker.ts"),o=c("./src/controller/base-stream-controller.ts"),p=c("./src/types/loader.ts"),q=c("./src/types/level.ts"),r=500,s=function(a){function b(b,c){var d;return d=a.call(this,b,c,"[subtitle-stream-controller]")||this,d.levels=[],d.currentTrackId=-1,d.tracksBuffered=[],d.mainDetails=null,d._registerListeners(),d}f(b,a);var c=b.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var a=this.hls;a.on(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(h.Events.ERROR,this.onError,this),a.on(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(h.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(h.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(h.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c._unregisterListeners=function(){var a=this.hls;a.off(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(h.Events.ERROR,this.onError,this),a.off(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(h.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(h.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(h.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c.startLoad=function(){this.stopLoad(),this.state=o.State.IDLE,this.setInterval(r),this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},c.onLevelLoaded=function(a,b){this.mainDetails=b.details},c.onSubtitleFragProcessed=function(a,b){var c=b.frag,d=b.success;if(this.fragPrevious=c,this.state=o.State.IDLE,d){var e=this.tracksBuffered[this.currentTrackId];if(e){for(var f,g=c.start,h=0;h<e.length;h++)if(g>=e[h].start&&g<=e[h].end){f=e[h];break}var i=c.start+c.duration;f?f.end=i:(f={start:g,end:i},e.push(f)),this.fragmentTracker.fragBuffered(c)}}},c.onBufferFlushing=function(a,b){var c=b.startOffset,d=b.endOffset;if(0===c&&d!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,f=this.levels;if(!f.length||!f[e]||!f[e].details)return;var g=f[e].details,h=g.targetduration,i=d-h;if(i<=0)return;b.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(function(a){for(var b=0;b<a.length;)if(a[b].end<=i)a.shift();else{if(!(a[b].start<i))break;a[b].start=i,b++}}),this.fragmentTracker.removeFragmentsInRange(c,i,p.PlaylistLevelType.SUBTITLE)}},c.onError=function(a,b){var c,d=b.frag;d&&d.type===p.PlaylistLevelType.SUBTITLE&&(null!==(c=this.fragCurrent)&&void 0!==c&&c.loader&&this.fragCurrent.loader.abort(),this.state=o.State.IDLE)},c.onSubtitleTracksUpdated=function(a,b){var c=this,d=b.subtitleTracks;this.tracksBuffered=[],this.levels=d.map(function(a){return new q.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){c.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},c.onSubtitleTrackSwitch=function(a,b){if(this.currentTrackId=b.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();var c=this.levels[this.currentTrackId];null!==c&&void 0!==c&&c.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(r)):this.mediaBuffer=null},c.onSubtitleTrackLoaded=function(a,b){var c,d=b.details,e=b.id,f=this.currentTrackId,g=this.levels;if(g.length){var h=g[f];if(!(e>=g.length||e!==f)&&h){if(this.mediaBuffer=this.mediaBufferTimeRanges,d.live||null!==(c=h.details)&&void 0!==c&&c.live){var i=this.mainDetails;if(d.deltaUpdateFailed||!i)return;var j=i.fragments[0];if(h.details){0===this.alignPlaylists(d,h.details)&&j&&Object(m.addSliding)(d,j.start)}else d.hasProgramDateTime&&i.hasProgramDateTime?Object(l.alignPDT)(d,i):j&&Object(m.addSliding)(d,j.start)}if(h.details=d,this.levelLastLoaded=e,this.tick(),d.live&&!this.fragCurrent&&this.media&&this.state===o.State.IDLE){Object(k.findFragmentByPTS)(null,d.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)}}}},c._handleFragmentLoadComplete=function(a){var b=a.frag,c=a.payload,d=b.decryptdata,e=this.hls;if(!this.fragContextChanged(b)&&c&&c.byteLength>0&&d&&d.key&&d.iv&&"AES-128"===d.method){var f=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(c),d.key.buffer,d.iv.buffer).then(function(a){var c=performance.now();e.trigger(h.Events.FRAG_DECRYPTED,{frag:b,payload:a,stats:{tstart:f,tdecrypt:c}})})}},c.doTick=function(){if(!this.media)return void(this.state=o.State.IDLE);if(this.state===o.State.IDLE){var a,b=this.currentTrackId,c=this.levels;if(!c.length||!c[b]||!c[b].details)return;var d=c[b].details,e=d.targetduration,f=this.config,g=this.media,l=j.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,g.currentTime-e,f.maxBufferHole),m=l.end;if(l.len>this.getMaxBufferLength()+e)return;console.assert(d,"Subtitle track details are defined on idle subtitle stream controller tick");var p,q=d.fragments,r=q.length,s=d.edge,t=this.fragPrevious;if(m<s){var u=f.maxFragLookUpTolerance;t&&d.hasProgramDateTime&&(p=Object(k.findFragmentByPDT)(q,t.endProgramDateTime,u)),p||!(p=Object(k.findFragmentByPTS)(t,q,m,u))&&t&&t.start<q[0].start&&(p=q[0])}else p=q[r-1];null!==(a=p)&&void 0!==a&&a.encrypted?(i.logger.log("Loading key for "+p.sn),this.state=o.State.KEY_LOADING,this.hls.trigger(h.Events.KEY_LOADING,{frag:p})):p&&this.fragmentTracker.getState(p)===n.FragmentState.NOT_LOADED&&this.loadFragment(p,d,m)}},c.loadFragment=function(b,c,d){this.fragCurrent=b,a.prototype.loadFragment.call(this,b,c,d)},e(b,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),b}(o.default)},"./src/controller/subtitle-track-controller.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,g(a,b)}function g(a,b){return(g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function h(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];"subtitles"===d.kind&&d.label&&b.push(a[c])}return b}c.r(b);var i=c("./src/events.ts"),j=c("./src/utils/texttrack-utils.ts"),k=c("./src/controller/base-playlist-controller.ts"),l=c("./src/types/loader.ts"),m=function(a){function b(b){var c;return c=a.call(this,b,"[subtitle-track-controller]")||this,c.media=null,c.tracks=[],c.groupId=null,c.tracksInGroup=[],c.trackId=-1,c.selectDefaultTrack=!0,c.queuedDefaultTrack=-1,c.trackChangeListener=function(){return c.onTextTracksChanged()},c.asyncPollTrackChange=function(){return c.pollTrackChange(0)},c.useTextTrackPolling=!1,c.subtitlePollingInterval=-1,c.subtitleDisplay=!0,c.registerListeners(),c}f(b,a);var c=b.prototype;return c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,a.prototype.destroy.call(this)},c.registerListeners=function(){var a=this.hls;a.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(i.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var a=this.hls;a.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(i.Events.ERROR,this.onError,this)},c.onMediaAttached=function(a,b){this.media=b.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},c.pollTrackChange=function(a){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,a)},c.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);h(this.media.textTracks).forEach(function(a){Object(j.clearCurrentCues)(a)}),this.subtitleTrack=-1,this.media=null}},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},c.onManifestParsed=function(a,b){this.tracks=b.subtitleTracks},c.onSubtitleTrackLoaded=function(a,b){var c=b.id,d=b.details,e=this.trackId,f=this.tracksInGroup[e];if(!f)return void this.warn("Invalid subtitle track id "+c);var g=f.details;f.details=b.details,this.log("subtitle track "+c+" loaded ["+d.startSN+"-"+d.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,b,g))},c.onLevelLoading=function(a,b){this.switchLevel(b.level)},c.onLevelSwitching=function(a,b){this.switchLevel(b.level)},c.switchLevel=function(a){var b=this.hls.levels[a];if(null!==b&&void 0!==b&&b.textGroupIds){var c=b.textGroupIds[b.urlId];if(this.groupId!==c){var d=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,e=this.tracks.filter(function(a){return!c||a.groupId===c});this.tracksInGroup=e;var f=this.findTrackId(null===d||void 0===d?void 0:d.name)||this.findTrackId();this.groupId=c;var g={subtitleTracks:e};this.log("Updating subtitle tracks, "+e.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(i.Events.SUBTITLE_TRACKS_UPDATED,g),-1!==f&&this.setSubtitleTrack(f,d)}}},c.findTrackId=function(a){for(var b=this.tracksInGroup,c=0;c<b.length;c++){var d=b[c];if((!this.selectDefaultTrack||d.default)&&(!a||a===d.name))return d.id}return-1},c.onError=function(b,c){a.prototype.onError.call(this,b,c),!c.fatal&&c.context&&c.context.type===l.PlaylistContextType.SUBTITLE_TRACK&&c.context.id===this.trackId&&c.context.groupId===this.groupId&&this.retryLoadingOrFail(c)},c.loadPlaylist=function(a){var b=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(b)){var c=b.id,d=b.groupId,e=b.url;if(a)try{e=a.addDirectives(e)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+c),this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADING,{url:e,id:c,groupId:d,deliveryDirectives:a||null})}},c.toggleTrackModes=function(a){var b=this,c=this.media,d=this.subtitleDisplay,e=this.trackId;if(c){var f=h(c.textTracks),g=f.filter(function(a){return a.groupId===b.groupId});if(-1===a)[].slice.call(f).forEach(function(a){a.mode="disabled"});else{var i=g[e];i&&(i.mode="disabled")}var j=g[a];j&&(j.mode=d?"showing":"hidden")}},c.setSubtitleTrack=function(a,b){var c,d=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=a);if(this.trackId!==a&&this.toggleTrackModes(a),!(this.trackId===a&&(-1===a||null!==(c=d[a])&&void 0!==c&&c.details)||a<-1||a>=d.length)){this.clearTimer();var e=d[a];if(this.log("Switching to subtitle track "+a),this.trackId=a,e){var f=e.id,g=e.groupId,h=void 0===g?"":g,j=e.name,k=e.type,l=e.url;this.hls.trigger(i.Events.SUBTITLE_TRACK_SWITCH,{id:f,groupId:h,name:j,type:k,url:l});var m=this.switchParams(e.url,null===b||void 0===b?void 0:b.details);this.loadPlaylist(m)}else this.hls.trigger(i.Events.SUBTITLE_TRACK_SWITCH,{id:a})}},c.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var a=-1,b=h(this.media.textTracks),c=0;c<b.length;c++)if("hidden"===b[c].mode)a=c;else if("showing"===b[c].mode){a=c;break}this.subtitleTrack!==a&&(this.subtitleTrack=a)}},e(b,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1;var b=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(a,b)}}]),b}(k.default);b.default=m},"./src/controller/timeline-controller.ts":function(a,b,c){"use strict";function d(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function e(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}function f(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}c.r(b),c.d(b,"TimelineController",function(){return p});var g=c("./src/polyfills/number.ts"),h=c("./src/events.ts"),i=c("./src/utils/cea-608-parser.ts"),j=c("./src/utils/output-filter.ts"),k=c("./src/utils/webvtt-parser.ts"),l=c("./src/utils/texttrack-utils.ts"),m=c("./src/utils/imsc1-ttml-parser.ts"),n=c("./src/types/loader.ts"),o=c("./src/utils/logger.ts"),p=function(){function a(a){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=f(),this.captionsProperties=void 0,this.hls=a,this.config=a.config,this.Cues=a.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var b=new j.default(this,"textTrack1"),c=new j.default(this,"textTrack2"),d=new j.default(this,"textTrack3"),e=new j.default(this,"textTrack4");this.cea608Parser1=new i.default(1,b,c),this.cea608Parser2=new i.default(3,d,e)}a.on(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(h.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(h.Events.FRAG_LOADING,this.onFragLoading,this),a.on(h.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(h.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.on(h.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.on(h.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(h.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.on(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var b=a.prototype;return b.destroy=function(){var a=this.hls;a.off(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(h.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(h.Events.FRAG_LOADING,this.onFragLoading,this),a.off(h.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(h.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.off(h.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.off(h.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(h.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.off(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},b.addCues=function(a,b,c,d,f){for(var g=!1,i=f.length;i--;){var j=f[i],k=e(j[0],j[1],b,c);if(k>=0&&(j[0]=Math.min(j[0],b),j[1]=Math.max(j[1],c),g=!0,k/(c-b)>.5))return}if(g||f.push([b,c]),this.config.renderTextTracksNatively){var l=this.captionsTracks[a];this.Cues.newCue(l,b,c,d)}else{var m=this.Cues.newCue(null,b,c,d);this.hls.trigger(h.Events.CUES_PARSED,{type:"captions",cues:m,track:a})}},b.onInitPtsFound=function(a,b){var c=this,d=b.frag,e=b.id,f=b.initPTS,g=b.timescale,i=this.unparsedVttFrags;"main"===e&&(this.initPTS[d.cc]=f,this.timescale[d.cc]=g),i.length&&(this.unparsedVttFrags=[],i.forEach(function(a){c.onFragLoaded(h.Events.FRAG_LOADED,a)}))},b.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c];if(d[a])return d}return null},b.createCaptionsTrack=function(a){this.config.renderTextTracksNatively?this.createNativeTrack(a):this.createNonNativeTrack(a)},b.createNativeTrack=function(a){if(!this.captionsTracks[a]){var b=this.captionsProperties,c=this.captionsTracks,d=this.media,e=b[a],f=e.label,g=e.languageCode,h=this.getExistingTrack(a);if(h)c[a]=h,Object(l.clearCurrentCues)(c[a]),Object(l.sendAddTrackEvent)(c[a],d);else{var i=this.createTextTrack("captions",f,g);i&&(i[a]=!0,c[a]=i)}}},b.createNonNativeTrack=function(a){if(!this.nonNativeCaptionsTracks[a]){var b=this.captionsProperties[a];if(b){var c=b.label,d={_id:a,label:c,kind:"captions",default:!!b.media&&!!b.media.default,closedCaptions:b.media};this.nonNativeCaptionsTracks[a]=d,this.hls.trigger(h.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[d]})}}},b.createTextTrack=function(a,b,c){var d=this.media;if(d)return d.addTextTrack(a,b,c)},b.onMediaAttaching=function(a,b){this.media=b.media,this._cleanTracks()},b.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(b){Object(l.clearCurrentCues)(a[b]),delete a[b]}),this.nonNativeCaptionsTracks={}},b.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=f(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},b._cleanTracks=function(){var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)Object(l.clearCurrentCues)(b[c])}},b.onSubtitleTracksUpdated=function(a,b){var c=this;this.textTracks=[];var e=b.subtitleTracks||[],f=e.some(function(a){return a.textCodec===m.IMSC1_CODEC});if(this.config.enableWebVTT||f&&this.config.enableIMSC1){var g=this.tracks&&e&&this.tracks.length===e.length;if(this.tracks=e||[],this.config.renderTextTracksNatively){var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,b){var e;if(b<i.length){for(var f=null,g=0;g<i.length;g++)if(d(i[g],a)){f=i[g];break}f&&(e=f)}e?Object(l.clearCurrentCues)(e):(e=c.createTextTrack("subtitles",a.name,a.lang))&&(e.mode="disabled"),e&&(e.groupId=a.groupId,c.textTracks.push(e))})}else if(!g&&this.tracks&&this.tracks.length){var j=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(h.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:j})}}},b.onManifestLoaded=function(a,b){var c=this;this.config.enableCEA708Captions&&b.captions&&b.captions.forEach(function(a){var b=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);if(b){var d="textTrack"+b[1],e=c.captionsProperties[d];e&&(e.label=a.name,a.lang&&(e.languageCode=a.lang),e.media=a)}})},b.onFragLoading=function(a,b){var c=this.cea608Parser1,d=this.cea608Parser2,e=this.lastSn;if(this.enabled&&c&&d&&b.frag.type===n.PlaylistLevelType.MAIN){var f=b.frag.sn;f!==e+1&&(c.reset(),d.reset()),this.lastSn=f}},b.onFragLoaded=function(a,b){var c=b.frag,d=b.payload,e=this.initPTS,f=this.unparsedVttFrags;if(c.type===n.PlaylistLevelType.SUBTITLE)if(d.byteLength){if(!Object(g.isFiniteNumber)(e[c.cc]))return f.push(b),void(e.length&&this.hls.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:new Error("Missing initial subtitle PTS")}));var i=c.decryptdata;if(null==i||null==i.key||"AES-128"!==i.method){var j=this.tracks[c.level],k=this.vttCCs;k[c.cc]||(k[c.cc]={start:c.start,prevCC:this.prevCC,new:!0},this.prevCC=c.cc),j&&j.textCodec===m.IMSC1_CODEC?this._parseIMSC1(c,d):this._parseVTTs(c,d,k)}}else this.hls.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:new Error("Empty subtitle payload")})},b._parseIMSC1=function(a,b){var c=this,d=this.hls;Object(m.parseIMSC1)(b,this.initPTS[a.cc],this.timescale[a.cc],function(b){c._appendCues(b,a.level),d.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(b){o.logger.log("Failed to parse IMSC1: "+b),d.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:b})})},b._parseVTTs=function(a,b,c){var d=this,e=this.hls;Object(k.parseWebVTT)(b,this.initPTS[a.cc],this.timescale[a.cc],c,a.cc,a.start,function(b){d._appendCues(b,a.level),e.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(c){d._fallbackToIMSC1(a,b),o.logger.log("Failed to parse VTT cue: "+c),e.trigger(h.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:c})})},b._fallbackToIMSC1=function(a,b){var c=this,d=this.tracks[a.level];d.textCodec||Object(m.parseIMSC1)(b,this.initPTS[a.cc],this.timescale[a.cc],function(){d.textCodec=m.IMSC1_CODEC,c._parseIMSC1(a,b)},function(){d.textCodec="wvtt"})},b._appendCues=function(a,b){var c=this.hls;if(this.config.renderTextTracksNatively){var d=this.textTracks[b];if("disabled"===d.mode)return;a.forEach(function(a){return Object(l.addCueToTrack)(d,a)})}else{var e=this.tracks[b],f=e.default?"default":"subtitles"+b;c.trigger(h.Events.CUES_PARSED,{type:"subtitles",cues:a,track:f})}},b.onFragDecrypted=function(a,b){var c=b.frag;if(c.type===n.PlaylistLevelType.SUBTITLE){if(!Object(g.isFiniteNumber)(this.initPTS[c.cc]))return void this.unparsedVttFrags.push(b);this.onFragLoaded(h.Events.FRAG_LOADED,b)}},b.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},b.onFragParsingUserdata=function(a,b){var c=this.cea608Parser1,d=this.cea608Parser2;if(this.enabled&&c&&d)for(var e=0;e<b.samples.length;e++){var f=b.samples[e].bytes;if(f){var g=this.extractCea608Data(f);c.addData(b.samples[e].pts,g[0]),d.addData(b.samples[e].pts,g[1])}}},b.onBufferFlushing=function(a,b){var c=b.startOffset,d=b.endOffset,e=b.endOffsetSubtitles,f=b.type,g=this.media;if(g&&!(g.currentTime<d)){if(!f||"video"===f){var h=this.captionsTracks;Object.keys(h).forEach(function(a){return Object(l.removeCuesInRange)(h[a],c,d)})}if(this.config.renderTextTracksNatively&&0===c&&void 0!==e){var i=this.textTracks;Object.keys(i).forEach(function(a){return Object(l.removeCuesInRange)(i[a],c,e)})}}},b.extractCea608Data=function(a){for(var b=31&a[0],c=2,d=[[],[]],e=0;e<b;e++){var f=a[c++],g=127&a[c++],h=127&a[c++],i=0!=(4&f),j=3&f;0===g&&0===h||i&&(0!==j&&1!==j||(d[j].push(g),d[j].push(h)))}return d},a}()},"./src/crypt/aes-crypto.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(a,b){this.subtle=void 0,this.aesIV=void 0,this.subtle=a,this.aesIV=b}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)},a}()},"./src/crypt/aes-decryptor.ts":function(a,b,c){"use strict";function d(a){var b=a.byteLength,c=b&&new DataView(a.buffer).getUint8(b-1);return c?Object(e.sliceUint8)(a,0,b-c):a}c.r(b),c.d(b,"removePadding",function(){return d}),c.d(b,"default",function(){return f});var e=c("./src/utils/typed-array.ts"),f=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var b=a.prototype;return b.uint8ArrayToUint32Array_=function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;d<4;d++)c[d]=b.getUint32(4*d);return c},b.initTable=function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;p<256;p++)m[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},b.expandKey=function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f,g,h,i,j=this.ksRows=4*(e+6+1),k=this.keySchedule=new Uint32Array(j),l=this.invKeySchedule=new Uint32Array(j),m=this.sBox,n=this.rcon,o=this.invSubMix,p=o[0],q=o[1],r=o[2],s=o[3];for(f=0;f<j;f++)f<e?h=k[f]=b[f]:(i=h,f%e==0?(i=i<<8|i>>>24,i=m[i>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i],i^=n[f/e|0]<<24):e>6&&f%e==4&&(i=m[i>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i]),k[f]=h=(k[f-e]^i)>>>0);for(g=0;g<j;g++)f=j-g,i=3&g?k[f]:k[f-4],l[g]=g<4||f<=4?i:p[m[i>>>24]]^q[m[i>>>16&255]]^r[m[i>>>8&255]]^s[m[255&i]],l[g]=l[g]>>>0}},b.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},b.decrypt=function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this.keySize+6,s=this.invKeySchedule,t=this.invSBox,u=this.invSubMix,v=u[0],w=u[1],x=u[2],y=u[3],z=this.uint8ArrayToUint32Array_(c),A=z[0],B=z[1],C=z[2],D=z[3],E=new Int32Array(a),F=new Int32Array(E.length),G=this.networkToHostOrderSwap;b<E.length;){for(l=G(E[b]),m=G(E[b+1]),n=G(E[b+2]),o=G(E[b+3]),h=l^s[0],i=o^s[1],j=n^s[2],k=m^s[3],p=4,q=1;q<r;q++)d=v[h>>>24]^w[i>>16&255]^x[j>>8&255]^y[255&k]^s[p],e=v[i>>>24]^w[j>>16&255]^x[k>>8&255]^y[255&h]^s[p+1],f=v[j>>>24]^w[k>>16&255]^x[h>>8&255]^y[255&i]^s[p+2],g=v[k>>>24]^w[h>>16&255]^x[i>>8&255]^y[255&j]^s[p+3],h=d,i=e,j=f,k=g,p+=4;d=t[h>>>24]<<24^t[i>>16&255]<<16^t[j>>8&255]<<8^t[255&k]^s[p],e=t[i>>>24]<<24^t[j>>16&255]<<16^t[k>>8&255]<<8^t[255&h]^s[p+1],f=t[j>>>24]<<24^t[k>>16&255]<<16^t[h>>8&255]<<8^t[255&i]^s[p+2],g=t[k>>>24]<<24^t[h>>16&255]<<16^t[i>>8&255]<<8^t[255&j]^s[p+3],F[b]=G(d^A),F[b+1]=G(g^B),F[b+2]=G(f^C),F[b+3]=G(e^D),A=l,B=m,C=n,D=o,b+=4}return F.buffer},a}()},"./src/crypt/decrypter.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return k});var d=c("./src/crypt/aes-crypto.ts"),e=c("./src/crypt/fast-aes-key.ts"),f=c("./src/crypt/aes-decryptor.ts"),g=c("./src/utils/logger.ts"),h=c("./src/utils/mp4-tools.ts"),i=c("./src/utils/typed-array.ts"),j=16,k=function(){function a(a,b,c){var d=void 0===c?{}:c,e=d.removePKCS7Padding,f=void 0===e||e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=a,this.config=b,this.removePKCS7Padding=f,f)try{var g=self.crypto;g&&(this.subtle=g.subtle||g.webkitSubtle)}catch(a){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var b=a.prototype;return b.destroy=function(){this.observer=null},b.isSync=function(){return this.config.enableSoftwareAES},b.flush=function(){var a=this.currentResult;if(!a)return void this.reset();var b=new Uint8Array(a);return this.reset(),this.removePKCS7Padding?Object(f.removePadding)(b):b},b.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},b.decrypt=function(a,b,c,d){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(a),b,c);var e=this.flush();e&&d(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(a),b,c).then(d)},b.softwareDecrypt=function(a,b,c){var d=this.currentIV,e=this.currentResult,g=this.remainderData;this.logOnce("JS AES decrypt"),g&&(a=Object(h.appendUint8Array)(g,a),this.remainderData=null);var j=this.getValidChunk(a);if(!j.length)return null;d&&(c=d);var k=this.softwareDecrypter;k||(k=this.softwareDecrypter=new f.default),k.expandKey(b);var l=e;return this.currentResult=k.decrypt(j.buffer,0,c),this.currentIV=Object(i.sliceUint8)(j,-16).buffer,l||null},b.webCryptoDecrypt=function(a,b,c){var f=this,g=this.subtle;return this.key===b&&this.fastAesKey||(this.key=b,this.fastAesKey=new e.default(g,b)),this.fastAesKey.expandKey().then(function(b){return g?new d.default(g,c).decrypt(a.buffer,b):Promise.reject(new Error("web crypto not initialized"))}).catch(function(d){return f.onWebCryptoError(d,a,b,c)})},b.onWebCryptoError=function(a,b,c,d){return g.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",a),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(b,c,d)},b.getValidChunk=function(a){var b=a,c=a.length-a.length%j;return c!==a.length&&(b=Object(i.sliceUint8)(a,0,c),this.remainderData=Object(i.sliceUint8)(a,c)),b},b.logOnce=function(a){this.logEnabled&&(g.logger.log("[decrypter.ts]: "+a),this.logEnabled=!1)},a}()},"./src/crypt/fast-aes-key.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(a,b){this.subtle=void 0,this.key=void 0,this.subtle=a,this.key=b}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}()},"./src/demux/aacdemuxer.ts":function(a,b,c){"use strict";function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,e(a,b)}function e(a,b){return(e=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b);var f=c("./src/demux/base-audio-demuxer.ts"),g=c("./src/demux/adts.ts"),h=c("./src/utils/logger.ts"),i=c("./src/demux/id3.ts"),j=function(a){function b(b,c){var d;return d=a.call(this)||this,d.observer=void 0,d.config=void 0,d.observer=b,d.config=c,d}d(b,a);var c=b.prototype;return c.resetInitSegment=function(b,c,d){a.prototype.resetInitSegment.call(this,b,c,d),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:b,duration:d,inputTimeScale:9e4,dropped:0}},b.probe=function(a){if(!a)return!1;for(var b=i.getID3Data(a,0)||[],c=b.length,d=a.length;c<d;c++)if(g.probe(a,c))return h.logger.log("ADTS sync word found !"),!0;return!1},c.canParse=function(a,b){return g.canParse(a,b)},c.appendFrame=function(a,b,c){g.initTrackConfig(a,this.observer,b,c,a.manifestCodec);var d=g.appendFrame(a,b,c,this.initPTS,this.frameIndex);if(d&&0===d.missing)return d},b}(f.default);j.minProbeByteLength=9,b.default=j},"./src/demux/adts.ts":function(a,b,c){"use strict";function d(a,b,c,d){var e,f,g,h,i=navigator.userAgent.toLowerCase(),j=d,k=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];e=1+((192&b[c+2])>>>6);var l=(60&b[c+2])>>>2;return l>k.length-1?void a.trigger(r.Events.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l}):(g=(1&b[c+2])<<2,g|=(192&b[c+3])>>>6,p.logger.log("manifest codec:"+d+", ADTS type:"+e+", samplingIndex:"+l),/firefox/i.test(i)?l>=6?(e=5,h=new Array(4),f=l-3):(e=2,h=new Array(2),f=l):-1!==i.indexOf("android")?(e=2,h=new Array(2),f=l):(e=5,h=new Array(4),d&&(-1!==d.indexOf("mp4a.40.29")||-1!==d.indexOf("mp4a.40.5"))||!d&&l>=6?f=l-3:((d&&-1!==d.indexOf("mp4a.40.2")&&(l>=6&&1===g||/vivaldi/i.test(i))||!d&&1===g)&&(e=2,h=new Array(2)),f=l)),h[0]=e<<3,h[0]|=(14&l)>>1,h[1]|=(1&l)<<7,h[1]|=g<<3,5===e&&(h[1]|=(14&f)>>1,h[2]=(1&f)<<7,h[2]|=8,h[3]=0),{config:h,samplerate:k[l],channelCount:g,codec:"mp4a.40."+e,manifestCodec:j})}function e(a,b){return 255===a[b]&&240==(246&a[b+1])}function f(a,b){return 1&a[b+1]?7:9}function g(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function h(a,b){return b+5<a.length}function i(a,b){return b+1<a.length&&e(a,b)}function j(a,b){return h(a,b)&&e(a,b)&&g(a,b)<=a.length-b}function k(a,b){if(i(a,b)){var c=f(a,b);if(b+c>=a.length)return!1;var d=g(a,b);if(d<=c)return!1;var e=b+d;return e===a.length||i(a,e)}return!1}function l(a,b,c,e,f){if(!a.samplerate){var g=d(b,c,e,f);if(!g)return;a.config=g.config,a.samplerate=g.samplerate,a.channelCount=g.channelCount,a.codec=g.codec,a.manifestCodec=g.manifestCodec,p.logger.log("parsed codec:"+a.codec+", rate:"+g.samplerate+", channels:"+g.channelCount)}}function m(a){return 9216e4/a}function n(a,b,c,d,e){var h=f(a,b),i=g(a,b);if((i-=h)>0){return{headerLength:h,frameLength:i,stamp:c+d*e}}}function o(a,b,c,d,e){var f=m(a.samplerate),g=n(b,c,d,e,f);if(g){var h,i=g.frameLength,j=g.headerLength,k=g.stamp,l=j+i,o=Math.max(0,c+l-b.length);o?(h=new Uint8Array(l-j),h.set(b.subarray(c+j,b.length),0)):h=b.subarray(c+j,c+l);var p={unit:h,pts:k};return o||a.samples.push(p),{sample:p,length:l,missing:o}}}c.r(b),c.d(b,"getAudioConfig",function(){return d}),c.d(b,"isHeaderPattern",function(){return e}),c.d(b,"getHeaderLength",function(){return f}),c.d(b,"getFullFrameLength",function(){return g}),c.d(b,"canGetFrameLength",function(){return h}),c.d(b,"isHeader",function(){return i}),c.d(b,"canParse",function(){return j}),c.d(b,"probe",function(){return k}),c.d(b,"initTrackConfig",function(){return l}),c.d(b,"getFrameDuration",function(){return m}),c.d(b,"parseFrameHeader",function(){return n}),c.d(b,"appendFrame",function(){return o});var p=c("./src/utils/logger.ts"),q=c("./src/errors.ts"),r=c("./src/events.ts")},"./src/demux/base-audio-demuxer.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"initPTSFn",function(){return j});var d=c("./src/polyfills/number.ts"),e=c("./src/demux/id3.ts"),f=c("./src/demux/dummy-demuxed-track.ts"),g=c("./src/utils/mp4-tools.ts"),h=c("./src/utils/typed-array.ts"),i=function(){function a(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var b=a.prototype;return b.resetInitSegment=function(a,b,c){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},b.resetTimeStamp=function(){},b.resetContiguity=function(){},b.canParse=function(a,b){return!1},b.appendFrame=function(a,b,c){},b.demux=function(a,b){this.cachedData&&(a=Object(g.appendUint8Array)(this.cachedData,a),this.cachedData=null);var c,d,i=e.getID3Data(a,0),k=i?i.length:0,l=this._audioTrack,m=this._id3Track,n=i?e.getTimeStamp(i):void 0,o=a.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=j(n,b)),i&&i.length>0&&m.samples.push({pts:this.initPTS,dts:this.initPTS,data:i}),d=this.initPTS;k<o;){if(this.canParse(a,k)){var p=this.appendFrame(l,a,k);p?(this.frameIndex++,d=p.sample.pts,k+=p.length,c=k):k=o}else e.canParse(a,k)?(i=e.getID3Data(a,k),m.samples.push({pts:d,dts:d,data:i}),k+=i.length,c=k):k++;if(k===o&&c!==o){var q=Object(h.sliceUint8)(a,c);this.cachedData?this.cachedData=Object(g.appendUint8Array)(this.cachedData,q):this.cachedData=q}}return{audioTrack:l,avcTrack:Object(f.dummyTrack)(),id3Track:m,textTrack:Object(f.dummyTrack)()}},b.demuxSampleAes=function(a,b,c){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},b.flush=function(a){var b=this.cachedData;return b&&(this.cachedData=null,this.demux(b,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(f.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(f.dummyTrack)()}},b.destroy=function(){},a}(),j=function(a,b){return Object(d.isFiniteNumber)(a)?90*a:9e4*b};b.default=i},"./src/demux/chunk-cache.ts":function(a,b,c){"use strict";function d(a,b){for(var c=new Uint8Array(b),d=0,e=0;e<a.length;e++){var f=a[e];c.set(f,d),d+=f.length}return c}c.r(b),c.d(b,"default",function(){return e});var e=function(){function a(){this.chunks=[],this.dataLength=0}var b=a.prototype;return b.push=function(a){this.chunks.push(a),this.dataLength+=a.length},b.flush=function(){var a,b=this.chunks,c=this.dataLength;return b.length?(a=1===b.length?b[0]:d(b,c),this.reset(),a):new Uint8Array(0)},b.reset=function(){this.chunks.length=0,this.dataLength=0},a}()},"./src/demux/dummy-demuxed-track.ts":function(a,b,c){"use strict";function d(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}c.r(b),c.d(b,"dummyTrack",function(){return d})},"./src/demux/exp-golomb.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/logger.ts"),e=function(){function a(a){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=a,this.bytesAvailable=a.byteLength,this.word=0,this.bitsAvailable=0}var b=a.prototype;return b.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},b.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},b.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&d.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c},b.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!=(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},b.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},b.readBoolean=function(){return 1===this.readBits(1)},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(a){for(var b,c=8,d=8,e=0;e<a;e++)0!==d&&(b=this.readEG(),d=(c+b+256)%256),c=0===d?c:d},b.readSPS=function(){var a,b,c,d=0,e=0,f=0,g=0,h=this.readUByte.bind(this),i=this.readBits.bind(this),j=this.readUEG.bind(this),k=this.readBoolean.bind(this),l=this.skipBits.bind(this),m=this.skipEG.bind(this),n=this.skipUEG.bind(this),o=this.skipScalingList.bind(this);h();var p=h();if(i(5),l(3),h(),n(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){var q=j();if(3===q&&l(1),n(),n(),l(1),k())for(b=3!==q?8:12,c=0;c<b;c++)k()&&o(c<6?16:64)}n();var r=j();if(0===r)j();else if(1===r)for(l(1),m(),m(),a=j(),c=0;c<a;c++)m();n(),l(1);var s=j(),t=j(),u=i(1);0===u&&l(1),l(1),k()&&(d=j(),e=j(),f=j(),g=j());var v=[1,1];if(k()&&k()){switch(h()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[h()<<8|h(),h()<<8|h()]}}return{width:Math.ceil(16*(s+1)-2*d-2*e),height:(2-u)*(t+1)*16-(u?2:4)*(f+g),pixelRatio:v}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}();b.default=e},"./src/demux/id3.ts":function(a,b,c){"use strict";function d(){return e||void 0===self.TextDecoder||(e=new self.TextDecoder("utf-8")),e}c.r(b),c.d(b,"isHeader",function(){return f}),c.d(b,"isFooter",function(){return g}),c.d(b,"getID3Data",function(){return h}),c.d(b,"canParse",function(){return j}),c.d(b,"getTimeStamp",function(){return k}),c.d(b,"isTimeStampFrame",function(){return l}),c.d(b,"getID3Frames",function(){return n}),c.d(b,"decodeFrame",function(){return o}),c.d(b,"utf8ArrayToStr",function(){return t}),c.d(b,"testables",function(){return u});var e,f=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},g=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},h=function(a,b){for(var c=b,d=0;f(a,b);){d+=10;d+=i(a,b+6),g(a,b+10)&&(d+=10),b+=d}if(d>0)return a.subarray(c,c+d)},i=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},j=function(a,b){return f(a,b)&&i(a,b+6)+10<=a.length-b},k=function(a){for(var b=n(a),c=0;c<b.length;c++){var d=b[c];if(l(d))return s(d)}},l=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},m=function(a){var b=String.fromCharCode(a[0],a[1],a[2],a[3]),c=i(a,4),d=10;return{type:b,size:c,data:a.subarray(d,d+c)}},n=function(a){for(var b=0,c=[];f(a,b);){var d=i(a,b+6);b+=10;for(var e=b+d;b+8<e;){var h=m(a.subarray(b)),j=o(h);j&&c.push(j),b+=h.size+10}g(a,b)&&(b+=10)}return c},o=function(a){return"PRIV"===a.type?p(a):"W"===a.type[0]?r(a):q(a)},p=function(a){if(!(a.size<2)){var b=t(a.data,!0),c=new Uint8Array(a.data.subarray(b.length+1));return{key:a.type,info:b,data:c.buffer}}},q=function(a){if(!(a.size<2)){if("TXXX"===a.type){var b=1,c=t(a.data.subarray(b),!0);b+=c.length+1;var d=t(a.data.subarray(b));return{key:a.type,info:c,data:d}}var e=t(a.data.subarray(1));return{key:a.type,data:e}}},r=function(a){if("WXXX"===a.type){if(a.size<2)return;var b=1,c=t(a.data.subarray(b),!0);b+=c.length+1;var d=t(a.data.subarray(b));return{key:a.type,info:c,data:d}}var e=t(a.data);return{key:a.type,data:e}},s=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return d/=45,c&&(d+=47721858.84),Math.round(d)}},t=function(a,b){void 0===b&&(b=!1);var c=d();if(c){var e=c.decode(a);if(b){var f=e.indexOf("\0");return-1!==f?e.substring(0,f):e}return e.replace(/\0/g,"")}for(var g,h,i,j=a.length,k="",l=0;l<j;){if(0===(g=a[l++])&&b)return k;if(0!==g&&3!==g)switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k+=String.fromCharCode(g);break;case 12:case 13:h=a[l++],k+=String.fromCharCode((31&g)<<6|63&h);break;case 14:h=a[l++],i=a[l++],k+=String.fromCharCode((15&g)<<12|(63&h)<<6|(63&i)<<0)}}return k},u={decodeTextFrame:q}},"./src/demux/mp3demuxer.ts":function(a,b,c){"use strict";function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,e(a,b)}function e(a,b){return(e=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}c.r(b);var f=c("./src/demux/base-audio-demuxer.ts"),g=c("./src/demux/id3.ts"),h=c("./src/utils/logger.ts"),i=c("./src/demux/mpegaudio.ts"),j=function(a){function b(){return a.apply(this,arguments)||this}d(b,a);var c=b.prototype;return c.resetInitSegment=function(b,c,d){a.prototype.resetInitSegment.call(this,b,c,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:b,duration:d,inputTimeScale:9e4,dropped:0}},b.probe=function(a){if(!a)return!1;for(var b=g.getID3Data(a,0)||[],c=b.length,d=a.length;c<d;c++)if(i.probe(a,c))return h.logger.log("MPEG Audio sync word found !"),!0;return!1},c.canParse=function(a,b){return i.canParse(a,b)},c.appendFrame=function(a,b,c){if(null!==this.initPTS)return i.appendFrame(a,b,c,this.initPTS,this.frameIndex)},b}(f.default);j.minProbeByteLength=4,b.default=j},"./src/demux/mp4demuxer.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/mp4-tools.ts"),e=c("./src/demux/dummy-demuxed-track.ts"),f=function(){function a(a,b){this.remainderData=null,this.config=void 0,this.config=b}var b=a.prototype;return b.resetTimeStamp=function(){},b.resetInitSegment=function(){},b.resetContiguity=function(){},a.probe=function(a){return Object(d.findBox)({data:a,start:0,end:Math.min(a.length,16384)},["moof"]).length>0},b.demux=function(a){var b=a,c=Object(e.dummyTrack)();if(this.config.progressive){this.remainderData&&(b=Object(d.appendUint8Array)(this.remainderData,a));var f=Object(d.segmentValidRange)(b);this.remainderData=f.remainder,c.samples=f.valid||new Uint8Array}else c.samples=b;return{audioTrack:Object(e.dummyTrack)(),avcTrack:c,id3Track:Object(e.dummyTrack)(),textTrack:Object(e.dummyTrack)()}},b.flush=function(){var a=Object(e.dummyTrack)();return a.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(e.dummyTrack)(),avcTrack:a,id3Track:Object(e.dummyTrack)(),textTrack:Object(e.dummyTrack)()}},b.demuxSampleAes=function(a,b,c){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},b.destroy=function(){},a}();f.minProbeByteLength=1024,b.default=f},"./src/demux/mpegaudio.ts":function(a,b,c){"use strict";function d(a,b,c,d,f){if(!(c+24>b.length)){var g=e(b,c);if(g&&c+g.frameLength<=b.length){var h=9e4*g.samplesPerFrame/g.sampleRate,i=d+f*h,j={unit:b.subarray(c,c+g.frameLength),pts:i,dts:i};return a.config=[],a.channelCount=g.channelCount,a.samplerate=g.sampleRate,a.samples.push(j),{sample:j,length:g.frameLength,missing:0}}}}function e(a,b){var c=a[b+1]>>3&3,d=a[b+1]>>1&3,e=a[b+2]>>4&15,f=a[b+2]>>2&3;if(1!==c&&0!==e&&15!==e&&3!==f){var g=a[b+2]>>1&1,h=a[b+3]>>6,i=3===c?3-d:3===d?3:4,o=1e3*k[14*i+e-1],p=3===c?0:2===c?1:2,q=l[3*p+f],r=3===h?1:2,s=m[c][d],t=n[d],u=8*s*t,v=Math.floor(s*o/q+g)*t;if(null===j){var w=navigator.userAgent||"",x=w.match(/Chrome\/(\d+)/i);j=x?parseInt(x[1]):0}return!!j&&j<=87&&2===d&&o>=224e3&&0===h&&(a[b+3]=128|a[b+3]),{sampleRate:q,channelCount:r,frameLength:v,samplesPerFrame:u}}}function f(a,b){return 255===a[b]&&224==(224&a[b+1])&&0!=(6&a[b+1])}function g(a,b){return b+1<a.length&&f(a,b)}function h(a,b){return f(a,b)&&4<=a.length-b}function i(a,b){if(b+1<a.length&&f(a,b)){var c=4,d=e(a,b),h=c;null!==d&&void 0!==d&&d.frameLength&&(h=d.frameLength);var i=b+h;return i===a.length||g(a,i)}return!1}c.r(b),c.d(b,"appendFrame",function(){return d}),c.d(b,"parseHeader",function(){return e}),c.d(b,"isHeaderPattern",function(){return f}),c.d(b,"isHeader",function(){return g}),c.d(b,"canParse",function(){return h}),c.d(b,"probe",function(){return i});var j=null,k=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],l=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],m=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],n=[0,1,1,4]},"./src/demux/sample-aes.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/crypt/decrypter.ts"),e=c("./src/demux/tsdemuxer.ts"),f=function(){function a(a,b,c){this.keyData=void 0,this.decrypter=void 0,this.keyData=c,this.decrypter=new d.default(a,b,{removePKCS7Padding:!1})}var b=a.prototype;return b.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.keyData.key.buffer,this.keyData.iv.buffer,b)},b.decryptAacSample=function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){var g=new Uint8Array(f);e.set(g,16),d||h.decryptAacSamples(a,b+1,c)})},b.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}},b.getAvcEncryptedData=function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c},b.getAvcDecryptedUnit=function(a,b){for(var c=new Uint8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)a.set(c.subarray(d,d+16),e);return a},b.decryptAvcSample=function(a,b,c,d,f,g){var h=Object(e.discardEPB)(f.data),i=this.getAvcEncryptedData(h),j=this;this.decryptBuffer(i.buffer,function(e){f.data=j.getAvcDecryptedUnit(h,e),g||j.decryptAvcSamples(a,b,c+1,d)})},b.decryptAvcSamples=function(a,b,c,d){if(a instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.data.length<=48||1!==f.type&&5!==f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}},a}();b.default=f},"./src/demux/transmuxer-interface.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return l});var d=c("./node_modules/webworkify-webpack/index.js"),e=c("./src/events.ts"),f=c("./src/demux/transmuxer.ts"),g=c("./src/utils/logger.ts"),h=c("./src/errors.ts"),i=c("./src/utils/mediasource-helper.ts"),j=c("./node_modules/eventemitter3/index.js"),k=Object(i.getMediaSource)()||{isTypeSupported:function(){return!1}},l=function(){function a(a,b,c,i){var l=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=a,this.id=b,this.onTransmuxComplete=c,this.onFlush=i;var m=a.config,n=function(b,c){c=c||{},c.frag=l.frag,c.id=l.id,a.trigger(b,c)};this.observer=new j.EventEmitter,this.observer.on(e.Events.FRAG_DECRYPTED,n),this.observer.on(e.Events.ERROR,n);var o={mp4:k.isTypeSupported("video/mp4"),mpeg:k.isTypeSupported("audio/mpeg"),mp3:k.isTypeSupported('audio/mp4; codecs="mp3"')},p=navigator.vendor;if(m.enableWorker&&"undefined"!=typeof Worker){g.logger.log("demuxing in webworker");var q;try{q=this.worker=d("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(b){a.trigger(e.Events.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(b.message+"  ("+b.filename+":"+b.lineno+")")})},q.postMessage({cmd:"init",typeSupported:o,vendor:p,id:b,config:JSON.stringify(m)})}catch(a){g.logger.warn("Error in worker:",a),g.logger.error("Error while initializing DemuxerWorker, fallback to inline"),q&&self.URL.revokeObjectURL(q.objectURL),this.transmuxer=new f.default(this.observer,o,m,p,b),this.worker=null}}else this.transmuxer=new f.default(this.observer,o,m,p,b)}var b=a.prototype;return b.destroy=function(){var a=this.worker;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.worker=null;else{var b=this.transmuxer;b&&(b.destroy(),this.transmuxer=null)}var c=this.observer;c&&c.removeAllListeners(),this.observer=null},b.push=function(a,b,c,d,e,h,i,j,k,l){var m=this;k.transmuxing.start=self.performance.now();var n=this.transmuxer,o=this.worker,p=h?h.start:e.start,q=e.decryptdata,r=this.frag,s=!(r&&e.cc===r.cc),t=!(r&&k.level===r.level),u=r?k.sn-r.sn:-1,v=this.part?k.part-this.part.index:1,w=!t&&(1===u||0===u&&1===v),x=self.performance.now();(t||u||0===e.stats.parsing.start)&&(e.stats.parsing.start=x),!h||!v&&w||(h.stats.parsing.start=x);var y=new f.TransmuxState(s,w,j,t,p);if(!w||s){g.logger.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+k.sn+" p: "+k.part+" level: "+k.level+" id: "+k.id+"\n        discontinuity: "+s+"\n        trackSwitch: "+t+"\n        contiguous: "+w+"\n        accurateTimeOffset: "+j+"\n        timeOffset: "+p);var z=new f.TransmuxConfig(c,d,b,i,l);this.configureTransmuxer(z)}if(this.frag=e,this.part=h,o)o.postMessage({cmd:"demux",data:a,decryptdata:q,chunkMeta:k,state:y},a instanceof ArrayBuffer?[a]:[]);else if(n){var A=n.push(a,q,k,y);Object(f.isPromise)(A)?A.then(function(a){m.handleTransmuxComplete(a)}):this.handleTransmuxComplete(A)}},b.flush=function(a){var b=this;a.transmuxing.start=self.performance.now();var c=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:a});else if(c){var e=c.flush(a);Object(f.isPromise)(e)?e.then(function(c){b.handleFlushResult(c,a)}):this.handleFlushResult(e,a)}},b.handleFlushResult=function(a,b){var c=this;a.forEach(function(a){c.handleTransmuxComplete(a)}),this.onFlush(b)},b.onWorkerMessage=function(a){var b=a.data,c=this.hls;switch(b.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(b.data);break;case"flush":this.onFlush(b.data);break;default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}},b.configureTransmuxer=function(a){var b=this.worker,c=this.transmuxer;b?b.postMessage({cmd:"configure",config:a}):c&&c.configure(a)},b.handleTransmuxComplete=function(a){a.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(a)},a}()},"./src/demux/transmuxer-worker.ts":function(a,b,c){"use strict";function d(a){var b=new l.EventEmitter,c=function(b,c){a.postMessage({event:b,data:c})};b.on(j.Events.FRAG_DECRYPTED,c),b.on(j.Events.ERROR,c),a.addEventListener("message",function(d){var f=d.data;switch(f.cmd){case"init":var h=JSON.parse(f.config);a.transmuxer=new i.default(b,f.typeSupported,h,f.vendor,f.id),Object(k.enableLogs)(h.debug),c("init",null);break;case"configure":a.transmuxer.configure(f.config);break;case"demux":var j=a.transmuxer.push(f.data,f.decryptdata,f.chunkMeta,f.state);Object(i.isPromise)(j)?j.then(function(b){e(a,b)}):e(a,j);break;case"flush":var l=f.chunkMeta,m=a.transmuxer.flush(l);Object(i.isPromise)(m)?m.then(function(b){g(a,b,l)}):g(a,m,l)}})}function e(a,b){if(!h(b.remuxResult)){var c=[],d=b.remuxResult,e=d.audio,g=d.video;e&&f(c,e),g&&f(c,g),a.postMessage({event:"transmuxComplete",data:b},c)}}function f(a,b){b.data1&&a.push(b.data1.buffer),b.data2&&a.push(b.data2.buffer)}function g(a,b,c){b.forEach(function(b){e(a,b)}),a.postMessage({event:"flush",data:c})}function h(a){return!(a.audio||a.video||a.text||a.id3||a.initSegment)}c.r(b),c.d(b,"default",function(){return d});var i=c("./src/demux/transmuxer.ts"),j=c("./src/events.ts"),k=c("./src/utils/logger.ts"),l=c("./node_modules/eventemitter3/index.js")},"./src/demux/transmuxer.ts":function(a,b,c){"use strict";function d(a,b){var c=null;return a.byteLength>0&&null!=b&&null!=b.key&&null!==b.iv&&null!=b.method&&(c=b),c}function e(a){return"then"in a&&a.then instanceof Function}c.r(b),c.d(b,"default",function(){return u}),c.d(b,"isPromise",function(){return e}),c.d(b,"TransmuxConfig",function(){return w}),c.d(b,"TransmuxState",function(){return x});var f,g=c("./src/events.ts"),h=c("./src/errors.ts"),i=c("./src/crypt/decrypter.ts"),j=c("./src/demux/aacdemuxer.ts"),k=c("./src/demux/mp4demuxer.ts"),l=c("./src/demux/tsdemuxer.ts"),m=c("./src/demux/mp3demuxer.ts"),n=c("./src/remux/mp4-remuxer.ts"),o=c("./src/remux/passthrough-remuxer.ts"),p=c("./src/demux/chunk-cache.ts"),q=c("./src/utils/mp4-tools.ts"),r=c("./src/utils/logger.ts");try{f=self.performance.now.bind(self.performance)}catch(a){r.logger.debug("Unable to use Performance API on this environment"),f=self.Date.now}var s=[{demux:l.default,remux:n.default},{demux:k.default,remux:o.default},{demux:j.default,remux:n.default},{demux:m.default,remux:n.default}],t=1024;s.forEach(function(a){var b=a.demux;t=Math.max(t,b.minProbeByteLength)});var u=function(){function a(a,b,c,d,e){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=a,this.typeSupported=b,this.config=c,this.vendor=d,this.id=e}var b=a.prototype;return b.configure=function(a){this.transmuxConfig=a,this.decrypter&&this.decrypter.reset()},b.push=function(a,b,c,e){var g=this,h=c.transmuxing;h.executeStart=f();var i=new Uint8Array(a),j=this.cache,k=this.config,l=this.currentTransmuxState,m=this.transmuxConfig;e&&(this.currentTransmuxState=e);var n=d(i,b);if(n&&"AES-128"===n.method){var o=this.getDecrypter();if(!k.enableSoftwareAES)return this.decryptionPromise=o.webCryptoDecrypt(i,n.key.buffer,n.iv.buffer).then(function(a){var b=g.push(a,null,c);return g.decryptionPromise=null,b}),this.decryptionPromise;var p=o.softwareDecrypt(i,n.key.buffer,n.iv.buffer);if(!p)return h.executeEnd=f(),v(c);i=new Uint8Array(p)}var r=e||l,s=r.contiguous,t=r.discontinuity,u=r.trackSwitch,w=r.accurateTimeOffset,x=r.timeOffset,y=m.audioCodec,z=m.videoCodec,A=m.defaultInitPts,B=m.duration,C=m.initSegmentData;if((t||u)&&this.resetInitSegment(C,y,z,B),t&&this.resetInitialTimestamp(A),s||this.resetContiguity(),this.needsProbing(i,t,u)){if(j.dataLength){var D=j.flush();i=Object(q.appendUint8Array)(D,i)}this.configureTransmuxer(i,m)}var E=this.transmux(i,n,x,w,c),F=this.currentTransmuxState;return F.contiguous=!0,F.discontinuity=!1,F.trackSwitch=!1,h.executeEnd=f(),E},b.flush=function(a){var b=this,c=a.transmuxing;c.executeStart=f();var d=this.decrypter,i=this.cache,j=this.currentTransmuxState,k=this.decryptionPromise;if(k)return k.then(function(){return b.flush(a)});var l=[],m=j.timeOffset;if(d){var n=d.flush();n&&l.push(this.push(n,null,a))}var o=i.dataLength;i.reset();var p=this.demuxer,q=this.remuxer;if(!p||!q)return o>=t&&this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),c.executeEnd=f(),[v(a)];var r=p.flush(m);return e(r)?r.then(function(c){return b.flushRemux(l,c,a),l}):(this.flushRemux(l,r,a),l)},b.flushRemux=function(a,b,c){var d=b.audioTrack,e=b.avcTrack,g=b.id3Track,h=b.textTrack,i=this.currentTransmuxState,j=i.accurateTimeOffset,k=i.timeOffset;r.logger.log("[transmuxer.ts]: Flushed fragment "+c.sn+(c.part>-1?" p: "+c.part:"")+" of level "+c.level);var l=this.remuxer.remux(d,e,g,h,k,j,!0,this.id);a.push({remuxResult:l,chunkMeta:c}),c.transmuxing.executeEnd=f()},b.resetInitialTimestamp=function(a){var b=this.demuxer,c=this.remuxer;b&&c&&(b.resetTimeStamp(a),c.resetTimeStamp(a))},b.resetContiguity=function(){var a=this.demuxer,b=this.remuxer;a&&b&&(a.resetContiguity(),b.resetNextTimestamp())},b.resetInitSegment=function(a,b,c,d){var e=this.demuxer,f=this.remuxer;e&&f&&(e.resetInitSegment(b,c,d),f.resetInitSegment(a,b,c))},b.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},b.transmux=function(a,b,c,d,e){return b&&"SAMPLE-AES"===b.method?this.transmuxSampleAes(a,b,c,d,e):this.transmuxUnencrypted(a,c,d,e)},b.transmuxUnencrypted=function(a,b,c,d){var e=this.demuxer.demux(a,b,!1,!this.config.progressive),f=e.audioTrack,g=e.avcTrack,h=e.id3Track,i=e.textTrack;return{remuxResult:this.remuxer.remux(f,g,h,i,b,c,!1,this.id),chunkMeta:d}},b.transmuxSampleAes=function(a,b,c,d,e){var f=this;return this.demuxer.demuxSampleAes(a,b,c).then(function(a){return{remuxResult:f.remuxer.remux(a.audioTrack,a.avcTrack,a.id3Track,a.textTrack,c,d,!1,f.id),chunkMeta:e}})},b.configureTransmuxer=function(a,b){for(var c,d=this.config,e=this.observer,f=this.typeSupported,g=this.vendor,h=b.audioCodec,i=b.defaultInitPts,j=b.duration,l=b.initSegmentData,m=b.videoCodec,n=0,p=s.length;n<p;n++)if(s[n].demux.probe(a)){c=s[n];break}c||(r.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),c={demux:k.default,remux:o.default});var q=this.demuxer,t=this.remuxer,u=c.remux,v=c.demux;t&&t instanceof u||(this.remuxer=new u(e,d,f,g)),q&&q instanceof v||(this.demuxer=new v(e,d,f),this.probe=v.probe),this.resetInitSegment(l,h,m,j),this.resetInitialTimestamp(i)},b.needsProbing=function(a,b,c){return!this.demuxer||!this.remuxer||b||c},b.getDecrypter=function(){var a=this.decrypter;return a||(a=this.decrypter=new i.default(this.observer,this.config)),a},a}(),v=function(a){return{remuxResult:{},chunkMeta:a}},w=function(a,b,c,d,e){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=a,this.videoCodec=b,this.initSegmentData=c,this.duration=d,this.defaultInitPts=e},x=function(a,b,c,d,e){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=a,this.contiguous=b,this.accurateTimeOffset=c,this.trackSwitch=d,this.timeOffset=e}},"./src/demux/tsdemuxer.ts":function(a,b,c){"use strict";function d(a,b,c,d){return{key:a,frame:!1,pts:b,dts:c,units:[],debug:d,length:0}}function e(a,b){return(31&a[b+10])<<8|a[b+11]}function f(a,b,c,d){var e={audio:-1,avc:-1,id3:-1,isAAC:!0},f=(15&a[b+1])<<8|a[b+2],g=b+3+f-4,h=(15&a[b+10])<<8|a[b+11];for(b+=12+h;b<g;){var i=(31&a[b+1])<<8|a[b+2];switch(a[b]){case 207:if(!d){r.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===e.audio&&(e.audio=i);break;case 21:-1===e.id3&&(e.id3=i);break;case 219:if(!d){r.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===e.avc&&(e.avc=i);break;case 3:case 4:c?-1===e.audio&&(e.audio=i,e.isAAC=!1):r.logger.log("MPEG audio found, not supported in this browser");break;case 36:r.logger.warn("Unsupported HEVC stream type found")}b+=5+((15&a[b+3])<<8|a[b+4])}return e}function g(a){var b,c,d,e,f,g=0,h=a.data;if(!a||0===a.size)return null;for(;h[0].length<19&&h.length>1;){var i=new Uint8Array(h[0].length+h[1].length);i.set(h[0]),i.set(h[1],h[0].length),h[0]=i,h.splice(1,1)}if(b=h[0],1===(b[0]<<16)+(b[1]<<8)+b[2]){if((c=(b[4]<<8)+b[5])&&c>a.size-6)return null;var j=b[7];192&j&&(e=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,64&j?(f=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,e-f>54e5&&(r.logger.warn(Math.round((e-f)/9e4)+"s delta between PTS and DTS, align them"),e=f)):f=e),d=b[8];var k=d+9;if(a.size<=k)return null;a.size-=k;for(var l=new Uint8Array(a.size),m=0,n=h.length;m<n;m++){b=h[m];var o=b.byteLength;if(k){if(k>o){k-=o;continue}b=b.subarray(k),o-=k,k=0}l.set(b,g),g+=o}return c&&(c-=d+3),{data:l,pts:e,dts:f,len:c}}return null}function h(a,b){if(a.units.length&&a.frame){if(void 0===a.pts){var c=b.samples,d=c.length;if(!d)return void b.dropped++;var e=c[d-1];a.pts=e.pts,a.dts=e.dts}b.samples.push(a)}a.debug.length&&r.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function i(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)}function j(a){for(var b=a.byteLength,c=[],d=1;d<b-2;)0===a[d]&&0===a[d+1]&&3===a[d+2]?(c.push(d+2),d+=2):d++;if(0===c.length)return a;var e=b-c.length,f=new Uint8Array(e),g=0;for(d=0;d<e;g++,d++)g===c[0]&&(g++,c.shift()),f[d]=a[g];return f}c.r(b),c.d(b,"discardEPB",function(){return j});var k=c("./src/demux/adts.ts"),l=c("./src/demux/mpegaudio.ts"),m=c("./src/demux/exp-golomb.ts"),n=c("./src/demux/id3.ts"),o=c("./src/demux/sample-aes.ts"),p=c("./src/events.ts"),q=c("./src/utils/mp4-tools.ts"),r=c("./src/utils/logger.ts"),s=c("./src/errors.ts"),t={video:1,audio:2,id3:3,text:4},u=function(){function a(a,b,c){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=b,this.typeSupported=c}a.probe=function(b){var c=a.syncOffset(b);return!(c<0)&&(c&&r.logger.warn("MPEG2-TS detected but first sync word found @ offset "+c+", junk ahead ?"),!0)},a.syncOffset=function(a){for(var b=Math.min(1e3,a.length-564),c=0;c<b;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return-1},a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:t[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===a?b:void 0}};var b=a.prototype;return b.resetInitSegment=function(b,c,d){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",d),this._audioTrack=a.createTrack("audio",d),this._id3Track=a.createTrack("id3",d),this._txtTrack=a.createTrack("text",d),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=b,this.videoCodec=c,this._duration=d},b.resetTimeStamp=function(){},b.resetContiguity=function(){var a=this._audioTrack,b=this._avcTrack,c=this._id3Track;a&&(a.pesData=null),b&&(b.pesData=null),c&&(c.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},b.demux=function(b,c,d,h){void 0===d&&(d=!1),void 0===h&&(h=!1),d||(this.sampleAes=null);var i,j=this._avcTrack,k=this._audioTrack,l=this._id3Track,m=j.pid,n=j.pesData,o=k.pid,t=l.pid,u=k.pesData,v=l.pesData,w=!1,x=this.pmtParsed,y=this._pmtId,z=b.length;if(this.remainderData&&(b=Object(q.appendUint8Array)(this.remainderData,b),z=b.length,this.remainderData=null),z<188&&!h)return this.remainderData=b,{audioTrack:k,avcTrack:j,id3Track:l,textTrack:this._txtTrack};var A=Math.max(0,a.syncOffset(b));(z-=(z+A)%188)<b.byteLength&&!h&&(this.remainderData=new Uint8Array(b.buffer,z,b.buffer.byteLength-z));for(var B=A;B<z;B+=188)if(71===b[B]){var C=!!(64&b[B+1]),D=((31&b[B+1])<<8)+b[B+2],E=(48&b[B+3])>>4,F=void 0;if(E>1){if((F=B+5+b[B+4])===B+188)continue}else F=B+4;switch(D){case m:C&&(n&&(i=g(n))&&this.parseAVCPES(i,!1),n={data:[],size:0}),n&&(n.data.push(b.subarray(F,B+188)),n.size+=B+188-F);break;case o:C&&(u&&(i=g(u))&&(k.isAAC?this.parseAACPES(i):this.parseMPEGPES(i)),u={data:[],size:0}),u&&(u.data.push(b.subarray(F,B+188)),u.size+=B+188-F);break;case t:C&&(v&&(i=g(v))&&this.parseID3PES(i),v={data:[],size:0}),v&&(v.data.push(b.subarray(F,B+188)),v.size+=B+188-F);break;case 0:C&&(F+=b[F]+1),y=this._pmtId=e(b,F);break;case y:C&&(F+=b[F]+1);var G=f(b,F,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,d);m=G.avc,m>0&&(j.pid=m),o=G.audio,o>0&&(k.pid=o,k.isAAC=G.isAAC),t=G.id3,t>0&&(l.pid=t),w&&!x&&(r.logger.log("reparse from beginning"),w=!1,B=A-188),x=this.pmtParsed=!0;break;case 17:case 8191:break;default:w=!0}}else this.observer.emit(p.Events.ERROR,p.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});j.pesData=n,k.pesData=u,l.pesData=v;var H={audioTrack:k,avcTrack:j,id3Track:l,textTrack:this._txtTrack};return h&&this.extractRemainingSamples(H),H},b.flush=function(){var a=this.remainderData;this.remainderData=null;var b;return b=a?this.demux(a,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(b),this.sampleAes?this.decrypt(b,this.sampleAes):b},b.extractRemainingSamples=function(a){var b,c=a.audioTrack,d=a.avcTrack,e=a.id3Track,f=d.pesData,h=c.pesData,i=e.pesData;f&&(b=g(f))?(this.parseAVCPES(b,!0),d.pesData=null):d.pesData=f,h&&(b=g(h))?(c.isAAC?this.parseAACPES(b):this.parseMPEGPES(b),c.pesData=null):(null!==h&&void 0!==h&&h.size&&r.logger.log("last AAC PES packet truncated,might overlap between fragments"),c.pesData=h),i&&(b=g(i))?(this.parseID3PES(b),e.pesData=null):e.pesData=i},b.demuxSampleAes=function(a,b,c){var d=this.demux(a,c,!0,!this.config.progressive),e=this.sampleAes=new o.default(this.observer,this.config,b);return this.decrypt(d,e)},b.decrypt=function(a,b){return new Promise(function(c){var d=a.audioTrack,e=a.avcTrack;d.samples&&d.isAAC?b.decryptAacSamples(d.samples,0,function(){e.samples?b.decryptAvcSamples(e.samples,0,0,function(){c(a)}):c(a)}):e.samples&&b.decryptAvcSamples(e.samples,0,0,function(){c(a)})})},b.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},b.parseAVCPES=function(a,b){var c,e=this,f=this._avcTrack,g=this.parseAVCNALu(a.data),k=!1,l=this.avcSample,o=!1;a.data=null,l&&g.length&&!f.audFound&&(h(l,f),l=this.avcSample=d(!1,a.pts,a.dts,"")),g.forEach(function(b){switch(b.type){case 1:c=!0,l||(l=e.avcSample=d(!0,a.pts,a.dts,"")),k&&(l.debug+="NDR "),l.frame=!0;var g=b.data;if(o&&g.length>4){var p=new m.default(g).readSliceType();2!==p&&4!==p&&7!==p&&9!==p||(l.key=!0)}break;case 5:c=!0,l||(l=e.avcSample=d(!0,a.pts,a.dts,"")),k&&(l.debug+="IDR "),l.key=!0,l.frame=!0;break;case 6:c=!0,k&&l&&(l.debug+="SEI ");var q=new m.default(j(b.data));q.readUByte();for(var r=0,s=0,t=!1,u=0;!t&&q.bytesAvailable>1;){r=0;do{u=q.readUByte(),r+=u}while(255===u);s=0;do{u=q.readUByte(),s+=u}while(255===u);if(4===r&&0!==q.bytesAvailable){t=!0;if(181===q.readUByte()){if(49===q.readUShort()){if(1195456820===q.readUInt()){if(3===q.readUByte()){for(var v=q.readUByte(),w=q.readUByte(),x=31&v,y=[v,w],z=0;z<x;z++)y.push(q.readUByte()),y.push(q.readUByte()),y.push(q.readUByte());i(e._txtTrack.samples,{type:3,pts:a.pts,bytes:y})}}}}}else if(5===r&&0!==q.bytesAvailable){if(t=!0,s>16){for(var A=[],B=0;B<16;B++)A.push(q.readUByte().toString(16)),3!==B&&5!==B&&7!==B&&9!==B||A.push("-");for(var C=s-16,D=new Uint8Array(C),E=0;E<C;E++)D[E]=q.readUByte();i(e._txtTrack.samples,{pts:a.pts,payloadType:r,uuid:A.join(""),userData:Object(n.utf8ArrayToStr)(D),userDataBytes:D})}}else if(s<q.bytesAvailable)for(var F=0;F<s;F++)q.readUByte()}break;case 7:if(c=!0,o=!0,k&&l&&(l.debug+="SPS "),!f.sps){var G=new m.default(b.data),H=G.readSPS();f.width=H.width,f.height=H.height,f.pixelRatio=H.pixelRatio,f.sps=[b.data],f.duration=e._duration;for(var I=b.data.subarray(1,4),J="avc1.",K=0;K<3;K++){var L=I[K].toString(16);L.length<2&&(L="0"+L),J+=L}f.codec=J}break;case 8:c=!0,k&&l&&(l.debug+="PPS "),f.pps||(f.pps=[b.data]);break;case 9:c=!1,f.audFound=!0,l&&h(l,f),l=e.avcSample=d(!1,a.pts,a.dts,k?"AUD ":"");break;case 12:c=!1;break;default:c=!1,l&&(l.debug+="unknown NAL "+b.type+" ")}if(l&&c){l.units.push(b)}}),b&&l&&(h(l,f),this.avcSample=null)},b.getLastNalUnit=function(){var a,b,c=this.avcSample;if(!c||0===c.units.length){var d=this._avcTrack.samples;c=d[d.length-1]}if(null!==(a=c)&&void 0!==a&&a.units){var e=c.units;b=e[e.length-1]}return b},b.parseAVCNALu=function(a){var b,c,d,e=a.byteLength,f=this._avcTrack,g=f.naluState||0,h=g,i=[],j=0,k=-1,l=0;for(-1===g&&(k=0,l=31&a[0],g=0,j=1);j<e;)if(b=a[j++],g)if(1!==g)if(b)if(1===b){if(k>=0){var m={data:a.subarray(k,j-g-1),type:l};i.push(m)}else{var n=this.getLastNalUnit();if(n&&(h&&j<=4-h&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-h)),(c=j-g-1)>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}j<e?(d=31&a[j],k=j,l=d,g=0):g=-1}else g=0;else g=3;else g=b?0:2;else g=b?0:1;if(k>=0&&g>=0){var p={data:a.subarray(k,e),type:l,state:g};i.push(p)}if(0===i.length){var q=this.getLastNalUnit();if(q){var r=new Uint8Array(q.data.byteLength+a.byteLength);r.set(q.data,0),r.set(a,q.data.byteLength),q.data=r}}return f.naluState=g,i},b.parseAACPES=function(a){var b=0,c=this._audioTrack,d=this.aacOverFlow,e=a.data;if(d){this.aacOverFlow=null;var f=d.sample.unit.byteLength,g=Math.min(d.missing,f),h=f-g;d.sample.unit.set(e.subarray(0,g),h),c.samples.push(d.sample),b=d.missing}var i,j;for(i=b,j=e.length;i<j-1&&!k.isHeader(e,i);i++);if(i!==b){var l,m;if(i<j-1?(l="AAC PES did not start with ADTS header,offset:"+i,m=!1):(l="no ADTS header found in AAC PES",m=!0),r.logger.warn("parsing error:"+l),this.observer.emit(p.Events.ERROR,p.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:m,reason:l}),m)return}k.initTrackConfig(c,this.observer,e,i,this.audioCodec);var n;if(void 0!==a.pts)n=a.pts;else{if(!d)return void r.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var o=k.getFrameDuration(c.samplerate);n=d.sample.pts+o}for(var q=0;i<j;){if(k.isHeader(e,i)){if(i+5<j){var t=k.appendFrame(c,e,i,n,q);if(t){if(!t.missing){i+=t.length,q++;continue}this.aacOverFlow=t}}break}i++}},b.parseMPEGPES=function(a){var b=a.data,c=b.length,d=0,e=0,f=a.pts;if(void 0===f)return void r.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");for(;e<c;)if(l.isHeader(b,e)){var g=l.appendFrame(this._audioTrack,b,e,f,d);if(!g)break;e+=g.length,d++}else e++},b.parseID3PES=function(a){if(void 0===a.pts)return void r.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");this._id3Track.samples.push(a)},a}();u.minProbeByteLength=188,b.default=u},"./src/errors.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"ErrorTypes",function(){return d}),c.d(b,"ErrorDetails",function(){return e});var d;!function(a){a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError"}(d||(d={}));var e;!function(a){a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.UNKNOWN="unknown"}(e||(e={}))},"./src/events.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"Events",function(){return d});var d;!function(a){a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached"}(d||(d={}))},"./src/hls.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}c.r(b),c.d(b,"default",function(){return t});var f=c("./node_modules/url-toolkit/src/url-toolkit.js"),g=c("./src/loader/playlist-loader.ts"),h=c("./src/loader/key-loader.ts"),i=c("./src/controller/id3-track-controller.ts"),j=c("./src/controller/latency-controller.ts"),k=c("./src/controller/level-controller.ts"),l=c("./src/controller/fragment-tracker.ts"),m=c("./src/controller/stream-controller.ts"),n=c("./src/is-supported.ts"),o=c("./src/utils/logger.ts"),p=c("./src/config.ts"),q=c("./node_modules/eventemitter3/index.js"),r=c("./src/events.ts"),s=c("./src/errors.ts"),t=function(){function a(b){void 0===b&&(b={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new q.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var c=this.config=Object(p.mergeConfig)(a.DefaultConfig,b);this.userConfig=b,Object(o.enableLogs)(c.debug),this._autoLevelCapping=-1,c.progressive&&Object(p.enableStreamingMode)(c);var d=c.abrController,e=c.bufferController,f=c.capLevelController,n=c.fpsController,r=this.abrController=new d(this),s=this.bufferController=new e(this),t=this.capLevelController=new f(this),u=new n(this),v=new g.default(this),w=new h.default(this),x=new i.default(this),y=this.levelController=new k.default(this),z=new l.FragmentTracker(this),A=this.streamController=new m.default(this,z);t.setStreamController(A),u.setStreamController(A);var B=[y,A];this.networkControllers=B;var C=[v,w,r,s,t,u,x,z];this.audioTrackController=this.createController(c.audioTrackController,null,B),this.createController(c.audioStreamController,z,B),this.subtitleTrackController=this.createController(c.subtitleTrackController,null,B),this.createController(c.subtitleStreamController,z,B),this.createController(c.timelineController,null,C),this.emeController=this.createController(c.emeController,null,C),this.latencyController=this.createController(j.default,null,C),this.coreComponents=C}a.isSupported=function(){return Object(n.isSupported)()};var b=a.prototype;return b.createController=function(a,b,c){if(a){var d=b?new a(this,b):new a(this);return c&&c.push(d),d}return null},b.on=function(a,b,c){void 0===c&&(c=this),this._emitter.on(a,b,c)},b.once=function(a,b,c){void 0===c&&(c=this),this._emitter.once(a,b,c)},b.removeAllListeners=function(a){this._emitter.removeAllListeners(a)},b.off=function(a,b,c,d){void 0===c&&(c=this),this._emitter.off(a,b,c,d)},b.listeners=function(a){return this._emitter.listeners(a)},b.emit=function(a,b,c){return this._emitter.emit(a,b,c)},b.trigger=function(a,b){if(this.config.debug)return this.emit(a,a,b);try{return this.emit(a,a,b)}catch(b){o.logger.error("An internal error happened while handling event "+a+'. Error message: "'+b.message+'". Here is a stacktrace:',b),this.trigger(r.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,error:b})}return!1},b.listenerCount=function(a){return this._emitter.listenerCount(a)},b.destroy=function(){o.logger.log("destroy"),this.trigger(r.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(a){return a.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(a){return a.destroy()}),this.coreComponents.length=0},b.attachMedia=function(a){o.logger.log("attachMedia"),this._media=a,this.trigger(r.Events.MEDIA_ATTACHING,{media:a})},b.detachMedia=function(){o.logger.log("detachMedia"),this.trigger(r.Events.MEDIA_DETACHING,void 0),this._media=null},b.loadSource=function(a){this.stopLoad();var b=this.media,c=this.url,d=this.url=f.buildAbsoluteURL(self.location.href,a,{alwaysNormalize:!0});o.logger.log("loadSource:"+d),b&&c&&c!==d&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(b)),this.trigger(r.Events.MANIFEST_LOADING,{url:a})},b.startLoad=function(a){void 0===a&&(a=-1),o.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},b.stopLoad=function(){o.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},b.swapAudioCodec=function(){o.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.recoverMediaError=function(){o.logger.log("recoverMediaError");var a=this._media;this.detachMedia(),a&&this.attachMedia(a)},b.removeLevel=function(a,b){void 0===b&&(b=0),this.levelController.removeLevel(a,b)},e(a,[{key:"levels",get:function(){var a=this.levelController.levels;return a||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){o.logger.log("set currentLevel:"+a),this.loadLevel=a,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){o.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){o.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){o.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){o.logger.log("set startLevel:"+a),-1!==a&&(a=Math.max(a,this.minAutoLevel)),this.levelController.startLevel=a}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(a){var b=!!a;b!==this.config.capLevelToPlayerSize&&(b?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=b)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){this._autoLevelCapping!==a&&(o.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a)}},{key:"bandwidthEstimate",get:function(){var a=this.abrController.bwEstimator;return a?a.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var a=this.levels,b=this.config.minAutoBitrate;if(!a)return 0;for(var c=a.length,d=0;d<c;d++)if(a[d].maxBitrate>b)return d;return 0}},{key:"maxAutoLevel",get:function(){var a=this.levels,b=this.autoLevelCapping;return-1===b&&a&&a.length?a.length-1:b}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(a){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,a)}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var a=this.subtitleTrackController;return!!a&&a.subtitleDisplay},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(a){this.config.lowLatencyMode=a}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.0.7"}},{key:"Events",get:function(){return r.Events}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:p.hlsDefaultConfig},set:function(b){a.defaultConfig=b}}]),a}();t.defaultConfig=void 0},"./src/is-supported.ts":function(a,b,c){"use strict";function d(){return self.SourceBuffer||self.WebKitSourceBuffer}function e(){var a=Object(g.getMediaSource)();if(!a)return!1;var b=d(),c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return!!c&&!!e}function f(){var a,b=d();return"function"==typeof(null===b||void 0===b?void 0:null===(a=b.prototype)||void 0===a?void 0:a.changeType)}c.r(b),c.d(b,"isSupported",function(){return e}),c.d(b,"changeTypeSupported",function(){return f});var g=c("./src/utils/mediasource-helper.ts")},"./src/loader/fragment-loader.ts":function(a,b,c){"use strict";function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,i(a,b)}function e(a){var b="function"==typeof Map?new Map:void 0;return(e=function(a){function c(){return f(a,arguments,j(this).constructor)}if(null===a||!h(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),i(c,a)})(a)}function f(a,b,c){return f=g()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);var e=Function.bind.apply(a,d),f=new e;return c&&i(f,c.prototype),f},f.apply(null,arguments)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function h(a){return-1!==Function.toString.call(a).indexOf("[native code]")}function i(a,b){return(i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function j(a){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function k(a,b){void 0===b&&(b=null);var c=b||a,d={frag:a,part:b,responseType:"arraybuffer",url:c.url,rangeStart:0,rangeEnd:0},e=c.byteRangeStartOffset,f=c.byteRangeEndOffset;return Object(l.isFiniteNumber)(e)&&Object(l.isFiniteNumber)(f)&&(d.rangeStart=e,d.rangeEnd=f),d}c.r(b),c.d(b,"default",function(){return o}),c.d(b,"LoadError",function(){return p});var l=c("./src/polyfills/number.ts"),m=c("./src/errors.ts"),n=Math.pow(2,17),o=function(){function a(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var b=a.prototype;return b.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},b.abort=function(){this.loader&&this.loader.abort()},b.load=function(a,b){var c=this,d=a.url;if(!d)return Promise.reject(new p({type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(d?"part list":"url")));this.abort();var e=this.config,f=e.fLoader,g=e.loader;return new Promise(function(d,h){c.loader&&c.loader.destroy();var i=c.loader=a.loader=f?new f(e):new g(e),j=k(a),l={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:n};a.stats=i.stats,i.load(j,l,{onSuccess:function(b,e,f,g){c.resetLoader(a,i),d({frag:a,part:null,payload:b.data,networkDetails:g})},onError:function(b,d,e){c.resetLoader(a,i),h(new p({type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:b,networkDetails:e}))},onAbort:function(b,d,e){c.resetLoader(a,i),h(new p({type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:e}))},onTimeout:function(b,d,e){c.resetLoader(a,i),h(new p({type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:e}))},onProgress:function(c,d,e,f){b&&b({frag:a,part:null,payload:e,networkDetails:f})}})})},b.loadPart=function(a,b,c){var d=this;this.abort();var e=this.config,f=e.fLoader,g=e.loader;return new Promise(function(h,i){d.loader&&d.loader.destroy();var j=d.loader=a.loader=f?new f(e):new g(e),l=k(a,b),o={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:n};b.stats=j.stats,j.load(l,o,{onSuccess:function(e,f,g,i){d.resetLoader(a,j),d.updateStatsFromPart(a,b);var k={frag:a,part:b,payload:e.data,networkDetails:i};c(k),h(k)},onError:function(c,e,f){d.resetLoader(a,j),i(new p({type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,part:b,response:c,networkDetails:f}))},onAbort:function(c,e,f){a.stats.aborted=b.stats.aborted,d.resetLoader(a,j),i(new p({type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,part:b,networkDetails:f}))},onTimeout:function(c,e,f){d.resetLoader(a,j),i(new p({type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,part:b,networkDetails:f}))}})})},b.updateStatsFromPart=function(a,b){var c=a.stats,d=b.stats,e=d.total;if(c.loaded+=d.loaded,e){var f=Math.round(a.duration/b.duration),g=Math.min(Math.round(c.loaded/e),f),h=f-g,i=h*Math.round(c.loaded/g);c.total=c.loaded+i}else c.total=Math.max(c.loaded,c.total);var j=c.loading,k=d.loading;j.start?j.first+=k.first-k.start:(j.start=k.start,j.first=k.first),j.end=k.end},b.resetLoader=function(a,b){a.loader=null,this.loader===b&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),b.destroy()},a}(),p=function(a){function b(b){for(var c,d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return c=a.call.apply(a,[this].concat(e))||this,c.data=void 0,c.data=b,c}return d(b,a),b}(e(Error))},"./src/loader/fragment.ts":function(a,b,c){"use strict";function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,e(a,b)}function e(a,b){return(e=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}c.r(b),c.d(b,"ElementaryStreamTypes",function(){return h}),c.d(b,"BaseSegment",function(){return n}),c.d(b,"Fragment",function(){return o}),c.d(b,"Part",function(){return p});var h,i=c("./src/polyfills/number.ts"),j=c("./node_modules/url-toolkit/src/url-toolkit.js"),k=c("./src/utils/logger.ts"),l=c("./src/loader/level-key.ts"),m=c("./src/loader/load-stats.ts");!function(a){a.AUDIO="audio",a.VIDEO="video",a.AUDIOVIDEO="audiovideo"}(h||(h={}));var n=function(){function a(a){var b;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(b={},b[h.AUDIO]=null,b[h.VIDEO]=null,b[h.AUDIOVIDEO]=null,b),this.baseurl=a}return a.prototype.setByteRange=function(a,b){var c=a.split("@",2),d=[];1===c.length?d[0]=b?b.byteRangeEndOffset:0:d[0]=parseInt(c[1]),d[1]=parseInt(c[0])+d[0],this._byteRange=d},g(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(j.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(a){this._url=a}}]),a}(),o=function(a){function b(b,c){var d;return d=a.call(this,c)||this,d._decryptdata=null,d.rawProgramDateTime=null,d.programDateTime=null,d.tagList=[],d.duration=0,d.sn=0,d.levelkey=void 0,d.type=void 0,d.loader=null,d.level=-1,d.cc=0,d.startPTS=void 0,d.endPTS=void 0,d.appendedPTS=void 0,d.startDTS=void 0,d.endDTS=void 0,d.start=0,d.deltaPTS=void 0,d.maxStartPTS=void 0,d.minEndPTS=void 0,d.stats=new m.LoadStats,d.urlId=0,d.data=void 0,d.bitrateTest=!1,d.title=null,d.initSegment=null,d.type=b,d}d(b,a);var c=b.prototype;return c.createInitializationVector=function(a){for(var b=new Uint8Array(16),c=12;c<16;c++)b[c]=a>>8*(15-c)&255;return b},c.setDecryptDataFromLevelKey=function(a,b){var c=a;return"AES-128"===(null===a||void 0===a?void 0:a.method)&&a.uri&&!a.iv&&(c=l.LevelKey.fromURI(a.uri),c.method=a.method,c.iv=this.createInitializationVector(b),c.keyFormat="identity"),c},c.setElementaryStreamInfo=function(a,b,c,d,e,f){void 0===f&&(f=!1);var g=this.elementaryStreams,h=g[a];if(!h)return void(g[a]={startPTS:b,endPTS:c,startDTS:d,endDTS:e,partial:f});h.startPTS=Math.min(h.startPTS,b),h.endPTS=Math.max(h.endPTS,c),h.startDTS=Math.min(h.startDTS,d),h.endDTS=Math.max(h.endDTS,e)},c.clearElementaryStreamInfo=function(){var a=this.elementaryStreams;a[h.AUDIO]=null,a[h.VIDEO]=null,a[h.AUDIOVIDEO]=null},g(b,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var a=this.sn;"number"!=typeof a&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&k.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),a=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,a)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(i.isFiniteNumber)(this.programDateTime))return null;var a=Object(i.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*a}},{key:"encrypted",get:function(){var a;return!(null===(a=this.decryptdata)||void 0===a||!a.keyFormat||!this.decryptdata.uri)}}]),b}(n),p=function(a){function b(b,c,d,e,f){var g;g=a.call(this,d)||this,g.fragOffset=0,g.duration=0,g.gap=!1,g.independent=!1,g.relurl=void 0,g.fragment=void 0,g.index=void 0,g.stats=new m.LoadStats,g.duration=b.decimalFloatingPoint("DURATION"),g.gap=b.bool("GAP"),g.independent=b.bool("INDEPENDENT"),g.relurl=b.enumeratedString("URI"),g.fragment=c,g.index=e;var h=b.enumeratedString("BYTERANGE");return h&&g.setByteRange(h,f),f&&(g.fragOffset=f.fragOffset+f.duration),g}return d(b,a),g(b,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var a=this.elementaryStreams;return!!(a.audio||a.video||a.audiovideo)}}]),b}(n)},"./src/loader/key-loader.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return g});var d=c("./src/events.ts"),e=c("./src/errors.ts"),f=c("./src/utils/logger.ts"),g=function(){function a(a){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=a,this._registerListeners()}var b=a.prototype;return b._registerListeners=function(){this.hls.on(d.Events.KEY_LOADING,this.onKeyLoading,this)},b._unregisterListeners=function(){this.hls.off(d.Events.KEY_LOADING,this.onKeyLoading)},b.destroy=function(){this._unregisterListeners();for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={}},b.onKeyLoading=function(a,b){var c=b.frag,e=c.type,g=this.loaders[e];if(!c.decryptdata)return void f.logger.warn("Missing decryption data on fragment in onKeyLoading");var h=c.decryptdata.uri;if(h!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;if(g&&(f.logger.warn("abort previous key loader for type:"+e),g.abort()),!h)return void f.logger.warn("key uri is falsy");var j=i.loader,k=c.loader=this.loaders[e]=new j(i);this.decrypturl=h,this.decryptkey=null;var l={url:h,frag:c,responseType:"arraybuffer"},m={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};k.load(l,m,n)}else this.decryptkey&&(c.decryptdata.key=this.decryptkey,this.hls.trigger(d.Events.KEY_LOADED,{frag:c}))},b.loadsuccess=function(a,b,c){var e=c.frag;if(!e.decryptdata)return void f.logger.error("after key load, decryptdata unset");this.decryptkey=e.decryptdata.key=new Uint8Array(a.data),e.loader=null,delete this.loaders[e.type],this.hls.trigger(d.Events.KEY_LOADED,{frag:e})},b.loaderror=function(a,b){var c=b.frag,f=c.loader;f&&f.abort(),delete this.loaders[c.type],this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})},b.loadtimeout=function(a,b){var c=b.frag,f=c.loader;f&&f.abort(),delete this.loaders[c.type],this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},a}()},"./src/loader/level-details.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}c.r(b),c.d(b,"LevelDetails",function(){return h});var f=c("./src/polyfills/number.ts"),g=10,h=function(){function a(a){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=a}return a.prototype.reloaded=function(a){if(!a)return this.advanced=!0,void(this.updated=!0);var b=this.lastPartSn-a.lastPartSn,c=this.lastPartIndex-a.lastPartIndex;this.updated=this.endSN!==a.endSN||!!c||!!b,this.advanced=this.endSN>a.endSN||b>0||0===b&&c>0,this.updated||this.advanced?this.misses=Math.floor(.6*a.misses):this.misses=a.misses+1,this.availabilityDelay=a.availabilityDelay},e(a,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(f.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||g}},{key:"drift",get:function(){var a=this.driftEndTime-this.driftStartTime;return a>0?1e3*(this.driftEnd-this.driftStart)/a:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var a;return null!==(a=this.partList)&&void 0!==a&&a.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var a;return null!==(a=this.fragments)&&void 0!==a&&a.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var a;return null!==(a=this.partList)&&void 0!==a&&a.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var a;return null!==(a=this.partList)&&void 0!==a&&a.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),a}()},"./src/loader/level-key.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}c.r(b),c.d(b,"LevelKey",function(){return g});var f=c("./node_modules/url-toolkit/src/url-toolkit.js"),g=function(){function a(a,b){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=b?Object(f.buildAbsoluteURL)(a,b,{alwaysNormalize:!0}):a}return a.fromURL=function(b,c){return new a(b,c)},a.fromURI=function(b){return new a(b)},e(a,[{key:"uri",get:function(){return this._uri}}]),a}()},"./src/loader/load-stats.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"LoadStats",function(){return d});var d=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(a,b,c){"use strict";function d(a){var b,c;return u.test(null!=(b=null===(c=j.parseURL(a))||void 0===c?void 0:c.path)?b:"")}function e(a,b){["video","audio","text"].forEach(function(c){var d=a.filter(function(a){return Object(p.isCodecType)(a,c)});if(d.length){var e=d.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[c+"Codec"]=e.length>0?e[0]:d[0],a=a.filter(function(a){return-1===d.indexOf(a)})}}),b.unknownCodecs=a}function f(a,b,c){var d=b[c];d&&(a[c]=d)}function g(a,b){for(var c=a[b],d=b;d--;){var e=a[d];if(!e)return;e.programDateTime=c.programDateTime-1e3*e.duration,c=e}}function h(a,b){a.rawProgramDateTime?a.programDateTime=Date.parse(a.rawProgramDateTime):null!==b&&void 0!==b&&b.programDateTime&&(a.programDateTime=b.endProgramDateTime),Object(i.isFiniteNumber)(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}c.r(b),c.d(b,"default",function(){return v});var i=c("./src/polyfills/number.ts"),j=c("./node_modules/url-toolkit/src/url-toolkit.js"),k=c("./src/loader/fragment.ts"),l=c("./src/loader/level-details.ts"),m=c("./src/loader/level-key.ts"),n=c("./src/utils/attr-list.ts"),o=c("./src/utils/logger.ts"),p=c("./src/utils/codecs.ts"),q=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,r=/#EXT-X-MEDIA:(.*)/g,s=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),t=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=/\.(mp4|m4s|m4v|m4a)$/i,v=function(){function a(){}return a.findGroup=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.id===b)return d}},a.convertAVC1ToAVCOTI=function(a){var b=a.split(".");if(b.length>2){var c=b.shift()+".";return c+=parseInt(b.shift()).toString(16),c+=("000"+parseInt(b.shift()).toString(16)).substr(-4)}return a},a.resolve=function(a,b){return j.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},a.parseMasterPlaylist=function(b,c){var d=[],f={},g=!1;q.lastIndex=0;for(var h;null!=(h=q.exec(b));)if(h[1]){var i=new n.AttrList(h[1]),j={attrs:i,bitrate:i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),name:i.NAME,url:a.resolve(h[2],c)},k=i.decimalResolution("RESOLUTION");k&&(j.width=k.width,j.height=k.height),e((i.CODECS||"").split(/[ ,]+/).filter(function(a){return a}),j),j.videoCodec&&-1!==j.videoCodec.indexOf("avc1")&&(j.videoCodec=a.convertAVC1ToAVCOTI(j.videoCodec)),d.push(j)}else if(h[3]){var l=new n.AttrList(h[3]);l["DATA-ID"]&&(g=!0,f[l["DATA-ID"]]=l)}return{levels:d,sessionData:g?f:null}},a.parseMasterPlaylistMedia=function(b,c,d,e){void 0===e&&(e=[]);var g,h=[],i=0;for(r.lastIndex=0;null!==(g=r.exec(b));){var j=new n.AttrList(g[1]);if(j.TYPE===d){var k={attrs:j,bitrate:0,id:i++,groupId:j["GROUP-ID"],instreamId:j["INSTREAM-ID"],name:j.NAME||j.LANGUAGE||"",type:d,default:j.bool("DEFAULT"),autoselect:j.bool("AUTOSELECT"),forced:j.bool("FORCED"),lang:j.LANGUAGE,url:j.URI?a.resolve(j.URI,c):""};if(e.length){var l=a.findGroup(e,k.groupId)||e[0];f(k,l,"audioCodec"),f(k,l,"textCodec")}h.push(k)}}return h},a.parseLevelPlaylist=function(a,b,c,e,f){var j,p,q,r=new l.LevelDetails(b),u=r.fragments,v=null,w=0,x=0,y=0,z=0,A=null,B=new k.Fragment(e,b),C=-1,D=!1;for(s.lastIndex=0,r.m3u8=a;null!==(j=s.exec(a));){D&&(D=!1,B=new k.Fragment(e,b),B.start=y,B.sn=w,B.cc=z,B.level=c,v&&(B.initSegment=v,B.rawProgramDateTime=v.rawProgramDateTime));var E=j[1];if(E){B.duration=parseFloat(E);var F=(" "+j[2]).slice(1);B.title=F||null,B.tagList.push(F?["INF",E,F]:["INF",E])}else if(j[3])Object(i.isFiniteNumber)(B.duration)&&(B.start=y,q&&(B.levelkey=q),B.sn=w,B.level=c,B.cc=z,B.urlId=f,u.push(B),B.relurl=(" "+j[3]).slice(1),h(B,A),A=B,y+=B.duration,w++,x=0,D=!0);else if(j[4]){var G=(" "+j[4]).slice(1);A?B.setByteRange(G,A):B.setByteRange(G)}else if(j[5])B.rawProgramDateTime=(" "+j[5]).slice(1),B.tagList.push(["PROGRAM-DATE-TIME",B.rawProgramDateTime]),-1===C&&(C=u.length);else{if(!(j=j[0].match(t))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(p=1;p<j.length&&void 0===j[p];p++);var H=(" "+j[p]).slice(1),I=(" "+j[p+1]).slice(1),J=j[p+2]?(" "+j[p+2]).slice(1):"";switch(H){case"PLAYLIST-TYPE":r.type=I.toUpperCase();break;case"MEDIA-SEQUENCE":w=r.startSN=parseInt(I);break;case"SKIP":var K=new n.AttrList(I),L=K.decimalInteger("SKIPPED-SEGMENTS");if(Object(i.isFiniteNumber)(L)){r.skippedSegments=L;for(var M=L;M--;)u.unshift(null);w+=L}var N=K.enumeratedString("RECENTLY-REMOVED-DATERANGES");N&&(r.recentlyRemovedDateranges=N.split("\t"));break;case"TARGETDURATION":r.targetduration=parseFloat(I);break;case"VERSION":r.version=parseInt(I);break;case"EXTM3U":break;case"ENDLIST":r.live=!1;break;case"#":(I||J)&&B.tagList.push(J?[I,J]:[I]);break;case"DIS":z++;case"GAP":B.tagList.push([H]);break;case"BITRATE":B.tagList.push([H,I]);break;case"DISCONTINUITY-SEQ":z=parseInt(I);break;case"KEY":var O,P=new n.AttrList(I),Q=P.enumeratedString("METHOD"),R=P.URI,S=P.hexadecimalInteger("IV"),T=P.enumeratedString("KEYFORMATVERSIONS"),U=P.enumeratedString("KEYID"),V=null!=(O=P.enumeratedString("KEYFORMAT"))?O:"identity",W=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(W.indexOf(V)>-1){o.logger.warn("Keyformat "+V+" is not supported from the manifest");continue}if("identity"!==V)continue;Q&&(q=m.LevelKey.fromURL(b,R),R&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Q)>=0&&(q.method=Q,q.keyFormat=V,U&&(q.keyID=U),T&&(q.keyFormatVersions=T),q.iv=S));break;case"START":var X=new n.AttrList(I),Y=X.decimalFloatingPoint("TIME-OFFSET");Object(i.isFiniteNumber)(Y)&&(r.startTimeOffset=Y);break;case"MAP":var Z=new n.AttrList(I);B.relurl=Z.URI,Z.BYTERANGE&&B.setByteRange(Z.BYTERANGE),B.level=c,B.sn="initSegment",q&&(B.levelkey=q),B.initSegment=null,v=B,D=!0;break;case"SERVER-CONTROL":var $=new n.AttrList(I);r.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),r.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),r.canSkipDateRanges=r.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),r.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),r.holdBack=$.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var _=new n.AttrList(I);r.partTarget=_.decimalFloatingPoint("PART-TARGET");break;case"PART":var aa=r.partList;aa||(aa=r.partList=[]);var ba=x>0?aa[aa.length-1]:void 0,ca=x++,da=new k.Part(new n.AttrList(I),B,b,ca,ba);aa.push(da),B.duration+=da.duration;break;case"PRELOAD-HINT":var ea=new n.AttrList(I);r.preloadHint=ea;break;case"RENDITION-REPORT":var fa=new n.AttrList(I);r.renditionReports=r.renditionReports||[],r.renditionReports.push(fa);break;default:o.logger.warn("line parsed but not handled: "+j)}}}A&&!A.relurl?(u.pop(),y-=A.duration,r.partList&&(r.fragmentHint=A)):r.partList&&(h(B,A),B.cc=z,r.fragmentHint=B);var ga=u.length,ha=u[0],ia=u[ga-1];if((y+=r.skippedSegments*r.targetduration)>0&&ga&&ia){r.averagetargetduration=y/ga;var ja=ia.sn;r.endSN="initSegment"!==ja?ja:0,ha&&(r.startCC=ha.cc,ha.initSegment||r.fragments.every(function(a){return a.relurl&&d(a.relurl)})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),B=new k.Fragment(e,b),B.relurl=ia.relurl,B.level=c,B.sn="initSegment",ha.initSegment=B,r.needSidxRanges=!0))}else r.endSN=0,r.startCC=0;return r.fragmentHint&&(y+=r.fragmentHint.duration),r.totalduration=y,r.endCC=z,C>0&&g(u,C),r},a}()},"./src/loader/playlist-loader.ts":function(a,b,c){"use strict";function d(a){switch(a.type){case l.PlaylistContextType.AUDIO_TRACK:return l.PlaylistLevelType.AUDIO;case l.PlaylistContextType.SUBTITLE_TRACK:return l.PlaylistLevelType.SUBTITLE;default:return l.PlaylistLevelType.MAIN}}function e(a,b){var c=a.url;return void 0!==c&&0!==c.indexOf("data:")||(c=b.url),c}c.r(b);var f=c("./src/polyfills/number.ts"),g=c("./src/events.ts"),h=c("./src/errors.ts"),i=c("./src/utils/logger.ts"),j=c("./src/utils/mp4-tools.ts"),k=c("./src/loader/m3u8-parser.ts"),l=c("./src/types/loader.ts"),m=c("./src/utils/attr-list.ts"),n=function(){function a(a){this.hls=void 0,this.loaders=Object.create(null),this.hls=a,this.registerListeners()}var b=a.prototype;return b.registerListeners=function(){var a=this.hls;a.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.on(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.unregisterListeners=function(){var a=this.hls;a.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.off(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.createInternalLoader=function(a){var b=this.hls.config,c=b.pLoader,d=b.loader,e=c||d,f=new e(b);return a.loader=f,this.loaders[a.type]=f,f},b.getInternalLoader=function(a){return this.loaders[a.type]},b.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},b.destroyInternalLoaders=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy(),this.resetInternalLoader(a)}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onManifestLoading=function(a,b){var c=b.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:l.PlaylistContextType.MANIFEST,url:c,deliveryDirectives:null})},b.onLevelLoading=function(a,b){var c=b.id,d=b.level,e=b.url,f=b.deliveryDirectives;this.load({id:c,groupId:null,level:d,responseType:"text",type:l.PlaylistContextType.LEVEL,url:e,deliveryDirectives:f})},b.onAudioTrackLoading=function(a,b){var c=b.id,d=b.groupId,e=b.url,f=b.deliveryDirectives;this.load({id:c,groupId:d,level:null,responseType:"text",type:l.PlaylistContextType.AUDIO_TRACK,url:e,deliveryDirectives:f})},b.onSubtitleTrackLoading=function(a,b){var c=b.id,d=b.groupId,e=b.url,f=b.deliveryDirectives;this.load({id:c,groupId:d,level:null,responseType:"text",type:l.PlaylistContextType.SUBTITLE_TRACK,url:e,deliveryDirectives:f})},b.load=function(a){var b,c=this.hls.config,d=this.getInternalLoader(a);if(d){var e=d.context;if(e&&e.url===a.url)return void i.logger.trace("[playlist-loader]: playlist request ongoing");i.logger.log("[playlist-loader]: aborting previous loader for type: "+a.type),d.abort()}var f,g,h,j;switch(a.type){case l.PlaylistContextType.MANIFEST:f=c.manifestLoadingMaxRetry,g=c.manifestLoadingTimeOut,h=c.manifestLoadingRetryDelay,j=c.manifestLoadingMaxRetryTimeout;break;case l.PlaylistContextType.LEVEL:case l.PlaylistContextType.AUDIO_TRACK:case l.PlaylistContextType.SUBTITLE_TRACK:f=0,g=c.levelLoadingTimeOut;break;default:f=c.levelLoadingMaxRetry,g=c.levelLoadingTimeOut,h=c.levelLoadingRetryDelay,j=c.levelLoadingMaxRetryTimeout}if(d=this.createInternalLoader(a),null!==(b=a.deliveryDirectives)&&void 0!==b&&b.part){var k;if(a.type===l.PlaylistContextType.LEVEL&&null!==a.level?k=this.hls.levels[a.level].details:a.type===l.PlaylistContextType.AUDIO_TRACK&&null!==a.id?k=this.hls.audioTracks[a.id].details:a.type===l.PlaylistContextType.SUBTITLE_TRACK&&null!==a.id&&(k=this.hls.subtitleTracks[a.id].details),k){var m=k.partTarget,n=k.targetduration;m&&n&&(g=Math.min(1e3*Math.max(3*m,.8*n),g))}}var o={timeout:g,maxRetry:f,retryDelay:h,maxRetryDelay:j,highWaterMark:0},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(a,o,p)},b.loadsuccess=function(a,b,c,d){if(void 0===d&&(d=null),c.isSidxRequest)return this.handleSidxRequest(a,c),void this.handlePlaylistLoaded(a,b,c,d);this.resetInternalLoader(c.type);var e=a.data;if(0!==e.indexOf("#EXTM3U"))return void this.handleManifestParsingError(a,c,"no EXTM3U delimiter",d);b.parsing.start=performance.now(),e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(a,b,c,d):this.handleMasterPlaylist(a,b,c,d)},b.loaderror=function(a,b,c){void 0===c&&(c=null),this.handleNetworkError(b,c,!1,a)},b.loadtimeout=function(a,b,c){void 0===c&&(c=null),this.handleNetworkError(b,c,!0)},b.handleMasterPlaylist=function(a,b,c,d){var f=this.hls,h=a.data,j=e(a,c),l=k.default.parseMasterPlaylist(h,j),n=l.levels,o=l.sessionData;if(!n.length)return void this.handleManifestParsingError(a,c,"no level found in manifest",d);var p=n.map(function(a){return{id:a.attrs.AUDIO,audioCodec:a.audioCodec}}),q=n.map(function(a){return{id:a.attrs.SUBTITLES,textCodec:a.textCodec}}),r=k.default.parseMasterPlaylistMedia(h,j,"AUDIO",p),s=k.default.parseMasterPlaylistMedia(h,j,"SUBTITLES",q),t=k.default.parseMasterPlaylistMedia(h,j,"CLOSED-CAPTIONS");if(r.length){r.some(function(a){return!a.url})||!n[0].audioCodec||n[0].attrs.AUDIO||(i.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),r.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new m.AttrList({}),bitrate:0,url:""}))}f.trigger(g.Events.MANIFEST_LOADED,{levels:n,audioTracks:r,subtitles:s,captions:t,url:j,stats:b,networkDetails:d,sessionData:o})},b.handleTrackOrLevelPlaylist=function(a,b,c,i){var j=this.hls,n=c.id,o=c.level,p=c.type,q=e(a,c),r=Object(f.isFiniteNumber)(n)?n:0,s=Object(f.isFiniteNumber)(o)?o:r,t=d(c),u=k.default.parseLevelPlaylist(a.data,q,s,t,r);if(!u.fragments.length)return void j.trigger(g.Events.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:q,reason:"no fragments found in level",level:"number"==typeof c.level?c.level:void 0});if(p===l.PlaylistContextType.MANIFEST){var v={attrs:new m.AttrList({}),bitrate:0,details:u,name:"",url:q};j.trigger(g.Events.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:q,stats:b,networkDetails:i,sessionData:null})}if(b.parsing.end=performance.now(),u.needSidxRanges){var w,x=null===(w=u.fragments[0].initSegment)||void 0===w?void 0:w.url;return void this.load({url:x,isSidxRequest:!0,type:p,level:o,levelDetails:u,id:n,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}c.levelDetails=u,this.handlePlaylistLoaded(a,b,c,i)},b.handleSidxRequest=function(a,b){var c=Object(j.parseSegmentIndex)(new Uint8Array(a.data));if(c){var d=c.references,e=b.levelDetails;d.forEach(function(a,b){var d=a.info,f=e.fragments[b];0===f.byteRange.length&&f.setByteRange(String(1+d.end-d.start)+"@"+String(d.start)),f.initSegment&&f.initSegment.setByteRange(String(c.moovEndOffset)+"@0")})}},b.handleManifestParsingError=function(a,b,c,d){this.hls.trigger(g.Events.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:b.type===l.PlaylistContextType.MANIFEST,url:a.url,reason:c,response:a,context:b,networkDetails:d})},b.handleNetworkError=function(a,b,c,d){void 0===c&&(c=!1),i.logger.warn("[playlist-loader]: A network "+(c?"timeout":"error")+" occurred while loading "+a.type+" level: "+a.level+" id: "+a.id+' group-id: "'+a.groupId+'"');var e=h.ErrorDetails.UNKNOWN,f=!1,j=this.getInternalLoader(a);switch(a.type){case l.PlaylistContextType.MANIFEST:e=c?h.ErrorDetails.MANIFEST_LOAD_TIMEOUT:h.ErrorDetails.MANIFEST_LOAD_ERROR,f=!0;break;case l.PlaylistContextType.LEVEL:e=c?h.ErrorDetails.LEVEL_LOAD_TIMEOUT:h.ErrorDetails.LEVEL_LOAD_ERROR,f=!1;break;case l.PlaylistContextType.AUDIO_TRACK:e=c?h.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case l.PlaylistContextType.SUBTITLE_TRACK:e=c?h.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:h.ErrorDetails.SUBTITLE_LOAD_ERROR,f=!1}j&&this.resetInternalLoader(a.type);var k={type:h.ErrorTypes.NETWORK_ERROR,details:e,fatal:f,url:a.url,loader:j,context:a,networkDetails:b};d&&(k.response=d),this.hls.trigger(g.Events.ERROR,k)},b.handlePlaylistLoaded=function(a,b,c,d){var e=c.type,f=c.level,h=c.id,i=c.groupId,j=c.loader,k=c.levelDetails,m=c.deliveryDirectives;if(null===k||void 0===k||!k.targetduration)return void this.handleManifestParsingError(a,c,"invalid target duration",d);if(j)switch(k.live&&(j.getCacheAge&&(k.ageHeader=j.getCacheAge()||0),j.getCacheAge&&!isNaN(k.ageHeader)||(k.ageHeader=0)),e){case l.PlaylistContextType.MANIFEST:case l.PlaylistContextType.LEVEL:this.hls.trigger(g.Events.LEVEL_LOADED,{details:k,level:f||0,id:h||0,stats:b,networkDetails:d,deliveryDirectives:m});break;case l.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(g.Events.AUDIO_TRACK_LOADED,{details:k,id:h||0,groupId:i||"",stats:b,networkDetails:d,deliveryDirectives:m});break;case l.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(g.Events.SUBTITLE_TRACK_LOADED,{details:k,id:h||0,groupId:i||"",stats:b,networkDetails:d,deliveryDirectives:m})}},a}();b.default=n},"./src/polyfills/number.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"isFiniteNumber",function(){return d}),c.d(b,"MAX_SAFE_INTEGER",function(){return e});var d=Number.isFinite||function(a){return"number"==typeof a&&isFinite(a)},e=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){}return a.getSilentFrame=function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},a}();b.default=d},"./src/remux/mp4-generator.ts":function(a,b,c){"use strict";c.r(b);var d=Math.pow(2,32)-1,e=function(){function a(){}return a.init=function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(a){for(var b=8,c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];for(var f=d.length,g=f;f--;)b+=d[f].byteLength;var h=new Uint8Array(b);for(h[0]=b>>24&255,h[1]=b>>16&255,h[2]=b>>8&255,h[3]=255&b,h.set(a,4),f=0,b=8;f<g;f++)h.set(d[f],b),b+=d[f].byteLength;return h},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,g)},a.sdtp=function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(c=0;c<e.length;c++)d=e[c].flags,f[c+4]=d.dependsOn<<4|d.isDependedOn<<2|d.hasRedundancy;return a.box(a.types.sdtp,f)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))},a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))},a.tkhd=function(b){var c=b.id,e=b.duration*b.timescale,f=b.width,g=b.height,h=Math.floor(e/(d+1)),i=Math.floor(e%(d+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,f>>8&255,255&f,0,0,g>>8&255,255&g,0,0]))},a.traf=function(b,c){var e=a.sdtp(b),f=b.id,g=Math.floor(c/(d+1)),h=Math.floor(c%(d+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,255&f])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h])),a.trun(b,e.length+16+20+8+16+8+8),e)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;d<k;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)},a.initSegment=function(b){a.types||a.init();var c=a.moov(b),d=new Uint8Array(a.FTYP.byteLength+c.byteLength);return d.set(a.FTYP),d.set(c,a.FTYP.byteLength),d},a}();e.types=void 0,e.HDLR_TYPES=void 0,e.STTS=void 0,e.STSC=void 0,e.STCO=void 0,e.STSZ=void 0,e.VMHD=void 0,e.SMHD=void 0,e.STSD=void 0,e.FTYP=void 0,e.DINF=void 0,b.default=e},"./src/remux/mp4-remuxer.ts":function(a,b,c){"use strict";function d(){return d=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},d.apply(this,arguments)}function e(a,b){var c;if(null===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}function f(a){for(var b=0;b<a.length;b++)if(a[b].key)return b;return-1}c.r(b),c.d(b,"default",function(){return u}),c.d(b,"normalizePts",function(){return e});var g=c("./src/polyfills/number.ts"),h=c("./src/remux/aac-helper.ts"),i=c("./src/remux/mp4-generator.ts"),j=c("./src/events.ts"),k=c("./src/errors.ts"),l=c("./src/utils/logger.ts"),m=c("./src/types/loader.ts"),n=c("./src/utils/timescale-conversion.ts"),o=1e4,p=1024,q=1152,r=null,s=null,t=!1,u=function(){function a(a,b,c,d){if(void 0===d&&(d=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=b,this.typeSupported=c,this.ISGenerated=!1,null===r){var e=navigator.userAgent||"",f=e.match(/Chrome\/(\d+)/i);r=f?parseInt(f[1]):0}if(null===s){var g=navigator.userAgent.match(/Safari\/(\d+)/i);s=g?parseInt(g[1]):0}t=!!r&&r<75||!!s&&s<600}var b=a.prototype;return b.destroy=function(){},b.resetTimeStamp=function(a){l.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},b.resetNextTimestamp=function(){l.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},b.resetInitSegment=function(){l.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},b.getVideoStartPts=function(a){var b=!1,c=a.reduce(function(a,c){var d=c.pts-a;return d<-4294967296?(b=!0,e(a,c.pts)):d>0?a:c.pts},a[0].pts);return b&&l.logger.debug("PTS rollover detected"),c},b.remux=function(a,b,c,d,g,h,i,j){var k,n,o,p,q,r,s=g,t=g,u=a.pid>-1,v=b.pid>-1,w=b.samples.length,x=a.samples.length>0,y=w>1;if((!u||x)&&(!v||y)||this.ISGenerated||i){this.ISGenerated||(o=this.generateIS(a,b,g));var z=this.isVideoContiguous,A=-1;if(y&&(A=f(b.samples),!z&&this.config.forceKeyFrameOnDiscontinuity))if(r=!0,A>0){l.logger.warn("[mp4-remuxer]: Dropped "+A+" out of "+w+" video samples due to a missing keyframe");var B=this.getVideoStartPts(b.samples);b.samples=b.samples.slice(A),b.dropped+=A,t+=(b.samples[0].pts-B)/(b.timescale||9e4)}else-1===A&&(l.logger.warn("[mp4-remuxer]: No keyframe found out of "+w+" video samples"),r=!1);if(this.ISGenerated){if(x&&y){var C=this.getVideoStartPts(b.samples),D=e(a.samples[0].pts,C)-C,E=D/b.inputTimeScale;s+=Math.max(0,E),t+=Math.max(0,-E)}if(x){if(a.samplerate||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),o=this.generateIS(a,b,g)),n=this.remuxAudio(a,s,this.isAudioContiguous,h,v||y||j===m.PlaylistLevelType.AUDIO?t:void 0),y){var F=n?n.endPTS-n.startPTS:0;b.inputTimeScale||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),o=this.generateIS(a,b,g)),k=this.remuxVideo(b,t,z,F)}}else y&&(k=this.remuxVideo(b,t,z,0));k&&(k.firstKeyFrame=A,k.independent=-1!==A)}}return this.ISGenerated&&(c.samples.length&&(q=this.remuxID3(c,g)),d.samples.length&&(p=this.remuxText(d,g))),{audio:n,video:k,initSegment:o,independent:r,text:p,id3:q}},b.generateIS=function(a,b,c){var d,f,h,j=a.samples,k=b.samples,l=this.typeSupported,m={},n=!Object(g.isFiniteNumber)(this._initPTS),o="audio/mp4";if(n&&(d=f=1/0),a.config&&j.length&&(a.timescale=a.samplerate,a.isAAC||(l.mpeg?(o="audio/mpeg",a.codec=""):l.mp3&&(a.codec="mp3")),m.audio={id:"audio",container:o,codec:a.codec,initSegment:!a.isAAC&&l.mpeg?new Uint8Array(0):i.default.initSegment([a]),metadata:{channelCount:a.channelCount}},n&&(h=a.inputTimeScale,d=f=j[0].pts-Math.round(h*c))),b.sps&&b.pps&&k.length&&(b.timescale=b.inputTimeScale,m.video={id:"main",container:"video/mp4",codec:b.codec,initSegment:i.default.initSegment([b]),metadata:{width:b.width,height:b.height}},n)){h=b.inputTimeScale;var p=this.getVideoStartPts(k),q=Math.round(h*c);f=Math.min(f,e(k[0].dts,p)-q),d=Math.min(d,p-q)}if(Object.keys(m).length)return this.ISGenerated=!0,n&&(this._initPTS=d,this._initDTS=f),{tracks:m,initPTS:d,timescale:h}},b.remuxVideo=function(a,b,c,f){var g,h,m,o=a.inputTimeScale,p=a.samples,q=[],s=p.length,u=this._initPTS,w=this.nextAvcDts,x=8,y=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,A=0,B=!1;if(!c||null===w){w=b*o-(p[0].pts-e(p[0].dts,p[0].pts))}for(var C=0;C<s;C++){var D=p[C];if(D.pts=e(D.pts-u,w),D.dts=e(D.dts-u,w),D.dts>D.pts){A=Math.max(Math.min(A,D.pts-D.dts),-1*18e3)}D.dts<p[C>0?C-1:C].dts&&(B=!0)}B&&p.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c||d}),h=p[0].dts,m=p[p.length-1].dts;var E=Math.round((m-h)/(s-1));if(A<0){if(A<-2*E){l.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(n.toMsFromMpegTsClock)(-E,!0)+" ms");for(var F=A,G=0;G<s;G++)p[G].dts=F=Math.max(F,p[G].pts-E),p[G].pts=Math.max(F,p[G].pts)}else{l.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(n.toMsFromMpegTsClock)(A,!0)+" ms to overcome this issue");for(var H=0;H<s;H++)p[H].dts=p[H].dts+A}h=p[0].dts}if(c){var I=h-w,J=I>E,K=I<-1;if(J||K){J?l.logger.warn("AVC: "+Object(n.toMsFromMpegTsClock)(I,!0)+" ms ("+I+"dts) hole between fragments detected, filling it"):l.logger.warn("AVC: "+Object(n.toMsFromMpegTsClock)(-I,!0)+" ms ("+I+"dts) overlapping between fragments detected"),h=w;var L=p[0].pts-I;p[0].dts=h,p[0].pts=L,l.logger.log("Video: First PTS/DTS adjusted: "+Object(n.toMsFromMpegTsClock)(L,!0)+"/"+Object(n.toMsFromMpegTsClock)(h,!0)+", delta: "+Object(n.toMsFromMpegTsClock)(I,!0)+" ms")}}t&&(h=Math.max(0,h));for(var M=0,N=0,O=0;O<s;O++){for(var P=p[O],Q=P.units,R=Q.length,S=0,T=0;T<R;T++)S+=Q[T].data.length;N+=S,M+=R,P.length=S,P.dts=Math.max(P.dts,h),P.pts=Math.max(P.pts,P.dts,0),y=Math.min(P.pts,y),z=Math.max(P.pts,z)}m=p[s-1].dts;var U,V=N+4*M+8;try{U=new Uint8Array(V)}catch(a){return void this.observer.emit(j.Events.ERROR,j.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating video mdat "+V})}var W=new DataView(U.buffer);W.setUint32(0,V),U.set(i.default.types.mdat,4);for(var X=0;X<s;X++){for(var Y=p[X],Z=Y.units,$=0,_=0,aa=Z.length;_<aa;_++){var ba=Z[_],ca=ba.data,da=ba.data.byteLength;W.setUint32(x,da),x+=4,U.set(ca,x),x+=da,$+=4+da}if(X<s-1)g=p[X+1].dts-Y.dts;else{var ea=this.config,fa=Y.dts-p[X>0?X-1:X].dts;if(ea.stretchShortVideoTrack&&null!==this.nextAudioPts){var ga=Math.floor(ea.maxBufferHole*o),ha=(f?y+f*o:this.nextAudioPts)-Y.pts;ha>ga?(g=ha-fa,g<0&&(g=fa),l.logger.log("[mp4-remuxer]: It is approximately "+ha/90+" ms to the next segment; using duration "+g/90+" ms for the last video frame.")):g=fa}else g=fa}var ia=Math.round(Y.pts-Y.dts);q.push(new v(Y.key,g,$,ia))}if(q.length&&r&&r<70){var ja=q[0].flags;ja.dependsOn=2,ja.isNonSync=0}console.assert(void 0!==g,"mp4SampleDuration must be computed"),this.nextAvcDts=w=m+g,this.isVideoContiguous=!0;var ka=i.default.moof(a.sequenceNumber++,h,d({},a,{samples:q})),la="video",ma={data1:ka,data2:U,startPTS:y/o,endPTS:(z+g)/o,startDTS:h/o,endDTS:w/o,type:la,hasAudio:!1,hasVideo:!0,nb:q.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(U.length,"MDAT length must not be zero"),ma},b.remuxAudio=function(a,b,c,f,g){var m=a.inputTimeScale,n=a.samplerate?a.samplerate:m,r=m/n,s=a.isAAC?p:q,t=s*r,u=this._initPTS,w=!a.isAAC&&this.typeSupported.mpeg,x=[],y=a.samples,z=w?0:8,A=this.nextAudioPts||-1,B=b*m;if(this.isAudioContiguous=c=c||y.length&&A>0&&(f&&Math.abs(B-A)<9e3||Math.abs(e(y[0].pts-u,B)-A)<20*t),y.forEach(function(a){a.pts=e(a.pts-u,B)}),!c||A<0){if(y=y.filter(function(a){return a.pts>=0}),!y.length)return;A=0===g?0:f?Math.max(0,B):y[0].pts}if(a.isAAC)for(var C=void 0!==g,D=this.config.maxAudioFramesDrift,E=0,F=A;E<y.length;E++){var G=y[E],H=G.pts,I=H-F,J=Math.abs(1e3*I/m);if(I<=-D*t&&C)0===E&&(l.logger.warn("Audio frame @ "+(H/m).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*I/m)+" ms."),this.nextAudioPts=A=F=H);else if(I>=D*t&&J<o&&C){var K=Math.round(I/t);F=H-K*t,F<0&&(K--,F+=t),0===E&&(this.nextAudioPts=A=F),l.logger.warn("[mp4-remuxer]: Injecting "+K+" audio frame @ "+(F/m).toFixed(3)+"s due to "+Math.round(1e3*I/m)+" ms gap.");for(var L=0;L<K;L++){var M=Math.max(F,0),N=h.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);N||(l.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),N=G.unit.subarray()),y.splice(E,0,{unit:N,pts:M}),F+=t,E++}}G.pts=F,F+=t}for(var O,P=null,Q=null,R=0,S=y.length;S--;)R+=y[S].unit.byteLength;for(var T=0,U=y.length;T<U;T++){var V=y[T],W=V.unit,X=V.pts;if(null!==Q){x[T-1].duration=Math.round((X-Q)/r)}else{if(c&&a.isAAC&&(X=A),P=X,!(R>0))return;R+=z;try{O=new Uint8Array(R)}catch(a){return void this.observer.emit(j.Events.ERROR,j.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:R,reason:"fail allocating audio mdat "+R})}if(!w){new DataView(O.buffer).setUint32(0,R),O.set(i.default.types.mdat,4)}}O.set(W,z);var Y=W.byteLength;z+=Y,x.push(new v(!0,s,Y,0)),Q=X}var Z=x.length;if(Z){var $=x[x.length-1];this.nextAudioPts=A=Q+r*$.duration;var _=w?new Uint8Array(0):i.default.moof(a.sequenceNumber++,P/r,d({},a,{samples:x}));a.samples=[];var aa=P/m,ba=A/m,ca="audio",da={data1:_,data2:O,startPTS:aa,endPTS:ba,startDTS:aa,endDTS:ba,type:ca,hasAudio:!0,hasVideo:!1,nb:Z};return this.isAudioContiguous=!0,console.assert(O.length,"MDAT length must not be zero"),da}},b.remuxEmptyAudio=function(a,b,c,d){var e=a.inputTimeScale,f=a.samplerate?a.samplerate:e,g=e/f,i=this.nextAudioPts,j=(null!==i?i:d.startDTS*e)+this._initDTS,k=d.endDTS*e+this._initDTS,m=g*p,n=Math.ceil((k-j)/m),o=h.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(l.logger.warn("[mp4-remuxer]: remux empty Audio"),!o)return void l.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");for(var q=[],r=0;r<n;r++){var s=j+r*m;q.push({unit:o,pts:s,dts:s})}return a.samples=q,this.remuxAudio(a,b,c,!1)},b.remuxID3=function(a,b){var c=a.samples.length;if(c){for(var d=a.inputTimeScale,f=this._initPTS,g=this._initDTS,h=0;h<c;h++){var i=a.samples[h];i.pts=e(i.pts-f,b*d)/d,i.dts=e(i.dts-g,b*d)/d}var j=a.samples;return a.samples=[],{samples:j}}},b.remuxText=function(a,b){var c=a.samples.length;if(c){for(var d=a.inputTimeScale,f=this._initPTS,g=0;g<c;g++){var h=a.samples[g];h.pts=e(h.pts-f,b*d)/d}a.samples.sort(function(a,b){return a.pts-b.pts});var i=a.samples;return a.samples=[],{samples:i}}},a}(),v=function(a,b,c,d){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=b,this.size=c,this.cts=d,this.flags=new w(a)},w=function(a){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=a?2:1,this.isNonSync=a?0:1}},"./src/remux/passthrough-remuxer.ts":function(a,b,c){"use strict";function d(a,b){var c=null===a||void 0===a?void 0:a.codec;return c&&c.length>4?c:"hvc1"===c?"hvc1.1.c.L120.90":"av01"===c?"av01.0.04M.08":"avc1"===c||b===g.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}c.r(b);var e=c("./src/polyfills/number.ts"),f=c("./src/utils/mp4-tools.ts"),g=c("./src/loader/fragment.ts"),h=c("./src/utils/logger.ts"),i=function(){function a(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var b=a.prototype;return b.destroy=function(){},b.resetTimeStamp=function(a){this.initPTS=a,this.lastEndDTS=null},b.resetNextTimestamp=function(){this.lastEndDTS=null},b.resetInitSegment=function(a,b,c){this.audioCodec=b,this.videoCodec=c,this.generateInitSegment(a),this.emitInitSegment=!0},b.generateInitSegment=function(a){var b=this.audioCodec,c=this.videoCodec;if(!a||!a.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var e=this.initData=Object(f.parseInitSegment)(a);b||(b=d(e.audio,g.ElementaryStreamTypes.AUDIO)),c||(c=d(e.video,g.ElementaryStreamTypes.VIDEO));var i={};e.audio&&e.video?i.audiovideo={container:"video/mp4",codec:b+","+c,initSegment:a,id:"main"}:e.audio?i.audio={container:"audio/mp4",codec:b,initSegment:a,id:"audio"}:e.video?i.video={container:"video/mp4",codec:c,initSegment:a,id:"main"}:h.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},b.remux=function(a,b,c,d,g){var i=this.initPTS,k=this.lastEndDTS,l={audio:void 0,video:void 0,text:d,id3:c,initSegment:void 0};Object(e.isFiniteNumber)(k)||(k=this.lastEndDTS=g||0);var m=b.samples;if(!m||!m.length)return l;var n={initPTS:void 0,timescale:1},o=this.initData;if(o&&o.length||(this.generateInitSegment(m),o=this.initData),!o||!o.length)return h.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(e.isFiniteNumber)(i)||(this.initPTS=n.initPTS=i=j(o,m,k));var p=Object(f.getDuration)(m,o),q=k,r=p+q;Object(f.offsetStartDTS)(o,m,i),p>0?this.lastEndDTS=r:(h.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var s=!!o.audio,t=!!o.video,u="";s&&(u+="audio"),t&&(u+="video");var v={data1:m,startPTS:q,startDTS:q,endPTS:r,endDTS:r,type:u,hasAudio:s,hasVideo:t,nb:1,dropped:0};return l.audio="audio"===v.type?v:void 0,l.video="audio"!==v.type?v:void 0,l.text=d,l.id3=c,l.initSegment=n,l},a}(),j=function(a,b,c){return Object(f.getStartDTS)(a,b)-c};b.default=i},"./src/task-loop.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=a.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(a){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,a),!0)},b.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.tick=function(){1===++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},a}()},"./src/types/level.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a,b){var c=a.canSkipUntil,d=a.canSkipDateRanges,e=a.endSN,f=void 0!==b?b-e:0;return c&&f<c?d?g.v2:g.Yes:g.No}c.r(b),c.d(b,"HlsSkip",function(){return g}),c.d(b,"getSkipValue",function(){return f}),c.d(b,"HlsUrlParameters",function(){return h}),c.d(b,"Level",function(){return i});var g;!function(a){a.No="",a.Yes="YES",a.v2="v2"}(g||(g={}));var h=function(){function a(a,b,c){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=b,this.skip=c}return a.prototype.addDirectives=function(a){var b=new self.URL(a);return void 0!==this.msn&&b.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&b.searchParams.set("_HLS_part",this.part.toString()),this.skip&&b.searchParams.set("_HLS_skip",this.skip),b.toString()},a}(),i=function(){function a(a){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[a.url],this.attrs=a.attrs,this.bitrate=a.bitrate,a.details&&(this.details=a.details),this.id=a.id||0,this.name=a.name,this.width=a.width||0,this.height=a.height||0,this.audioCodec=a.audioCodec,this.videoCodec=a.videoCodec,this.unknownCodecs=a.unknownCodecs,this.codecSet=[a.videoCodec,a.audioCodec].filter(function(a){return a}).join(",").replace(/\.[^.,]+/g,"")}return e(a,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(a){var b=a%this.url.length;this._urlId!==b&&(this.details=void 0,this._urlId=b)}}]),a}()},"./src/types/loader.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"PlaylistContextType",function(){return d}),c.d(b,"PlaylistLevelType",function(){return e});var d;!function(a){a.MANIFEST="manifest",a.LEVEL="level",a.AUDIO_TRACK="audioTrack",a.SUBTITLE_TRACK="subtitleTrack"}(d||(d={}));var e;!function(a){a.MAIN="main",a.AUDIO="audio",a.SUBTITLE="subtitle"}(e||(e={}))},"./src/types/transmuxer.ts":function(a,b,c){"use strict";function d(){return{start:0,executeStart:0,executeEnd:0,end:0}}c.r(b),c.d(b,"ChunkMetadata",function(){return e});var e=function(a,b,c,e,f,g){void 0===e&&(e=0),void 0===f&&(f=-1),void 0===g&&(g=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=d(),this.buffering={audio:d(),video:d(),audiovideo:d()},this.level=a,this.sn=b,this.id=c,this.size=e,this.part=f,this.partial=g}},"./src/utils/attr-list.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"AttrList",function(){return f});var d=/^(\d+)x(\d+)$/,e=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,f=function(){function a(b){"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}var b=a.prototype;return b.decimalInteger=function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b},b.hexadecimalInteger=function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null},b.hexadecimalIntegerAsNumber=function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b},b.decimalFloatingPoint=function(a){return parseFloat(this[a])},b.optionalFloat=function(a,b){var c=this[a];return c?parseFloat(c):b},b.enumeratedString=function(a){return this[a]},b.bool=function(a){return"YES"===this[a]},b.decimalResolution=function(a){var b=d.exec(this[a]);if(null!==b)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}},a.parseAttrList=function(a){var b,c={},d='"';for(e.lastIndex=0;null!==(b=e.exec(a));){var f=b[2];0===f.indexOf(d)&&f.lastIndexOf(d)===f.length-1&&(f=f.slice(1,-1)),c[b[1]]=f}return c},a}()},"./src/utils/binary-search.ts":function(a,b,c){"use strict";c.r(b);var d={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;c<=d;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(g<0))return f;d=e-1}}return null}};b.default=d},"./src/utils/buffer-helper.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"BufferHelper",function(){return f});var d=c("./src/utils/logger.ts"),e={length:0,start:function(){return 0},end:function(){return 0}},f=function(){function a(){}return a.isBuffered=function(b,c){try{if(b)for(var d=a.getBuffered(b),e=0;e<d.length;e++)if(c>=d.start(e)&&c<=d.end(e))return!0}catch(a){}return!1},a.bufferInfo=function(b,c,d){try{if(b){var e,f=a.getBuffered(b),g=[];for(e=0;e<f.length;e++)g.push({start:f.start(e),end:f.end(e)});return this.bufferedInfo(g,c,d)}}catch(a){}return{len:0,start:c,end:c,nextStart:void 0}},a.bufferedInfo=function(a,b,c){b=Math.max(0,b),a.sort(function(a,b){var c=a.start-b.start;return c||b.end-a.end});var d=[];if(c)for(var e=0;e<a.length;e++){var f=d.length;if(f){var g=d[f-1].end;a[e].start-g<c?a[e].end>g&&(d[f-1].end=a[e].end):d.push(a[e])}else d.push(a[e])}else d=a;for(var h,i=0,j=b,k=b,l=0;l<d.length;l++){var m=d[l].start,n=d[l].end;if(b+c>=m&&b<n)j=m,k=n,i=k-b;else if(b+c<m){h=m;break}}return{len:i,start:j||0,end:k||0,nextStart:h}},a.getBuffered=function(a){try{return a.buffered}catch(a){return d.logger.log("failed to get media.buffered",a),e}},a}()},"./src/utils/cea-608-parser.ts":function(a,b,c){"use strict";function d(a,b,c){c.a=a,c.b=b}function e(a,b,c){return c.a===a&&c.b===b}function f(){return{a:null,b:null}}c.r(b),c.d(b,"Row",function(){return v}),c.d(b,"CaptionScreen",function(){return w});var g,h=c("./src/utils/logger.ts"),i={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},j=function(a){var b=a;return i.hasOwnProperty(a)&&(b=i[a]),String.fromCharCode(b)},k=15,l=100,m={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},n={17:2,18:4,21:6,22:8,23:10,19:13,20:15},o={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},q=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(a){a[a.ERROR=0]="ERROR",a[a.TEXT=1]="TEXT",a[a.WARNING=2]="WARNING",a[a.INFO=2]="INFO",a[a.DEBUG=3]="DEBUG",a[a.DATA=3]="DATA"}(g||(g={}));var r=function(){function a(){this.time=null,this.verboseLevel=g.ERROR}return a.prototype.log=function(a,b){this.verboseLevel>=a&&h.logger.log(this.time+" ["+a+"] "+b)},a}(),s=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},t=function(){function a(a,b,c,d,e){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=b||!1,this.italics=c||!1,this.background=d||"black",this.flash=e||!1}var b=a.prototype;return b.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},b.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},b.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},b.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},b.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},b.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),u=function(){function a(a,b,c,d,e,f){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new t(b,c,d,e,f)}var b=a.prototype;return b.reset=function(){this.uchar=" ",this.penState.reset()},b.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},b.setPenState=function(a){this.penState.copy(a)},b.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},b.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},b.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},a}(),v=function(){function a(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var b=0;b<l;b++)this.chars.push(new u);this.logger=a,this.pos=0,this.currPenState=new t}var b=a.prototype;return b.equals=function(a){for(var b=!0,c=0;c<l;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},b.copy=function(a){for(var b=0;b<l;b++)this.chars[b].copy(a.chars[b])},b.isEmpty=function(){for(var a=!0,b=0;b<l;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},b.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(g.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(this.logger.log(g.DEBUG,"Too large cursor position "+this.pos),this.pos=l)},b.moveCursor=function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;c<b+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)},b.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},b.insertChar=function(a){a>=144&&this.backSpace();var b=j(a);if(this.pos>=l)return void this.logger.log(g.ERROR,"Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(b,this.currPenState),this.moveCursor(1)},b.clearFromPos=function(a){var b;for(b=a;b<l;b++)this.chars[b].reset()},b.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},b.clearToEndOfRow=function(){this.clearFromPos(this.pos)},b.getTextString=function(){for(var a=[],b=!0,c=0;c<l;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},b.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},a}(),w=function(){function a(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var b=0;b<k;b++)this.rows.push(new v(a));this.logger=a,this.currRow=k-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var b=a.prototype;return b.reset=function(){for(var a=0;a<k;a++)this.rows[a].clear();this.currRow=k-1},b.equals=function(a){for(var b=!0,c=0;c<k;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},b.copy=function(a){for(var b=0;b<k;b++)this.rows[b].copy(a.rows[b])},b.isEmpty=function(){for(var a=!0,b=0;b<k;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},b.backSpace=function(){this.rows[this.currRow].backSpace()},b.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},b.insertChar=function(a){this.rows[this.currRow].insertChar(a)},b.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},b.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},b.setCursor=function(a){this.logger.log(g.INFO,"setCursor: "+a),this.rows[this.currRow].setCursor(a)},b.setPAC=function(a){this.logger.log(g.INFO,"pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;c<k;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var f=e.rows[d].cueStartTime,h=this.logger.time;if(f&&null!==h&&f<h)for(var i=0;i<this.nrRollUpRows;i++)this.rows[b-this.nrRollUpRows+i+1].copy(e.rows[d+i])}}this.currRow=b;var j=this.rows[this.currRow];if(null!==a.indent){var l=a.indent,m=Math.max(l-1,0);j.setCursor(a.indent),a.color=j.chars[m].penState.foreground}var n={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(n)},b.setBkgData=function(a){this.logger.log(g.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},b.setRollUpRows=function(a){this.nrRollUpRows=a},b.rollUp=function(){if(null===this.nrRollUpRows)return void this.logger.log(g.DEBUG,"roll_up but nrRollUpRows not set yet");this.logger.log(g.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),this.logger.log(g.INFO,"Rolling up")},b.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;e<k;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},b.getTextAndFormat=function(){return this.rows},a}(),x=function(){function a(a,b,c){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=b,this.mode=null,this.verbose=0,this.displayedMemory=new w(c),this.nonDisplayedMemory=new w(c),this.lastOutputScreen=new w(c),this.currRollUpRow=this.displayedMemory.rows[k-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=c}var b=a.prototype;return b.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[k-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},b.getHandler=function(){return this.outputFilter},b.setHandler=function(a){this.outputFilter=a},b.setPAC=function(a){this.writeScreen.setPAC(a)},b.setBkgData=function(a){this.writeScreen.setBkgData(a)},b.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(g.INFO,"MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},b.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(g.INFO,c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(g.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},b.ccRCL=function(){this.logger.log(g.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},b.ccBS=function(){this.logger.log(g.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},b.ccAOF=function(){},b.ccAON=function(){},b.ccDER=function(){this.logger.log(g.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},b.ccRU=function(a){this.logger.log(g.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},b.ccFON=function(){this.logger.log(g.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},b.ccRDC=function(){this.logger.log(g.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},b.ccTR=function(){this.logger.log(g.INFO,"TR"),this.setMode("MODE_TEXT")},b.ccRTD=function(){this.logger.log(g.INFO,"RTD"),this.setMode("MODE_TEXT")},b.ccEDM=function(){this.logger.log(g.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},b.ccCR=function(){this.logger.log(g.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},b.ccENM=function(){this.logger.log(g.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},b.ccEOC=function(){if(this.logger.log(g.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(g.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},b.ccTO=function(a){this.logger.log(g.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},b.ccMIDROW=function(a){var b={flash:!1};if(b.underline=a%2==1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}this.logger.log(g.INFO,"MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},b.outputDataUpdate=function(a){void 0===a&&(a=!1);var b=this.logger.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=b,this.lastOutputScreen.copy(this.displayedMemory))},b.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},a}(),y=function(){function a(a,b,c){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var d=new r;this.channels=[null,new x(a,b,d),new x(a+1,c,d)],this.cmdHistory=f(),this.logger=d}var b=a.prototype;return b.getHandler=function(a){return this.channels[a].getHandler()},b.setHandler=function(a,b){this.channels[a].setHandler(b)},b.addData=function(a,b){var c,d,e,f=!1;this.logger.time=a;for(var h=0;h<b.length;h+=2)if(d=127&b[h],e=127&b[h+1],0!==d||0!==e){if(this.logger.log(g.DATA,"["+s([b[h],b[h+1]])+"] -> ("+s([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e))){var i=this.currentChannel;if(i&&i>0){var j=this.channels[i];j.insertChars(f)}else this.logger.log(g.WARNING,"No channel found yet. TEXT-MODE?")}c||f||this.logger.log(g.WARNING,"Couldn't parse cleaned data "+s([d,e])+" orig: "+s([b[h],b[h+1]]))}},b.parseCmd=function(a,b){var c=this.cmdHistory,f=(20===a||28===a||21===a||29===a)&&b>=32&&b<=47,h=(23===a||31===a)&&b>=33&&b<=35;if(!f&&!h)return!1;if(e(a,b,c))return d(null,null,c),this.logger.log(g.DEBUG,"Repeated command ("+s([a,b])+") is dropped"),!0;var i=20===a||21===a||23===a?1:2,j=this.channels[i];return 20===a||21===a||28===a||29===a?32===b?j.ccRCL():33===b?j.ccBS():34===b?j.ccAOF():35===b?j.ccAON():36===b?j.ccDER():37===b?j.ccRU(2):38===b?j.ccRU(3):39===b?j.ccRU(4):40===b?j.ccFON():41===b?j.ccRDC():42===b?j.ccTR():43===b?j.ccRTD():44===b?j.ccEDM():45===b?j.ccCR():46===b?j.ccENM():47===b&&j.ccEOC():j.ccTO(b-32),d(a,b,c),this.currentChannel=i,!0},b.parseMidrow=function(a,b){var c=0;if((17===a||25===a)&&b>=32&&b<=47){if((c=17===a?1:2)!==this.currentChannel)return this.logger.log(g.ERROR,"Mismatch channel in midrow parsing"),!1;var d=this.channels[c];return!!d&&(d.ccMIDROW(b),this.logger.log(g.DEBUG,"MIDROW ("+s([a,b])+")"),!0)}return!1},b.parsePAC=function(a,b){var c,f=this.cmdHistory,g=(a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127,h=(16===a||24===a)&&b>=64&&b<=95;if(!g&&!h)return!1;if(e(a,b,f))return d(null,null,f),!0;var i=a<=23?1:2;c=b>=64&&b<=95?1===i?m[a]:o[a]:1===i?n[a]:p[a];var j=this.channels[i];return!!j&&(j.setPAC(this.interpretPAC(c,b)),d(a,b,f),this.currentChannel=i,!0)},b.interpretPAC=function(a,b){var c,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1==(1&c),c<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},b.parseChars=function(a,b){var c,e=null,f=null;if(a>=25?(c=2,f=a-8):(c=1,f=a),f>=17&&f<=19){var h;h=17===f?b+80:18===f?b+112:b+144,this.logger.log(g.INFO,"Special char '"+j(h)+"' in channel "+c),e=[h]}else a>=32&&a<=127&&(e=0===b?[a]:[a,b]);if(e){var i=s(e);this.logger.log(g.DEBUG,"Char codes =  "+i.join(",")),d(a,b,this.cmdHistory)}return e},b.parseBackgroundAttributes=function(a,b){var c=(16===a||24===a)&&b>=32&&b<=47,e=(23===a||31===a)&&b>=45&&b<=47;if(!c&&!e)return!1;var f,g={};16===a||24===a?(f=Math.floor((b-32)/2),g.background=q[f],b%2==1&&(g.background=g.background+"_semi")):45===b?g.background="transparent":(g.foreground="black",47===b&&(g.underline=!0));var h=a<=23?1:2;return this.channels[h].setBkgData(g),d(a,b,this.cmdHistory),!0},b.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var b=this.channels[a];b&&b.reset()}this.cmdHistory=f()},b.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++){var c=this.channels[b];c&&c.cueSplitAtTime(a)}},a}();b.default=y},"./src/utils/codecs.ts":function(a,b,c){"use strict";function d(a,b){var c=f[b];return!!c&&!0===c[a.slice(0,4)]}function e(a,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}c.r(b),c.d(b,"isCodecType",function(){return d}),c.d(b,"isCodecSupportedInMp4",function(){return e});var f={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}}},"./src/utils/cues.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/vttparser.ts"),e=c("./src/utils/webvtt-parser.ts"),f=c("./src/utils/texttrack-utils.ts"),g=/\s/,h={newCue:function(a,b,c,h){for(var i,j,k,l,m,n=[],o=self.VTTCue||self.TextTrackCue,p=0;p<h.rows.length;p++)if(i=h.rows[p],k=!0,l=0,m="",!i.isEmpty()){for(var q=0;q<i.chars.length;q++)g.test(i.chars[q].uchar)&&k?l++:(m+=i.chars[q].uchar,k=!1);i.cueStartTime=b,b===c&&(c+=1e-4),l>=16?l--:l++;var r=Object(d.fixLineBreaks)(m.trim()),s=Object(e.generateCueId)(b,c,r);a&&a.cues&&a.cues.getCueById(s)||(j=new o(b,c,r),j.id=s,j.line=p+1,j.align="left",j.position=10+Math.min(80,10*Math.floor(8*l/32)),n.push(j))}return a&&n.length&&(n.sort(function(a,b){return"auto"===a.line||"auto"===b.line?0:a.line>8&&b.line>8?b.line-a.line:a.line-b.line}),n.forEach(function(b){return Object(f.addCueToTrack)(a,b)})),n}};b.default=h},"./src/utils/discontinuities.ts":function(a,b,c){"use strict";function d(a,b){for(var c=null,d=0,e=a.length;d<e;d++){var f=a[d];if(f&&f.cc===b){c=f;break}}return c}function e(a,b,c){return!(!b.details||!(c.endCC>c.startCC||a&&a.cc<c.startCC))}function f(a,b){var c=a.fragments,e=b.fragments;if(!e.length||!c.length)return void m.logger.log("No fragments to align");var f=d(c,e[0].cc);return!f||f&&!f.startPTS?void m.logger.log("No frag in previous level to align on"):f}function g(a,b){if(a){var c=a.start+b;a.start=a.startPTS=c,a.endPTS=c+a.duration}}function h(a,b){for(var c=b.fragments,d=0,e=c.length;d<e;d++)g(c[d],a);b.fragmentHint&&g(b.fragmentHint,a),b.alignedSliding=!0}function i(a,b,c){b&&(j(a,c,b),!c.alignedSliding&&b.details&&k(c,b.details),c.alignedSliding||!b.details||c.skippedSegments||Object(n.adjustSliding)(b.details,c))}function j(a,b,c){if(e(a,c,b)){var d=f(c.details,b);d&&Object(l.isFiniteNumber)(d.start)&&(m.logger.log("Adjusting PTS using last level due to CC increase within current level "+b.url),h(d.start,b))}}function k(a,b){if(b.fragments.length&&a.hasProgramDateTime&&b.hasProgramDateTime){var c=b.fragments[0].programDateTime,d=a.fragments[0].programDateTime,e=(d-c)/1e3+b.fragments[0].start;e&&Object(l.isFiniteNumber)(e)&&(m.logger.log("Adjusting PTS using programDateTime delta "+(d-c)+"ms, sliding:"+e.toFixed(3)+" "+a.url+" "),h(e,a))}}c.r(b),c.d(b,"findFirstFragWithCC",function(){return d}),c.d(b,"shouldAlignOnDiscontinuities",function(){return e}),c.d(b,"findDiscontinuousReferenceFrag",function(){return f}),c.d(b,"adjustSlidingStart",function(){return h}),c.d(b,"alignStream",function(){return i}),c.d(b,"alignPDT",function(){return k});var l=c("./src/polyfills/number.ts"),m=c("./src/utils/logger.ts"),n=c("./src/controller/level-helper.ts")},"./src/utils/ewma-bandwidth-estimator.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/ewma.ts"),e=function(){function a(a,b,c){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=c,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new d.default(a),this.fast_=new d.default(b)}var b=a.prototype;return b.update=function(a,b){var c=this.slow_,e=this.fast_;this.slow_.halfLife!==a&&(this.slow_=new d.default(a,c.getEstimate(),c.getTotalWeight())),this.fast_.halfLife!==b&&(this.fast_=new d.default(b,e.getEstimate(),e.getTotalWeight()))},b.sample=function(a,b){a=Math.max(a,this.minDelayMs_);var c=8*b,d=a/1e3,e=c/d;this.fast_.sample(d,e),this.slow_.sample(d,e)},b.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},a}();b.default=e},"./src/utils/ewma.ts":function(a,b,c){"use strict";c.r(b);var d=function(){function a(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=a,this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=b,this.totalWeight_=c}var b=a.prototype;return b.sample=function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a},b.getTotalWeight=function(){return this.totalWeight_},b.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);if(a)return this.estimate_/a}return this.estimate_},a}();b.default=d},"./src/utils/fetch-loader.ts":function(a,b,c){"use strict";function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,i(a,b)}function e(a){var b="function"==typeof Map?new Map:void 0;return(e=function(a){function c(){return f(a,arguments,j(this).constructor)}if(null===a||!h(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),i(c,a)})(a)}function f(a,b,c){return f=g()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);var e=Function.bind.apply(a,d),f=new e;return c&&i(f,c.prototype),f},f.apply(null,arguments)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function h(a){return-1!==Function.toString.call(a).indexOf("[native code]")}function i(a,b){return(i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function j(a){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function k(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(a){}return!1}function l(a,b){var c={method:"GET",mode:"cors",credentials:"same-origin",signal:b};return a.rangeEnd&&(c.headers=new self.Headers({Range:"bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)})),c}function m(a,b){return new self.Request(a.url,b)}c.r(b),c.d(b,"fetchSupported",function(){return k});var n=c("./src/polyfills/number.ts"),o=c("./src/loader/load-stats.ts"),p=c("./src/demux/chunk-cache.ts"),q=function(){function a(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||m,this.controller=new self.AbortController,this.stats=new o.LoadStats}var b=a.prototype;return b.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},b.abortInternal=function(){var a=this.response;a&&a.ok||(this.stats.aborted=!0,this.controller.abort())},b.abort=function(){var a;this.abortInternal(),null!==(a=this.callbacks)&&void 0!==a&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},b.load=function(a,b,c){var d=this,e=this.stats;if(e.loading.start)throw new Error("Loader can only be used once.");e.loading.start=self.performance.now();var f=l(a,this.controller.signal),g=c.onProgress,h="arraybuffer"===a.responseType,i=h?"byteLength":"length";this.context=a,this.config=b,this.callbacks=c,this.request=this.fetchSetup(a,f),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){d.abortInternal(),c.onTimeout(e,a,d.response)},b.timeout),self.fetch(this.request).then(function(c){if(d.response=d.loader=c,!c.ok){var f=c.status,i=c.statusText;throw new r(i||"fetch, bad network response",f,c)}return e.loading.first=Math.max(self.performance.now(),e.loading.start),e.total=parseInt(c.headers.get("Content-Length")||"0"),g&&Object(n.isFiniteNumber)(b.highWaterMark)?d.loadProgressively(c,e,a,b.highWaterMark,g):h?c.arrayBuffer():c.text()}).then(function(f){var h=d.response;self.clearTimeout(d.requestTimeout),e.loading.end=Math.max(self.performance.now(),e.loading.first),e.loaded=e.total=f[i];var j={url:h.url,data:f};g&&!Object(n.isFiniteNumber)(b.highWaterMark)&&g(e,a,f,h),c.onSuccess(j,e,a,h)}).catch(function(b){if(self.clearTimeout(d.requestTimeout),!e.aborted){var f=b.code||0;c.onError({code:f,text:b.message},a,b.details)}})},b.getCacheAge=function(){var a=null;if(this.response){var b=this.response.headers.get("age");a=b?parseFloat(b):null}return a},b.loadProgressively=function(a,b,c,d,e){void 0===d&&(d=0);var f=new p.default,g=a.body.getReader();return function h(){return g.read().then(function(g){if(g.done)return f.dataLength&&e(b,c,f.flush(),a),Promise.resolve(new ArrayBuffer(0));var i=g.value,j=i.length;return b.loaded+=j,j<d||f.dataLength?(f.push(i),f.dataLength>=d&&e(b,c,f.flush(),a)):e(b,c,i,a),h()}).catch(function(){return Promise.reject()})}()},a}(),r=function(a){function b(b,c,d){var e;return e=a.call(this,b)||this,e.code=void 0,e.details=void 0,e.code=c,e.details=d,e}return d(b,a),b}(e(Error));b.default=q},"./src/utils/imsc1-ttml-parser.ts":function(a,b,c){"use strict";function d(){return d=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},d.apply(this,arguments)}function e(a,b,c,d,e){var g=Object(p.findBox)(new Uint8Array(a),["mdat"]);if(0===g.length)return void e(new Error("Could not parse IMSC1 mdat"));var h=g[0],i=Object(s.utf8ArrayToStr)(new Uint8Array(a,h.start,h.end-h.start)),j=Object(t.toTimescaleFromScale)(b,1,c);try{d(f(i,j))}catch(a){e(a)}}function f(a,b){var c=new DOMParser,e=c.parseFromString(a,"text/xml"),f=e.getElementsByTagName("tt")[0];if(!f)throw new Error("Invalid ttml");var k={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(k).reduce(function(a,b){return a[b]=f.getAttribute("ttp:"+b)||k[b],a},{}),o="preserve"!==f.getAttribute("xml:space"),p=h(g(f,"styling","style")),q=h(g(f,"layout","region")),s=g(f,"body","[begin]");return[].map.call(s,function(a){var c=i(a,o);if(!c||!a.hasAttribute("begin"))return null;var e=m(a.getAttribute("begin"),n),f=m(a.getAttribute("dur"),n),g=m(a.getAttribute("end"),n);if(null===e)throw l(a);if(null===g){if(null===f)throw l(a);g=e+f}var h=new r.default(e-b,g-b,c);h.id=Object(u.generateCueId)(h.startTime,h.endTime,h.text);var k=q[a.getAttribute("region")],s=p[a.getAttribute("style")];h.position=10,h.size=80;var t=j(k,s),v=t.textAlign;if(v){var w=y[v];w&&(h.lineAlign=w),h.align=v}return d(h,t),h}).filter(function(a){return null!==a})}function g(a,b,c){var d=a.getElementsByTagName(b)[0];return d?[].slice.call(d.querySelectorAll(c)):[]}function h(a){return a.reduce(function(a,b){var c=b.getAttribute("xml:id");return c&&(a[c]=b),a},{})}function i(a,b){return[].slice.call(a.childNodes).reduce(function(a,c,d){var e;return"br"===c.nodeName&&d?a+"\n":null!==(e=c.childNodes)&&void 0!==e&&e.length?i(c,b):b?a+c.textContent.trim().replace(/\s+/g," "):a+c.textContent},"")}function j(a,b){var c="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(d,e){var f=k(b,c,e)||k(a,c,e);return f&&(d[e]=f),d},{})}function k(a,b,c){return a.hasAttributeNS(b,c)?a.getAttributeNS(b,c):null}function l(a){return new Error("Could not parse ttml timestamp "+a)}function m(a,b){if(!a)return null;var c=Object(q.parseTimeStamp)(a);return null===c&&(w.test(a)?c=n(a,b):x.test(a)&&(c=o(a,b))),c}function n(a,b){var c=w.exec(a),d=(0|c[4])+(0|c[5])/b.subFrameRate;return 3600*(0|c[1])+60*(0|c[2])+(0|c[3])+d/b.frameRate}function o(a,b){var c=x.exec(a),d=Number(c[1]);switch(c[2]){case"h":return 3600*d;case"m":return 60*d;case"ms":return 1e3*d;case"f":return d/b.frameRate;case"t":return d/b.tickRate}return d}c.r(b),c.d(b,"IMSC1_CODEC",function(){return v}),c.d(b,"parseIMSC1",function(){return e});var p=c("./src/utils/mp4-tools.ts"),q=c("./src/utils/vttparser.ts"),r=c("./src/utils/vttcue.ts"),s=c("./src/demux/id3.ts"),t=c("./src/utils/timescale-conversion.ts"),u=c("./src/utils/webvtt-parser.ts"),v="stpp.ttml.im1t",w=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,x=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,y={left:"start",center:"center",right:"end",start:"start",end:"end"}},"./src/utils/logger.ts":function(a,b,c){"use strict";function d(a){var b=self.console[a];return b?b.bind(self.console,"["+a+"] >"):g}function e(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];c.forEach(function(b){i[b]=a[b]?a[b].bind(a):d(b)})}function f(a){if(self.console&&!0===a||"object"==typeof a){e(a,"debug","log","info","warn","error");try{i.log()}catch(a){i=h}}else i=h}c.r(b),c.d(b,"enableLogs",function(){return f}),c.d(b,"logger",function(){return j});var g=function(){},h={trace:g,debug:g,log:g,warn:g,info:g,error:g},i=h,j=i},"./src/utils/mediakeys-helper.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"KeySystems",function(){return d}),c.d(b,"requestMediaKeySystemAccess",function(){return e});var d;!function(a){a.WIDEVINE="com.widevine.alpha",a.PLAYREADY="com.microsoft.playready"}(d||(d={}));var e=function(){return"undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(a,b,c){"use strict";function d(){return self.MediaSource||self.WebKitMediaSource}c.r(b),c.d(b,"getMediaSource",function(){return d})},"./src/utils/mp4-tools.ts":function(a,b,c){"use strict";function d(a){return String.fromCharCode.apply(null,a)}function e(a,b){"data"in a&&(b+=a.start,a=a.data);var c=a[b]<<8|a[b+1];return c<0?65536+c:c}function f(a,b){"data"in a&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return c<0?4294967296+c:c}function g(a,b,c){"data"in a&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c}function h(a,b){var c=[];if(!b.length)return c;var e,g,i;"data"in a?(e=a.data,g=a.start,i=a.end):(e=a,g=0,i=e.byteLength);for(var j=g;j<i;){var k=f(e,j),l=d(e.subarray(j+4,j+8)),m=k>1?j+k:i;if(l===b[0])if(1===b.length)c.push({data:e,start:j+8,end:m});else{var n=h({data:e,start:j+8,end:m},b.slice(1));n.length&&t.apply(c,n)}j=m}return c}function i(a){var b=h(a,["moov"]),c=b[0],d=c?c.end:null,g=h(a,["sidx"]);if(!g||!g[0])return null;var i=[],j=g[0],k=j.data[0],l=0===k?8:16,m=f(j,l);l+=4;var n=0,o=0;l+=0===k?8:16,l+=2;var p=j.end+o,q=e(j,l);l+=2;for(var r=0;r<q;r++){var s=l,t=f(j,s);s+=4;var u=2147483647&t;if(1===(2147483648&t)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var v=f(j,s);s+=4,i.push({referenceSize:u,subsegmentDuration:v,info:{duration:v/m,start:p,end:p+u-1}}),p+=u,s+=4,l=s}return{earliestPresentationTime:n,timescale:m,version:k,referencesCount:q,references:i,moovEndOffset:d}}function j(a){for(var b=[],c=h(a,["moov","trak"]),e=0;e<c.length;e++){var g=c[e],i=h(g,["tkhd"])[0];if(i){var j=i.data[i.start],k=0===j?12:20,l=f(i,k),m=h(g,["mdia","mdhd"])[0];if(m){j=m.data[m.start],k=0===j?12:20;var n=f(m,k),o=h(g,["mdia","hdlr"])[0];if(o){var p=d(o.data.subarray(o.start+8,o.start+12)),q={soun:r.ElementaryStreamTypes.AUDIO,vide:r.ElementaryStreamTypes.VIDEO}[p];if(q){var s=h(g,["mdia","minf","stbl","stsd"])[0],t=void 0;s&&(t=d(s.data.subarray(s.start+12,s.start+16))),b[l]={timescale:n,type:q},b[q]={timescale:n,id:l,codec:t}}}}}}return h(a,["moov","mvex","trex"]).forEach(function(a){var c=f(a,4),d=b[c];d&&(d.default={duration:f(a,12),flags:f(a,20)})}),b}function k(a,b){return h(b,["moof","traf"]).reduce(function(b,c){var d=h(c,["tfdt"])[0],e=d.data[d.start],g=h(c,["tfhd"]).reduce(function(b,c){var g=f(c,4),h=a[g];if(h){var i=f(d,4);1===e&&(i*=Math.pow(2,32),i+=f(d,8));var j=h.timescale||9e4,k=i/j;if(isFinite(k)&&(null===b||k<b))return k}return b},null);return null!==g&&isFinite(g)&&(null===b||g<b)?g:b},null)||0}function l(a,b){for(var c=0,d=0,e=0,g=h(a,["moof","traf"]),j=0;j<g.length;j++){var k=g[j],l=h(k,["tfhd"])[0],n=f(l,4),o=b[n];if(o){var p=o.default,q=f(l,0)|(null===p||void 0===p?void 0:p.flags),s=null===p||void 0===p?void 0:p.duration;8&q&&(s=2&q?f(l,12):f(l,8));for(var t=o.timescale||9e4,u=h(k,["trun"]),v=0;v<u.length;v++){if(s){c=s*f(u[v],4)}else c=m(u[v]);o.type===r.ElementaryStreamTypes.VIDEO?d+=c/t:o.type===r.ElementaryStreamTypes.AUDIO&&(e+=c/t)}}}if(0===d&&0===e){var w=i(a);if(null!==w&&void 0!==w&&w.references)return w.references.reduce(function(a,b){return a+b.info.duration||0},0)}return d||e}function m(a){var b=f(a,0),c=8;1&b&&(c+=4),4&b&&(c+=4);for(var d=0,e=f(a,4),g=0;g<e;g++){if(256&b){d+=f(a,c),c+=4}512&b&&(c+=4),1024&b&&(c+=4),2048&b&&(c+=4)}return d}function n(a,b,c){h(b,["moof","traf"]).forEach(function(b){h(b,["tfhd"]).forEach(function(d){var e=f(d,4),i=a[e];if(i){var j=i.timescale||9e4;h(b,["tfdt"]).forEach(function(a){var b=a.data[a.start],d=f(a,4);if(0===b)g(a,4,d-c*j);else{d*=Math.pow(2,32),d+=f(a,8),d-=c*j,d=Math.max(d,0);var e=Math.floor(d/(s+1)),h=Math.floor(d%(s+1));g(a,4,e),g(a,8,h)}})}})})}function o(a){var b={valid:null,remainder:null},c=h(a,["moof"]);if(!c)return b;if(c.length<2)return b.remainder=a,b;var d=c[c.length-1];return b.valid=Object(q.sliceUint8)(a,0,d.start-8),b.remainder=Object(q.sliceUint8)(a,d.start-8),b}function p(a,b){var c=new Uint8Array(a.length+b.length);return c.set(a),c.set(b,a.length),c}c.r(b),c.d(b,"bin2str",function(){return d}),c.d(b,"readUint16",function(){return e}),c.d(b,"readUint32",function(){return f}),c.d(b,"writeUint32",function(){return g}),c.d(b,"findBox",function(){return h}),c.d(b,"parseSegmentIndex",function(){return i}),c.d(b,"parseInitSegment",function(){return j}),c.d(b,"getStartDTS",function(){return k}),c.d(b,"getDuration",function(){return l}),c.d(b,"computeRawDurationFromSamples",function(){return m}),c.d(b,"offsetStartDTS",function(){return n}),c.d(b,"segmentValidRange",function(){return o}),c.d(b,"appendUint8Array",function(){return p});var q=c("./src/utils/typed-array.ts"),r=c("./src/loader/fragment.ts"),s=Math.pow(2,32)-1,t=[].push},"./src/utils/output-filter.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(a,b){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=a,this.trackName=b}var b=a.prototype;return b.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[]},a}()},"./src/utils/texttrack-utils.ts":function(a,b,c){"use strict";function d(a,b){var c;try{c=new Event("addtrack")}catch(a){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)}function e(a,b){var c=a.mode;if("disabled"===c&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(b.id))try{if(a.addCue(b),!a.cues.getCueById(b.id))throw new Error("addCue is failed for: "+b)}catch(c){j.logger.debug("[texttrack-utils]: "+c);var d=new self.TextTrackCue(b.startTime,b.endTime,b.text);d.id=b.id,a.addCue(d)}"disabled"===c&&(a.mode=c)}function f(a){var b=a.mode;if("disabled"===b&&(a.mode="hidden"),a.cues)for(var c=a.cues.length;c--;)a.removeCue(a.cues[c]);"disabled"===b&&(a.mode=b)}function g(a,b,c){var d=a.mode;if("disabled"===d&&(a.mode="hidden"),a.cues&&a.cues.length>0)for(var e=i(a.cues,b,c),f=0;f<e.length;f++)a.removeCue(e[f]);"disabled"===d&&(a.mode=d)}function h(a,b){if(b<a[0].startTime)return 0;var c=a.length-1;if(b>a[c].endTime)return-1;for(var d=0,e=c;d<=e;){var f=Math.floor((e+d)/2);if(b<a[f].startTime)e=f-1;else{if(!(b>a[f].startTime&&d<c))return f;d=f+1}}return a[d].startTime-b<b-a[e].startTime?d:e}function i(a,b,c){var d=[],e=h(a,b);if(e>-1)for(var f=e,g=a.length;f<g;f++){var i=a[f];if(i.startTime>=b&&i.endTime<=c)d.push(i);else if(i.startTime>c)return d}return d}c.r(b),c.d(b,"sendAddTrackEvent",function(){return d}),c.d(b,"addCueToTrack",function(){return e}),c.d(b,"clearCurrentCues",function(){return f}),c.d(b,"removeCuesInRange",function(){return g}),c.d(b,"getCuesInRange",function(){return i});var j=c("./src/utils/logger.ts")},"./src/utils/time-ranges.ts":function(a,b,c){"use strict";c.r(b);var d={toString:function(a){for(var b="",c=a.length,d=0;d<c;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}};b.default=d},"./src/utils/timescale-conversion.ts":function(a,b,c){"use strict";function d(a,b,c,d){void 0===c&&(c=1),void 0===d&&(d=!1);var e=a*b*c;return d?Math.round(e):e}function e(a,b,c,e){return void 0===c&&(c=1),void 0===e&&(e=!1),d(a,b,1/c,e)}function f(a,b){return void 0===b&&(b=!1),d(a,1e3,1/h,b)}function g(a,b){return void 0===b&&(b=1),d(a,h,1/b)}c.r(b),c.d(b,"toTimescaleFromBase",function(){return d}),c.d(b,"toTimescaleFromScale",function(){return e}),c.d(b,"toMsFromMpegTsClock",function(){return f}),c.d(b,"toMpegTsClockFromTimescale",function(){return g});var h=9e4},"./src/utils/typed-array.ts":function(a,b,c){"use strict";function d(a,b,c){return Uint8Array.prototype.slice?a.slice(b,c):new Uint8Array(Array.prototype.slice.call(a,b,c))}c.r(b),c.d(b,"sliceUint8",function(){return d})},"./src/utils/vttcue.ts":function(a,b,c){"use strict";c.r(b),b.default=function(){function a(a,b){if("string"!=typeof b)return!1;if(!Array.isArray(a))return!1;var c=b.toLowerCase();return!!~a.indexOf(c)&&c}function b(b){return a(f,b)}function c(b){return a(g,b)}function d(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];for(var e=1;e<arguments.length;e++){var f=arguments[e];for(var g in f)a[g]=f[g]}return a}function e(a,e,f){var g=this,h={enumerable:!0};g.hasBeenReset=!1;var i="",j=!1,k=a,l=e,m=f,n=null,o="",p=!0,q="auto",r="start",s=50,t="middle",u=50,v="middle";Object.defineProperty(g,"id",d({},h,{get:function(){return i},set:function(a){i=""+a}})),Object.defineProperty(g,"pauseOnExit",d({},h,{get:function(){return j},set:function(a){j=!!a}})),Object.defineProperty(g,"startTime",d({},h,{get:function(){return k},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");k=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",d({},h,{get:function(){return l},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");l=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",d({},h,{get:function(){return m},set:function(a){m=""+a,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",d({},h,{get:function(){return n},set:function(a){n=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",d({},h,{get:function(){return o},set:function(a){var c=b(a);if(!1===c)throw new SyntaxError("An invalid or illegal string was specified.");o=c,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",d({},h,{get:function(){return p},set:function(a){p=!!a,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",d({},h,{get:function(){return q},set:function(a){if("number"!=typeof a&&"auto"!==a)throw new SyntaxError("An invalid number or illegal string was specified.");q=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",d({},h,{get:function(){return r},set:function(a){var b=c(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");r=b,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",d({},h,{get:function(){return s},set:function(a){if(a<0||a>100)throw new Error("Position must be between 0 and 100.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",d({},h,{get:function(){return t},set:function(a){var b=c(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");t=b,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",d({},h,{get:function(){return u},set:function(a){if(a<0||a>100)throw new Error("Size must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",d({},h,{get:function(){return v},set:function(a){var b=c(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");v=b,this.hasBeenReset=!0}})),g.displayState=void 0}if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var f=["","lr","rl"],g=["start","middle","end","left","right"];return e.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},e}()},"./src/utils/vttparser.ts":function(a,b,c){"use strict";function d(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+parseFloat(d||0)}var c=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return c?parseFloat(c[2])>59?b(c[2],c[3],0,c[4]):b(c[1],c[2],c[3],c[4]):null}function e(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function f(a,b,c){function f(){var b=d(a);if(null===b)throw new Error("Malformed timestamp: "+i);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function g(a,b){var d=new j;e(a,function(a,b){var e;switch(a){case"region":for(var f=c.length-1;f>=0;f--)if(c[f].id===b){d.set(a,c[f].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":e=b.split(","),d.integer(a,e[0]),d.percent(a,e[0])&&d.set("snapToLines",!1),d.alt(a,e[0],["auto"]),2===e.length&&d.alt("lineAlign",e[1],["start",l,"end"]);break;case"position":e=b.split(","),d.percent(a,e[0]),2===e.length&&d.alt("positionAlign",e[1],["start",l,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",l,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var f=d.get("line","auto");"auto"===f&&-1===k.line&&(f=-1),b.line=f,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",l);var g=d.get("position","auto");"auto"===g&&50===k.position&&(g="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=g}function h(){a=a.replace(/^\s+/,"")}var i=a;if(h(),b.startTime=f(),h(),"--\x3e"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);a=a.substr(3),h(),b.endTime=f(),h(),g(a,b)}function g(a){return a.replace(/<br(?: \/)?>/gi,"\n")}c.r(b),c.d(b,"parseTimeStamp",function(){return d}),c.d(b,"fixLineBreaks",function(){return g}),c.d(b,"VTTParser",function(){return m});var h=c("./src/utils/vttcue.ts"),i=function(){function a(){}return a.prototype.decode=function(a,b){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))},a}(),j=function(){function a(){this.values=Object.create(null)}var b=a.prototype;return b.set=function(a,b){this.get(a)||""===b||(this.values[a]=b)},b.get=function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},b.has=function(a){return a in this.values},b.alt=function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},b.integer=function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},b.percent=function(a,b){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(b)){var c=parseFloat(b);if(c>=0&&c<=100)return this.set(a,c),!0}return!1},a}(),k=new h.default(0,0,""),l="middle"===k.align?"middle":"center",m=function(){function a(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var b=a.prototype;return b.parse=function(a){function b(){var a=d.buffer,b=0;for(a=g(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){e(a,function(a,b){},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var i="";if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;i=b();var j=i.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!j||!j[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var k=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(k?k=!1:i=b(),d.state){case"HEADER":/:/.test(i)?c(i):i||(d.state="ID");continue;case"NOTE":i||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){d.state="NOTE";break}if(!i)continue;if(d.cue=new h.default(0,0,""),d.state="CUE",-1===i.indexOf("--\x3e")){d.cue.id=i;continue}case"CUE":if(!d.cue){d.state="BADCUE";continue}try{f(i,d.cue,d.regionList)}catch(a){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var l=-1!==i.indexOf("--\x3e");if(!i||l&&(k=!0)){d.oncue&&d.cue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}if(null===d.cue)continue;d.cue.text&&(d.cue.text+="\n"),d.cue.text+=i;continue;case"BADCUE":i||(d.state="ID")}}}catch(a){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},b.flush=function(){var a=this;try{if((a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state||"BADWEBVTT"===a.state)throw new Error("Malformed WebVTT signature.")}catch(b){a.onparsingerror&&a.onparsingerror(b)}return a.onflush&&a.onflush(),this},a}()},"./src/utils/webvtt-parser.ts":function(a,b,c){"use strict";function d(a,b,c){return n(a.toString())+n(b.toString())+n(c)}function e(a,b,c,e,f,n,p,q){var r,s=new g.VTTParser,t=Object(h.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(k,"\n").split("\n"),u=[],v=Object(i.toMpegTsClockFromTimescale)(b,c),w="00:00.000",x=0,y=0,z=!0,A=!1;s.oncue=function(a){var b=e[f],c=e.ccOffset,g=(x-v)/9e4;if(null!==b&&void 0!==b&&b.new&&(void 0!==y?c=e.ccOffset=b.start:o(e,f,g)),g&&(c=g-e.presentationOffset),A){var h=a.endTime-a.startTime,i=Object(j.normalizePts)(9e4*(a.startTime+c-y),9e4*n)/9e4;a.startTime=i,a.endTime=i+h}var k=a.text.trim();a.text=decodeURIComponent(encodeURIComponent(k)),a.id||(a.id=d(a.startTime,a.endTime,k)),a.endTime>0&&u.push(a)},s.onparsingerror=function(a){r=a},s.onflush=function(){if(r)return void q(r);p(u)},t.forEach(function(a){if(z){if(l(a,"X-TIMESTAMP-MAP=")){z=!1,A=!0,a.substr(16).split(",").forEach(function(a){l(a,"LOCAL:")?w=a.substr(6):l(a,"MPEGTS:")&&(x=parseInt(a.substr(7)))});try{y=m(w)/1e3}catch(a){A=!1,r=a}return}""===a&&(z=!1)}s.parse(a+"\n")}),s.flush()}c.r(b),c.d(b,"generateCueId",function(){return d}),c.d(b,"parseWebVTT",function(){return e});var f=c("./src/polyfills/number.ts"),g=c("./src/utils/vttparser.ts"),h=c("./src/demux/id3.ts"),i=c("./src/utils/timescale-conversion.ts"),j=c("./src/remux/mp4-remuxer.ts"),k=/\r\n|\n\r|\n|\r/g,l=function(a,b,c){return void 0===c&&(c=0),a.substr(c,b.length)===b},m=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),d=parseInt(a.substr(-9,2)),e=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;if(!(Object(f.isFiniteNumber)(b)&&Object(f.isFiniteNumber)(c)&&Object(f.isFiniteNumber)(d)&&Object(f.isFiniteNumber)(e)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return b+=1e3*c,b+=6e4*d,b+=36e5*e},n=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return(b>>>0).toString()},o=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e.new&&d.new)return a.ccOffset=a.presentationOffset=d.start,void(d.new=!1);for(;null!==(f=e)&&void 0!==f&&f.new;){var f;a.ccOffset+=d.start-e.start,d.new=!1,d=e,e=a[d.prevCC]}a.presentationOffset=c}},"./src/utils/xhr-loader.ts":function(a,b,c){"use strict";c.r(b);var d=c("./src/utils/logger.ts"),e=c("./src/loader/load-stats.ts"),f=/^age:\s*[\d.]+\s*$/m,g=function(){function a(a){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=a?a.xhrSetup:null,this.stats=new e.LoadStats,this.retryDelay=0}var b=a.prototype;return b.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},b.abortInternal=function(){var a=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),a&&(a.onreadystatechange=null,a.onprogress=null,4!==a.readyState&&(this.stats.aborted=!0,a.abort()))},b.abort=function(){var a;this.abortInternal(),null!==(a=this.callbacks)&&void 0!==a&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},b.load=function(a,b,c){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=a,this.config=b,this.callbacks=c,this.retryDelay=b.retryDelay,this.loadInternal()},b.loadInternal=function(){var a=this.config,b=this.context;if(a){var c=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0;var e=this.xhrSetup;try{if(e)try{e(c,b.url)}catch(a){c.open("GET",b.url,!0),e(c,b.url)}c.readyState||c.open("GET",b.url,!0)}catch(a){return void this.callbacks.onError({code:c.status,text:a.message},b,c)}b.rangeEnd&&c.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),c.onreadystatechange=this.readystatechange.bind(this),c.onprogress=this.loadprogress.bind(this),c.responseType=b.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout),c.send()}},b.readystatechange=function(){var a=this.context,b=this.loader,c=this.stats;if(a&&b){var e=b.readyState,f=this.config;if(!c.aborted&&e>=2)if(self.clearTimeout(this.requestTimeout),0===c.loading.first&&(c.loading.first=Math.max(self.performance.now(),c.loading.start)),4===e){b.onreadystatechange=null,b.onprogress=null;var g=b.status;if(g>=200&&g<300){c.loading.end=Math.max(self.performance.now(),c.loading.first);var h,i;if("arraybuffer"===a.responseType?(h=b.response,i=h.byteLength):(h=b.responseText,i=h.length),c.loaded=c.total=i,!this.callbacks)return;var j=this.callbacks.onProgress;if(j&&j(c,a,h,b),!this.callbacks)return;var k={url:b.responseURL,data:h};this.callbacks.onSuccess(k,c,a,b)}else c.retry>=f.maxRetry||g>=400&&g<499?(d.logger.error(g+" while loading "+a.url),this.callbacks.onError({code:g,text:b.statusText},a,b)):(d.logger.warn(g+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,f.maxRetryDelay),c.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),f.timeout)}},b.loadtimeout=function(){d.logger.warn("timeout while loading "+this.context.url);var a=this.callbacks;a&&(this.abortInternal(),a.onTimeout(this.stats,this.context,this.loader))},b.loadprogress=function(a){var b=this.stats;b.loaded=a.loaded,a.lengthComputable&&(b.total=a.total)},b.getCacheAge=function(){var a=null;if(this.loader&&f.test(this.loader.getAllResponseHeaders())){var b=this.loader.getResponseHeader("age");a=b?parseFloat(b):null}return a},a}();b.default=g}}).default}),function(c){"use strict";function d(){var a=c.crypto||c.msCrypto;if(!j&&a&&a.getRandomValues)try{var b=new Uint8Array(16);m=j=function(){return a.getRandomValues(b),b},j()}catch(a){}if(!j){var d=new Array(16);k=j=function(){for(var a,b=0;b<16;b++)0==(3&b)&&(a=4294967296*Math.random()),d[b]=a>>>((3&b)<<3)&255;return d},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function e(){if("function"==typeof b)try{var a=b("crypto").randomBytes;l=j=a&&function(){return a(16)},j()}catch(a){}}function f(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){e<16&&(b[d+e++]=q[a])});e<16;)b[d+e++]=0;return b}function g(a,b){var c=b||0,d=p;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function h(a,b,c){var d=b&&c||0,e=b||[];a=a||{};var f=null!=a.clockseq?a.clockseq:u,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:w+1,j=h-v+(i-w)/1e4;if(j<0&&null==a.clockseq&&(f=f+1&16383),(j<0||h>v)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=h,w=i,u=f,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;e[d++]=k>>>24&255,e[d++]=k>>>16&255,e[d++]=k>>>8&255,e[d++]=255&k;var l=h/4294967296*1e4&268435455;e[d++]=l>>>8&255,e[d++]=255&l,e[d++]=l>>>24&15|16,e[d++]=l>>>16&255,e[d++]=f>>>8|128,e[d++]=255&f;for(var m=a.node||t,n=0;n<6;n++)e[d+n]=m[n];return b||g(e)}function i(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"===a?new o(16):null,a=null),a=a||{};var e=a.random||(a.rng||j)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,b)for(var f=0;f<16;f++)b[d+f]=e[f];return b||g(e)}var j,k,l,m,n;c?d():e();for(var o="function"==typeof Buffer?Buffer:Array,p=[],q={},r=0;r<256;r++)p[r]=(r+256).toString(16).substr(1),q[p[r]]=r;var s=j(),t=[1|s[0],s[1],s[2],s[3],s[4],s[5]],u=16383&(s[6]<<8|s[7]),v=0,w=0,x=i;x.v1=h,x.v4=i,x.parse=f,x.unparse=g,x.BufferClass=o,x._rng=j,x._mathRNG=k,x._nodeRNG=l,x._whatwgRNG=m,"undefined"!=typeof module&&module.exports?module.exports=x:"function"==typeof a&&a.amd?a(function(){return x}):(n=c.uuid,x.noConflict=function(){return c.uuid=n,x},c.uuid=x)}("undefined"!=typeof window?window:null),function(){function a(a){var b=a.__resizeTriggers__,c=b.firstElementChild,d=b.lastElementChild,e=c.firstElementChild;d.scrollLeft=d.scrollWidth,d.scrollTop=d.scrollHeight,e.style.width=c.offsetWidth+1+"px",e.style.height=c.offsetHeight+1+"px",c.scrollLeft=c.scrollWidth,c.scrollTop=c.scrollHeight}function b(a){return a.offsetWidth!=a.__resizeLast__.width||a.offsetHeight!=a.__resizeLast__.height}function c(c){var d=this;a(this),this.__resizeRAF__&&h(this.__resizeRAF__),this.__resizeRAF__=g(function(){b(d)&&(d.__resizeLast__.width=d.offsetWidth,d.__resizeLast__.height=d.offsetHeight,d.__resizeListeners__.forEach(function(a){a.call(d,c)}))})}function d(){if(!f){var a=(r||"")+".resize-triggers { "+(s||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c),f=!0}}var e=document.attachEvent,f=!1;if(!e){var g=function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};return function(b){return a(b)}}(),h=function(){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(b){return a(b)}}(),i=!1,j="",k="animationstart",l="Webkit Moz O ms".split(" "),m="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),n="",o=document.createElement("fakeelement");if(void 0!==o.style.animationName&&(i=!0),!1===i)for(var p=0;p<l.length;p++)if(void 0!==o.style[l[p]+"AnimationName"]){n=l[p],n+"Animation",j="-"+n.toLowerCase()+"-",k=m[p],i=!0;break}var q="resizeanim",r="@"+j+"keyframes "+q+" { from { opacity: 0; } to { opacity: 0; } } ",s=j+"animation: 1ms "+q+"; "}window.addResizeListener=function(b,f){e?b.attachEvent("onresize",f):(b.__resizeTriggers__||("static"==getComputedStyle(b).position&&(b.style.position="relative"),d(),b.__resizeLast__={},b.__resizeListeners__=[],(b.__resizeTriggers__=document.createElement("div")).className="resize-triggers",b.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',b.appendChild(b.__resizeTriggers__),a(b),b.addEventListener("scroll",c,!0),k&&b.__resizeTriggers__.addEventListener(k,function(c){c.animationName==q&&a(b)})),b.__resizeListeners__.push(f))},window.removeResizeListener=function(a,b){e?a.detachEvent("onresize",b):(a.__resizeListeners__.splice(a.__resizeListeners__.indexOf(b),1),a.__resizeListeners__.length||(a.removeEventListener("scroll",c),a.__resizeTriggers__=!a.removeChild(a.__resizeTriggers__)))}}(),function(b,c){"object"==typeof module&&module.exports?module.exports=c():"function"==typeof a&&a.amd?a(c):b.Spinner=c()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(k.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",k.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;if(b=b.charAt(0).toUpperCase()+b.slice(1),void 0!==e[b])return b;for(d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}k.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.scale*(d.length+d.width),k=2*d.scale*j,l=-(d.width+d.length)*d.scale*2+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,(e=e&&e.firstChild)&&(e.opacity=c))}}var j,k,l=["webkit","Moz","ms","O"],m={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=a(null,{className:d.className});if(e(f,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function a(){h++;for(var b=0;b<d.lines;b++)g=Math.max(1-(h+(d.lines-b)*n)%l*m,d.opacity),c.opacity(f,b*d.direction+i,g,d);c.timeout=c.el&&setTimeout(a,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.scale*(f.length+f.width)+"px",height:f.scale*f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.scale*f.radius+"px,0)",borderRadius:(f.corners*f.scale*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.scale*f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),"undefined"!=typeof document){k=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}();var o=e(a("group"),{behavior:"url(#default#VML)"});!d(o,"transform")&&o.adj?i():j=d(o,"animation")}return h}),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_BUFFERING:"onAdBuffering",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",AD_VOLUME_CHANGE:"onAdVolumeChange",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},ErrorCode:{1001:"1200",1002:"",1003:"",2000:"1000",2001:"1101",2002:"1100",2003:"1106",2004:"2004",2005:"2000",3000:"3400",3001:"3100",3002:"3001",3003:"3200",3004:"3101",3005:"",3006:"3002",3007:"3102",3008:"3202",3009:"3401",3011:"3300",3012:"3301",3013:"",4000:"4000",4001:"4300"},mapErrorCode:function(a){return uvpjs.ErrorCode[a]||a},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(a){var b,c,d=a.split("."),e=window,f=d.length;for(b=0;b<f;b++)c=d[b],void 0===e[c]&&(e[c]={}),e=e[c];return e},getClass:function(a){var b,c,d,e,f,g;if("string"!=typeof a)return a;for(b=a.split("."),c=window,d=b.length,e="",f=0;f<d;f++){if(g=b[f],e+=g,void 0===c[g])throw new Error("uvpjs.getClass(): "+e+" is undefined.");f<d-1&&(e+="."),c=c[g]}return c},getObject:function(a){return uvpjs.getClass(a)}},function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e,f,g,h,i=this.prototype;a=!0,f=new this,a=!1,e=function(a,b){return function(){var c,d=this._super;return this._super=i[a],c=b.apply(this,arguments),this._super=d,c}};for(h in c)c.hasOwnProperty(h)&&(g=c[h],f[h]="function"==typeof g&&"function"==typeof i[h]&&b.test(g)?e(h,g):g);return d.prototype=f,d.prototype.constructor=d,d.subClass=arguments.callee,d}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),function(a){a.b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA=="}(uvpjs.register("uvpjs")),function(a){"use strict";a.util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(a){return a&&this.xhrMessages[a]||"XHR status: "+a},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(a){var b=document.createElement("a");return b.href=a,{host:b.hostname,pathname:b.pathname,protocol:b.protocol,search:b.search}},objFromQueryStr:function(a){var b,c,d,e="string"==typeof a?a:"",f=e.indexOf("?")>-1?e.split("?")[1]:e,g=f.split("&"),h={};for(c=0,d=g.length;c<d;c++)b=g[c].split("="),h[b[0]]=b[1];return h},queryStrFromObj:function(a,b){var c,d="",e=!1;for(c in a)d+=(e?"&":"")+c+"="+(b?encodeURIComponent(a[c]):a[c]),e=!0;return d},uid8:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()},getUserStatusForQuery:function(a){var b="";switch(a){case"anon":b="sb=0";break;case"reg;sub;pay":b="sb=1";break;case"reg":b="sb=2";break;case"reg;sub;susp":b="sb=3";break;case"reg;sub;exsub":b="sb=4";break;case"reg;sub;trial":b="sb=5";break;default:if(a.indexOf("|")>-1){var c,d,e,f,g,h="",i=a.split(","),j=i.length;for(i.sort(),g=0;g<j;g++)c=i[g],d=c.split("|"),2==d.length&&(e=d[0],f=d[1],h!=e?(b.length>0&&(b+="&"),b+=e+"="+f):b+=","+f,h=e)}}return""==b&&(b="sb=0"),b},firstInt:function(){var a,b,c=arguments.length;for(b=0;b<c;b++)if(a=arguments[b],parseInt(a)===a)return a},inRange:function(a,b,c){return"number"==typeof a&&a>=b&&a<=c},isEmpty:function(a){return null===a||void 0===a||Array.isArray(a)&&0===a.length||"object"==typeof a&&0===Object.keys(a).length||"string"==typeof a&&""===a},isPlainObject:function(a){return a&&"object"==typeof a&&a.constructor===Object},isFunction:function(a){return"function"==typeof a},isDefinedString:function(a){return!!(a&&"string"==typeof a&&a.length>0)},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isDefined:function(a){return void 0!==a},isFlagTrue:function(a){return!0===a||"true"===a||1===a||"1"===a},getDefinedString:function(){var a,b,c=arguments.length;for(b=0;b<c;b++)if(a=arguments[b],this.isDefinedString(a))return a;return""},supportsLocalStorage:function(){var a,b="test";if(null===this.isLocalStorageSupported)try{localStorage.setItem(b,"1"),a=localStorage.getItem(b),this.isLocalStorageSupported="1"===a,localStorage.removeItem(b)}catch(a){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild},createStyleSheet:function(a,b){var c,d,e,f,g,h,i,j,k,l,m=document.styleSheets,n=m.length;for(k=function(){l||(a(g),l=!0)},c=0;c<n;c++){g=m[c];try{if((g.href&&g.href.replace(/http(s)?:/,""))===b)return void k()}catch(a){null}}d="string"==typeof b&&""!==b,e=uvpjs.mediaCapabilities.isFirefox(),f=!d||e?"style":"link",g=document.createElement(f),g.setAttribute("type","text/css"),g.appendChild(document.createTextNode("")),d&&(g.setAttribute("rel","stylesheet"),g.setAttribute("href",b),g.textContent='@import "'+b+'"'),"function"==typeof a&&(g.onload=k,g.addEventListener&&g.addEventListener("load",k,!1),g.onreadystatechange=function(){"loaded"!==(h=g.readyState)&&"complete"!==h||(link.onreadystatechange=null,k())},i=setInterval(function(){document.styleSheets.length>n&&(k(),clearInterval(i))},10),e&&(j=setInterval(function(){try{g.sheet.cssRules,clearInterval(j),k()}catch(a){}},10)),document.getElementsByTagName("head")[0].appendChild(g))},addCSSObject:function(a,b,c,d){var e,f=uvpjs.util,g="#"+b.id+" "+(d||"");for(e in c)f.addCSSRule(a,g,e,c[e])},addCSSRule:function(a,b,c,d){var e,f,g,h,i=uvpjs.mediaCapabilities,j="string"==typeof d&&d.match(/NaN(%|px)/);if(a&&a.sheet)if(!j||i.isAndroid()&&i.isChrome()||(d="0"),e=a.sheet,f=e.rules||e.cssRules,g=f.length,h=c+":"+d+";",e.insertRule)try{e.insertRule(b+"{"+h+"}",g)}catch(a){console.warn("Unable to add CSS rule: "+a.message)}else e.addRule&&e.addRule(b,h,g)},addCSSRules:function(a,b,c){for(var d,e=c.length;e--;)d=c[e],uvpjs.util.addCSSRule(a,b,d.name,d.value)},copyObjectWithKeyMap:function(a){var b=a,c=null;return this.from=function(a){return c=a,this},this.to=function(a){if(!(b&&c&&a))return a;for(var d in b)b.hasOwnProperty(d)&&c.hasOwnProperty(d)&&null!==c[d]&&(a[b[d]]=c[d]);return a},this}}}(uvpjs.register("uvpjs")),function(a){var b=uvpjs._,c={mediaRefId:/\{mediaReferenceId}/g,partner:/PARTNER/g,ptype:/\{ptype}/g,vguid:/\{VGUID}/g,ptypeAlt:/%7Bptype%7D/g,vguidAlt:/%7BVGUID%7D/g,session:/;/g};a.adUtil={MOAT_PARTNER_CODE:"redventuresjsimavideo349688315372",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(a,d,e,f){var g,h,i,j,k,l,m,n,o=uvpjs.util,p="cust_params",q=a.split("?"),r=q[1],s=a.indexOf("%7Bptype%7D")>-1,t=a.indexOf("{ptype}")>-1,u=this.getAdParams(d,e,f);return r=r.replace(c.mediaRefId,u.vid).replace(c.partner,u.partner),s&&(r=r.replace(c.vguidAlt,u.vguid).replace(c.ptypeAlt,u.ptype)),t&&(r=r.replace(c.vguid,u.vguid).replace(c.ptype,u.ptype)),h=o.objFromQueryStr(r),this.isExcludedFromVpaid(d)&&delete h.pp,i=h[p],i&&(g=o.objFromQueryStr(decodeURIComponent(i)),delete h[p]),j=u[p],delete u[p],delete u.partner,delete u.vguid,delete u.ptype,k=b.assign(u,h),l=b.assign(j,g||{}),decodeURIComponent(k.iu).indexOf("/22309610186/")>=0&&d.isMuteAtPlayStart&&!d.userHasUnmuted&&(k.sz="640x483"),this.removeEmpty(k),this.removeEmpty(l),m=o.queryStrFromObj(k,!1),n=o.queryStrFromObj(l,!1),m+="&"+p+"="+encodeURIComponent(n),q[0]+"?"+m},getAdParams:function(a,c,d){var e,f,g=a.dwPageParams,h=this.getDwViewGuid(a),i=this.getPpidValue(a),j=a.contentVideoState,k=encodeURIComponent(a.sessionOptions.partner),l=g.pagetype||"",m=this.getUserStatusKey(a.getSessionOption("userStatus")),n=""!==j.contPlayState,o=n&&!uvpjs.util.isFlagTrue(d)?"1":"0",p=a.getSessionOption("isEmbedded")?"1":"0",q=this.getHost("1"===p,a),r=j.pid,s={cust_params:{}},t=uvpjs.Configuration.env,u=a.getAdCallParams();e=c?this.getVideoDfpId(a):"",s.vid=e,s.partner=k,s.ptype=l,s.vguid=h,s.cust_params.vguid=h,s.cust_params.embed=p,q&&(s.cust_params.host=q),this.populateCustParamsWithAdSessionValues(s.cust_params,r),j.podsToSkip.length>0&&(s.cust_params.resume=1,s.cust_params.skippod=j.podsToSkip);for(f in m)s.cust_params[f]=m[f];if(i&&(s.ppid=i,s.cust_params.ppid=i),"cbs"===k&&(s.cust_params.cpSession=o,s.cust_params.cpPre=o,s.cust_params.sub=b.isEmpty(a.sessionOptions.userId)?"":a.sessionOptions.userId),u&&!uvpjs.util.isEmpty(u.standardParams))for(f in u.standardParams)s[f]=u.standardParams[f];if(u&&!uvpjs.util.isEmpty(u.customParams))for(f in u.customParams)s.cust_params[f]=u.customParams[f];return this.isExcludedFromVpaid(a)?s.pp="ssai":("local"===t||"dev"===t)&&(s.pp="vpaid_js"),s},getVideoDfpId:function(a){return uvpjs.util.isEmpty(a.contentVideoState.dfpMediaId)?a.contentVideoState.cmsRefGuid:a.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(a){return"AA Original"===a.contentVideoState.contentType},getDwViewGuid:function(a){var b=a.dwPageParams;return b&&b.viewguid||b.pguid||""},extractAdInfo:function(a,c){var d,e,f=c===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(a)||!c?(!c&&console.error("No 'context' arg supplied"),null):(d={adId:a.getAdId(),adSystem:a.getAdSystem(),creativeAdId:a.getCreativeAdId(),creativeId:a.getCreativeId()},d.adPodInfo=this.extractPodInfo(a.getAdPodInfo()),e=this[f](a),b.assign(d,e))},extractAdStateData:function(a,b,c){var d=a.getAdPodInfo(),e=d.getPodIndex(),f=d.getAdPosition(),g=a.getDuration(),h=c?"mid":0===e?"pre":e>=1?"mid":-1===e?"post":"",i=("mid"!==h?h+"_0":"mid_"+e)+"_"+f,j=b===this.context.IMA,k=j?this.extractIdInfo(a):null,l=this.getAdStateBlank();return l.adPosition=f,l.adBitrate=a.getVastMediaBitrate?a.getVastMediaBitrate():NaN,l.adServerName=j?this.context.IMA:this.context.DAI,l.adVideoTitle=a.getTitle(),l.duration=g,l.adType=h,l.adClipID=i,l.wrapperAdId=j?k.wrapperAdId||"":"",l.adVideoId=j?k.wrapperAdId||k.adId:a.getAdId(),l.creativeId=j?k.wrapperCreativeId||k.creativeId:a.getCreativeId(),b===this.context.DAI&&(l.sourceWidth=a.getVastMediaWidth(),l.sourceHeight=a.getVastMediaHeight()),l},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(a){var b=a.getWrapperAdIds(),c=a.getWrapperCreativeIds(),d=Array.isArray(b)&&b.length||0,e=Array.isArray(c)&&c.length||0,f=null,g=null,h=a.getAdId()||"",i=a.getCreativeId()||"";return d&&(d>1&&(f=b[1]),h=b[0]),e&&(e>1&&(g=c[1]),i=c[0]),{adId:h,wrapperAdId:f,creativeId:i,wrapperCreativeId:g}},getHost:function(a,b){var c,d,e;return a?(c=b.getSessionOption("referrer"))&&(d=uvpjs.util.parseUrl(c),e=d.host):e=window.location.hostname,e&&""!==e?e:null},getUserStatusKey:function(a){for(var b,c=uvpjs.util.getUserStatusForQuery(a),d=c.split("&"),e=d.length,f={};e--;)b=d[e].split("="),f[b[0]]=b[1];return f},trackAd:function(a){var b,c,d,e=a.model,f=a.context,g=e.getAdVideoState(),h=f===this.context.IMA,i=f===this.context.DAI,j=h||i;return j?(c=e.dwPageParams.pagetype||"",b={level1:"",level2:"",level3:g.adVideoId,level4:g.creativeId,slicer1:"vaw-can",slicer2:e.sessionOptions.partner,slicer3:c,moatVASTSystem:g.adServerName,moatVASTAdID:g.wrapperAdId},d=this.getDwViewGuid(e),""!==d&&(b.zMoatVGUID=d),""!==c&&(b.zMoatPT=c),this.initMoatTracking(a.adVideoContainer,b,g.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(a){var b=this.getVpaidEventForEvent(a.eventName,a.context);b&&a.trackingHandle.dispatchEvent({type:b,adVolume:a.volume})},checkForAdBlocker:function(a){var b=a.getSessionOption("adBlockerCallback");return b&&b()},populateCustParamsWithAdSessionValues:function(a,b){var d,e,f;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(d=window.getVideoAdSessionValues(b))&&""!==d){d=d.replace(c.session,"&"),e=uvpjs.util.objFromQueryStr(d);for(f in e)a[f]=e[f]}},removeEmpty:function(a){for(var b in a)(null===a[b]||""===a[b])&&delete a[b]},extractAdInfoIma:function(a){return{contentType:a.getContentType(),isLinear:a.isLinear()}},extractAdInfoDai:function(a){return{advertiserName:a.getAdvertiserName(),description:a.getDescription(),duration:a.getDuration(),title:a.getTitle()}},extractPodInfo:function(a){return a?{adPosition:a.getAdPosition(),podIndex:a.getPodIndex(),timeOffset:a.getTimeOffset(),totalAds:a.getTotalAds()}:null},getPpidValue:function(a){var b=a.getSessionOption("userPPID");return uvpjs.util.isDefinedString(b)?b:null},initMoatTracking:function(a,b,c,d,e){var f,g,h,i=document.createElement("script"),j=[];b={adData:{ids:b,duration:c,url:e},dispatchEvent:function(a){this.sendEvent?(j&&(j.push(a),a=j,j=!1),this.sendEvent(a)):j.push(a)}},h="_moatApi"+Math.floor(1e8*Math.random());try{f=a.ownerDocument,g=f.defaultView||f.parentWindow}catch(a){g=window}return g[h]=b,i.type="text/javascript",a&&a.insertBefore(i,a.childNodes[0]||null),i.src="https://z.moatads.com/"+d+"/moatvideo.js#"+h,b},getVpaidEventForEvent:function(a,b){var c=this.moatEventMapping[b][a];return uvpjs.util.isEmpty(c)?null:this.vpaidEvents[c]}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.Configuration={env:"prod",hostname:"",name:"UVPJS",version:"3.2.1",date:"08/18/21 8:22:12 PM (GMT+0000)",path:"/a/video-player/uvpjs-rv/3.2.1/",playerName:"video-player"}}(uvpjs),function(a){a.AutoplayDetectionService=uvpjs.Class.subClass({init:function(a){this.mc=a.mediaCapabilities,this.completeCallback=a.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=a.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(a,b){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:a,supportsMutedAutoplay:b})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(a,b){this.killVid(),this.setInfo(a,b),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var a,b;this.vidEl=b=this.createVideoElement(!1),b.load(),a=b.play(),void 0===a?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):a.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var a,b;if(this.killVid(),this.checkForEarlySafari())return void this.finishCheck(!1,!1);this.vidEl=b=this.createVideoElement(!0),b.load(),a=b.play(),a.then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var a=this.mc.getBrowserName()===this.mc.SAFARI,b=this.mc.isDesktop(),c=a&&b?this.mc.getBrowserVersion():null,d=c&&c.split("."),e=d?11===parseInt(d[0])&&0===parseInt(d[1]):null;return null!==c&&(e&&(!d[2]||parseInt(d[2])<3))},detectMobileCapabilities:function(){var a=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,a)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var a=this.mc.isIOSTen(),b=a&&this.mc.isSafari(),c=a&&!b&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return b||c},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(a){var b=document.createElement("video");return a&&(b.muted=!0,b.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(b,!0),b.volume=.005,b.style.width="100%",b.style.height="100%",b.src=this.testVidPath,this.testDom.appendChild(b),b},createTestDom:function(){var a=document.createElement("div"),b=a.style,c="-1000px";return b.position="absolute",b.top=c,b.left=c,b.width="320px",b.height="180px",document.body.appendChild(a),a}})}(uvpjs.register("uvpjs")),uvpjs.MediaCapabilities=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=uvpjs._,p=uuid.noConflict(),q=!1,r=!1,s={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLATFORM_OUTLET_ACCOUNT_ID:"",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",FIREFOX_IOS:"FxiOS",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",FACEBOOK_IOS:"Facebook Browser iOS",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(c,d){var g=this.systemInfo;return typeof c===this.STRING?(a=c,b=!0):(a=navigator.userAgent||null,b=!1),e=document.createElement(this.VIDEO),f=document.createElement(this.AUDIO),typeof d===this.BOOLEAN&&(q=d),t(),x(),L(),r="https:"===location.protocol,g.browser=this.getBrowserName(),g.version=parseInt(this.getBrowserMajorVersion()),g.isMobile=this.isMobile(),g.isDesktop=this.isDesktop(),g.os=this.getOS()+"; ver. "+this.getOSVersion(),g.supportsMse=this.hasMediaSourceSupport(),g.isHlsjsEligible=this.canPlayHLSJS(),g.supportsNativeHls=this.canPlayNativeHLS(),g.supportsMp4=this.canPlayH264(),g.supportsDash=this.canPlayDASH(),this},determineAutoplayCapabilities:function(a){var b;if(null!==this.systemInfo.supportsUnmutedAutoplay)return void a();b=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,a()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:b,testVidPath:this.getPreferredPlaceholderURL()})},setTrackingInfo:function(a){var b,c,d=uvpjs.tracking,e={};for(c in d)b=d[c],e[c]=!!a[b];this.systemInfo.trackingAvailability=e},setAutoplayInfo:function(a){this.systemInfo.supportsUnmutedAutoplay=a.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=a.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return p.v1().replace(/-/g,"")},checkBrowserName:function(a){return typeof a===this.STRING&&this.getBrowserName()===a},canPlayHTML5Video:function(){var a=document.createElement(this.VIDEO);return typeof a===this.OBJECT&&typeof a.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var a=document.createElement(this.AUDIO);return typeof a===this.OBJECT&&typeof a.canPlayType===this.FUNCTION},getBrowserName:function(){return l||"unknown"},getBrowserVersion:function(){return m||-1},getBrowserMajorVersion:function(){return n||-1},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(a,b){if(typeof b===this.OBJECT){var c=b.exec(this.getUserAgent()),d="",e="";if(c&&typeof c===this.OBJECT&&c.length&&c.length>1){if(d=c[1]||"",d.indexOf(".")){var f=d.split(".");"object"==typeof f&&f.length&&f.length>0&&(e=f[0])}else e=d;return l=a,m=d,n=e,!0}}return!1},hasTealium:function(){return o.has(window,"utag")||o.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)||this.checkBrowserName(this.FIREFOX_IOS)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(a){return typeof a===this.STRING&&(this._detectEnvironment(a),!0)},getUserAgent:function(){return a},getMimeTypesObj:function(){return c||(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(c=navigator.mimeTypes),c)},getMimeTypes:function(){if(typeof d===this.OBJECT)return d;var a={length:0},b=this.getMimeTypesObj();if(typeof b===this.OBJECT){for(var c=0;c<this.length;c++){var e=b[c].enabledPlugin&&b[c].enabledPlugin.name?b[c].enabledPlugin.name:"";a[b[c].type]={type:b[c].type,description:b[c].description,suffixes:b[c].suffixes,enabledPlugin:b[c].enabledPlugin,enabledPluginName:e},a.length++}return d=a}},getPlatform:function(){return typeof h===this.STRING?h:null},getOS:function(){return typeof i===this.STRING?i:null},getOSVersion:function(){return typeof j===this.STRING?j:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof k===this.BOOLEAN?k:k=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return y()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var a='video/mp4; codecs="avc1.42E01E,mp4a.40.2"',b=window.MediaSource||window.WebKitMediaSource,c=window.SourceBuffer||window.WebKitSourceBuffer,d=b&&"function"==typeof b.isTypeSupported&&b.isTypeSupported(a),e=!c||c.prototype&&"function"==typeof c.prototype.appendBuffer&&"function"==typeof c.prototype.remove;this.hasMse=!(!d||!e)}return this.hasMse},canPlayHLSJS:function(a){var b=this.isMobile(),c=!!y(),d=this.hasMediaSourceSupport(),e=this.isFirefox()||this.isChrome(),f=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),g=this.isOpera()&&this.getBrowserMajorVersion()>=30,h=this.isPlaystation();return!(!d||!c||h||b&&!this.canPlayHlsjsAndriod(a))&&(!!a||(e||f||g))},canPlayHlsjsAndriod:function(a){var b=this.getUserAgent();if(b.indexOf("Android")>=0){if(parseFloat(b.slice(b.indexOf("Android")+8))>=5&&a)return!0}return!1},canPlayNativeHLSAudio:function(){return z()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return y()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return y()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return y()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(a,b){return y()&&this.canPlayMediaType(this.VIDEO,a,b||!1)},canPlayAudioType:function(a,b){return y()&&this.canPlayMediaType(this.AUDIO,a,b||!1)},canPlayMediaType:function(a,b,c){var d=a===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return c=1==c,!(typeof d!==this.OBJECT||typeof d.canPlayType!==this.FUNCTION||!(c&&d.canPlayType(b)===this.PROBABLY||!c&&""!==d.canPlayType(b)))},canPlayType:function(a,b){b=1==b;var c=/audio\//,d=c.test(a)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof d!==this.OBJECT||typeof d.canPlayType!==this.FUNCTION||!(b&&d.canPlayType(a)===this.PROBABLY||!b&&""!==d.canPlayType(a)))},nativeCanPlayType:function(a,b){var c=a===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof c===this.OBJECT&&typeof c.canPlayType===this.FUNCTION?c.canPlayType(b)||null:null},canPlayDASHType:function(a){if(typeof a!==this.STRING||a.length<1)return null;var b=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(a)&&this.hasMSE()&&b.isTypeSupported(a)},canPlayDASH264:function(a){return a=typeof a===this.STRING?a:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(a)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var a=this.getUserAgent();return a&&!(this.isChromecast()||this.isIOS()||a.indexOf("Android 2.")>-1||a.indexOf("Android 4.0")>-1||a.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(a){return(!a||!this.supportsAutoplay())&&(!this.isChromecast()&&!this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(a){return a&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(a){return!a&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(a,b){var c=this.getInlinePlayAttribute(),d=c&&c.name;b&&c?c&&a.setAttribute(d,c.value):!b&&d&&a.removeAttribute(d)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/video/uvp_blank.mp4"},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var a="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return a&&!a.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var a,b;return void 0===this._hasFullscreenApiSupport&&(this.isIOS()?this._hasFullscreenApiSupport=!1:(a=document.createElement("div"),b=uvpjs.util,this._hasFullscreenApiSupport=!!(b.isFunction(a.requestFullscreen)||b.isFunction(a.webkitRequestFullscreen)||b.isFunction(a.mozRequestFullScreen)||b.isFunction(a.msRequestFullscreen)))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(a){var b=document,c=this.supportsFullscreenApi()&&(b.fullscreenEnabled||b.webkitFullscreenEnabled||b.mozFullScreenEnabled||b.msFullscreenEnabled);return!c&&(c=a&&a.webkitSupportsFullscreen),c},getDevice:function(){return g||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var a=this.isIOS();return!a||a&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(a){return/\.m3u|assetType=hls/i.test(a)},isDashUrl:function(a){return/\.mpd/i.test(a)},isSecure:function(){return r},setUrlProtocol:function(a){return r?a.replace("http:","https:"):a},getDrmType:function(a){var b="none";return a.enabled?((this.isIOS()||this.isSafari())&&null!==a.fairplay.appCertURL?b="Fairplay":(this.isIE()||this.isEdge())&&null!==a.dash.playreadyURL?b="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==a.dash.widevineURL&&(b="Widevine"),b):b}},t=function(){var a=/\s(\([^)]+\))/,b=new RegExp(a),c=b.exec(s.getUserAgent());c&&c.length&&c.length>1&&(c=c[1].replace(/_/gi,"."),v(c)||w(c)||u(c)||C(c))},u=function(a){if(-1!==a.indexOf(s.LINUX)||-1!==a.indexOf(s.ANDROID)){if(h=s.LINUX,-1!==a.indexOf(s.ANDROID)){var b=/\ Android\ ([^\s]+);/;a=new RegExp(b).exec(a),g=s.ANDROID,i=s.ANDROID,j=a&&a[1]?a[1]:""}return!0}return!1},v=function(a){var b,c,d="like Mac OS X";if(-1!==a.indexOf(s.MAC))return h=s.MAC,g=s.DESKTOP,-1!==a.indexOf(s.OSX)&&(b=/Mac\ OS\ X\ ([\d\.]+)/,c=new RegExp(b),a=c.exec(a),i=s.OSX,j=a&&a[1]?a[1]:null),!0;if(-1!==a.indexOf(d)){h=s.MAC,i=s.IOS;var e=/\(iPhone;/,f=/\(iPad;/,k=/\(iPod;/;c=/\sOS\s([^\s]*)\s/;var l=c.exec(a);if(l&&l[1]&&(j=l[1]),e.test(a))g=s.IPHONE;else if(f.test(a))g=s.IPAD;else{if(!k.test(a))return!1;g=s.IPOD}return!0}return!1},w=function(a){var b=/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/,c=/Windows\ NT\ ([^\s]+)[;\)]/,d=new RegExp(b);if((a=d.exec(s.getUserAgent()))&&a[2])return h=s.WINDOWS,i=s.WINDOWS_PHONE,j=a[2],g=s.PHONE,!0;if(d=new RegExp(c),(a=d.exec(s.getUserAgent()))&&a[1]){h=s.WINDOWS,i=s.WINDOWS;var e=a[1];return 6==e?i=s.WINDOWS_VISTA:6.1==e?(i=s.WINDOWS7,j=7):6.2==e?(i=s.WINDOWS8,j=8):10==parseInt(e)&&(i=s.WINDOWS10,j=e),g=s.DESKTOP,!0}return!1},x=function(){return!!A()||(!!D()||(!!E()||(!!F()||(!!G()||(!!H()||(!!I()||(!!B()||!!K())))))))},y=function(){return e},z=function(){return f},A=function(){var a=/Chrome\/(\S+)/,b=/CriOS\/(\S+)/,c=/(Opera|OPR)/,d=/Edge/,e=/CrKey/,f=s.getUserAgent(),g=b.test(f);return!(!a.test(f)&&!g||c.test(f)||d.test(f)||e.test(f)||(s.setBrowserVersion(s.CHROME,g?b:a),0))},B=function(){var a=/Playstation (\S+)/i;return!!a.test(s.getUserAgent())&&(s.setBrowserVersion(s.PLAYSTATION,a),!0)},C=function(){return null!=s.getUserAgent()&&s.getUserAgent().indexOf(s.CHROMECAST_USER_AGENT)>-1&&(h=s.LINUX,g=s.CHROMECAST,i=s.ANDROID,!0)},D=function(){var a=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,b=/\ Edge\/([^\s]+)/,c=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return a.test(s.getUserAgent())?(s.setBrowserVersion(s.IE,a),!0):b.test(s.getUserAgent())?(s.setBrowserVersion(s.EDGE,b),!0):!!c.test(s.getUserAgent())&&(s.setBrowserVersion(s.IE,c),!0)},E=function(){var a=/Firefox\/(\S+)/,b=/FxiOS\/(\S+)/,c=s.getUserAgent(),d=b.test(c),e=!d&&a.test(c)?s.FIREFOX:d?s.FIREFOX_IOS:null;return!!e&&(s.setBrowserVersion(e,d?b:a),!0)},F=function(){var a,b=/Version\/(\S+).*Safari\//,c=b.test(s.getUserAgent());return a=i===s.ANDROID?s.ANDROID:s.SAFARI,!!c&&(s.setBrowserVersion(a,b),!0)},G=function(){var a=/Opera|OPR\/(\S+)/,b=new RegExp(a),c=b.exec(s.getUserAgent());if(c){var d=-1!==c.indexOf("Opera Mini/")||-1!==c.indexOf("Opera Mobi")?s.OPERA_MOBILE:s.OPERA;return s.setBrowserVersion(d,/Opera|OPR\/(\S+)/),!0}return!1},H=function(){return!!/Silk/i.test(s.getUserAgent())&&(s.setBrowserVersion(s.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},I=function(){return!!/Android/.test(s.getUserAgent())&&(l=s.ANDROID_BROWSER,!0)},J=function(a){var b=a.match(/\[(.*)\]/),c=null,d={},e=[];return b&&b.length>0&&(c=b[1]),e=c.split(";"),e.forEach(function(a){var b=a.split("/");b.length>0&&(d[b[0]]=b[1])}),d},K=function(){var a=s.getUserAgent();if(!/FBAN/.test(a))return!1;var b=J(a),c=/iOS/i;return b.FBSN&&(i=b.FBSN),b.FBSV&&(j=b.FBSV),!(!b.FBAN||!c.test(b.FBAN))&&(l=s.FACEBOOK_IOS,!0)},L=function(){var a=y(),b=function(a,b){a._fullscreenEventName=b?b[0]:null,a._fullscreenEnterEventName=b?b[1]:null,a._fullscreenExitEventName=b?b[2]:null,a._enterFullscreenMethodName=b?b[3]:null,a._exitFullscreenMethodName=b?b[4]:null,a._isFullscreenPropertyName=b?b[5]:null,a._fullscreenElementName=b?b[6]:null,a._fullscreenErrorEventName=b?b[7]:null},c=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],d=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"],e=null;s.isIOS()?e=d:a.requestFullscreen?e=c:a.webkitRequestFullscreen?e=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:a.mozRequestFullScreen?e=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:a.msRequestFullscreen?s.getBrowserVersion()<12?e=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(e=c.slice(),e[5]=null):s.isAndroid()&&(e=d),b(s,e)};return s},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(a){var b=uvpjs._,c=uvpjs.mediaCapabilities;if(this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,!b.isObject(a))return void this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.");this.cookie=this._getCookie(),this.CDO=a,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=c.isChrome()||c.isFirefox()||c.isSafari(),this.setSessionStartTime()},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(a,b,c){this.debugCount++;var d=uvpjs._;if(this.isEnabled||d.isUndefined(this.CDO)){if(!d.isString(a)||!d.isString(b)||d.isUndefined(c))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+c,b);if(this.showAll||d.isUndefined(this.CDO)||this.isParamEnabled(b)||!0===this.cookie[b]){var e=this.showTimestamps?"["+this._timestamp()+"] ":"",f=d.drop(arguments,3),g=d.isEmpty(f)?"":f,h={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[a]("%sUVPJS %s %s",e,b,c,g);console[a]("%s%cUVPJS %c%s%c %s",e,h.bold,h.underline,b,h.normal,c,g)}}},isParamEnabled:function(a){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,a)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var a=uvpjs._,b=new Date,c=b-this.adjustedStartTime,d=c%1e3;c=(c-d)/1e3;var e=c%60;c=(c-e)/60;var f=c%60;c=(c-f)/60;var g=c%24-this.adjustedTimezone;return a.padStart(g,2,"0")+":"+a.padStart(f,2,"0")+":"+a.padStart(e,2,"0")+"."+a.padStart(d,3,"0")},_getCookie:function(){var a=this._readCookie(this.COOKIE_NAME),b={};if(!a)return b;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",a);try{b=JSON.parse(a)}catch(a){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",a)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",b),b},_readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0,e=c.length;d<e;d++){for(var f=c[d];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b))return f.substring(b.length,f.length)}return null}},function(a){var b,c=a._;a.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(a){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",a),this.mc=null,this._createControls=a.createControls,this._createAds=a.createAds,this._useInlinePlayAttribute=a.useInlinePlayAttribute,this._useMutedAttribute=a.useMutedAttribute,this._DOMReadyCB=a.callback,this._useAutoplayAttribute=a.useAutoplayAttribute,this._crossOriginAttrValue=a.crossOriginAttrValue,this._userAgent=null,this.adClickElement=null,this.dom=b(),this.dom.outer.id=a.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var a=this.dom.video.el;a&&a instanceof HTMLElement&&(a.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),a.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),a.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),a.removeEventListener(this.PLAY,this._handleEvent,!1),a.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return c.clone(this.dom)},createAdClickElement:function(){var a={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};this.adClickElement=document.createElement("div");for(var b in a)this.adClickElement.style[b]=a[b];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(a){this.dom.ad.el&&(this.dom.ad.el.style.display=a?"block":"none")},showAdClickElement:function(a){this.adClickElement&&(this.adClickElement.style.display=a?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var a=this.dom.video.el;a.addEventListener?a.addEventListener("contextmenu",function(a){a.preventDefault()},!1):a.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var a=this.dom;if(a.outer.el=document.getElementById(a.outer.id),c.isNull(this.dom.outer.el))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",a.outer.id));a.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),a.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),a.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),a.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),a.content.el=this._getOrCreateElement("content"),a.outer.el.insertBefore(a.content.el,a.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),a.ad.el=this._getOrCreateElement("ad"),a.outer.el.insertBefore(a.ad.el,a.content.el.nextSibling)),this._createControls?(a.controls.el=this._getOrCreateElement("controls"),a.outer.el.appendChild(a.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB()},_createVideoElement:function(){var a,b=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),c=document.querySelectorAll(b);if(c instanceof NodeList&&c[0]instanceof HTMLElement&&c[0].id)return void this._checkVideoTagAttributes(c);if(b=[this.dom.outer.id,this.dom.video.id].join(" "),(c=document.querySelectorAll(b))instanceof NodeList&&c[0]instanceof HTMLElement){if(c[0].id)return;return c[0].id=this.dom.video.id,void this.dom.content.el.appendChild(c[0])}a=this._getOrCreateElement("video"),this._checkVideoTagAttributes(a),this.dom.content.el.appendChild(a),this.dom.video.el=a},_createPlaceholderContent:function(){var a=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||c.isNull(this._userAgent)&&this.mc.isIPhone()?a.innerHTML='<source src="'+this.dom.video.url+'">':a.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),a.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),a.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),a.addEventListener(this.CAN_PLAY,this._handleEvent,!1),a.addEventListener(this.PLAY,this._handleEvent,!1),a.addEventListener(this.PAUSE,this._handleEvent,!1),a.style.width="100%",this._DOMReadyCB()},_handleEvent:function(a){var b=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",a),!c.isNull(b)){var d=this._useSeparateTags?b.getElementsByTagName("source")[0]:b;if(!c.isNull(d)){if(a.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,a.target),b.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===d.src.indexOf(this.dom.video.url))return b.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),b.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),b.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),b.removeEventListener(this.PLAY,this._handleEvent,!1),void b.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",a.type),a.type){case this.CAN_PLAY:b.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),b.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:b.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(b.removeEventListener(this.PLAY,this._handleEvent,!1),b.pause(),!c.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:b.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(a){this._useMutedAttribute&&a.setAttribute("muted","muted"),this._useAutoplayAttribute&&a.setAttribute("autoplay","autoplay"),this._crossOriginAttrValue&&a.setAttribute("crossorigin",this._crossOriginAttrValue),this.mc.setVideoForInlinePlay(a,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var a=this.dom.ad.el;a.style.position="absolute",a.style.width="100%",a.style.height="100%",a.style.left="0",a.style.top="0"}},_getIdByPrefix:function(a){if(!c.isNull(a))return uvpjs.domConstants[a]+this.dom.outer.id},_getOrCreateElement:function(a){var b=this.dom[a],d=document.getElementById(b.id);return c.isNull(d)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+b.type+' id="'+b.id+'">.'),d=document.createElement(b.type),d.id=b.id),d}}),b=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,uvpc:null,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,audioInfo:{},bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(a,c,d,e){if(!b.isString(a)||!b.isObject(c)||!b.isObject(d))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN"));this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+a),this.vidContId=a,this.cviMgr=c,this.CDO=d,this.sessionOptions=e,this.eventsMgr=c.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(a){if(b.isPlainObject(a)&&a.target===this.vidContId&&b.isNumber(a.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+a.payload.newState);var c=a.payload.newState;c!==uvpjs.mediaCapabilities.EMPTY&&c!==uvpjs.mediaCapabilities.LOADING&&c!==uvpjs.mediaCapabilities.STOPPED&&c!==uvpjs.mediaCapabilities.PLAYING&&c!==uvpjs.mediaCapabilities.PAUSED&&c!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=c,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(a){var b=a.payload;a.target===this.vidContId&&(this.isCurrVideoAd=b.isAd,this.playbackState=b.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=b.currentTime,this.adPlaybackState.absoluteStreamTime=b.absoluteStreamTime||b.currentTime,this.adPlaybackState.duration=b.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=b.playbackStarted,this.adPlaybackState.playbackComplete=b.playbackComplete,this.adPlaybackState.sourceBitrate=b.sourceBitrate,this.adPlaybackState.playbackBitrate=b.playbackBitrate,this.adPlaybackState.errorInfo=b.errorInfo,this.adPlaybackState.lastSecondCompleted=b.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=b.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=b.currentTime,this.contentPlaybackState.absoluteStreamTime=b.absoluteStreamTime||b.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=b.playbackStarted,this.contentPlaybackState.playbackComplete=b.playbackComplete,this.contentPlaybackState.sourceBitrate=b.sourceBitrate,this.contentPlaybackState.playbackBitrate=b.playbackBitrate,this.contentPlaybackState.videoFramerate=b.videoFramerate,this.contentPlaybackState.isSeeking=b.isSeeking,this.contentPlaybackState.isHDStreamLive=b.isHDStreamLive,this.contentPlaybackState.isPlayingLive=b.isPlayingLive,this.contentPlaybackState.currentContentSegment=b.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=b.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=b.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=b.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=b.lastPercentageCompleted,this.contentPlaybackState.bufferLength=b.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=b.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&b.isNumber(a.payload.vol)&&(this.volume=a.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.isFullscreen=a.payload.isFs)},onContextMetadata:function(a){!b.isPlainObject(a)||a.target!==this.vidContId||b.isPlainObject(a.target.contextMetadata)},onResourceStart:function(a){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){b.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){b.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){b.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(a){this.CDO.setAdCallParams(a)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var a=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof a&&a.length?a:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(a){var c=void 0;return a&&b.isString(a)&&this.hasOwnProperty(a)&&!b.isFunction(this[a])&&(c=this[a]),c},getModule:function(a){if(b.isString(a))return this.CDO.getModule(a)},getModuleParam:function(a,c){if(b.isString(a)&&b.isString(c))return this.CDO.getModuleParam(a,c)},getModules:function(){return this.CDO.getModules()},copyModules:function(a){this.CDO.copyModules(a)},isModuleEnabled:function(a){return!(!a||!b.isString(a))&&this.CDO.isModuleEnabled(a)},isModuleSet:function(a){return!uvpjs.util.isEmpty(a)&&this.CDO.isModuleSet(a)},getSessionOption:function(a){return a?this.sessionOptions[a]:null},getClass:function(a){if(b.isString(a))return this.CDO.getClass(a)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(a,b){return this.CDO.getClassProperty(a,b)},getClassListItems:function(a){return this.CDO.getClassListItems(a)},getClassListItemProperty:function(a,b,c){return this.CDO.getClassListItemProperty(a,b,c)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var a={};return b.assign(a,this.contentVideoState),a},getAdVideoState:function(){var a={};return b.assign(a,this.adVideoState),a},getContentPlaybackState:function(){var a={};return b.assign(a,this.contentPlaybackState),a},getAdPlaybackState:function(){return b.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(a){this.contentVideoState.abrInfo=a,this.contentPlaybackState.abrInfo=a},setAdVideoState:function(a){this.adVideoState=b.assign({},this.adVideoStateDefaults,a||{})},setContentVideoStateItems:function(a){this._addItemsToInstanceObj("contentVideoState",a)},setContentPlaybackStateItems:function(a){this._addItemsToInstanceObj("contentPlaybackState",a)},setAdVideoStateItems:function(a){this._addItemsToInstanceObj("adVideoState",a)},setAdPlaybackStateItems:function(a){this._addItemsToInstanceObj("adPlaybackState",a)},setNonDefaultContentVideoStateItems:function(a){this.setContentVideoStateItems(this._removeDefaults(a,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(a){this.setAdVideoStateItems(this._removeDefaults(a,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(a){var b=this.VIDEO_PLAYBACK_SETTINGS,c=this.isModuleEnabled(b),d=this.getModuleParam(b,a);if(c&&d)return d},setAbrStartBitrateFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==a&&this.setStartBitrate(a)},setAbrMinBitrateFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==a&&this.setMinBitrate(a)},setAbrMaxBitrateFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==a&&this.setMaxBitrate(a)},setLiveSyncDurationCountFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==a&&this.setLiveSyncDurationCount(a)},setCapLevelToPlayerSizeFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==a&&this.setCapLevelToPlayerSize(a)},setDashJSFastSwitchABRFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==a&&this.setDashJSFastSwitchABR(a)},setStartBitrate:function(a){this.startBitrate=a,this.setContentPlaybackStateItems({startBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(a){this.minBitrate=a,this.setContentPlaybackStateItems({minBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(a){this.maxBitrate=a,this.setContentPlaybackStateItems({maxBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(a){this.liveSyncDurationCount=a,this.setContentPlaybackStateItems({liveSyncDurationCount:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(a){this.capLevelToPlayerSize=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(a){this.enableDashJSFastSwitchABR=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setAudioTrackInfo:function(a){this.contentPlaybackState.audioInfo=a},getAudioTrackInfo:function(){return this.contentPlaybackState.audioInfo},setErrorRecovery:function(a){this.errorRecovery=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(a){this.useDynamicSwitching=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var a=this;b.forOwn(this.sessionOptions,function(c,d){if(b.isString(c))return b.has(a.contentVideoState,d)?void(a.contentVideoState[d]=c):b.has(a.adVideoState,d)?void(a.adVideoState[d]=c):void 0}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(a,c){return b.omitBy(a,function(b,d){return a[d]===c[d]})},_addItemsToInstanceObj:function(a,c){var d,e,f;if(!(d=this[a]))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+a));if(!b.isObject(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",c));this.debug;for(e in d)f=c[e],!c.hasOwnProperty(e)||b.isUndefined(f)||b.isFunction(f)||(d[e]=f)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(a,c,d){var e,f;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",a),this.scriptsLoadedCB=c,this.timeout=d||this.REQUEST_TIMEOUT,b.isString(a)&&this.urls.push(a),b.isArray(a)&&(this.urls=a),f=this.urls.length,e=0;e<f;e++)this._getScript(this.urls[e])},_getScript:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",a);var c=this,d=function(a,d){if(!b.isFunction(c._onScriptLoaded)||c._onScriptLoaded.done)return void(c.debug&&uvpjs.warn(c.DEBUG_ID,"_getScript _doCallback callback not a function or already called."));c.urls=b.without(c.urls,a),c._onScriptLoaded({url:a,error:d})},e=document.createElement("script");e.src=this._setUrlProtocol(a),e.async=!0,e.onreadystatechange=e.onload=function(){e.readyState&&!/loaded|complete/.test(e.readyState)||d(a)},e.onerror=function(b){uvpjs.error(c.DEBUG_ID,"_getScript "+b.target.src+" is not accessible."),d(a,b)},document.querySelector("head").appendChild(e),this.timeoutHandle=setTimeout(function(a){-1===b.indexOf(c.urls,a)||(this.debug&&uvpjs.warn(c.DEBUG_ID,"_getScript request timeout"),d(a,"timeout"))}.bind(this,a),this.timeout)},_onScriptLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var c=b.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),c&&b.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(a))},createCORSRequest:function(a,b){var c=new XMLHttpRequest;return b=this._setUrlProtocol(b),"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=!1,c},loadXHR:function(a,c,d,e){var f,g;if(a=this._setUrlProtocol(a),!1===(f=this.createCORSRequest("GET",a)))return g="loadXHR CORS not supported for url = "+a,uvpjs.warn(this.DEBUG_ID,g),void d(f);e&&!uvpjs.util.isEmpty(e)&&(f.responseType=e),f.timeout=this.REQUEST_TIMEOUT,f.onload=function(){if(b.inRange(f.status,200,400))return void c(f);d(f)},f.onerror=function(){d(f)},f.ontimeout=function(){d(f)},f.send()},loadXML:function(a,b,c){this.loadXHR(a,b,c,"document")},loadArrayBuffer:function(a,b,c){this.loadXHR(a,b,c,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(a){var b=a.vidContId;if(!a.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=b,this.eventsMgr=a.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=a.readyCallback,this.cachedOptions={suppressFacadePlay:a.suppressFacadePlay,deferLoadingCaptions:a.playerOptions.deferLoadingCaptions},this.cviModel.initialize(b,this,a.CDO,a.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(a){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(a)},setAdCallParams:function(a){this.cviModel.setAdCallParams(a)},setInitialPlaybackType:function(a,b){this.initialPlaybackInfo.isAutoplay=a,this.initialPlaybackInfo.isMuteAtPlayStart=b},setContextMetadata:function(a){this.cviModel.contentVideoState.contextMetadata=a||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var c=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:c.suppressFacadePlay,p2pClient:a||null,multiCdnClient:b||null,deferLoadingCaptions:c.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:c.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(a){var c=this.cviModel.getSessionOption("adBlockerCallback"),d=!(!c||!c()),e=this.eventsMgr.eventTypes,f=uvpjs.ErrorInfo,g=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+d),d&&this.eventsMgr.dispatchEvent(e.AD_BLOCKED,{errorInfo:new f({eventType:e.AD_BLOCKED,errorCode:f.errorCodes.AD_BLOCKING_DETECTED,message:f.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),!d&&!g)return void this.eventsMgr.dispatchEvent(e.PLAYER_START_ERROR,{errorInfo:new f({eventType:e.PLAYER_START_ERROR,errorCode:f.errorCodes.IMA_SDK_MISSING,message:f.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId);if(g){if(!b.isEmpty(this.imaAdDisplayContainer))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed"));this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(a),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var h=this.adsLoader.getSettings();h.setAutoPlayAdBreaks(!0),h.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}},_createIMAAdDisplayContainer:function(a){var b,c,d;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),b=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),c=b.getElementsByTagName("video")[0],d=new google.ima.AdDisplayContainer(this.adVideoDiv,c,a),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",a),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",d),d},onAdsManagerLoaded:function(a){var b,c=uvpjs.util,d=c.isEmpty(this.RPM),e=c.isEmpty(this.RPM.currRP),f=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",a),d||e||f)return b="CVI mgr: onAdsManagerLoaded; ",b+=d?"no RPM found":e?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,b),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+b,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(a)},onAdError:function(a){var c=!b.isEmpty(this.RPM)&&this.RPM,d=c&&!b.isEmpty(c.currRP)&&c.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",a),!c||!d)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof d.handleAdsLoaderError&&d.handleAdsLoaderError(a)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),this.RPM.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(a){void 0===a&&(a={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,a,this.vidContId)},seekToRequest:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+a),b.isNaN(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+a));-1===a&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:a},this.vidContId)},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",a),b.isNaN(a)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:a},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",a),b.isString(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:a},this.vidContId)},showCaptionsRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{language:a},this.vidContId)},setCaptionLanguage:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SET_CAPTIONS_LANG,{language:a},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},getCaptionInfo:function(){return this.captionsMgr.getCaptionInfo()},setCaptionsStyleRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",a),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(a):this.captionsMgr.setStyles(a)},setCaptionsCuePropertyRequest:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",a,b),this.captionsMgr.setCueProperty(a,b)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},getAudioTrackInfo:function(){return this.cviModel.getAudioTrackInfo()},setAudioTrack:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_AUDIO_TRACK,{id:a})},resizeRequest:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+a+"  height = "+c),!b.isNaN(a)&&!b.isNaN(c)&&a>=0&&c>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:a,height:c},this.vidContId)},fullscreenRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",a),b.isBoolean(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:a},this.vidContId)},setUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:a},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",a),b.isPlainObject(a)},setNativeControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",a),b.isBoolean(a)&&(this.cviModel.nativeControls=a)},createPauseAdRetriever:function(){var a=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),b={eventsMgr:this.eventsMgr,adCallUrl:a,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return a?uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new uvpjs.PauseAdRetriever(b)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+a))},checkForPauseAd:function(){var a,b=this.cviModel.isModuleEnabled("PauseAd"),c=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/PauseAdRetriever.js";b&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(a=new uvpjs.CodeLoader,a.loadScript(c,this.createPauseAdRetriever.bind(this))))}})}(uvpjs.register("uvpjs")),function(a){a.ErrorInfo=uvpjs.Class.subClass({init:function(a){var b=a||{};this.errorCode=b.errorCode||null,this.eventType=b.eventType||null,this.isFatal=!!b.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=b.message||null,this.adInfo=b.adInfo||null,this.serverCode=b.serverCode||null,this.hlsjsErrorCode=null}}),a.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},a.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."}}(uvpjs.register("uvpjs")),function(a){var b=a._,c=Math.random();a.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(a){if(this.debug=uvpjs.debug,!a||a!==c)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance()."));this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(a,c){if(!(a&&b.isString(a)&&c&&b.isFunction(c)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var d=this._returnValidEvtTypeAndNameSpace(a);if(!1===d)return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+a},this.internalNS);var e=d[0],f=d[1];if(this.registeredEventsTable[e]||(this.registeredEventsTable[e]={}),this.registeredEventsTable[e][f])return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",e," ns = ",f));this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",e," ns = ",f),this.registeredEventsTable[e][f]=c},removeEventListener:function(a){if(!a||!b.isString(a))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",a),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var c=this._returnValidEvtTypeAndNameSpace(a);if(!1===c)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",a));var d=c[0],e=c[1];if(!this.registeredEventsTable[d]||!this.registeredEventsTable[d][e])return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",a));this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",a),delete this.registeredEventsTable[d][e]},dispatchEvent:function(a,c,d){var e={};if(!a||!b.isString(a))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+a+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS);if(!b.isUndefined(c)&&!b.isPlainObject(c))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);if(!b.isUndefined(d)&&!b.isString(d))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);var f=this.registeredEventsTable[a];if(f){b.isUndefined(c)&&(c={}),b.isUndefined(d)&&(d=""),e.type=a,e.payload=c,e.target=d;for(var g in f)f.hasOwnProperty(g)&&f[g](e)}},_returnValidEvtTypeAndNameSpace:function(a){var b=[],c=a.split(".");if(c.length<2)return!1;var d=c[0];c.shift();var e=c.join("_");return!(!this._validateEventType(d)||e.indexOf("undefined")>-1)&&(b[0]=d,b[1]=e,b)},_validateEventType:function(a){var b=!1,c=this.eventTypes;for(var d in c)if(c.hasOwnProperty(d)&&c[d]===a){b=!0;break}return b},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(a){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),a)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(a,c,d,e){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",c);var f={};if(!a||!b.isNumber(a)||!c||!b.isString(c)||!d||!b.isFunction(d)||e&&!b.isNumber(e)&&(e>=1||-1===e))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);a<this.uvpjsClockInterval&&(a=this.uvpjsClockInterval),c=c.split(".").join("_"),f={freq:a,ns:c,cb:d,rptCnt:-1,nextTime:Date.now()+a},e&&(f.rptCnt=e),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",a),this.timerCBOs.push(f)},removeTimedEventCallback:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",a+" ns = "+c),!(a&&b.isNumber(a)&&c&&b.isString(c)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var d,e,f=c.split(".");for(c=f.join("_"),d=this.timerCBOs.length;d--;)e=this.timerCBOs[d],e.freq===a&&e.ns===c&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",e.freq+" CBO.ns = "+e.ns),this.timerCBOs.splice(d,1))},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var a,b,c=Date.now();for(a=this.timerCBOs.length-1;a>=0;a--)b=this.timerCBOs[a],c>=b.nextTime&&(b.cb(),b.nextTime=c+b.freq,-1!==b.rptCnt&&(b.rptCnt=b.rptCnt-1,0===b.rptCnt&&this.timerCBOs.splice(a,1)))},eventTypes:{SWITCH_AUDIO_TRACK:"switchAudioTrack",FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,AD_BUFFERING:uvpjs.EventType.AD_BUFFERING,AD_VOLUME_CHANGE:uvpjs.EventType.AD_VOLUME_CHANGE,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",SET_CAPTIONS_LANG:"onSetCaptionLang",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),a.EventsManager._instance=null,a.EventsManager.destroyInstance=function(){this._instance=null},a.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(c)),this._instance}}(uvpjs.register("uvpjs")),function(a){var b="www.nielsen.com";a.AbstractId3Parser=uvpjs.Class.subClass({init:function(a){this.findNielsen=a.findNielsen,this.dataCallback=a.dataCallback,this.ownerIds=this.assembleOwnerIds(a.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(a){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(a){for(var b=a.length,c=[];b--;)c[b]=a[b].length;return c},assembleOwnerIds:function(a,c){var d,e,f=[];if("string"==typeof a)for(d=a.split(","),e=d.length;e--;)f.push(d[e].trim());return c&&-1===f.indexOf(b)&&f.push(b),f}})}(uvpjs.register("uvpjs")),function(a){a.FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(a){var b,c=a.length;for(b=0;b<c;b++)a[b].data&&this.findId3(a[b])},findId3:function(a){var b,c,d,e,f,g,h,i=0,j=a.data;h=this.readStr(j,i,3),i+=3,"ID3"===h&&(i+=3,b=127&j[i++],c=127&j[i++],d=127&j[i++],e=127&j[i++],f=(b<<21)+(c<<14)+(d<<7)+e,g=i+f,this.findId3PrivateFrame(a,i,g))},findId3PrivateFrame:function(a,b,c){for(var d,e=a.data;b+8<=c;)d=this.readStr(e,b,4),b+=4,e[b++],e[b++],e[b++],e[b++],e[b++],e[b++],"PRIV"===d&&this.parseFrame(a,b)},parseFrame:function(a,b){for(var c,d,e,f=this.idLengths,g=this.totalIds,h=a.data;g--;)if(e=f[g],(d=this.readStr(h,b,e))===this.ownerIds[g]){b+=e,c="www.nielsen.com"===d?this.parseNielsen(d,h,b):this.readStr(h,++b,h.length),this.dataCallback({name:d,data:c,pts:a.pts});break}},parseNielsen:function(a,b,c){var d=a+this.readStr(b,c,b.length-(c+2));return 249===d.length?d:null},readStr:function(a,b,c){var d="",e=b||0,f=b+c;do{d+=String.fromCharCode(a[e++])}while(e<f);return d}})}(uvpjs.register("uvpjs")),function(a){a.TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(a){if(1===a.length){var b=a[0];if("PRIV"===b.value.key)for(var c=0;c<this.ownerIds.length;c++){var d=this.ownerIds[c];-1!==b.value.info.indexOf(d)&&this.dataCallback({name:d,data:"www.nielsen.com"===d?b.value.info:String.fromCharCode.apply(null,new Uint8Array(b.value.data)),pts:b.startTime})}}}})}(uvpjs.register("uvpjs")),function(a){a.SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var a={};for(var b in this.historyItems)a[b]=this.historyItems[b];return a},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(a){var b="//79423.analytics.edgesuite.net/js/csma.js";return b=a&&a.getModuleParam("AkamaiQOSPluginJS","libpath")||b,uvpjs.mediaCapabilities.isSecure()?[b.replace("edgesuite","edgekey")]:[b]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===a._.get(ADB,"va.Heartbeat"))},getPath:function(a){var b="2.3.0";try{var c=a.modules.find(function(a,b){return"SiteCatalyst"===a.name}),d=c.params.find(function(a,b){return"appMeasurementVersion"===a.name});d&&d.value&&(b=d.value)}catch(a){}var e=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-"+b+".min.js",f=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return a.sessionOptions.usesTealium?[f]:[e,f]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}}},init:function(a,b){var c=[],d=a.getModules(),e=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",a),this.cdo=a,this.initCallback=b,e.isEmpty(d))return void this.invokeCallbackWithHistory();a.getModule("MuxQOSPluginJS")||d.push({name:"MuxQOSPluginJS",enabled:"true"});for(var f=d.length;f--;){var g,h,i=d[f],j=i.name,k=this.sdkModules[i.name];if(i.enabled&&k)if(k.isDefined())this.addToHistory({name:i.name,loaded:!0});else for(g=k.getPath(a),h=g.length;h--;)c.push({name:j,path:g[h]})}e.isEmpty(c)?this.invokeCallbackWithHistory():this.bulkLoad(c)},invokeCallbackWithHistory:function(){var a=this.initCallback,b=this.getHistory();setTimeout(function(){a(b)},1)},bulkLoad:function(a){var b=a,c=[],d=(this.handleAllLoadResults,function(a,d,f){c.push({name:a,result:f}),d.destroy(),0===b.length?this.handleAllLoadResults(c):e()}),e=function(){var a=b.shift(),c=new uvpjs.CodeLoader;c.loadScript(a.path,d.bind(this,a.name,c))}.bind(this);e()},handleAllLoadResults:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",a);for(var b=a.length;b--;){var c=a[b];c.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+c.result.error),this.addToHistory({name:c.name,loaded:!c.result.error})}this.initCallback(this.getHistory())},addToHistory:function(a){if(!a.name)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",a));!1!==this.historyItems[a.name]&&(this.historyItems[a.name]=!a.error&&a.loaded)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(a){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=a.p2pClient||null,this.multiCdnClient=a.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=a.suppressFacadePlay,this.deferLoadingCaptions=a.deferLoadingCaptions,this.playlistPaused=!1,!b.isEmpty(a)&&this.initialize(a.vidContId,a.cviMgr)},initialize:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",a),!b.isString(a)||!b.isObject(c))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS"));this.vidContId=a,this.cviMgr=c,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()},setContainers:function(a){this.containers=a},setCaptionStyle:function(a){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(a)},onResourceLoadRequest:function(a){if(a.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",a.payload.rcObj),this.playlistPaused=!1;var b=this._createResourceProvider(a.payload.rcObj);this.rscProviders.unshift(b),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(a){if(a.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",a.payload.rcObjs);var c,d,e=a.payload.rcObjs,f=e.length;for(c=0;c<f;c++)d=this._createResourceProvider(e[c]),this.rscProviders.push(d);b.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(a){if(a.target===this.vidContId){for(var b,c=a.payload.rcObjs,d=c.length,e=this.rscProviders,f=this.usedRPs,g=!1,h=!uvpjs.util.isEmpty(this.currRP);d--;)b=c[d],this.removeFromList(b,e),this.removeFromList(b,f),h&&!g&&(g=this.isMatchingResource(b,this.currRP.rco.rcoSeed));g&&this.advancePlaylist()}},removeFromList:function(a,b){for(var c=b.length;c--;)this.isMatchingResource(a,b[c].rco.rcoSeed)&&b.splice(c,1)},isMatchingResource:function(a,b){var c=uvpjs.util;return a.type===b.type&&(!c.isEmpty(a.pid)&&a.pid===b.pid||!c.isEmpty(a.assetURL)&&a.assetURL===b.assetURL||!c.isEmpty(a.selectorCall)&&a.selectorCall===b.selectorCall)},onResourcePlaylistPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),a.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(a){a.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,b.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(a){a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(a){a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),b.isEmpty(this.currRP)||b.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){!b.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),b.isEmpty(this.currRP)||b.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(a){var b,c,d={rco:a,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",a),a.type){case this.mc.RP_URL:b=new uvpjs.RP_URL(d);break;case this.mc.RP_PLATFORM:b=new uvpjs.RP_Platform(d);break;case this.mc.RP_DAI:c=a.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider,b=new c(d);break;case this.mc.RP_IMA:b=new uvpjs.RP_IMA(d);break;case this.mc.RP_MDIALOG:b=new uvpjs.RP_Mdialog(d)}return b},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),b.isEmpty(this.currRP)||b.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!b.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(a){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",a.message),this.eventsMgr.dispatchEvent(a.eventType,{errorInfo:a},this.vidContId),this.advancePlaylist()},resourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:a},this.vidContId)},resourceEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",a),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:a,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!b.isEmpty(this.currRP)&&b.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.crossOriginAttrValue=null,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(a,c,d,e,f){var g=!0===f.skin;if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",a),!(b.isString(a)&&b.isObject(c)&&b.isObject(d)&&b.isFunction(e)))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"-"));this.vidContId=a,this.namespace=".vci_"+a,this.eventsMgr=c,this.CDO=d,this.vciReadyCB=e,this._usesIMA=f.usesIMA,this._loadSkinFlag=g,this._isPreviewBtnInternallyManaged=g,this._isUnmutedAutoplay=f.enableUnmutedAutoplay,this._isMutedAutoplay=f.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!f.useBrowserControls,this.crossOriginAttrValue=f.crossOriginAttrValue,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:a,eventsMgr:c,CDO:d,playerOptions:f,suppressFacadePlay:this.checkNativeAutoplay(f.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,f)})},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(a){var b={skin:!0===a.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:a.customCSS,enableReplay:a.enableReplay,previewImage:a.previewImage,themeName:a.themeName,controls:a.controls,template:a.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:a.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(a.enableNativeMobileAutoplay),crossOriginAttrValue:a.crossOriginAttrValue,callback:this.onDOMReady.bind(this,b)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(a){},onAdStart:function(a){var b=a.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(b),b.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(a){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){if(this.handleFirstGesture(),this.skinMgr){var a=this.skinMgr,b=this.mc.PAUSED;setTimeout(function(){a.setPlaystate(b)},200)}},setAdCallParams:function(a){this.CVI_Mgr.setAdCallParams(a)},checkAutoplayRestriction:function(a){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===a.adType&&"ima"===a.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(a){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,a,this.vidContId)},prepForRestrictedAutoplay:function(a){var b=this.dom.video.el,c=function(){this.isPreparedForAutoplay=!0,b.removeEventListener("play",c,!1),b.muted=!1,a&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),b.src=this.mc.getPreferredPlaceholderURL(),b.addEventListener("play",c,!1),b.muted=!0,b.load();var d=b.play();void 0!==d&&d.then(Function.prototype).catch(function(a){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(a){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:a||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(a){if(this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),!this.useBrowserNativeControls&&this._loadSkinFlag)return void(this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:a}));this.onVCIReady()},checkNativeAutoplay:function(a){return a&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),!this._vciReadySent){if(!this._autoPlay&&this._isPreviewBtnInternallyManaged&&!this._previewButtonDone)return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId);this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)}},loadDynamicAdCall:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),!b.isString(a))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)"));this.CVI_Mgr.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(a){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(a)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=a,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void a())):void(this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(a){var b,c;if(!0!==a&&!this.canOverrideUserGesture())return b=uvpjs.ErrorInfo,c=this.eventsMgr,void c.dispatchEvent(c.eventTypes.PLAYER_START_ERROR,{errorInfo:new b({eventType:c.eventTypes.PLAYER_START_ERROR,errorCode:b.errorCodes.USER_GESTURE_REQUIRED,message:b.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(a,c){if(!a||!b.isString(a)||!b.isFunction(c))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId);this.eventsMgr.addEventListener(a,c)},removeEventListener:function(a){if(!a||!b.isString(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId);this.eventsMgr.removeEventListener(a)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(a){var c;if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",a),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,a),void this.playBlankVideo();c=this.createResourceConfig(a),b.isObject(c)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:c},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",a),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,a),void this.playBlankVideo();if(b.isArray(a)&&a.length>0){var c,d,e=[];for(c in a)d=this.createResourceConfig(a[c]),b.isObject(d)?e.push(d):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);e.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:e},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(a){var b,c,d,e,f,g,h,i="",j=!1,k=a.type===this.mc.RP_IMA,l="",m=!1,n=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",a),h=this.prevalidateRcObj(a),h.error)return i="Resource configuration error: "+h.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(i,null),!1;switch(a.type){case this.mc.RP_URL:c=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:c=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(i="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",j=!0),m=!0,c=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:c=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:m=!a.useSsb,c=uvpjs.DaiRco;break;default:l="Unknown resource type "+a.type,i="VCI createResourceConfig "+l+"; this.vidContId = "+this.vidContId,j=!0}return j?(this.dispatchStartError(i,null),!1):(this.rcoIdIndex++,b=this.rcoIdIndex+"_"+this.vidContId,d=new c(a,b,this.vidContId),h=d.getValidationInfo(),m&&this.checkForAdBlocker()?(!0===h.missingSDK&&(n=k?"IMA":"DAI"),this.dispatchAdBlocked(n,!0),!1):h.error?(i="VCI error initializing RCO: "+h.message,e=uvpjs.ErrorInfo,f=e.errorCodes,!0===h.missingSDK?(g=k?f.IMA_SDK_MISSING:f.DAI_SDK_MISSING,this.dispatchStartError(i,g)):this.dispatchStartError(i,null),!1):(this._replayRco=a,d))},prevalidateRcObj:function(a){var b=uvpjs.util,c="",d=!1;return b.isPlainObject(a)?b.isDefinedString(a.type)||(c="Invalid resource type encountered",d=!0):(c="Invalid resource config object format",d=!0),{error:d,message:c}},dispatchStartError:function(a,b){this.debug&&uvpjs.error(this.DEBUG_ID,a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:b||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+a,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(a,b){var c=a?" (Missing "+a+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+c,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+c,isFatal:!!b})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(a){b.isArray(a)&&a.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:a},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(a){void 0===a&&(a={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest(a)},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",a),isNaN(a)||this.CVI_Mgr.seekToRequest(a)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",a),b.isEmpty(this.skinMgr)||b.isEmpty(a)||this.skinMgr.disableButton(a)},enableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",a),b.isEmpty(this.skinMgr)||b.isEmpty(a)||this.skinMgr.enableButton(a)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(a){b.isNaN(a)||this.CVI_Mgr.volumeChangeRequest(a)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",a),b.isString(a)&&this.CVI_Mgr.loadCaptionsRequest(a)},showCaptions:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest(a)},setCaptionLanguage:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionLanguage to "+a),this.CVI_Mgr.setCaptionLanguage(a)},getCaptionInfo:function(){return this.CVI_Mgr.getCaptionInfo()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},getAudioTrackInfo:function(){return this.CVI_Mgr.getAudioTrackInfo()},setAudioTrack:function(a){this.CVI_Mgr.setAudioTrack(a)},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",a),this.CVI_Mgr.setCaptionsStyleRequest(a)},setCaptionsStyleProperty:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",a,b),this.CVI_Mgr.setCaptionsStyleRequest([{name:a,value:b}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",a,b),this.CVI_Mgr.setCaptionsCuePropertyRequest(a,b)},setSize:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+a+"  height = "+c),b.isNumber(a)||b.isNumber(c)||this.CVI_Mgr.resizeRequest(a,c)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",a),!b.isEmpty(a)&&(b.isArray(a)&&a.length>0||uvpjs.util.isDefinedString(a))&&this.CVI_Mgr.setUserGesture(a)},setQosMetadata:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",a),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",c),b.isEmpty(a)||b.isEmpty(c)||!b.isArray(a)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:a,paramsObj:c},this.vidContId))},fullscreen:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",a),b.isBoolean(a)&&this.CVI_Mgr.fullscreenRequest(a)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(a){a&&b.isPlainObject(a)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:a},this.vidContId))},forceTrackSessionEnd:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FORCE_TRACK_SESSION_END,{},this.vidContId)},removeNativeControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",a),b.isBoolean(a)&&this.CVI_Mgr.setNativeControls(a)},useDynamicSwitching:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",a),b.isBoolean(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:a},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(a){if(!a||"number"!=typeof a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",a));this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:a},this.vidContId)},switchTo:function(a){var b="up,down",c=null!==a&&void 0!==a&&"string"==typeof a&&-1!==b.indexOf(a),d=null!==a&&void 0!==a&&"number"==typeof a&&!isNaN(a);if(!c&&!d)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",a,c,d,typeof a));this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",a),d?this.switchBitrateTo(a):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:a},this.vidContId)},setMinimumBitrateAllowed:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:a},this.vidContId)},setMaximumBitrateAllowed:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:a},this.vidContId)},pauseAdRequest:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:a||null,height:b||null},this.vidContId)},_dispatchResizeEvent:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:a},this.vidContId)},liveSegmentStart:function(a){var b=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,c={liveSegmentData:a};this.eventsMgr.dispatchEvent(b,c,this.vidContId)},liveSegmentEnd:function(a){var b=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,c={liveSegmentData:a};this.eventsMgr.dispatchEvent(b,c,this.vidContId)}})}(uvpjs.register("uvpjs")),function(a){var b=Math.random(),c=a._;a.VideoManager=uvpjs.Class.subClass({init:function(a){if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance)return void console.warn("UVPJS: An instance of VideoManager has already been created.");uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1},destroy:function(){for(var a in this.VCIs)this.destroyVideoPlayer(a);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(a,b,c){var d=uvpjs.Configuration,e=uvpjs.VideoManager._instance,f=uvpjs.DebugManager,g=this.validateParams(a,b,c),h=g.message,i=g.isValid;if(!h||(console[i?"warn":"error"](h),!i&&g.errorCb&&g.errorCb(h),i)){if(e){if(e.isInitializing())return void e.addInitCallback(b);if(e.isReady())return void(uvpjs.util.isFunction(b)&&b(this.mc.systemInfo))}console.log([d.name,d.version,d.date].join(" ")),uvpjs.log=f.log.bind(f),uvpjs.warn=f.warn.bind(f),uvpjs.error=f.error.bind(f),f.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!a.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(b),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",a),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(a,this.onCongfigMgrReady.bind(this))}},validateParams:function(a,b,d){var e=uvpjs.util,f=null,g=!1,h="VideoManager.initialize()",i=e.isFunction(d)?d:null;return a&&c.isPlainObject(a)||(f=h+" was invoked with invalid session options.",g=!0),e.isFunction(b)||(f=h+": A success callback function is required.",g=!0),i||(f=h+" did not receive a valid error callback function.",g=!1),{errorCb:i,message:f,isValid:!g}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(a){var b=this.successCallbacks.length;if(uvpjs.util.isFunction(a)){for(;b--;)if(this.successCallbacks[b]===a)return;this.successCallbacks.push(a)}},onCongfigMgrReady:function(a){if(!c.isObject(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS);this.CDO=a,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))},onSdkLoadManagerReady:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",a),uvpjs.mediaCapabilities.setTrackingInfo(a),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(a){var b,c=a.isModuleEnabled("VideoPlaybackSettings"),d=c&&a.getModuleParam("VideoPlaybackSettings","forceHlsjs"),e="string"==typeof d,f=e&&d.toLowerCase();d&&!uvpjs.util.isEmpty(d)&&(!0===d||1===d||e&&("1"===f||"y"===f||"yes"===f))&&(b=this.mc.canPlayHLSJS(!0),b&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=b)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(a,b){if(this.eventsMgr)return a&&c.isString(a)&&c.isFunction(b)?void this.eventsMgr.addEventListener(a,b):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(a){if(!a||!c.isString(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS);this.eventsMgr.removeEventListener(a)},getVideoPlayers:function(){var a,b={};for(a in this.VCIs)b[a]=this.VCIs[a];return b},createVideoPlayer:function(a,b,d){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),!c.isString(a)||!c.isFunction(b)||d&&!c.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);var e=[a,b];d&&e.push(d),this.createMultipleVideoPlayers([e])},destroyVideoPlayer:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),c.isString(a)?c.isEmpty(this.VCIs)||!this.VCIs[a]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+a},this.internalNS),!1):(this.VCIs[a].destroy(),delete this.VCIs[a]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(a){var b,d,e,f,g,h,i,j;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!c.isEmpty(this.VCIs)),!c.isArray(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS);for(f=a.length,e=0;e<f;e++)if(g=a[e],h=g[0],i=g[1],j=g[2],g.length<2||!c.isString(h)||!c.isFunction(i)||!c.isUndefined(j)&&!c.isPlainObject(j))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),e=0;e<f;e++)g=a[e],h=g[0],i=g[1],j=g[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",h),j=this.CDO.getSessionOptions(j),b=this.validateAutoplay(j),!1===this._allowConcurrentPlayback&&b&&(this._disableAutoplay&&(j.enableMutedAutoplay=!1,j.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),d=new uvpjs.VideoControlInterface,this.VCIs[h]=d,d.initialize(h,this.eventsMgr,this.CDO,i,j);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))},validateAutoplay:function(a){var b=a.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),c=!!(a.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||b);return b&&(a.enableMutedAutoplay=!1),c||(a.enableMutedAutoplay=!1,a.enableUnmutedAutoplay=!1),c},overrideSessionOptions:function(a){a&&c.isPlainObject(a)&&this.CDO.overrideSessionOptions(a)},onVideoProgress:function(a){if(!(this._allowConcurrentPlayback||!c.isPlainObject(a)||c.isUndefined(a.target)||c.isUndefined(a.payload)||c.isUndefined(a.payload.playbackState)||a.payload.playbackState!==this.mc.PLAYING)){var b=a.target;c.isEmpty(this.currActiveVCI)&&!c.isUndefined(this.VCIs[b])&&(this.currActiveVCI=this.VCIs[b]),b===this.currActiveVCI.vidContId||c.isUndefined(this.VCIs[b])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",b),this.VCIs[b].pauseVideo({autoPause:!0}))}},onVideoPlaybackInitiated:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",a),!this._allowConcurrentPlayback&&c.isPlainObject(a)&&!c.isUndefined(a.target)){var b=a.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),c.isEmpty(this.VCIs)||c.isUndefined(this.VCIs[b])||this.currActiveVCI&&this.currActiveVCI.vidContId===b||(this.currActiveVCI=this.VCIs[b],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(a){a?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",a.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(a){a?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",a.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),a.VideoManager._instance=null,a.VideoManager.destroyInstance=function(){this._instance=null},a.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(b)),this._instance}}(uvpjs.register("uvpjs")),function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=a._;a.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(a){var b=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,a&&(this._cviModel=a.cviModel,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=c(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=b.getCaptionsLineOffset(),this._lineAlign=b.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=a.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._disabled=!1,this.subtitleLanguage="en",this.subtitleMasterList=null,this.ccDisplayRequested=!1,this.isAndroidOnHlsjs=uvpjs.mediaCapabilities.canPlayHlsjsAndriod(this._cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=a,this.isAndroidOnHlsjs||!this._ccEl&&this._createCaptionsElement()},showCaptions:function(a){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.setCaptionLanguage(a),this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(a,"showing")},setCaptionLanguage:function(a){var b=a.payload.language;if(uvpjs.util.isDefinedString(b)){var c=this._getActiveTrack();c&&c.language===this.subtitleLanguage&&this.subtitleLanguage!==b&&this._clearCaptionTrack(c),this.clearCcElInnerHtml(),this.subtitleLanguage=b}},getCaptionInfo:function(){for(var a=[],b=this.subtitleMasterList||this._getTextTracks(),c=this._getActiveTrack(),d=0;d<b.length;d++){var e=b[d];enabled=c&&c.language===e.language||!1,a.push({language:e.language,label:e.label,kind:e.kind,enabled:enabled})}return b.length>0&&(this.subtitleMasterList=a),this.subtitleMasterList},hideCaptions:function(a){this.ccDisplayRequested=!1,this._toggleVisibility(a,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:q.clone(this.styles)},setStyles:function(a){var b,c,d,e=this._pageStyles,f=a.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",a);f--;)d=a[f],b=n(d.name),c=d.value,e[b]=c;this._updateStylesObject(e),this._applyStyles(),this._setPosition(e["text-position"]||null)}},setCueProperty:function(a,b){var c;if(!this._disabled){if(c=this._getActiveTrack(),!(a&&b&&c&&this._supportsVTTCue))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",a,b));this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",c,a,b),this._props[a]=isNaN(b)?b:Number(b)}},_addEventListeners:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners"),a.addEventListener(b.CONTAINER_RESIZE+c,this._onContainerResize.bind(this)),a.addEventListener(b.CONTROL_LOAD_CAPTIONS+c,this._onControlLoadCaptions.bind(this)),a.addEventListener(b.CONTENT_DATA_LOADED+c,this._onContentDataLoaded.bind(this)),a.addEventListener(b.CONTROL_SHOW_CAPTIONS+c,this.showCaptions.bind(this)),a.addEventListener(b.CONTROL_HIDE_CAPTIONS+c,this.hideCaptions.bind(this)),a.addEventListener(b.SET_CAPTIONS_LANG+c,this.setCaptionLanguage.bind(this)),a.addEventListener(b.CONTENT_FACADE_CREATED+c,this._onContentFacadeCreated.bind(this)),a.addEventListener(b.RESOURCE_END+c,this._onVideoComplete.bind(this)),a.addEventListener(b.VIDEO_PROGRESS+c,this._onVideoProgress.bind(this)),a.addEventListener(b.AD_START+c,this._onAdStart.bind(this))},_removeEventListeners:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),a.removeEventListener(b.CONTAINER_RESIZE+c),a.removeEventListener(b.CONTROL_LOAD_CAPTIONS+c),a.removeEventListener(b.CONTENT_DATA_LOADED+c),a.removeEventListener(b.CONTROL_SHOW_CAPTIONS+c),a.removeEventListener(b.CONTROL_HIDE_CAPTIONS+c),a.removeEventListener(b.SET_CAPTIONS_LANG+c),a.removeEventListener(b.CONTENT_FACADE_CREATED+c),a.removeEventListener(b.RESOURCE_END+c),a.removeEventListener(b.VIDEO_PROGRESS+c),a.removeEventListener(b.AD_START+c)},_createTrackElement:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",a);var b=document.createElement("track");b.default=!0,b.kind="captions",b.label="English",b.srclang="en",b.id=this._trackId,b.src=a,this._videoEl.appendChild(b)},_createCaptionsElement:function(){var a=uvpjs.util,b=this._styleEl,c=document.createElement("div"),d=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);if(c.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),!d)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container."));d.appendChild(c),this._ccEl=c,a.addCSSObject(b,c,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),a.addCSSObject(b,c,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),a.addCSSObject(b,c,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)},_dispatchCaptionsError:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",a),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:a},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this.adjustVttCuesLinePosition(),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(a){a.target===this._containerId&&this._setRect()},_onAdStart:function(a){this.clearCcElInnerHtml()},clearCcElInnerHtml:function(){this._ccEl&&(this._ccEl.innerHTML="")},_onVideoComplete:function(a){var b,c,d=a.target,e=this._videoEl;d===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",d),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,e&&e.removeEventListener("loadeddata",this._onLoadedData),e&&e.removeEventListener("timeupdate",this._onTimeUpdate),c=this._getTextTracks(),c&&(c.onaddtrack=null),b=this._getActiveTrack(),b instanceof window.TextTrack&&h(b)&&(b.mode="disabled",b.oncuechange=null),this._trackCount++)},_onContentDataLoaded:function(a){var b,c=uvpjs.util,d=a.target,e=a.payload.vidState,f=e.closedCaptionPath;e.isLive;d===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",d),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,b=this._getTextTracks(),b&&(b.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),c.isDefinedString(f)&&(this._captionsUrl=f))},_onLoadedData:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",a),this._checkForLiveCaptions()},_onTimeUpdate:function(a){!this.hasDispatchedCaptionsReady&&!!this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(a)},_onControlLoadCaptions:function(a){var b;a.target===this._containerId&&(b=a.payload.url,q.isString(b)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",a.target),this._loadCaptionsUrl(b)))},_onContentFacadeCreated:function(a){a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",a.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(a){var b=a.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",a);try{b=b.replace(/\n/g,""),b=b.substr(b.indexOf("<?xml"));var c=new DOMParser,d=c.parseFromString(b,"text/xml");this._xmlToCues(d)}catch(a){var e="Error parsing closed captions XML.";this._dispatchCaptionsError(e),this.debug&&uvpjs.error(this.DEBUG_ID,e,a)}},_onLoadError:function(a){var b=a.status,c="Unknown error";switch(b){case 404:c="File not found";break;case 500:c="Server error";break;case 0:c="Request aborted"}c+=" "+b,this._dispatchCaptionsError(c),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",c)},_onAddTrack:function(a){var b=a.track;b.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(b,!1),h(b)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",a)},_syncCCTrackMode:function(a,b){if(a)return b?void(a.mode="disabled"):void(this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(a.mode="showing"):"hidden"!==a.mode&&(a.mode="hidden"))},_onVideoProgress:function(a){var b;if(a.target===this._containerId){var c=this._getActiveTrack();if(this.isAndroidOnHlsjs||this._syncCCTrackMode(c,!1),!this._hasCaptions())return void(this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1));if(!this._liveCaptionsInitalized)return void this._checkForLiveCaptions();if(c&&c.activeCues&&(b=c.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);b--;)a.payload.currentTime-c.activeCues[b].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!a||!this._liveCaptionsInitalized){try{!a&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(a){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",a),this._dispatchCaptionsError(a)}a&&(this._liveCaptionsInitalized=!0),!!this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var a=this._getActiveTrack(),b=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),a&&(a.oncuechange=b)||this._videoEl.addEventListener("timeupdate",b)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var a=q.get(this._captionsJson,"tt.head.styling.style");if(a=q.isArray(a)?a[0]:a,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",a),!a)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file."));this._inlineStyles={backgroundColor:a["tts:backgroundColor"],color:a["tts:color"],fontFamily:a["tts:fontFamily"],fontSize:a["tts:fontSize"],fontStyle:a["tts:fontStyle"],fontWeight:a["tts:fontWeight"],textAlign:a["tts:textAlign"],textDecoration:a["tts:textDecoration"]}},_applyStyles:function(){var a,c,d,e=uvpjs.util,f=this.styles,g=this._styleSelector,h=[];this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",f);for(c in f){switch(d=f[c],a=!1,c){case"background-opacity":case"font-opacity":a=!0;break;case"text-position":a=!0,this._setPosition(d);break;case"background-color":d=b(d,f["background-opacity"]);break;case"color":case"font-color":c="color",d=b(d,f["font-opacity"]);break;case"text-edge-style":c="text-shadow",d=o(d)}a||(i(c,d)?h.push({name:c,value:d}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",c,d))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",g,h),e.addCSSRules(this._styleEl,g,h)},_updateStylesObject:function(a){var b,c,e;for(b in a){if(!(c=a[b])||!b)return;if((e=n(b))in this.styles){switch(e){case"font-size":c=d(c)}this.styles[e]=c}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",e)}},_hasCaptions:function(){return h(this._getActiveTrack())},_loadOrDeferCaptions:function(a){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(a)},_loadCaptionsUrl:function(a){var b,c=uvpjs.util.isDefinedString(a),d=c&&-1!==a.indexOf(".vtt");if(c&&!this._cviModel.contentVideoState.isFlash){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),d)return void this._createTrackElement(a);b=new uvpjs.CodeLoader,b.loadXHR(a,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_checkForLiveCaptions:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),!this._hasCaptions())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize."));this._finalizeTrackElement(),this._finalizeLiveCaptions()},_clearAllCaptionTracks:function(){var a=this._getTextTracks(),b=a&&a.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",a);b--;)this._clearCaptionTrack(a[b]);this.clearCcElInnerHtml()},_clearCaptionTrack:function(a){var b,c;if(h(a)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",a),b=a&&a.cues,c=b&&b.length||0;c--;)a.removeCue(b[c]);this._syncCCTrackMode(a,!0),a.cues=null}},_toggleVisibility:function(a,b){a.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",b),this.showCcContainer("hidden"!==b))},showCcContainer:function(a){if(this.isAndroidOnHlsjs){this._getActiveTrack().mode=a?"showing":"hidden"}else this._ccEl&&(a?this._ccEl.style.display="block":(this._ccEl.style.display="none",this._ccEl.innerHTML=""))},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var a,b,c,d=this._getTextTracks(),e=d&&d.length||0;for(c=0;c<e;c++)if(a=d[c],(b=a&&a.cues)&&b.length&&h(a))return a},enableCaptionsTracks:function(){for(var a,b=this._getTextTracks(),c=b&&b.length||0;c--;)a=b[c],h(a)&&(a.mode="hidden")},_getTrackById:function(a){var b=this._getTextTracks();return b&&b.getTrackById(a||this._trackId)},_getActiveCues:function(){var a=this._getActiveTrack();return a&&a.activeCues},_getAllCues:function(){var a=this._getActiveTrack();return a&&a.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var a,b,c,d=this._cviModel.getModule(this.CONFIG_MODULE_NAME),e={};return this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",d),d?!0!==d.enabled?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):q.isEmpty(d.params)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(q.each(d.params,function(d){a=d.name,b=d.value,a&&b&&(c=n(a),e[a]=b)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(e,null,2)),void(this._configStyles=e)):void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(a){var b=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"],c=b.indexOf(a)>-1?a:"bottom-center-floated";this._setPositionCSS(c)},_setPositionCSS:function(a){var b,c,d,e,f,g,h,i,j=uvpjs.util,k=this._styleEl,l=this._ccEl,m=l&&l.style.marginBottom,n=parseInt(this.BASE_CONTROLS_HEIGHT),o=10;k&&l&&(c=a.split("-"),e=c[0],d=c[1],h="inherit"===m?0:parseInt(m),i=isNaN(h)?n+"px":(h>n?o:n-h)+"px",f={top:o+"px",middle:"50%",bottom:"auto"}[e],g={top:"auto",middle:"auto",bottom:i}[e],b={top:f,bottom:g,"text-align":d,transform:"initial"},"middle"===e&&(b.transform="translateY(-50%)"),j.addCSSObject(k,l,b,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var a=this.styles;a&&this._setPosition(a["text-position"])},_setRect:function(){function a(){q.assign(r.style,k),s&&(q.assign(s.style,k),this._checkBottomPosition())}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,r=this._videoEl,s=this._ccEl,t=r&&r.parentNode;r&&t&&(i=r.videoHeight,(j=r.videoWidth)&&i&&(c=r.getBoundingClientRect(),b=t.getBoundingClientRect(),d=c.height,e=c.width,h=i/j,g=d/e,f=g/h,n=b.height-c.height,m=b.width-c.width,o=f>1||0===m&&0!==n,p=f<1||0!==m&&0===n,k=o?{height:"auto","max-height":"100%",width:"100%",margin:0}:p?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0},k&&a.call(this),c=r.getBoundingClientRect(),b=t.getBoundingClientRect(),n=b.height-c.height,m=b.width-c.width,o?(l=n/2+"px",k={margin:"inherit","margin-top":l,"margin-bottom":l}):p&&(l=m/2+"px",k={margin:"inherit","margin-left":l,"margin-right":l}),s&&(k["font-size"]=this._calculateFontSize(c.width)),k&&a.call(this)))},_calculateFontSize:function(a){var b;try{b=a/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),b=Math.max(b,parseInt(this.MIN_FONT_SIZE))}catch(a){console.error(a)}return b&&b+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(a){var b=a&&a.target,c=b&&b.activeCues||this._getActiveCues();this._setCueProps(c)},adjustVttCuesLinePosition:function(){if(this.isAndroidOnHlsjs){var a=this._getAllCues();if(a&&a.length>0){this._syncCCTrackMode(this._getActiveTrack(),!1);for(var b=0;b<a.length;b++){var c=a[b];!c||"auto"!==c.line&&-1!==c.line&&-2!==c.line||(c.line=-3)}}}},_setCueProps:function(a){this._addCuesToCaptionsElement(a)},_xmlToCues:function(a){var b,c,d,g,h,i,j,l,m,n,o,r=p(a);if(this._captionsJson=r,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",r),!q.isEmpty(r)&&q.isPlainObject(r)){if(c=q.get(r,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",c),q.isUndefined(c)||q.isEmpty(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file."));if(!(b=this._supportsVTTCue?window.VTTCue:window.TextTrackCue))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions."));for(h=this._videoEl.addTextTrack("captions","English","en"),h.id=this._trackId,n=c.length,l=0;l<n;l++)if(m=l+1,j=c[l],g=c[m],i=j.text,!q.isEmpty(i)){for(i=i.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3"),i=i.replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3"),i=i.replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),o=e(i),j._lineCountPrev=j._lineCountPrev||0,j._lineCountNext=j._lineCountNext||0;(g&&g.begin)===j.begin;)g._lineCountPrev=o+j._lineCountNext,j._lineCountNext+=e(g.text),g=c[++m];d=new b(f(j.begin),f(j.end),i),d._lineCount=o,d._lineCountPrev=j._lineCountPrev,d._lineCountNext=j._lineCountNext,d._metadata=j.metadata,d=k.call(this,d),h.addCue(d)}this._finalizeCaptions()}},_addCuesToCaptionsElement:function(a){var b,c,d,e=uvpjs.util,f=this._ccEl,g='<div class="{{cntrClass}}">{{spans}}</div>',h="",i=a&&a.length;if(i){for(b=0;b<i;b++)c=a[b],d=c.text,e.isDefinedString(d)&&(d=d.replace(/(\r\n|\n|\r)/g,"<br/>"),h+='<span class="{{txtClass}}">'+d+"</span>",b+1!==i&&(h+="<br/>"));g=g.replace("{{spans}}",h),g=g.replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME),g=g.replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),f&&(f.innerHTML=g)}}}),b=function(a,b){var c=l(a)||g(a)||g(j(a));return c&&b?m(c.r,c.g,c.b,b):a},c=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},d=function(a){var b="100%";return a.indexOf("px")>-1?(b=a.replace("px",""),b/=18,b=100*b+"%"):a.indexOf("%")>-1&&(b=a),b},e=function(a){return a&&(a.match(/\n/g)||[]).length+1},f=function(a){var b,c,d,e,f,g;if(!q.isNull(a)&&!q.isUndefined(a))return g=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},f=a.split(":"),b=60*Number(f[0])*60,c=60*Number(f[1]),d=Number(f[2]),e=b+c+d,g(e,2)},g=function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},h=function(a){return a instanceof window.TextTrack&&("captions"===a.kind||"subtitles"===a.kind)},i=function(a,b){if(a&&b)return q.get(window,"CSS.supports")?window.CSS.supports(a,b):"string"==typeof document.createElement("div").style[a]},k=function(a){var b,c=a._metadata;if(c){a.snapToLines=!0,b=Math.round(c.cccol/35*100),a.position=b;try{a.align=b<45?"start":b>55?"end":this._lineAlign}catch(b){a.align="center"}a.positionAlign=b<45?"line-left":b>55?"line-right":"center",a.line=c.ccrow-17+this._lineOffset,a._defaults={line:a.line,position:a.position,align:a.align,positionAlign:a.positionAlign}}return a},j=function(a){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[a.toLowerCase()]},l=function(a){var b;if(-1!==a.indexOf("rgba"))return b=a.substr(5,a.length).split(","),{r:b[0],g:b[1],b:b[2]}},n=function(a){if(q.isString(a)&&!q.isEmpty(a))return a.replace(/([A-Z])/g,"-$1").toLowerCase()},m=function(a,b,c,d){return"rgba("+[a,b,c,d].join(",")+")"},o=function(a){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[a]||"none"},p=function(a){var b={};if(1===a.nodeType&&a.attributes.length>0)for(var c=0,d=a.attributes.length;c<d;c++){var e=a.attributes.item(c);b[e.nodeName]=e.nodeValue}else 3===a.nodeType&&(b=a.nodeValue);if("p"===a.nodeName&&(b.text="",q.each(a.childNodes,function(a){if("metadata"!==a.nodeName){var c=(new XMLSerializer).serializeToString(a);1===a.nodeType&&(b.text+="br"===a.tagName?"\n":c),3===a.nodeType&&(b.text+=c)}})),a.hasChildNodes())for(var f=0,g=a.childNodes.length;f<g;f++){var h=a.childNodes.item(f),i=h.nodeName;if(void 0!==b[i]){if(void 0===b[i].push){var j=b[i];b[i]=[],b[i].push(j)}b[i].push(p(h))}else b[i]=p(h)}return b}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,crossOriginAttrValue:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(a)},initialize:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",a),this.overrideSessionOptions(a)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(a){var b;if(!uvpjs.util.isEmpty(a.standardParams)&&null===this.adCallParams.standardParams){this.adCallParams.standardParams={};for(b in a.standardParams)this.adCallParams.standardParams[b]=a.standardParams[b]}if(!uvpjs.util.isEmpty(a.customParams)&&null===this.adCallParams.customParams){this.adCallParams.customParams={};for(b in a.customParams)this.adCallParams.customParams[b]=a.customParams[b]}},overrideSessionOptions:function(a){var c=this.getSessionOptions(a);if(!c||!b.isPlainObject(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type."));this.sessionOptions=c},getSessionOption:function(a){return this.sessionOptions[a]||null},getSessionOptions:function(a){var c,d,e;if(c=b.clone(this.sessionOptions),!a||!b.isPlainObject(a))return c;if((d=a.skinConfig)&&!b.isEmpty(d)){uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object.");for(e in d)c.hasOwnProperty(e)&&(c[e]=d[e])}for(e in c)a.hasOwnProperty(e)&&(c[e]=a[e]);return c},getModule:function(a){return d(this.modules,a)},getModules:function(){return this.modules},getModuleParam:function(a,b){var c=d(this.modules,a),e=d(c.params,b);if(e&&e.hasOwnProperty("value"))return e.value},setModule:function(a){g(this.modules,a,"name",this.DEBUG_ID)},isModuleEnabled:function(a){var b=this.getModule(a);if(!b){var c="ConfigDataObject isModuleEnabled module not found: "+a;return this.debug&&uvpjs.log(this.DEBUG_ID,c),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+a+":",b.enabled),b.enabled},isModuleSet:function(a){return!!this.getModule(a)},getClass:function(a){return d(this.classes,a)},getClasses:function(){return this.classes},getClassProperty:function(a,b){var c=d(this.classes,a),e=f.call(this,c,"properties",this.DEBUG_ID),g=d(e,b);return f.call(this,g,"value",this.DEBUG_ID)},getClassListItems:function(a){var b=d(this.classes,a);return f.call(this,b,"list",this.DEBUG_ID)},getClassListItemProperty:function(a,b,c){var g=this.getClassListItems(a),h=e(g,b),i=f.call(this,h,"properties",this.DEBUG_ID),j=d(i,c);return f.call(this,j,"value",this.DEBUG_ID)},setClass:function(a){g(this.classes,a,"name",this.DEBUG_ID)},isCAN:function(){return b.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()},copyModules:function(a){for(var b=a.length;b--;)for(var c=a[b],d=this.modules.length;d--;){var e=this.modules[d];if(e.name===c.name){this.modules[d]=c;break}}}});var c=function(a,b,c){for(var d in a)if(a[d][b]==c)return a[d];return!1},d=function(a,b){return c(a,"name",b)},e=function(a,b){return c(a,"id",b)},f=function(a,b,c){return a?a.hasOwnProperty(b)?a[b]:(this.debug&&uvpjs.warn(c,"ConfigDataObject findItemProperty no item property:",a,b),!1):(this.debug&&uvpjs.warn(c,"ConfigDataObject findItemProperty item not found:",a),!1)},g=function(a,b,c,d){for(var e in a)if(a[e][c]==b[c])return this.debug&&uvpjs.log(d,"ConfigDataObject _addItemToArray updating existing item",b),void(a[e]=b);this.debug&&uvpjs.log(d,"ConfigDataObject _addItemToArray creating item",b),a.push(b)}}(uvpjs.register("uvpjs")),function(a){var b=a._,c=Math.random();a.ConfigManager=uvpjs.Class.subClass({init:function(a,b,d){if(this.debug=uvpjs.debug,!a||a!==c)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance()."));this.initCallback=d,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",b),this.CDO=new uvpjs.ConfigDataObject(b),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(!this.configSources.length)return void(b.isFunction(this.initCallback)&&this.initCallback(this.CDO));var a=this.configSources.shift();if(null!==a&&void 0!==a)switch(a.constructor){case String:if(""===a)break;return void(new uvpjs.CodeLoader).loadXHR(a,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=a.concat(this.configSources);break;case Object:this.updateCDO(a)}this.loadConfig()},onLoadComplete:function(a){var b,c,d,e=a.responseText,f=a.getResponseHeader("Content-Type");f.indexOf("application/json")>-1?d=JSON.parse(e):f.indexOf("text/xml")>-1||f.indexOf("application/xml")>-1?(b=new DOMParser,c=b.parseFromString(e,"text/xml"),d=this.xmlToCDO(c)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",f),d&&this.updateCDO(d),this.loadConfig()},onLoadError:function(a){var b="unknown error";switch(a.status){case 0:b="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",b,a),this.loadConfig()},updateCDO:function(a){if(b.isEmpty(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"));["classes","modules"].map(function(b){a.hasOwnProperty(b)&&(this.CDO[b]=d(this.CDO[b],a[b]))},this)},xmlToCDO:function(a){var b={},c=function(a){return"y"===a||"n"===a},d=function(a){return"y"===a},g=e(a);return g.hasOwnProperty("player-config")&&(g=g["player-config"]),b.modules=function(){var a,b=[];if(g.modules){a=f(g.modules.module);for(var e in a){var h=a[e],i={name:h.name,category:h.category,enabled:d(h.enabled),params:[]};if(a[e].hasOwnProperty("params")){var j=f(h.params.param);for(var k in j){var l=j[k];l.name&&(c(l.value)&&(l.value=d(l.value)),i.params.push(l))}}h.category;b.push(i)}return b}}(),b.classes=function(){var a=f(g.classes),b=[];for(var c in a){var d=a[c];if(d.hasOwnProperty("classDef")&&(d=d.classDef),d.name){var e={name:d.name,className:d.className,properties:[],list:[]};if(d.hasOwnProperty("list")){var h=f(d.list.listitem);for(var i in h){var j=h[i];j.id&&(j.hasOwnProperty("properties")&&(j.properties=j.properties.property),e.list.push(j))}}d.hasOwnProperty("properties")&&(e.properties=d.properties.property),b.push(e)}}return b}(),b},getCDO:function(){return this.CDO}}),a.ConfigManager._instance=null,a.ConfigManager.destroyInstance=function(){this._instance=null},a.ConfigManager.getInstance=function(a,b){return this._instance||(this._instance=new uvpjs.ConfigManager(c,a,b)),this._instance};var d=function(a,b){for(var c in b){var d=!1;for(var e in a)if(a[e].name===b[c].name){d=!0;break}d||a.push(b[c])}return a},e=function(a){var b,c={};if(1===a.nodeType&&a.attributes.length>0){b=a.attributes.length;for(var d=0;d<b;d++){var f=a.attributes.item(d);c[f.nodeName]=f.nodeValue}}if(a.hasChildNodes()){b=a.childNodes.length;for(var g=0;g<b;g++){var h=a.childNodes.item(g),i=h.nodeName;if(3!==h.nodeType)if(void 0!==c[i]){if(void 0===c[i].push){var j=c[i];c[i]=[],c[i].push(j)}c[i].push(e(h))}else c[i]=e(h)}}return c},f=function(a){if(void 0!==a&&a.constructor!==String)return a.constructor===Object&&(a=[a]),a}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=null,c=null,d=a._;a.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1,this.isMobile=!1},initialize:function(a){var d=a.resourceProvider,e=d.vidContId;this.resourceProvider=d,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=e,this.assetURL=a.assetURL,this.vidContentId=this.PREFIX_CONTENT+e,this.internalNS="."+e+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+e),this.deferLoadingCaptions=a.deferLoadingCaptions,this._updateVolumeSettings(a),d.createWatermark()&&!a.suppressWatermark&&(b=new uvpjs.Watermark({containerId:e,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),d.is360()&&!a.suppress360&&(c=new uvpjs.Kaleidoscope360({containerId:e,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==a.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){if(d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."));this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),b&&(b.destroy(),b=null),c&&(c.destroy(),c=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1},_updateVolumeSettings:function(a){var a=a||{},b=a.volume,c=!0===a.isMuted,d=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",a),uvpjs.util.inRange(b,0,1)&&d.volume!==b&&(d.volume=b),"isMuted"in a&&d.muted!==c&&this.muteVideo(c)},_addHTML5Events:function(){var a,b=this.eventTypes.HTML5,c=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events");for(a in b)"CLICK"!==a&&"TOUCH_END"!==a&&this.videoTagRef.addEventListener(b[a],this,!1);this.videoTagRef.addEventListener(b[c],this,!1)},_removeHTML5Events:function(){var a,b=this.eventTypes.HTML5,c=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events");for(a in b)"CLICK"!==a&&"TOUCH_END"!==a&&this.videoTagRef.removeEventListener(b[a],this,!1);this.videoTagRef.removeEventListener(b[c],this,!1)},handleEvent:function(a){var b=this.eventTypes.HTML5;if(this.videoTagRef)switch(a.type){case b.ABORT:break;case b.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(b.CAN_PLAY,this,!1);break;case b.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(b.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case b.CLICK:case b.DURATION_CHANGE:break;case b.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case b.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case b.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(a.target.error);break;case b.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case b.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case b.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case b.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case b.PLAY:break;case b.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case b.PROGRESS:this.videoLoading();break;case b.RATE_CHANGE:break;case b.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",a);break;case b.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",a),this.seeked(a.target.currentTime);break;case b.STALLED:case b.SUSPEND:break;case b.TIME_UPDATE:this.timeUpdated();break;case b.VOL_CHANGE:this.volumeChanged();break;case b.WAITING:}},seeked:function(a){var b=this.videoTagRef.paused,c=uvpjs.mediaCapabilities;this.playbackStateChange(b?c.PAUSED:c.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:a,paused:b,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:a})},videoLoading:function(){var a;try{a=this.videoTagRef.buffered.end(0)||0}catch(b){a=0}var b={bufferLength:a,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(b)},volumeChanged:function(){var a=this.videoTagRef.volume;!d.isNumber(a)||a<0?a=0:a>1&&(a=1),this.resourceProvider.facadeVolumeChange(a)},timeUpdated:function(){var a=this.videoTagRef.currentTime;"number"==typeof a&&this.resourceProvider.facadeTimeUpdate(a)},error:function(a){var b=uvpjs.ErrorInfo.messages,c=uvpjs.ErrorInfo.errorCodes,e=b.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,f=c.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,g=!0;if(a)switch(a.code){case a.MEDIA_ERR_ABORTED:g=!1,e=b.MEDIA_ERR_ABORTED,f=c.MEDIA_ERR_ABORTED;break;case a.MEDIA_ERR_NETWORK:e=b.MEDIA_ERR_NETWORK,f=c.MEDIA_ERR_NETWORK;break;case a.MEDIA_ERR_DECODE:e=b.MEDIA_ERR_DECODE,f=c.MEDIA_ERR_DECODE;break;case a.MEDIA_ERR_SRC_NOT_SUPPORTED:e=b.MEDIA_ERR_SRC_NOT_SUPPORTED,f=c.MEDIA_ERR_SRC_NOT_SUPPORTED}if(this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+e),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."));this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:f,message:e,isFatal:g}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var a;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(a=this.videoTagRef.play())&&a.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+a.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(a.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",a),isNaN(a)||this.videoTagRef&&a>=0&&a<this.videoTagRef.duration&&(this.videoTagRef.currentTime=a)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var a=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(a)&&a>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=a)}},toggleMute:function(){var a;this.videoTagRef&&(a=!this.videoTagRef.muted,this.muteVideo(a))},setFullscreenState:function(a){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(a){var b=!1!==a;this.videoTagRef&&(this.videoTagRef.muted=b,b&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!b&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(a){this.videoTagRef&&a>=0&&a<=1&&(this.videoTagRef.volume=a)},getDuration:function(){var a=0;return this.videoTagRef&&(a=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(a=this.videoTagRef.seekable.end(0)),a},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(a){(!this.isAbrStreamingSupported()||"boolean"!=typeof a)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(a,b,c){if(a.length>0){var d=a.length,e=a[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(b>=a[d-1][e])return d-1;for(;d--;){if(b>=a[d][e])return c?d+1:d}}return 0},addSessionIdAndTicketToURL:function(a,b,c){if(!a)return a;var d=function(a){return-1!==a.indexOf("?")?"&":"?"};return b&&-1===a.indexOf("SessionId=")&&(a+=d(a)+"SessionId="+b),c&&-1===a.indexOf("Ticket=")&&(a+=d(a)+"Ticket="+c),a},processResponseHeader:function(a,b){switch(b){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==a&&this.resourceProvider.setContentVideoStateCdn(a)}},getCdnNameAtStartup:function(a){return""},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(a,b){},getBuffered:function(){var a,b=this.videoTagRef,c=b&&b.buffered,d=0,e=0;return c&&c.length>0&&(d=c.start&&c.start(0),e=c.end&&c.end(0)),(a=e-d)>0&&a||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(a){if(this.videoTagRef){var b=this.videoTagRef.hasAttribute(this.CONTROLS);a&&!b?this.videoTagRef.setAttribute("controls",this.CONTROLS):!a&&b&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(a){if(a!==this.playbackState){if(this.playbackState=a,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+a),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(a)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var a=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!d.isUndefined(a),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,a=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",a),a},normalizeAudioTrackInfo:function(a,b){if(a){for(var c=[],d=0;d<a.length;d++){var e=a[d];this.checkCodecForWeb(e)&&c.push({index:d,id:e.id,type:e.type||e.kind,codec:e.codec||"n/a",label:b===uvpjs.mediaCapabilities.DASHJS?e.lang:e.label||e.name})}return c}},checkCodecForWeb:function(a){return!a.codec||-1!==a.codec.indexOf("mp4a")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b="www.nielsen.com";a.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(a){for(var b in a)this.initOptions[b]=a[b];a.suppress360=!0,a.suppressCreatedEvent=!0,this._super(a),this.swfService=a.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var a;for(a in this.windowLabels)window[this.windowLabels[a]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(a){this.player&&this.player.setVolume(a)},seekTo:function(a){this.player&&this.player.seekTo(a)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(a){this.swfService.resetSize()},loadCaptions:function(a){this.captionsUrl=uvpjs.util.isEmpty(a)?null:a,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(a)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(a){for(var b,c,d,e=Array.isArray(a)&&a.length||0,f=uvpjs.util,g=uvpjs.VPF_Flash.styleTransform;e--;)b=a[e],c=this.dashToCamel(b.name),d=g[c]?g[c](b.value):b.value,!f.isEmpty(b.value)&&this.player.setStyleAttribute(c,d)},setId3Options:function(a){this.id3Options=a},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(a){var b=!1===a?"false":"true";this.player.enableDynamicStreaming(b)},switchToBitrate:function(a){var b=this.findClosestBitrate(a);-1!==b.index&&this.player.switchStreamingIndex(b.index)},setMinBitrateAllowed:function(a){var b=this.findClosestBitrate(a);-1!==b.index&&(this.bitrateInfo.min=b.bitrate,this.player.setMinimumStreamingIndex(b.index))},setMaxBitrateAllowed:function(a){var b=this.findClosestBitrate(a);-1!==b.index&&(this.bitrateInfo.max=b.bitrate,this.player.setMaximumStreamingIndex(b.index))},switchUp:function(){var a=this.currFlashVideoState.playbackBitrate,b=this.findClosestBitrate(a),c=-1!==b.index&&this.bitrateInfo.bitrates.length;-1!==b.index&&b.index<c-1&&this.player.switchStreamingIndex(b.index+1)},switchDown:function(){var a=this.currFlashVideoState.playbackBitrate,b=this.findClosestBitrate(a);-1!==b.index&&b.index>0&&this.player.switchStreamingIndex(b.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var a=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return a?this.bitrateInfo.bitrates[a-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(a){for(var b,c=this.bitrateInfo.bitrates,d=c?c.length:0,e={bitrate:0,delta:1/0,index:-1};d--;)(b=Math.abs(a-c[d]))<e.delta&&(e.bitrate=c[d],e.index=d,e.delta=b);return e},hContentEvent:function(a){var b=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(a){case b.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case b.CONTENT_END:}},hPlaybackEvent:function(a,b){var c,d=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(a){case d.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+b);break;case d.VIDEO_PROGRESS:this.processCvioPayload(b);break;case d.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(b);break;case d.VIDEO_ERROR:this.processCvioPayload(b),this.dispatchError();break;case d.VIDEO_DONE:this.processCvioPayload(b),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case d.VIDEO_TRANSITION_COMPLETE:c=this.parsePayload(b),this.resourceProvider.facadeVideoTransitionComplete(c.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case d.VIDEO_TRANSITION_START:c=this.parsePayload(b),this.pendingSwitchMode=c.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(c.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(a){var b,c,d=this.parsePayload(a,"ContentVIO");if(d){c=d.ContentVIO;for(b in c)this.currFlashVideoState[b]=this.getCvioValue(c[b]);null===this.bitrateInfo.bitrates&&c.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var a=[],b=[],c=this.player.getContentBitrateInfo(),d="string"==typeof c&&c.split(","),e=Array.isArray(d)?d.length:0;e--;)a[e]=+d[e],b[e]={bitrate:+d[e]};this.bitrateInfo.bitrates=a,this.bitrateInfo.abrInfo=b},processCuepointPayload:function(a){var c=this.parsePayload(a,"Cuepoint"),d=this.id3Options,e={pts:null};!c||!d.dataCallback||c.text.indexOf("syncbak.cc")>=0||(e.name=d.findNielsen&&c.text.indexOf(b)>-1?b:c.name,e.data=c.text,d.dataCallback(e))},getCvioValue:function(a){var b,c,d,e,f;return"boolean"==typeof a||"number"==typeof a?a:"string"==typeof a?(b="NaN"===a||"null"===a||""===a,c=!b&&"true"===a.toLowerCase(),d=!b&&!c&&"false"===a.toLowerCase(),e=!b&&!c&&!d&&parseInt(a),f=isNaN(e)?a:e,b?-1:!!c||!d&&f):void 0},parsePayload:function(a,b){var c=null;if(0===a.indexOf("{")||0===a.indexOf("[")){try{c=JSON.parse(a)}catch(a){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+b+"as JSON; "+a.message),null}return c}return a},addUvpFlashEventListeners:function(){var a,b,c,d,e,f=uvpjs.VPF_Flash.uvpFlashEvent,g={},h=function(a,b,c){return a["h"+(b.charAt(0).toUpperCase()+b.substr(1))+"Event"].bind(a,c)};for(c in f){b=f[c];for(e in b)d=b[e],g[d]=h(this,c,d)}a=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(g);for(c in a)this.player.addEventJSCallback(c,a[c])},loadVideo:function(){var a={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(a.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,a)},initializeCaptionStyles:function(){var a,b={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(a in b)this.player.setStyleAttribute(a,b[a])},dashToCamel:function(a){return a.replace(/(-\w)/g,function(a){return a[1].toUpperCase()})}}),a.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},a.VPF_Flash.styleTransform={_opacity:function(a){return 100*+a},backgroundOpacity:function(a){return uvpjs.VPF_Flash.styleTransform._opacity(a)},fontOpacity:function(a){return uvpjs.VPF_Flash.styleTransform._opacity(a)},fontSize:function(a){var b=a.substr(0,a.indexOf("%")),c=.01*+b;return Math.round(14*c)}}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.hVideoEvent=this.onVideoEvent.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(a){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",a.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",a)),this._super(a),a.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:a.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(a.startTime)&&(this.startTime=Math.floor(a.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",a)},handleEvent:function(a){var b=this.eventTypes.HTML5;this.videoTagRef&&(this._super(a),a.type===b.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(a,b){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:a,message:b,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(a){console.log("Error caught at setSource: ",a)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onVideoEvent:function(a){a.type===this.eventTypes.HTML5.CAN_PLAY&&(this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.updateAudioTracksInfo())},switchAudioTrack:function(a){this.videoTagRef.audioTracks?(this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+a),this.videoTagRef.audioTracks[a].enabled=!0,this.updateAudioTracksInfo()):this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switching is not supported on this user agent")},updateAudioTracksInfo:function(){var a=this.normalizeAudioTrackInfo(this.videoTagRef.audioTracks,uvpjs.mediaCapabilities.HTML5);if(a){var b=this.getCurrentEnabledAudioTrackIndex(this.videoTagRef.audioTracks),c={tracks:a,track:a[b],index:b};this.resourceProvider.facadeSetAudioTrackInfo(c)}},getCurrentEnabledAudioTrackIndex:function(a){for(var b=a.length;b--;)if(a[b].enabled)return b;return b},onAddTextTrack:function(a){a.track&&"metadata"===a.track.kind&&(this.activeMetadataTrack=a.track),a.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(a){a&&a.target&&a.target.activeCues&&a.target.activeCues.length>=1&&("metadata"===a.target.kind?this.resourceProvider.facadeId3Data(a.target.activeCues):"captions"!==a.target.kind&&"subtitles"!==a.target.kind||(a.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},showCaptions:function(a){if(uvpjs.util.isDefinedString(a)){for(var b=this.videoTagRef.textTracks,c=!1,d=0,e=b.length;d<e;d++){var f=b[d];f.language===a?(c=!0,f.mode="hidden"):f.mode="disabled"}c||(uvpjs.log(this.DEBUG_ID,"Language string was supplied but nothing matched in the stream. Enabling the first track in the list as best effort",b,a),b[0].mode="hidden")}},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(a){if(b.isEmpty(this.resourceProvider)||b.isEmpty(this.resourceProvider.cviModel))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",a));var c=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",a,c)}})}(uvpjs.register("uvpjs")),function(a){a.VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"prod"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isHdStreamLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.levelDetails=null,this.isMobile=uvpjs.mediaCapabilities.isMobile(),this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onAudioEvent=this.onAudioEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy");for(var a=this.videoTagRef.textTracks,b=0;b<a.length;b++){var c=a[b];"captions"!==c.kind&&"subtitles"!==c.kind||(c.textTrack1&&(c.textTrack1=!1),c.textTrack2&&(c.textTrack2=!1))}this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null,this.levelDetails=null},initialize:function(a){return this._super(a),this.id3HandlingEnabled=a.enableId3Handling,"number"==typeof a.liveSyncDurationCount&&a.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=a.liveSyncDurationCount),!0===a.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=a.capLevelToPlayerSize),this.isMobile&&(this.libConfig.maxBufferLength=20,this.libConfig.maxMaxBufferLength=60,this.libConfig.liveBackBufferLength=30),uvpjs.util.isEmpty(a.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=a.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof a.startBitrate&&a.startBitrate>-1&&(this.startBitrate=a.startBitrate),"number"==typeof a.maxBitrate&&a.maxBitrate>-1&&(this.maxBitrate=a.maxBitrate),"number"==typeof a.minBitrate&&a.minBitrate>-1&&(this.minBitrate=a.minBitrate),a.startTime&&(this.startTime=Math.round(a.startTime)),a.errorRecovery&&this.setErrorRecoveryOverrides(a.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){this.player&&this._isHdStreamLive?this.seekTo(this.getLiveEdgeOffset()):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+isHDStreamLive)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(a){this._super(),this.player?this.player.nextLevel=a?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchAudioTrack:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+a),this.player.audioTrack=a},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(a){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,a,!1))},switchToIndex:function(a){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var b=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,c=isNaN(b)?this.bitrateList.length-1:b;a>=0&&a<=c?this.player.nextLevel=a:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",c," : Index=",a)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var a=this.player;return this.startBitrate||this.minBitrate||a&&a.levels&&a.levels[0]&&a.levels[0].bitrate||-1},setStartBitrate:function(a){this.player?(a<this.getMinBitrateAllowed()&&(a=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,a,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var a=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[a].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(a){if(this.player){this.player.config.minAutoBitrate=a-1;var b=this.getIndexForBitrate(this.bitrateList,a,!0);this.player.currentLevel<b&&(this.player.nextAutoLevel=b),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",a)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var a=this.player.maxAutoLevel;return void 0!==a?this.bitrateList[a].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(a){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===a?a:this.getIndexForBitrate(this.bitrateList,a,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",a)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var a=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(a=this.bitrateList[this.player.currentLevel].bitrate),a},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var a,b,c=this.player;if(c)return a=this.player.media,(b=a.getVideoPlaybackQuality)&&"function"==typeof b?b.call(a).droppedVideoFrames:a.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var a=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,b=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(b,a)},getFacadeState:function(){this.videoTagRef&&this.videoTagRef.textTracks.length>0&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var a={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(a.abrInfo=this.bitrateList,a.currentAbr=this.bitrateList[this.player.currentLevel],a.cappedAbrInfo=this.getCappedAbrInfo(),a.startBitrate=this.getStartBitrate(),a.currentBitrate=this.getCurrentBitrate(),a.minBitrate=this.getMinBitrateAllowed(),a.maxBitrate=this.getMaxBitrateAllowed()),a},getStreamType:function(){return"HLS"},isPlayingLive:function(){var a=!1;if(this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.currentTime>=0){var b=Math.floor(this.getLiveEdgeOffset());a=Math.ceil(this.videoTagRef.currentTime)>=b}return a},getLiveEdgeOffset:function(){var a=Number.POSITIVE_INFINITY;if(this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.duration>0)var a=this.videoTagRef.duration-this.player.config.liveSyncDurationCount*this.levelDetails.targetduration;return a},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var a=Hls.Events,b=this.onLibraryEvent,c=this.onLevelEvent,d=this.onAudioEvent,e=this.onFragmentEvent;this.player.on(a.MEDIA_ATTACHING,b,!1),this.player.on(a.MEDIA_ATTACHED,b,!1),this.player.on(a.MEDIA_DETACHING,b,!1),this.player.on(a.MANIFEST_PARSED,b,!1),this.player.on(a.MANIFEST_LOADED,b,!1),this.player.on(a.MANIFEST_LOADING,b,!1),this.player.on(a.FPS_DROP,b,!1),this.player.on(a.SUBTITLE_TRACKS_UPDATED,b,!1),this.player.on(a.LEVEL_SWITCHING,c,!1),this.player.on(a.LEVEL_SWITCHED,c,!1),this.player.on(a.LEVEL_LOADING,c,!1),this.player.on(a.LEVEL_LOADED,c,!1),this.player.on(a.LEVEL_UPDATED,c,!1),this.player.on(a.LEVEL_PTS_UPDATED,c,!1),this.player.on(a.AUDIO_TRACKS_UPDATED,d,!1),this.player.on(a.AUDIO_TRACK_SWITCHED,d,!1),this.player.on(a.FRAG_LOADING,e,!1),this.player.on(a.FRAG_LOAD_PROGRESS,e,!1),this.player.on(a.FRAG_LOADED,e,!1),this.player.on(a.FRAG_PARSED,e,!1),this.player.on(a.FRAG_BUFFERED,e,!1),this.player.on(a.FRAG_CHANGED,e,!1),this.player.on(a.FRAG_PARSING_DATA,e,!1),this.id3HandlingEnabled&&this.player.on(a.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(a.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var a=Hls.Events,b=this.onLibraryEvent,c=this.onLevelEvent,d=this.onAudioEvent,e=this.onFragmentEvent;this.player.off(a.MEDIA_ATTACHING,b),this.player.off(a.MEDIA_ATTACHED,b),this.player.off(a.MEDIA_DETACHING,b),this.player.off(a.MANIFEST_PARSED,b),this.player.off(a.MANIFEST_LOADED,b),this.player.off(a.MANIFEST_LOADING,b),this.player.off(a.FPS_DROP,b),this.player.off(a.SUBTITLE_TRACKS_UPDATED,b),this.player.off(a.LEVEL_SWITCHING,c),this.player.off(a.LEVEL_SWITCHED,c),this.player.off(a.LEVEL_LOADING,c),this.player.off(a.LEVEL_LOADED,c),this.player.off(a.LEVEL_UPDATED,c),this.player.off(a.LEVEL_PTS_UPDATED,c),this.player.off(a.AUDIO_TRACKS_UPDATED,d,!1),this.player.off(a.AUDIO_TRACK_SWITCHED,d,!1),this.player.off(a.FRAG_LOADING,e),this.player.off(a.FRAG_LOAD_PROGRESS,e),this.player.off(a.FRAG_LOADED,e),this.player.off(a.FRAG_PARSED,e),this.player.off(a.FRAG_BUFFERED,e),this.player.off(a.FRAG_CHANGED,e),this.player.off(a.FRAG_PARSING_DATA,e),this.id3HandlingEnabled&&this.player.off(a.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(a.ERROR,this.onError)},handleManifestData:function(a){this.bitrateList=this.player.levels;for(var b,c=a.levels,d=c.length,e=[];d--;)b=c[d],e.unshift({name:b.name||null,rate:b.bitrate,width:b.width,height:b.height});e.sort(function(a,b){var c=a.rate,d=b.rate;return c<d?-1:c>d?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:e})},onRequest:function(a,b){this.withCredentials=this.withCredentials||b.indexOf("akamaihd")>-1&&b.indexOf("csmil")>-1,a.withCredentials=this.withCredentials;var c=function(c){if(-1!==b.indexOf(".ts")&&a.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var d=a.getAllResponseHeaders();this.multiCDNEnabled=-1!==d.indexOf(this.responseHeaders.MULTI_CDN);var e=this.multiCDNEnabled?a.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(b);this.processResponseHeader(e,this.responseHeaders.MULTI_CDN)}};(this.multiCDNEnabled||-1!==b.indexOf(".m3u8"))&&a.addEventListener("readystatechange",c.bind(this))},onLibraryEvent:function(a,b){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,a,b);var c=Hls.Events;switch(a){case c.MEDIA_ATTACHING:case c.MEDIA_ATTACHED:case c.MEDIA_DETACHING:case c.MANIFEST_LOADING:break;case c.MANIFEST_PARSED:this.handleManifestData(b);break;case c.FPS_DROP:break;case c.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case c.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(a,b){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,a,b);var c=Hls.Events;switch(a){case c.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(b.details);break;case c.LEVEL_LOADING:break;case c.LEVEL_UPDATED:b.details&&(this.levelDetails=b.details,this._isHdStreamLive=b.details.live);break;case c.LEVEL_PTS_UPDATED:break;case c.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[b.level].bitrate);break;case c.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[b.level].bitrate)}},onAudioEvent:function(a,b){if(a===Hls.Events.AUDIO_TRACKS_UPDATED||a===Hls.Events.AUDIO_TRACK_SWITCHED){var c=this.normalizeAudioTrackInfo(this.player.audioTracks,this.mc.HLSJS),d={tracks:c,track:c[this.player.audioTrack],index:this.player.audioTrack};this.resourceProvider.facadeSetAudioTrackInfo(d),this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switched",d.track)}},onFragmentEvent:function(a,b){var c,d,e=Hls.Events;switch(a){case e.FRAG_LOAD_PROGRESS:break;case e.FRAG_PARSING_DATA:"video"===b.type&&(this._playbackFramerate=b.nb/(b.endPTS-b.startPTS));break;case e.FRAG_LOADED:d=b.frag.stats,c=8e3*d.loaded/Number(window.performance.now()-d.trequest),this._currentBandwidth=c,this._currentMaxBandwidth=Math.max(c,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case e.FRAG_CHANGED:}},onID3Event:function(a,b){this.resourceProvider.facadeId3Data(b.samples)},onError:function(a,b){var c=!1,d=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(b.fatal&&-1===d.indexOf(b.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,a,b.type,b.details,"isFatal: "+b.fatal),b.type){case Hls.ErrorTypes.NETWORK_ERROR:c=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts,c&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(c).network());break;case Hls.ErrorTypes.MEDIA_ERROR:c=this.tryRecoveryFromMediaError()}else b.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",b.type,b.details,"isFatal: "+b.fatal),c=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,a,b.type,b.details,"isFatal: "+b.fatal);c||(b.response&&b.response.code&&b.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,b.details,b.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(b.type,b.details,b.fatal)))},tryRecoveryFromMediaError:function(){var a=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return a&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(a).media()),a},getErrorMsg:function(a){var b=a?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,c=" attempt : ";return{network:function(){return c+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+b+c}.bind(this),media:function(){return c+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+b+c}.bind(this)}},getErrorInfoForType:function(a,b,c){var d=uvpjs.ErrorInfo,e=Hls.ErrorTypes,f=uvpjs.ErrorInfo.errorCodes;switch(a){case e.NETWORK_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_NETWORK_ERROR,message:d.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",b),isFatal:c});case e.MEDIA_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_MEDIA_ERROR,message:d.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",b),isFatal:c});case e.MUX_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_MUX_ERROR,message:d.messages.HLSJS_MUX_ERROR.replace("{INFO}",b),isFatal:c});case e.OTHER_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_OTHER_ERROR,message:d.messages.HLSJS_OTHER_ERROR.replace("{INFO}",b),isFatal:c});case f.RESOURCE_GEOBLOCKED:return new d({errorCode:f.RESOURCE_GEOBLOCKED,hlsjsErrorCode:f.HLSJS_OTHER_ERROR,message:d.messages.RESOURCE_GEOBLOCKED,isFatal:c})}},setErrorRecoveryOverrides:function(a){["network","media"].forEach(function(b){a[b]&&a[b].attempts&&"number"==typeof a[b].attempts&&(this.errorRecovery[b+"RetryAttempts"]=a[b].attempts)}.bind(this))}})}(uvpjs.register("uvpjs")),function(a){"use strict";function b(a){if(!isNaN(a))return a<1048576?(a/1024).toFixed(2)+"k":a<1073741824?(a/1048576).toFixed(2)+"M":(a/1073741824).toFixed(2)+"G"}a.Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(a){var b,c=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),a&&(b=a.videoEl,this._videoEl=b,this._containerEl=a.containerEl,this._eventsMgr=a.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":c.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),!this._diagEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window."));this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=a,this._createDiag(),this._addEventListeners()},_createDiag:function(){var a,b,c,d=uvpjs.util,e=this._styleEl,f=this._contentEl;this._template,this._params;f&&(a=document.createElement("div"),a.id=this._diagnosticId,f.insertBefore(a,f.firstChild),c=uvpjs.util.htmlToElement("<span>x</span>"),c.addEventListener("click",this._handleCloseButton.bind(this),!0),a.appendChild(c),b=document.createElement("table"),a.appendChild(b),d.addCSSObject(e,a,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),d.addCSSObject(e,a,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),d.addCSSObject(e,a,{color:"#fff"},"span:hover"),d.addCSSObject(e,a,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),d.addCSSObject(e,a,{background:"transparent"},"table td"),d.addCSSObject(e,a,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),d.addCSSObject(e,a,{width:"60px"},"table td:last-child"),this._diagEl=a,this._diagTableEl=b,this._hideDiagBtn=c)},_removeDiag:function(){var a=this._diagEl,b=this._hideDiagBtn;b&&b.removeEventListener("click",this._handleCloseButton.bind(this)),a&&a.remove()},_hideDiag:function(){var a=this._diagEl,b=this._eventsMgr;a&&(a.style.display="none"),b.dispatchEvent(b.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var a=this._diagEl;a&&(a.style.display="block")},_toggleDiag:function(){var a=this._diagEl;if(a)return"block"===a.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var a=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),a.dispatchEvent(a.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;this._containerEl;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners."));this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),b.addEventListener(c.VIDEO_PROGRESS+a,this._onVideoProgress.bind(this)),b.addEventListener(c.VIDEO_STATE_CHANGE+a,this._onVideoStateChange.bind(this)),b.addEventListener(c.VIDEO_TRANSITION_START+a,this._onVideoTransitionStart.bind(this)),b.addEventListener(c.VIDEO_TRANSITION_COMPLETE+a,this._onVideoTransitionComplete.bind(this))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;this._containerEl;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners."));b.removeEventListener(c.VIDEO_PROGRESS+a),b.removeEventListener(c.VIDEO_STATE_CHANGE+a),b.removeEventListener(c.VIDEO_TRANSITION_START+a),b.removeEventListener(c.VIDEO_TRANSITION_COMPLETE+a)},_updateTableHtml:function(){var a,b,c="",d=this._params;for(a in d)null!==(b=d[a])&&void 0!==b&&(c+="<tr><td>"+a+"</td><td>"+b+"</td></tr>");this._diagTableEl.innerHTML=c},_onVideoProgress:function(a){var c=a.payload,d=c.facadeState,e=this._params,f=d.minABRLevel,g=d.maxABRLevel;a.target===this._containerId&&(e["stream type"]=c.streamType,e.duration=c.duration,e["current time"]=c.currentTime.toFixed(2),e["buffer length"]=c.bufferLength.toFixed(2),e["total dropped frames"]=c.droppedFrames>=0&&c.droppedFrames||null,e["average dropped (fps)"]=c.averageDroppedFPS>=0&&c.averageDroppedFPS.toFixed(2)||null,e["playback framerate (fps)"]=c.playbackFramerate>=0&&c.playbackFramerate.toFixed(2)||null,e["current bandwidth (B/s)"]=c.currentBandwidth>=0&&b(c.currentBandwidth)||null,e["switching mode"]=c.switchingMode,e["current index bitrate (B/s)"]=b(d.currentAbr&&d.currentAbr.bitrate),e["start index bitrate (B/s)"]=b(d.startBitrate),void 0!==f&&void 0!==g&&(e["available indexes"]=f+" to "+g),this._updateTableHtml())},_onVideoStateChange:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(c["playback state"]=b.newState,this._updateTableHtml())},_onVideoTransitionStart:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",b),c["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",b),c["transition state"]="complete",this._updateTableHtml())}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(a){var b;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),a&&(b=a.videoEl,this._videoEl=b,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){if(!this._imgEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark."));this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null},_createImage:function(){var a;this._contentEl&&(a=document.createElement("img"),a.id=this._watermarkId,a.src=this.IMAGE,a.style.position="absolute",a.style.display="none",this._imgEl=a,this._contentEl.appendChild(a))},_removeImage:function(){var a=this._imgEl;a&&a.parentNode&&a.parentNode.removeChild(a)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var a=this._imgEl;a&&(a.style.display="none")},_showImage:function(){var a=this._imgEl;a&&(a.style.display="block")},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));b.addEventListener(c.AD_START+a,this._hideImage.bind(this)),b.addEventListener(c.CONTENT_START+a,this._showImage.bind(this)),b.addEventListener(c.CONTENT_END+a,this._hideImage.bind(this)),b.addEventListener(c.CONTAINER_RESIZE+a,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),b.addTimedEventCallback(b.HALF_SECOND,a,this._ensureImage.bind(this))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));b.removeEventListener(c.AD_START+a),b.removeEventListener(c.CONTENT_START+a),b.removeEventListener(c.CONTENT_END+a),b.removeEventListener(c.CONTAINER_RESIZE+a),b.removeTimedEventCallback(this.TIMER_INTERVAL,a),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(a){a.target===this._containerId&&this._setPosition()},_setPosition:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;b=this._contentEl,c=this._videoEl,(a=this._imgEl)&&c&&b&&(n=c.videoHeight,(o=c.videoWidth)&&n&&(f=this.OFFSET,j=this.SIZE,g=c.getBoundingClientRect(),p=b.getBoundingClientRect(),h=g.height,i=g.width,m=n/o,l=h/i,k=l/m,d=i*m,e=h/m,q=p.bottom-g.bottom,r=p.right-g.right,k>1?(s=(h-d)/2,t=0,v=i*j+"px",u="auto"):(s=0,t=(i-e)/2,v="auto",u=h*j*(this.RATIO/m)+"px"),a.style.width=v,a.style.height=u,a.style.bottom=s+q+f+"px",a.style.right=t+r+f+"px"))}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(a){var b;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),a&&(b=a.videoEl,this._videoEl=b,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){if(!this._360El||!this._kaleidoscopeViewer)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360."));this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null},_loadKaleidoscope:function(a){return"function"!=typeof a?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));b.addEventListener(c.CONTAINER_RESIZE+a,this._handleContainerResize.bind(this)),b.addEventListener(c.CONTENT_START+a,this._startKaleidoscopeRender.bind(this))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));b.removeEventListener(c.CONTAINER_RESIZE+a),b.removeEventListener(c.CONTENT_START+a)}})}(uvpjs.register("uvpjs")),function(a){a.ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(a,b,c){this.debug=uvpjs.debug,this.validationInfo=null,this.id=b,this.vidContId=c,this.rcoSeed={},this.initialize(a)},initialize:function(a){this.validationInfo=this.validateUserRco(a),this.validationInfo&&(this.rcoSeed=a,this.populateSelf(a))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},has:function(a){return!uvpjs.util.isEmpty(this[a])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(a){return{error:!1,message:""}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=this._super(a),c=uvpjs.util.isDefinedString(a.assetURL);return{error:b.error||!c,message:b.error?b.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(a){a.DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(a,b,c)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(a){this.cmsRefGuid=a,this.daiParams.daiVideoId=a},canMakePlatformCall:function(a){var b=uvpjs.util.isDefinedString(a),c=this.has("selectorCall")&&this.selectorCall||b&&a;return!!c&&(c.indexOf("$PID$")>-1?this.has("pid"):!(c.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var a=this.daiParams.dfpMediaId,b=this.daiParams.daiVideoId,c=a||b||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return a||b||c},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(a){var b=window.google&&google.ima&&google.ima.dai,c=this.validateDaiConfig(a),d=this._super(a),e=(a.useSsb||b)&&c&&!d.error,f=b?c?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!e,missingSDK:!b,message:d.error?d.message:f}},populateSelf:function(a){var b,c;for(b in a)c=a.hasOwnProperty(b),c&&void 0!==this.daiParams[b]?this.daiParams[b]=a[b]:c&&(this[b]=a[b]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(a){var b=uvpjs.util,c=!b.isEmpty(a.adTagParameters),d=!b.isEmpty(a.contentSourceId),e=!b.isEmpty(a.assetKey);return a.useSsb||e||c&&d?a.useSsb?!b.isEmpty(a.assetURL):e||c&&d:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),c&&d)},checkCustomAdTagParams:function(){var a,b=uvpjs.util,c=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;c&&"string"!=typeof c&&b.isPlainObject(c)&&(a=b.queryStrFromObj(c),this.daiParams.adTagParameters.cust_params=encodeURIComponent(a))}})}(uvpjs.register("uvpjs")),function(a){a.RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=window.google&&google.ima,c=this._super(a);return{error:!(b&&!c.error),missingSDK:!b,message:c.error?c.message:"IMA SDK is missing."}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=this._super(a);return{error:b.error||!uvpjs.util.isDefinedString(a.assetURL),message:b.err?b.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=uvpjs.util,c=b.isDefinedString(a.pid),d=!c&&b.isDefinedString(a.cmsRefGuid)&&!b.isDefinedString(a.assetURL),e=this._super(a);return{error:!(!e.error&&(c||d||b.isDefinedString(a.selectorCall))),message:e.error?e.message:"Supplied RCO is not valid for type rp_platform"}}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.UvpSwfService=uvpjs.Class.subClass({init:function(a){this.debugId=a.debugId,this.debug=uvpjs.debug,this.containerId=a.containerId,this.dom=a.contentVideoDom,this.playerDom=a.playerDom,this.callback=a.readyCallback,this.id3OwnerIds=a.id3OwnerIds||"",this.capLevelToPlayerSize=a.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var a;this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype;for(a in this.windowLabels)window[this.windowLabels[a]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var a=this.getContainerSize(),b=a.width,c=a.height;this.swf&&this.swf.setSize(b,c,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=-1!==navigator.appName.indexOf("Microsoft")?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(a){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(a){if(!a.success)return void this.callback(null,this.svcC.error.EMBED_FAILED);this.startTimer()},embed:function(a){var b=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,a,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:b.jsReady,playerReady:b.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var a,b,c=this.dom;if(!this.svcC.hasFlash())return void this.callback(null,this.svcC.error.FLASH_NOT_DETECTED);this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),a=document.createElement("div"),a.id=this.swfName,b=c.querySelector("video"),b.style.display="none",c.style.height="100%",this.playerDom.style.height="100%",c.insertBefore(a,b),this.embed(a)}}),a.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},a.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},a.UvpSwfService.hasFlash=function(){var a=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(a)&&parseInt(a)>0},a.UvpSwfService.setWindowMethods=function(a){var b,c,d,e="f_",f=uvpjs.util;for(b in a)c=a[b],d=e+f.uid8(),window[d]=c,a[b]=d;return a},a.UvpSwfService.swfobject=function(){function a(){if(!T&&document.getElementsByTagName("body")[0]){try{var a,b=r("span");b.style.display="none",a=M.getElementsByTagName("body")[0].appendChild(b),a.parentNode.removeChild(a),a=null,b=null}catch(a){return}T=!0;for(var c=P.length,d=0;d<c;d++)P[d]()}}function b(a){T?a():P[P.length]=a}function c(a){if(typeof L.addEventListener!=E)L.addEventListener("load",a,!1);else if(typeof M.addEventListener!=E)M.addEventListener("load",a,!1);else if(typeof L.attachEvent!=E)t(L,"onload",a);else if("function"==typeof L.onload){var b=L.onload;L.onload=function(){b(),a()}}else L.onload=a}function d(){var a=M.getElementsByTagName("body")[0],b=r(F);b.setAttribute("style","visibility: hidden;"),b.setAttribute("type",I);var c=a.appendChild(b);if(c){var d=0;!function f(){if(typeof c.GetVariable!=E)try{var g=c.GetVariable("$version");g&&(g=g.split(" ")[1].split(","),X.pv=[s(g[0]),s(g[1]),s(g[2])])}catch(a){X.pv=[8,0,0]}else if(d<10)return d++,void setTimeout(f,10);a.removeChild(b),c=null,e()}()}else e()}function e(){var a=Q.length;if(a>0)for(var b=0;b<a;b++){var c=Q[b].id,d=Q[b].callbackFn,e={success:!1,id:c};if(X.pv[0]>0){var j=q(c);if(j)if(!u(Q[b].swfVersion)||X.wk&&X.wk<312)if(Q[b].expressInstall&&g()){var k={};k.data=Q[b].expressInstall,k.width=j.getAttribute("width")||"0",k.height=j.getAttribute("height")||"0",j.getAttribute("class")&&(k.styleclass=j.getAttribute("class")),j.getAttribute("align")&&(k.align=j.getAttribute("align"));for(var l={},m=j.getElementsByTagName("param"),n=m.length,o=0;o<n;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));h(k,l,c,d)}else i(j),d&&d(e);else w(c,!0),d&&(e.success=!0,e.ref=f(c),e.id=c,d(e))}else if(w(c,!0),d){var p=f(c);p&&typeof p.SetVariable!=E&&(e.success=!0,e.ref=p,e.id=p.id),d(e)}}}function f(a){var b=null,c=q(a);return c&&"OBJECT"===c.nodeName.toUpperCase()&&(b=typeof c.SetVariable!==E?c:c.getElementsByTagName(F)[0]||c),b}function g(){return!U&&u("6.0.65")&&(X.win||X.mac)&&!(X.wk&&X.wk<312)}function h(a,b,c,d){var e=q(c);if(c=p(c),U=!0,A=d||null,B={success:!1,id:c},e){"OBJECT"==e.nodeName.toUpperCase()?(y=j(e),z=null):(y=e,z=c),a.id=J,(typeof a.width==E||!/%$/.test(a.width)&&s(a.width)<310)&&(a.width="310"),(typeof a.height==E||!/%$/.test(a.height)&&s(a.height)<137)&&(a.height="137");var f=X.ie?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURIComponent(L.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+f+"&MMdoctitle="+encodeURIComponent(M.title.slice(0,47)+" - Flash Player Installation");if(typeof b.flashvars!=E?b.flashvars+="&"+g:b.flashvars=g,X.ie&&4!=e.readyState){var h=r("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",n(e)}l(a,b,c)}}function i(a){if(X.ie&&4!=a.readyState){a.style.display="none";var b=r("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(j(a),b),n(a)}else a.parentNode.replaceChild(j(a),a)}function j(a){var b=r("div");if(X.win&&X.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(F)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;f<e;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function k(a,b){var c=r("div");return c.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+a+"'>"+b+"</object>",c.firstChild}function l(a,b,c){var d,e=q(c);if(c=p(c),X.wk&&X.wk<312)return d;if(e){var f,g,h,i=r(X.ie?"div":F);typeof a.id==E&&(a.id=c);for(h in b)b.hasOwnProperty(h)&&"movie"!==h.toLowerCase()&&m(i,h,b[h]);X.ie&&(i=k(a.data,i.innerHTML));for(f in a)a.hasOwnProperty(f)&&(g=f.toLowerCase(),"styleclass"===g?i.setAttribute("class",a[f]):"classid"!==g&&"data"!==g&&i.setAttribute(f,a[f]));X.ie?R[R.length]=a.id:(i.setAttribute("type",I),i.setAttribute("data",a.data)),e.parentNode.replaceChild(i,e),d=i}return d}function m(a,b,c){var d=r("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=q(a);b&&"OBJECT"==b.nodeName.toUpperCase()&&(X.ie?(b.style.display="none",function a(){if(4==b.readyState){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}else setTimeout(a,10)}()):b.parentNode.removeChild(b))}function o(a){return a&&a.nodeType&&1===a.nodeType}function p(a){return o(a)?a.id:a}function q(a){if(o(a))return a;var b=null;try{b=M.getElementById(a)}catch(a){}return b}function r(a){return M.createElement(a)}function s(a){return parseInt(a,10)}function t(a,b,c){a.attachEvent(b,c),S[S.length]=[a,b,c]}function u(a){a+="";var b=X.pv,c=a.split(".");return c[0]=s(c[0]),c[1]=s(c[1])||0,c[2]=s(c[2])||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]}function v(a,b,c,d){var e=M.getElementsByTagName("head")[0];if(e){var f="string"==typeof c?c:"screen";if(d&&(C=null,D=null),!C||D!=f){var g=r("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),C=e.appendChild(g),X.ie&&typeof M.styleSheets!=E&&M.styleSheets.length>0&&(C=M.styleSheets[M.styleSheets.length-1]),D=f}C&&(typeof C.addRule!=E?C.addRule(a,b):typeof M.createTextNode!=E&&C.appendChild(M.createTextNode(a+" {"+b+"}")))}}function w(a,b){if(V){var c=b?"visible":"hidden",d=q(a);T&&d?d.style.visibility=c:"string"==typeof a&&v("#"+a,"visibility:"+c)}}function x(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=E?encodeURIComponent(a):a}var y,z,A,B,C,D,E="undefined",F="object",G="Shockwave Flash",H="ShockwaveFlash.ShockwaveFlash",I="application/x-shockwave-flash",J="SWFObjectExprInst",K="onreadystatechange",L=window,M=document,N=navigator,O=!1,P=[],Q=[],R=[],S=[],T=!1,U=!1,V=!0,W=!1,X=function(){var a=typeof M.getElementById!=E&&typeof M.getElementsByTagName!=E&&typeof M.createElement!=E,b=N.userAgent.toLowerCase(),c=N.platform.toLowerCase(),d=/win/.test(c?c:b),e=/mac/.test(c?c:b),f=!!/webkit/.test(b)&&parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),g="Microsoft Internet Explorer"===N.appName,h=[0,0,0],i=null;if(typeof N.plugins!=E&&typeof N.plugins[G]==F)(i=N.plugins[G].description)&&typeof N.mimeTypes!=E&&N.mimeTypes[I]&&N.mimeTypes[I].enabledPlugin&&(O=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=s(i.replace(/^(.*)\..*$/,"$1")),h[1]=s(i.replace(/^.*\.(.*)\s.*$/,"$1")),h[2]=/[a-zA-Z]/.test(i)?s(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof L.ActiveXObject!=E)try{var j=new ActiveXObject(H);j&&(i=j.GetVariable("$version"))&&(g=!0,i=i.split(" ")[1].split(","),h=[s(i[0]),s(i[1]),s(i[2])])}catch(a){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();!function(){X.w3&&((typeof M.readyState!=E&&("complete"===M.readyState||"interactive"===M.readyState)||typeof M.readyState==E&&(M.getElementsByTagName("body")[0]||M.body))&&a(),T||(typeof M.addEventListener!=E&&M.addEventListener("DOMContentLoaded",a,!1),X.ie&&(M.attachEvent(K,function b(){"complete"==M.readyState&&(M.detachEvent(K,b),a())}),L==top&&function b(){if(!T){try{M.documentElement.doScroll("left")}catch(a){return void setTimeout(b,0)}a()}}()),X.wk&&function b(){if(!T)return/loaded|complete/.test(M.readyState)?void a():void setTimeout(b,0)}()))}();P[0]=function(){O?d():e()};!function(){X.ie&&window.attachEvent("onunload",function(){for(var a=S.length,b=0;b<a;b++)S[b][0].detachEvent(S[b][1],S[b][2]);for(var c=R.length,d=0;d<c;d++)n(R[d]);for(var e in X)X[e]=null;X=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}();return{registerObject:function(a,b,c,d){if(X.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,Q[Q.length]=e,w(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(X.w3)return f(a)},embedSWF:function(a,c,d,e,f,i,j,k,m,n){var o=p(c),q={success:!1,id:o};X.w3&&!(X.wk&&X.wk<312)&&a&&c&&d&&e&&f?(w(o,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===F)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var r={};if(k&&typeof k===F)for(var s in k)r[s]=k[s];if(j&&typeof j===F)for(var t in j)if(j.hasOwnProperty(t)){var v=W?encodeURIComponent(t):t,x=W?encodeURIComponent(j[t]):j[t];typeof r.flashvars!=E?r.flashvars+="&"+v+"="+x:r.flashvars=v+"="+x}if(u(f)){var y=l(b,r,c);b.id==o&&w(o,!0),q.success=!0,q.ref=y,q.id=y.id}else{if(i&&g())return b.data=i,void h(b,r,c,n);w(o,!0)}n&&n(q)})):n&&n(q)},switchOffAutoHideShow:function(){V=!1},enableUriEncoding:function(a){W=typeof a===E||a},ua:X,getFlashPlayerVersion:function(){return{major:X.pv[0],minor:X.pv[1],release:X.pv[2]}},hasFlashPlayerVersion:u,createSWF:function(a,b,c){return X.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){X.w3&&g()&&h(a,b,c,d)},removeSWF:function(a){X.w3&&n(a)},createCSS:function(a,b,c,d){X.w3&&v(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=M.location.search||M.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return x(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return x(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var a=q(J);a&&y&&(a.parentNode.replaceChild(y,a),z&&(w(z,!0),X.ie&&(y.style.display="block")),A&&A(B)),U=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(a){var b=a._;a.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this.vidContId="",this.containers=a.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=a.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=a.p2pClient,this.multiCdnClient=a.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(a.rco,a.cviMgr,a.vidContId)},initialize:function(a,c,d){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",a),this.rco=a,this.vidContId=d,this.cviMgr=c,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",e=this.cviModel.contentVideoState,e.sendResumeEvent=!1,e.startTime=0,e.elapsedTime=0,e.showPreroll=!0,e.playedChapterTime=0,e.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({cviModel:this.cviModel,eventsManager:this.eventsMgr}),b.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var a=this.eventsMgr;this._removeTimers(),a.addTimedEventCallback(a.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),a.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(a){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(a)},_removeTimers:function(){var a=this.eventsMgr;a.removeTimedEventCallback(a.TENTH_SECOND,this.internalNS),a.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var a=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(a)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(a){var b=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),b.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),b.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),b.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=a,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(a){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,a)})):this.finishLoadVideoAndBeginPlayback(a),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(a,b,c){var d,e=uvpjs.ErrorInfo;if(c)return d=new e({errorCode:e.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+c,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:d},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,a),2)},handleCdnDecision:function(a,b){this.setNewAssetUrlAndCdn(b),this.doFlashCheck(a)},shouldUseFlash:function(){var a=this.mc.systemInfo,b=this.cviModel.getSessionOption("preventFlashPlayback"),c=a.supportsNativeHls||a.isHlsjsEligible,d=!b&&a.isDesktop&&uvpjs.UvpSwfService.hasFlash(),e=this.mc.isHlsUrl(this._getAssetUrl()),f=uvpjs.Configuration.env;return!("local"!==f&&"dev"!==f&&"stage"!==f||!window.forceFlash||!d)||e&&!c&&d},prepForCaptionEvents:function(){for(var a=this.eventsMgr.eventTypes,b=[a.CONTROL_HIDE_CAPTIONS,a.CONTROL_SHOW_CAPTIONS,a.CAPTIONS_READY,a.SET_CAPTIONS_LANG],c=b.length;c--;)this.eventsMgr.addEventListener(b[c]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var a=this.eventsMgr.eventTypes,b=[a.CONTROL_HIDE_CAPTIONS,a.CONTROL_SHOW_CAPTIONS,a.CAPTIONS_READY,a.SET_CAPTIONS_LANG],c=b.length;c--;)this.eventsMgr.removeEventListener(b[c]+this.internalNS)},hCaptionEventForUvp:function(a){var b=this.eventsMgr.eventTypes;if(this._hasFacade()&&a.target===this.vidContId)switch(a.type){case b.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case b.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions(a.payload.language);break;case b.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions();break;case b.SET_CAPTIONS_LANG:uvpjs.util.isFunction(this.facade.setCaptionLanguage)&&this.facade.setCaptionLanguage(a.payload.language)}},finishLoadVideoAndBeginPlayback:function(a){var b,c=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),c.incrementMedNum(),this.createFacade(),b=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(b),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),b===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(a){var b,c,d,e=a&&a.providers||null,f=e&&e[0]?e[0]:null,g=f&&f.host||null,h=f&&f.provider||null;g&&(b=this._getAssetUrl(),c=uvpjs.util.parseUrl(b),g!==c.host&&(d=c.protocol+"//"+g+c.pathname+c.search,this.cviModel.contentVideoState.assetURL=d)),h&&this.setContentVideoStateCdn(h)},setContentVideoStateCdn:function(a){this.cviModel.contentVideoState.cdn=a,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:a},this.vidContId)},getContentVideoStateCdn:function(a){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var a=function(a){var b=c.getSessionOption(a);return"boolean"==typeof b?b:void 0!==c.getVideoPlaybackCDOProperty(a)&&c.getVideoPlaybackCDOProperty(a)},b=function(a){var b=c.getSessionOption(a);return"number"==typeof b&&b>=0?b:void 0!==c.getVideoPlaybackCDOProperty(a)?Number(c.getVideoPlaybackCDOProperty(a)):-1},c=this.cviModel,d=b(c.START_BITRATE),e=b(c.MIN_BITRATE),f=b(c.MAX_BITRATE),g=b(c.LIVE_SYNC_DURATION_COUNT),h=a(c.CAP_LEVEL_TO_PLAYER_SIZE),i=a(c.DASHJS_FAST_SWITCH_ABR),j=c.getSessionOption("useDynamicSwitching"),k=c.getSessionOption("errorRecovery"),l=Number(this.rco.startBitrate)||-1,m=Number(this.rco.minBitrate)||-1,n=Number(this.rco.maxBitrate)||-1,o=Number(this.rco.liveSyncDurationCount)||-1,p=this.rco.capLevelToPlayerSize,q=this.rco.enableDashJSFastSwitchABR,r=this.rco.useDynamicSwitching,r=this.rco.useDynamicSwitching,s=this.rco.errorRecovery;l>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",l),c.setStartBitrate(l)):c.setStartBitrate(d),m>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",m),c.setMinBitrate(m)):c.setMinBitrate(e),n>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",n),c.setMaxBitrate(n)):c.setMaxBitrate(f),o>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",o),c.setLiveSyncDurationCount(o)):c.setLiveSyncDurationCount(g),"boolean"==typeof p?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",p),c.setCapLevelToPlayerSize(p)):c.setCapLevelToPlayerSize(h),"boolean"==typeof q?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",q),c.setDashJSFastSwitchABR(q)):c.setDashJSFastSwitchABR(i),"boolean"==typeof r?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",r),c.setUseDynamicSwitching(r)):c.setUseDynamicSwitching(j),"object"==typeof s?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",s),c.setErrorRecovery(s)):c.setErrorRecovery(k)},createId3Parser:function(a){this.id3EventQueue=[];var b={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(a){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(b);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(b);break;case this.mc.FLASH_HLS:b.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(b)}},handleId3Metadata:function(a){this.id3EventQueue&&this.id3EventQueue.push(a)},checkId3Events:function(a){for(var b,c=this.id3EventQueue,d=c&&c.length||0;d--;)b=c[d],a>=b.pts&&(this.dispatchCuepointEvent(b),this.id3EventQueue.splice(d,1))},dispatchCuepointEvent:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,a,this.vidContId)},createFacade:function(){var a=this.cviModel,b=a.getContentVideoState(),c=this._getAssetUrl(),d={enableId3Handling:this.id3HandlingEnabled,assetURL:c,isMuted:a.isMuted,resourceProvider:this,startTime:b.startTime,startBitrate:a.startBitrate,maxBitrate:a.maxBitrate,minBitrate:a.minBitrate,useDynamicSwitching:a.useDynamicSwitching,liveSyncDurationCount:a.liveSyncDurationCount,volume:a.volume,capLevelToPlayerSize:a.capLevelToPlayerSize,enableDashJSFastSwitchABR:a.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:a.errorRecovery,drm:b.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",d),this.facade=this.getFacade(c),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(d.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(d.swfService=this.uvpSwfService);var e=this.facade.initialize(d);!e||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:e,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(a.nativeControls)},destroyFacade:function(){var a=this._hasFacade()&&"function"==typeof this.facade.destroy;if(this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up."));this.facade.destroy(),this.facade={}},muteContentForAdPlay:function(a){var b=this.cviModel,c=this.facade;this._hasFacade()&&(!1!==a?c.muteVideo():b.isMuted||c.unMuteVideo())},getModule:function(a){return this.cviModel.getModule(a)},getModuleParam:function(a,b){return this.cviModel.getModuleParam(a,b)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var a=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:a},this.vidContId)},dispatchContentEnd:function(){var a=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:a},this.vidContId)},dispatchSeekDone:function(){var a=this.eventsMgr;a.dispatchEvent(a.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var a=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,b=a?"Fatal ERROR encountered":"";this.eventsMgr&&(this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+b),!a&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId))},dispatchVideoStateChange:function(a){isNaN(a)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:a,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+a,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(a){a&&a.abrInfo&&this.cviModel.setAbrInfo(a.abrInfo)},facadeProgress:function(a){!uvpjs.util.isEmpty(a)&&"object"==typeof a&&a.currentTime&&a.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:a.currentTime}),this.setModelDuration(parseInt(a.duration)))},facadeDurationChanged:function(a){uvpjs.util.isEmpty(a)||"object"!=typeof a||a.duration},setModelDuration:function(a){a>0&&this.cviModel.contentVideoState.duration!==a&&(this.cviModel.setContentVideoStateItems({duration:a}),this.cviModel.setContentPlaybackStateItems({duration:a}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",a),!this._seekFromTime)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE."));this._seekToTime=a.seekToTime,this.dispatchSeekDone()},facadeError:function(a){var b,c,d,e,f=uvpjs.util,g=this.RPM&&this.RPM.currRP,h=this.eventsMgr,i=this.cviModel,j=!f.isEmpty(i),k=a.isFatal;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+a.message),j&&k&&(b=this.cviModel.getContentVideoState(),c=b.playbackStarted,d=f.isDefinedString(b.overrideAssetURL),!c&&d&&!this._overrideAssetUrlFailure))return void this._handleOverrideAssetURLError(a);if(j||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),f.isEmpty(h)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(e=a.eventType||h.eventTypes.VIDEO_PLAYBACK_ERROR,a.eventType=e,h.dispatchEvent(e,{errorInfo:a},this.vidContId)),k){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),j&&(i.contentPlaybackState.fatalError=!0),g&&g.rco&&g.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void g.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+a),this.dispatchVideoStateChange(a)},facadeVideoLevelLoaded:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:a},this.vidContId)},facadeVideoTransitionStart:function(a,b){var c=b||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+a+" mode = "+c),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:a,mode:c},this.vidContId)},facadeVideoTransitionComplete:function(a,b){var c=b||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+a+" mode = "+c),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:a,mode:c},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeSetAudioTrackInfo:function(a){this.cviModel.setAudioTrackInfo(a)},facadeId3Data:function(a){this.id3Parser&&this.id3Parser.parse(a)},facadeMinimumBitrateAllowedChanged:function(a){this.cviModel.setMinBitrate(a)},facadeMaximumBitrateAllowedChanged:function(a){this.cviModel.setMaxBitrate(a)},getFacade:function(a){var b,c=this.mc.STREAMING,a=a||this._getAssetUrl(),d=this.mc.isHlsUrl(a),e=this.mc.isDashUrl(a),f=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(f||d||e)&&this._setDeliveryType(c),!f&&d)this.mc.canPlayHLSJS()&&(b=new uvpjs.VPF_HLSJS);else if(!f&&e)if(uvpjs.VPF_DASHJS)b=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));b=new uvpjs.VPF_SHAKA}else f&&(b=new uvpjs.VPF_Flash);return b||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS,d=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",d),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,a.addEventListener(b.CONTROL_SEEK+c,this.onVideoSeekTo.bind(this)),a.addEventListener(b.CONTROL_SEEK_TO_LIVE_POINT+c,this.onVideoSeekToLive.bind(this)),a.addEventListener(b.CONTROL_PAUSE+c,this.onPauseVideo.bind(this)),a.addEventListener(b.CONTROL_PLAY+c,this.onPlayVideo.bind(this)),a.addEventListener(b.CONTROL_MUTE+c,this.onMuteVideo.bind(this)),a.addEventListener(b.CONTROL_UNMUTE+c,this.onUnMuteVideo.bind(this)),a.addEventListener(b.CONTROL_VOLUME_SET+c,this.onChangeVideoVolume.bind(this)),a.addEventListener(b.CONTROL_FULLSCREEN+c,this.onFullscreen.bind(this)),a.addEventListener(b.SWITCH_REQUEST+c,this.onSwitchRequest.bind(this)),a.addEventListener(b.USE_DYNAMIC_SWITCHING+c,this.onUseDynamicSwitching.bind(this)),a.addEventListener(b.MAXIMUM_BITRATE_ALLOWED+c,this.onMaximumBitrateAllowed.bind(this)),a.addEventListener(b.MINIMUM_BITRATE_ALLOWED+c,this.onMinimumBitrateAllowed.bind(this)),a.addEventListener(b.CONTAINER_RESIZE+c,this.handleContainerResize.bind(this)),a.addEventListener(b.SWITCH_AUDIO_TRACK+c,this.onSwitchAudioTrack.bind(this)))},_removeUVPEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS,d=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",d),a.removeEventListener(b.CONTROL_SEEK+c),a.removeEventListener(b.CONTROL_SEEK_TO_LIVE_POINT+c),a.removeEventListener(b.CONTROL_PAUSE+c),a.removeEventListener(b.CONTROL_PLAY+c),a.removeEventListener(b.CONTROL_MUTE+c),a.removeEventListener(b.CONTROL_UNMUTE+c),a.removeEventListener(b.CONTROL_VOLUME_SET+c),a.removeEventListener(b.SWITCH_REQUEST+c),a.removeEventListener(b.USE_DYNAMIC_SWITCHING+c),a.removeEventListener(b.MAXIMUM_BITRATE_ALLOWED+c),a.removeEventListener(b.MINIMUM_BITRATE_ALLOWED+c),a.removeEventListener(b.CONTROL_SHOW_CAPTIONS+c),a.removeEventListener(b.CONTROL_HIDE_CAPTIONS+c),a.removeEventListener(b.CAPTIONS_READY+c),a.removeEventListener(b.CONTAINER_RESIZE+c),a.removeEventListener(b.SWITCH_AUDIO_TRACK+c)},_getAssetUrl:function(a){var b=uvpjs.util,c=a||this.cviModel.getContentVideoState(),d=c.overrideAssetURL,e=b.isDefinedString(d)&&!this._overrideAssetUrlFailure,f=e?d:c.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+e+")",f),f},_setDeliveryType:function(a){this.cviModel.setContentVideoStateItems({deliveryType:a})},_handleOverrideAssetURLError:function(a){var b=uvpjs.ErrorInfo,c=this.eventsMgr,d=c.eventTypes.VIDEO_START_ERROR,e=b.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,e+" Error using overrideAssetURL; will use assetURL."),a.eventType=d,a.message=e,a.isFatal=!1,a.errorCode=b.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,c.dispatchEvent(d,{errorInfo:a},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.bitrate,e=this.cviModel,f=this.facade;if(b===this.vidContId&&d&&this._hasFacade())switch(typeof d){case"string":if("up"===d)e.setUseDynamicSwitching(!1),f.switchUp();else if("down"===d)e.setUseDynamicSwitching(!1),f.switchDown();else{if(d=Number(d),isNaN(d))return;e.setUseDynamicSwitching(!1),f.switchToBitrate(d)}break;case"number":e.setUseDynamicSwitching(!1),f.switchToBitrate(d);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",d)}},onSwitchAudioTrack:function(a){uvpjs.util.isFunction(this.facade.switchAudioTrack)&&this.facade.switchAudioTrack(a.payload.id)},onUseDynamicSwitching:function(a){if(a&&a.target===this.vidContId&&a.payload){var b=a.payload.data;this.cviModel.setUseDynamicSwitching(b),this._hasFacade()&&(this.facade.useDynamicSwitching(b),b&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",b)}},onMinimumBitrateAllowed:function(a){var b=a.payload,c=b&&b.bitrate,d=this.facade;if(a.target===this.vidContId){if(!c||"number"!=typeof c)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+c,typeof c));this.cviModel.setMinBitrate(c),this._hasFacade()&&d.setMinBitrateAllowed(c)}},onMaximumBitrateAllowed:function(a){var b=a.payload,c=b&&b.bitrate,d=this.facade;if(a.target===this.vidContId){if(!c||"number"!=typeof c)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+c,typeof c));this.cviModel.setMaxBitrate(c),this._hasFacade()&&d.setMaxBitrateAllowed(c)}},onVideoSeekTo:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.seekTime,e=this.cviModel.contentVideoState.duration,f=this.cviModel.contentPlaybackState.currentTime,g=this.facade;if("number"==typeof d&&b===this.vidContId){if(d<0||d>e)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+d));this._seekFromTime=this._seekFromTime||f,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:d,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&g.seekTo(d)}},onVideoSeekToLive:function(){var a=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&a.seekToLive()},facadeVolumeChange:function(a){!b.isNaN(a)&&b.isNumber(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:a},this.vidContId)},facadeLoading:function(a){var b={data:a};a&&(a.bufferLength||a.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,b,this.vidContId)},facadeTimeUpdate:function(a){this.cviModel.setContentPlaybackStateItems({currentTime:a})},onFullscreen:function(a){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(a.payload.isFs)},onPauseVideo:function(a){var b=a&&a.target,c=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",b),b===this.vidContId&&this._hasFacade()&&c.pauseVideo()},onPlayVideo:function(a){var b=a&&a.target,c=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",b),b===this.vidContId&&this._hasFacade()&&c.playVideo()},onChangeVideoVolume:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.vol,e=uvpjs.util.inRange(d,0,1),f=this.cviModel.isMuted,g=this.facade;b===this.vidContId&&e&&!f&&this._hasFacade()&&g.setVolume(d)},onMuteVideo:function(a){var b=a&&a.target,c=this.facade;b===this.vidContId&&this._hasFacade()&&c.muteVideo()},onUnMuteVideo:function(a){var b=a&&a.target,c=this.facade;b===this.vidContId&&this._hasFacade()&&c.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var a={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),a=this.cviModel.getContentVideoState(),!b.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:a},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var c=this.getVideoProgressPayload();this.setModelDuration(c.duration),this.id3HandlingEnabled&&this.checkId3Events(c.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,c,this.vidContId)}},checkBuffering:function(a){var b,c=this.cviModel?this.cviModel.contentPlaybackState:null;c&&c.playbackStarted&&c.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(b=a||c.currentTime||0,!this.bufferingDetected&&b<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&b>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=b)},getVideoProgressPayload:function(){var a=(this.cviModel.getCurrentVideoState(),this.facade.getDuration()),b={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:a,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(b),b},setFacadeStateOnProgressPayload:function(a){var b=this.facade,c=this._hasFacade()&&b.getFacadeState();if(!c)return a;a.facadeState=c,a.averageDroppedFPS=b.getAverageDroppedFPS(),a.bufferLength=b.getBuffered()||0,a.currentTime=b.getCurrentTime()||0,a.currentBandwidth=b.getCurrentBandwidth(),a.currentMaxBandwidth=b.getCurrentMaxBandwidth(),a.droppedFrames=b.getDroppedFramesCount(),a.playbackFramerate=b.getPlaybackFramerate(),a.playbackState=b.getPlaybackState(),a.streamType=b.getStreamType(),a.isHDStreamLive=b.isHDStreamLive(),a.isPlayingLive=b.isPlayingLive(),a.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var a=this.cviModel.contentVideoState,b=localStorage.getItem("UVPJS.resumePid")||null,c=localStorage.getItem("UVPJS.resumeContentTime")||null,d=localStorage.getItem("UVPJS.resumeEpochTime")||null,e=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(b&&(a.resumePid=b),c&&(a.resumeContentTime=c),d&&(a.resumeEpochTime=d),e&&(a.resumeSessionId=e))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var a=this.cviModel;a&&(a.resetAdVideoState(),a.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(a){var b=a._,c={DOUBLECLICK_IMA:"pubads.g.doubleclick.net",DOUBLECLICK:"ad.doubleclick.net",PHP:"request.php",JSP:"Request.jsp"};a.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(a){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=a||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.cviModel=this.opts.cviModel,this.eventsMgr=this.opts.eventsManager,this.cviModel.contentVideoStateDefaults&&this.populateDefaults(this.cviModel.contentVideoStateDefaults),this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(a){var b;for(b in a)this.opts[b]=a[b]},getModel:function(){return this.mdl},getProperty:function(a){return this.mdl[a]},setProperty:function(a,b){this.mdl[a]=b},loadData:function(a,b){var c,d="callback=uvpHandleJsonpResult",e=b||this.opts.queryParams,f=!1,g=!uvpjs.util.isEmpty(e);if(this.opts.url=a,this.opts.queryParams=b,g){a+=a.indexOf("?")<0?"?":"&";for(c in e)a+=(f?"&":"")+c+"="+e[c],f=!0}a.indexOf(d)<0&&(a+=(a.indexOf("?")<0?"?":"&")+d),this.selectorCall=a,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var a=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),a.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(a){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(a)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(a){var b,c,d,e,f,g,h,i,j,k=a.getElementsByTagName("ref"),l=null,m=k[0],n=!1,o=this.mdl,p=m&&this.checkForPlatformError(m);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",a),p&&p.error)return p;if(b=a.getElementsByTagName("switch"),c=b[0]?b[0].getElementsByTagName("video"):a.getElementsByTagName("video"),null===c[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(o.chapterTimesString="",m)for(d=0,e=k.length;d<e;d++)f=k[d],h=f.attributes.src.nodeValue,this.isAdCallURL(h)?(!n&&(o.imaAdCall=h),n=!0):l||(l=f,o.assetURL=l.getAttribute("src"),i=f.getElementsByTagName("param")),null!==f.getAttribute("clipEnd")&&(o.chapterTimesString+=f.getAttribute("clipEnd")+",");for(d=0,e=c.length;d<e&&(g=c[d],h=g.attributes.src.nodeValue,l||(l=g,o.assetURL=l.getAttribute("src"),i=g.getElementsByTagName("param"),null!==g.getAttribute("clipEnd")));d++)null!==g.getAttribute("clipEnd")&&(o.chapterTimesString+=g.getAttribute("clipEnd")+",");return j=i&&this.extractParams(i)||{},this.populateModelFromContentNodeAndParams(l,j),{error:!1}},populateModelFromContentNodeAndParams:function(a,b){var c,d,e=this.mdl,f=uvpjs.mediaCapabilities,g={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},h={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},i="true";for(q in g)e[q]=a.getAttribute(g[q])||"";for(q in h)e[q]=b[h[q]]||"";e.mediaId=this.getMediaId(b),e.duration=this.getDuration(a),e.sourceOwner=this.getSourceOwner(b),e.cmsRefGuid=a.getAttribute("guid")||a.getAttribute("vid")||"",e.isEmbedable=b.Embeddable===i,e.isLive=b.IsLive===i,e.episodeFlag=b.EpisodeFlag===i,e.useWatermark=b.WatermarkPlayback===i,e.chapterTimesString.length>0?(c=e.chapterTimesString,d=c.length-1,c.lastIndexOf(",")===d&&(e.chapterTimesString=c.substring(0,d)),e.chapterStartTimes=this.convertChapterTimesToSeconds(e.chapterTimesString)):e.chapterStartTimes=[],e.assetURL.indexOf(f.M3U)>-1?(e.cdn="",e.fileType=f.M3U):e.assetURL.indexOf(f.MP3)>-1?e.fileType=f.MP3:e.fileType=f.MP4;var j=this.cviModel.getVideoPlaybackCDOProperty("matchPageUrlProtocol")||!1;j&&(e.assetURL=e.assetURL.replace(/^\w*:/,"")),this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy mdl",e,j)},handleData:function(a){var b=a.responseText,c=uvpjs.util,d=b.substring(b.indexOf("{"),b.lastIndexOf("}")+1),e=this.isValidJsonStr(d)&&JSON.parse(d)||null,f=c.isEmpty(e)?null:e.metafile,g=f&&new DOMParser,h=g&&g.parseFromString(f,"application/xml"),i=h&&this.parseSmilXML(h);if(this.callAttempts=0,i){if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+i.errorInfo.message),void this.signalError(i.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(a){return"string"==typeof a&&("{"===a.charAt(0)&&"}"===a.charAt(a.length-1)||"["===a.charAt(0)&&"]"===a.charAt(a.length-1))},handleError:function(a){var b,c="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(a.status);this.debug&&uvpjs.error(this.DEBUG_ID,c,this.selectorCall),this.shouldRetryCall(a)?(b=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+b,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),b)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:c+" URL: "+this.selectorCall,isFatal:!0,serverCode:a.status})))},shouldRetryCall:function(a){var b=a.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==b&&404!==b&&403!==b&&0!==b},defineProperties:function(){},checkForPlatformError:function(a){var b=a&&this.parseSmilRefNodeForException(a);return b?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(b),serverCode:b.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(a){var b=a.responseCode||"n/a",c="; PID: "+(this.opts.pid||"n/a")+"; ",d=this.opts&&this.opts.cmsRefGuid+"; "||"",e=a.abstract?a.abstract+" ":"";return"Platform Error; code: "+b+c+d+(a.exception||"Resource Unavailable.")+" "+e},populateDefaults:function(a){!uvpjs.util.isEmpty(a)&&b.assign(this.mdl,a)},parseSmilRefNodeForException:function(a){var b,c=a.getElementsByTagName("param"),d={};if(c&&c.length){for(b=c.length;b--;)d[c[b].getAttribute("name")]=c[b].getAttribute("value");if("true"===d.isException)return d.abstract=a.getAttribute("abstract")||"",d}return null},extractParams:function(a){var b,c,d,e,f={};if(uvpjs.util.isEmpty(a))return f;for(e=a.length;e--;)b=a[e],c=b.getAttribute("name"),d=b.getAttribute("value"),c&&d&&(f[c]=d);return f},isAdCallURL:function(a){return a.indexOf(c.DOUBLECLICK)>-1||a.indexOf(c.DOUBLECLICK_IMA)>-1||a.indexOf(c.PHP)>-1||a.indexOf(c.JSP)>-1},getMediaId:function(a){var b,c,d,e="",f=a.trackingData;if(uvpjs.util.isEmpty(f))return"";for(b=f.split("|"),c=0,d=b.length;c<d;c++)b[c].indexOf("cid=")>-1&&(e=b[c].split("=")[1]);return e},getSourceOwner:function(a){var b=a.Source;return uvpjs.util.isEmpty(b)&&"true"===a.WatermarkPlayback?"Entertainment":b||""},getDuration:function(a){var b=parseInt(a.getAttribute("dur"))||0;return b>0?.001*b:b},convertChapterTimesToSeconds:function(a){for(var b=[],c=a.split(","),d=c.length,e=function(a){var b=parseInt;switch(a=c[d].split(":"),a.length){case 1:return b(a[0]);case 2:return 60*b(a[0])+b(a[1]);case 3:return 3600*b(a[0])+60*b(a[1])+b(a[2])}};d--;)b.unshift(e(c[d]));return b}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(a,b,c){this._super(a,b,c)},loadData:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),!b.isFunction(a)||!b.isFunction(c))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS);this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=a,this.dataLoadErrorCB=c,this.dataLoadedCB()},loadVideoAndBeginPlayback:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(a)}})}(uvpjs.register("uvpjs")),function(a){a.RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(a){this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(a,b){var c=this.getSelectorCall(),d=c.url||null,e=null;if(c.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+c.message),void("function"==typeof b&&b(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+c.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=a,uvpjs.util.isDefinedString(this.rco.sig)&&(e={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:b}),this.contentDataProxy.loadData(d,e)},loadVideoAndBeginPlayback:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(a)},getSelectorCall:function(){var a,b,c,d,e,f,g,h,i,j=this.rco,k=j.has("selectorCall")&&j.selectorCall||null;if(!k){if(k=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"),d=k&&k.indexOf("$PID$")>-1,e=k&&k.indexOf("$GUID$")>-1,a=j.has("pid")&&j.pid||null,b=j.has("cmsRefGuid")&&j.cmsRefGuid||null,f=!d&&!e,c=!a&&!b,f||c)return h="Config error: "+(f?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(d?"pid":"cmsRefGuid")),{error:!0,message:h};g=d?a:b,i=d?/\$PID\$/g:/\$GUID\$/g,k=k.replace(i,g),k=k.replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:k}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var a=uvpjs.util;a.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),a.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var a,b,c,d,e,f,g,h,i=this.cviModel.contentVideoState,j=this.contentDataProxy,k=this.rco,l=function(){var a=j.getProperty("duration");return!uvpjs.util.isEmpty(k.globalResumeTime)&&k.globalResumeTime>0&&a>0&&a-k.globalResumeTime>20};this.populateContentVideoStateFromLocalStorage(),b=Date.now()-+i.resumeEpochTime,j.setProperty("resumePid",i.resumePid),j.setProperty("resumeEpochTime",+i.resumeEpochTime),j.setProperty("resumeSessionId",i.resumeSessionId),j.setProperty("resumeContentTime",+i.resumeContentTime),j.setProperty("playedChapterTime",+i.playedChapterTime),j.setProperty("showPreroll",i.showPreroll),j.setProperty("sendResumeEvent",!1),j.getProperty("episodeFlag")&&!0!==i.isLive&&(c=l(),e=!c&&k.pid===i.resumePid,c||e?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),d=c?k.globalResumeTime:+i.resumeContentTime||0,a=c?0:b||0,h=!c&&b>this.ONE_HOUR_MS,g=c?this.cviModel.sessionId:"",f=this.getPlayedChapterTimeForContentResume(d),j.setProperty("sendResumeEvent",!0),j.setProperty("startTime",d),j.setProperty("elapsedTime",a),j.setProperty("showPreroll",h),j.setProperty("playedChapterTime",f),j.setProperty("previousSessionId",g),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(e?"local":"global")+"Resume"],startTime:d},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(a){var b,c=0,d=this.contentDataProxy.getProperty("chapterStartTimes"),e=d.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",d),e)for(;e--;)if(b=d[e],a>=b){a-b>=4?c=b:(this.contentDataProxy.setProperty("startTime",a-4),e>0&&(c=d[e-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",c),c}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(a,b,c){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",c),this._super(a,b,c)},loadData:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),!b.isFunction(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS);this.dataLoadedCB=a,this.dataLoadErrorCB=c,this.dataLoadedCB()}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_BITRATE_THRESHOLD:2500,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(a){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(a,b,c){var d,e;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",a),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",c)),this.playbackState=this.mc.EMPTY,this.vidContId=c,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=a,this.isContentScenario=!1,this._super(a,b,c),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(d=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(d.eventType,{errorInfo:d},c)):(e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=e.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(a,b){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:a();break;case this.PLATFORM:this._super(a,b);break;case this.CONTENT_AND_AD_CALL:a()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(a){var b=this.rco,c=this.cviModel,d=uvpjs.util.isDefinedString(b.adCall)?b.adCall:null,e=this.imaScenario===this.PLATFORM,f=d||(e?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(c.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(f)):(c.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),c.setContentVideoStateItems(b),c.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,f)):this.doFlashCheck(f))},finishLoadVideoAndBeginPlayback:function(a){var b="",c=uvpjs.adUtil,d=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,d.incrementMedNum(),this.isContentScenario=!0),a?(b=c.populateImaAdCallValues(a,d,this.isContentScenario),this.viewGuid=c.getDwViewGuid(d),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",b)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(b)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(a){b.isString(a)&&!b.isEmpty(a)?this._requestAdsManager(a):this._onContentResumeRequested()},setImaAdUrl:function(){var a=this.checkForAdCallOverride();a?(this.contentDataProxy.setProperty("imaAdCall",a),this.imaAdCall=a):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var a=this.cviModel.getModule(this.AD_SETTINGS),c=null!=a&&1==a.enabled,d=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),e=null;return c&&!b.isUndefined(d)&&(e=d),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(e||"null")),e},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var a,b="",c=this.contentDataProxy,d=c.getProperty("chapterStartTimes");return c.getProperty("showPreroll")||(b="1"),d.length>0&&(a=d.indexOf(c.getProperty("playedChapterTime")))>=0&&(a+=2,b=b.length>0?b+","+String(a):String(a)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",b),b},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(a){var b=a&&a.id,c=this.trueXInteractionIds;switch(b){case c.CLOSED_BEFORE_CREDIT:case c.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case c.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case c.OPT_OUT:case c.TIME_OUT:this.resetTrueXStatus();break;case c.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(a){var b=this.getAdPodInfo(a),c=b.podIndex,d=0===c?"pre":-1===c?"post":"mid_"+c;if(this.currAdPod=this.APM.getAdPodById(d),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(a)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var e=this.currAdPod;return e.adCount=b.totalAds,e.podDuration=b.maxDuration,e.isBumper=b.isBumper,e.imaPodIndex=b.podIndex,e.timeOffset=b.timeOffset,e.totalAds=b.totalAds,e.imaAdPostion=b.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",c,this.currAdPod),!0},getAdPodInfo:function(a,b){var c=a.getAdPodInfo(),d=b||{};return d.adPosition=c.getAdPosition(),d.isBumper=c.getIsBumper(),d.maxDuration=c.getMaxDuration(),d.podIndex=c.getPodIndex(),d.timeOffset=c.getTimeOffset(),d.totalAds=c.getTotalAds(),d},assembleAdInfo:function(a){return{adId:a.getAdId(),adPodInfo:this.getAdPodInfo(a),adSystem:a.getAdSystem(),advertiserName:a.getAdvertiserName(),apiFramework:a.getApiFramework(),contentType:a.getContentType(),creativeAdId:a.getCreativeAdId(),creativeId:a.getCreativeId(),dealId:a.getDealId(),description:a.getDescription(),duration:a.getDuration(),height:a.getHeight(),mediaUrl:a.getMediaUrl(),minSuggestedDuration:a.getMinSuggestedDuration(),skipTimeOffset:a.getSkipTimeOffset(),surveyUrl:a.getSurveyUrl(),title:a.getTitle(),traffickingParams:a.getTraffickingParameters(),traffickingParametersString:a.getTraffickingParametersString(),uiElements:a.getUiElements(),universalAdIdRegistry:a.getUniversalAdIdRegistry(),universalAdIdValue:a.getUniversalAdIdValue(),vastMediaHeight:a.getVastMediaHeight(),vastMediaWidth:a.getVastMediaWidth(),vastMediaBitrate:a.getVastMediaBitrate(),width:a.getWidth(),wrapperAdIds:a.getWrapperAdIds(),wrapperAdSystems:a.getWrapperAdSystems(),wrapperCreativeIds:a.getWrapperCreativeIds(),isLinear:a.isLinear()}},onAdEvent:function(a){var c,d=a.getAdData(),e=a.getAd(),f=google.ima.AdEvent.Type;if(a.type===f.INTERACTION)return void this.processInteractionEvent(d);if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(a.type),a.type){case f.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",e),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(a)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(e))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(e,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(a)}),this._dispatchAdLoaded(this.assembleAdInfo(e));break;case f.STARTED:var g,h,i=e.getContentType();this.ad=e,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=e.getDuration(),this._populateAdVideoState(e,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(a)}),this.cviModel.mergeCDOData(),"application/javascript"!==i&&"application/x-shockwave-flash"!==i||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===i&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(e),this.trackAdEvent(f.STARTED),g=e.getAdPodInfo(),g&&(h=g.getTotalAds()),this._dispatchAdStart(h),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case f.AD_BUFFERING:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.AD_BUFFERING"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BUFFERING,{},this.vidContId);break;case f.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case f.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case f.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case f.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case f.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||b.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case f.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),c=this.cviModel.getAdVideoState(),c.paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:c},this.vidContId);break;case f.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case f.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case f.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case f.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,c=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:c,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case f.LOG:var j,k=d&&d.adError,l=(uvpjs.ErrorInfo,null===e);this.eventsMgr.eventTypes.AD_ERROR;!k&&l?(j=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof j&&j()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(k,e,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),l&&!k&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;case f.VOLUME_CHANGED:this._dispatchAdVolumeChange();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",f))}},_populateAdVideoState:function(a,c){var d,e;if(!b.isObject(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN"));if(e=uvpjs.adUtil.extractAdStateData(a,uvpjs.adUtil.context.IMA),c)for(d in c)e[d]=c[d];this.cviModel.setAdVideoState(e),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())},_requestAdsManager:function(a){var b=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",a),this.adStartEventReceived=!1,this.adCallUrl=a,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var c=new google.ima.AdsRequest;c.adTagUrl=a,this._updateAdSize(),c.linearAdSlotWidth=this.containerWidth,c.linearAdSlotHeight=this.containerHeight,c.nonLinearAdSlotWidth=this.containerWidth,c.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof c.setAdWillAutoPlay&&(c.setAdWillAutoPlay(b.isAutoplay),c.setAdWillPlayMuted(b.isMuteAtPlayStart&&!b.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(c)},onAdsManagerLoaded:function(a){var c,d,e,f=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,g=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",a),this._dispatchAdResponse(),g.isEmpty(this.RPM)||g.isEmpty(this.RPM.currRP)||g.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var h=this.renderSettings;h.bitrate=this.getAdPlaybackBitrate(),h.restoreCustomPlaybackStateOnAdBreakComplete=!1,h.enablePreloading=!1,h.loadVideoTimeout=this._returnIMATimeout(),c=this.adsManager=a.getAdsManager(f,h),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",c.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",c.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",c.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(d=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",d)),this.imaCuePoints=this.adsManager.getCuePoints(),b.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,d,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",d),this.APM.initialize(this.vidContId,d,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,e),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},getAdPlaybackBitrate:function(){var a=this.cviModel.contentPlaybackState.facadeState.currentBitrate,b=900;return!uvpjs.util.isEmpty(a)&&a>0&&(b=Math.min(a/1e3,this.AD_BITRATE_THRESHOLD)),b},startAds:function(){var a,b,c=null,d=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(e){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),b=uvpjs.ErrorInfo,a=b.messages.NO_AD_CONTENT,e&&"function"==typeof e.getMessage&&(a+=": "+e.getMessage(),c=e.getErrorCode(),d=e.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new b({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:b.errorCodes.IMA_AD_ERROR,message:a,imaErrorCode:c,imaVastErrorCode:d,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var a,c=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),b.isEmpty(this.facade)||(c=this.cviModel.contentVideoState.isLive,a=this.imaUsesContentVideoTag(),!a&&this.facade.hideVideo(),c&&!a?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),a&&(this.savedSeekToTime=c?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!b.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),!b.isEmpty(this.APM)&&this.APM.isPostRoll(this.currAdPod))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN"));if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),b.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!b.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}},facadePlaybackStateChange:function(a){this.seekPending&&a===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(a)},_updateIMAPlaybackState:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",a),a!==this.playbackState&&(this.playbackState=a,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(a){var b=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:a||1,adData:b,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(a){var b;this.uvpjsAdStartOpened&&(b=this.cviModel.getAdVideoState(),b.skipped=!0===a,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:b,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(a){var b="function"==typeof a.getAdData?a.getAdData():{},c="function"==typeof a.getAd?a.getAd():{};return("function"==typeof c.getMediaUrl?c.getMediaUrl():b.mediaUrl)||null},_dispatchAdLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:a},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},_dispatchAdVolumeChange:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdVolumeChange dispatch AD_VOLUME_CHANGE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_VOLUME_CHANGE,{volume:this.adsManager.getVolume()},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(a,b){var c,d,e;a&&(this.containerWidth=a),b&&(this.containerHeight=b),this.mc.isChromecast()||(c=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),d=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),c===this.containerWidth&&d===this.containerHeight||(this.containerWidth=c,this.containerHeight=d,this.adsManager&&(e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,e))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var a=this.adsManager.getRemainingTime();this._checkForStuckAd(a)?this.adsManager.discardAdBreak():(this.currImaAdTime=Math.floor(this.duration-a),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime}))}},_checkForStuckAd:function(a){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=a,!1;var b=this.previousRemainingTime-a;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+b),0===b?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var c="Ad playback stuck for "+this.stuckIntervals+" intervals.",d=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:c,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,c,d),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:d,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=a,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(a){var b=a&&a.getAd&&a.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(a.getError(),b),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(a){this.dispatchAdErrorEvent(a.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(a){return uvpjs.adUtil.extractAdInfo(a,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(a,b,c){var d,e,f,g=null,h=null,i=null,j="Unknown",k=uvpjs.ErrorInfo,l=uvpjs.util,m=l.isFunction,n="n/a",o=" Unspecified IMA ad error.";a&&m(a.getMessage)&&(g=a.getMessage(),h=a.getErrorCode()||"n/a",i=a.getVastErrorCode()||"n/a",j=" imaErrorCode: "+h+"; vastErrorCode: "+i,g+=j),a&&m(a.getInnerError)&&(d=a.getInnerError())&&(!g&&(g=""),e=m(d.getMessage)?d.getMessage():d.message||n,f=m(d.getErrorCode)?d.getErrorCode():n,g+=" Inner error: "+e+"; inner error code: "+f),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+g),c&&(g=c+" "+g),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new k({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:k.errorCodes.IMA_AD_ERROR,message:k.messages.IMA_AD_ERROR_EVENT_RECEIVED+(g||o),isFatal:!1,imaErrorCode:h,imaVastErrorCode:i,adInfo:this.extractAdInfo(b)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),b.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var a=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(a)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(a){var b;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",a),null!==this.adsManager)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call"));this.dynamicMidRollPodCount++,b=uvpjs.adUtil.populateImaAdCallValues(a,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=b,this._requestAdsManager(b)},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(a)))},onPlayVideo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(a)))},onVideoSeekTo:function(a){var c,d,e,f=this.cviModel.contentPlaybackState.currentTime;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",a),a.target!==this.vidContId||b.isEmpty(this.facade)||!this.canSeek(a&&a.payload)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):b.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(a)):(c=a.payload.seekTime,this._seekFromTime=f,d=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(c):c,e=this.APM.returnPrecedingUnplayedAdPod(d),void(b.isEmpty(e)||e.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(a)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",e.startTime),this.savedSeekToTime=d,e.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=e.startTime)))},canSeek:function(a){return void 0!==a.seekTime&&null!==a.seekTime&&a.seekTime>=0&&a.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(a){return a},onChangeVideoVolume:function(a){b.has(a,"target")&&a.target===this.vidContId&&!this.cviModel.isMuted&&a.payload.vol>=0&&a.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(a.payload.vol):this._super(a))},onMuteVideo:function(a){b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(a)))},onUnMuteVideo:function(a){b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(a)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var a,b=this.adsManager,c=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),a=this.onAdEvent,b.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),b.addEventListener(c.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),b.addEventListener(c.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),b.addEventListener(c.LOADED,a),b.addEventListener(c.STARTED,a),b.addEventListener(c.AD_BUFFERING,a),b.addEventListener(c.FIRST_QUARTILE,a),b.addEventListener(c.MIDPOINT,a),b.addEventListener(c.THIRD_QUARTILE,a),b.addEventListener(c.COMPLETE,a),b.addEventListener(c.ALL_ADS_COMPLETED,a),b.addEventListener(c.CLICK,a),b.addEventListener(c.PAUSED,a),b.addEventListener(c.RESUMED,a),b.addEventListener(c.USER_CLOSE,a),b.addEventListener(c.SKIPPED,a),b.addEventListener(c.LOG,a),b.addEventListener(c.VOLUME_CHANGED,a),b.addEventListener(c.VOLUME_MUTED,a),b.addEventListener(c.INTERACTION,a)},_removeAdsManagerEventListeners:function(){var a=this.onAdEvent,b=this.adsManager,c=google.ima.AdEvent.Type;b&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),b.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),b.removeEventListener(c.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),b.removeEventListener(c.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),b.removeEventListener(c.LOADED,a),b.removeEventListener(c.STARTED,a),b.removeEventListener(c.AD_BUFFERING,a),b.removeEventListener(c.FIRST_QUARTILE,a),b.removeEventListener(c.MIDPOINT,a),b.removeEventListener(c.THIRD_QUARTILE,a),b.removeEventListener(c.COMPLETE,a),b.removeEventListener(c.ALL_ADS_COMPLETED,a),b.removeEventListener(c.CLICK,a),b.removeEventListener(c.PAUSED,a),b.removeEventListener(c.RESUMED,a),b.removeEventListener(c.USER_CLOSE,a),b.removeEventListener(c.SKIPPED,a),b.removeEventListener(c.LOG,a),b.removeEventListener(c.VOLUME_CHANGED,a),b.removeEventListener(c.VOLUME_MUTED,a))},onUVPJSTimerTick:function(){var a,b,c,d,e,f=uvpjs.util,g=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,h=!f.isEmpty(this.adsManager),i=!f.isEmpty(this.facade);if(h){var j=this.getAdPlaybackBitrate();j!==this.renderSettings.bitrate&&(this.renderSettings.bitrate=j,this.adsManager.updateAdsRenderingSettings(this.renderSettings))}if(g&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:i?(a=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=a):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return d=h&&g&&(this.cviModel.sessionOptions.adBlockerCallback||null),b=d&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),e=d&&(c=(new Date).getTime())&&(this.lastAdBlockCheckTime<c||b),e&&(this.lastAdBlockCheckTime=c+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&i&&this.checkId3Events(a),this.playbackState===this.mc.PLAYING){var k=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,k,this.vidContId)}},_checkForCloseToMidrollPod:function(a){var b,c,d,e=this.APM.getMidRollPods();if(a<=0)return!1;for(b=e.length;b--;)if(d=e[b],(c=d.startTime-a)>0&&c<1&&!d.hasPlayed&&!d.hasBeenChecked)return d.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(a){var b=uvpjs.util,c=this._getAssetUrl(a),d=b.isDefinedString(a.pid),e=b.isDefinedString(a.cmsRefGuid),f=b.isDefinedString(a.selectorCall),g=b.isDefinedString(a.assetURL);return d||e&&!g||f?this.PLATFORM:b.isDefinedString(c)?this.CONTENT_AND_AD_CALL:b.isDefinedString(a.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var a=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return a&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),a},_checkForContentPreload:function(){var a=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,b=this.adsManager.isCustomPlaybackUsed(),c=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!b;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&a&&this.duration>5&&c&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var a=-1,b=this.cviModel.getModule(this.AD_SETTINGS),c=b&&b.enabled,d=c&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return d&&(a=parseInt(d),a=a>0?1e3*a:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+a),a},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(a){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:a,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c=(a._,["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"]),d=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];a.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(a){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this.pendingSeekTime=null,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(a,c,d){var e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+d),f=e.getElementsByTagName("video")[0];!b&&(b=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new b.StreamManager(f),this.adClickElement=this.createAdClickElement(f),this.streamManager.setClickElement(this.adClickElement),this._super(a,c,d),this.resetAdStates(),this.contentVideoDiv=e,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(a,b){var c=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(c)?this._super(a,b):(this.dataLoadedCB=a,this.onDataProxyComplete())},onDataProxyComplete:function(){var a=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(a)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(a),this._super()},loadVideoAndBeginPlayback:function(a){var b,c=this.rco,d=this.cviModel,e=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===a,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),d.setNonDefaultContentVideoStateItems(e),d.setContentVideoStateItems(c),d.mergeCDOData(),this.killDataProxy(),!(b=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.cviMgr.setPlaybackInfoOnModel(),this.requestStream(b)},requestStream:function(a){var c=!uvpjs.util.isEmpty(a.assetKey),d=c?b.LiveStreamRequest:b.VODStreamRequest,e=new d;e.apiKey=a.apiKey||null,e.adTagParameters=a.adTagParameters,c?(e.assetKey=a.assetKey,e.attemptPreroll=!0,this.isLiveStream=!0,this.id3HandlingEnabled=!0):(e.contentSourceId=a.contentSourceId,e.videoId=a.videoId),this.streamManager.requestStream(e)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(a){var b=a.getStreamData().url;if(!uvpjs.util.isDefinedString(b))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=b,this.cviModel.contentVideoState.isLive=this.isLiveStream,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(a){this.daiStreamId=a.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(a){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(a){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null,this.pendingSeekTime&&(this._hasFacade()&&this.facade.seekTo(this.pendingSeekTime),this.pendingSeekTime=null)},hCuePointsChanged:function(a){this.currAdPod=this.getNewPod(a.getStreamData().cuepoints)},hAdStarted:function(a){var b=a.getAd();this.resetAdStates(),!this.currAdPod&&this.isLiveStream&&(this.currAdPod={played:!0}),this.updateAdModel(b),this.currAd=b,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.trackAdEvent(a.type),this.dispatchAdPodStart()),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(a){var c,d,e,f=a.type,g=b.StreamEvent.Type,h=null;switch(f){case g.FIRST_QUARTILE:h=25;break;case g.MIDPOINT:h=50;break;case g.THIRD_QUARTILE:h=75;break;case g.AD_PROGRESS:c=a.getStreamData(),d=c&&c.adProgressData,e=d&&this.createAdProgressPayload(d),e&&this.dispatchVideoProgress(e)}h&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=h,this.dispatchAdQuartile(h))},hStreamError:function(a){var b=a.getStreamData(),c=b&&b.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+c,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,c||"Unknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(a){},hStreamEvent:function(a){this.isAdPlaying()&&this.trackAdEvent(a.type),this[this.hMap[a.type]](a)},onVideoSeekTo:function(a){var b,c=a&&a.target,d=a&&a.payload,e=d&&d.seekTime,f=this.facade,g=this._hasFacade(),h=f.getDuration(),i=this.facade.getCurrentTime();if("number"==typeof e&&c===this.vidContId){if((e=this.streamManager.streamTimeForContentTime(e))<0||e>h)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+e));b=this.getSkippedPod(e),b&&(this.pendingSeekTime=e,e=b.startTime-1),this._seekFromTime=this._seekFromTime||i,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:e,seekFromTime:this._seekFromTime},null,2)),g&&f.seekTo(e)}},getSkippedPod:function(a){var b,c,d,e,f=[];for(b in this.adPods)f.push(this.adPods[b].startTime);for(f.sort(function(a,b){return a-b}),c=f.length;c--;)if((d=f[c])<a)return e=this.adPods["t_"+d],e.hasPlayed?null:e;return null},dispatch:function(a,b){this.eventsMgr.dispatchEvent(a,b,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var a=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:a})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_LOADED,{adData:a}),this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:a})},dispatchAdEnd:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:a})},dispatchAdQuartile:function(a){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:a})},dispatchVideoProgress:function(a){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,a)},dispatchError:function(a,b,c,d){this.dispatch(a,{errorInfo:new uvpjs.ErrorInfo({eventType:a,errorCode:c,message:b+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===d,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(a){var b,c,d=null,e=a&&a.length;for(e&&!this.adPods&&this.createAdPods(a);e--;)b=a[e],c=this.adPods["t_"+b.start],d||c.hasPlayed===b.played||(d=c),c.hasPlayed=b.played;return d},createAdPods:function(a){var b,c,d,e,f=function(a){return i>1&&a===i-1?"post":0===a?"pre":"mid"},g=0,h=[],i=a.length;for(this.adPods={},c=0;c<i;c++)b=a[c],d=f(c),e=b.start,h.push(e),this.adPods["t_"+e]={startTime:e,hasPlayed:!1,adPodId:d+("mid"===d?"_"+g++:"_0"),adCount:0,podDuration:b.end-e};this.cviModel.contentVideoState.chapterStartTimes=h},resetAdStates:function(){var a=this.cviModel;a.resetAdPlaybackState(),a.resetAdVideoState(),a.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(a){var b=a.getAdPodInfo();this.populateAdVideoState(a),b&&this.currAdPod&&(this.currAdPod.adCount=b.getTotalAds(),this.currAdPod.podDuration=b.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(a){var b=uvpjs.adUtil.extractAdStateData(a,uvpjs.adUtil.context.DAI,this.isLiveStream);b.adBitrate=this.cviModel.getContentPlaybackState().facadeState.currentBitrate,this.cviModel.setAdVideoState(b)},createAdProgressPayload:function(a){var b=this.getVideoProgressPayload(),c=a.currentTime;return b.isAd=!0,b.duration=a.duration,b.currentTime=c,b.absoluteStreamTime=this.facade.getCurrentTime(),b.lastSecondCompleted=Math.floor(c),b.lastPercentageCompleted=this.currAdPercentComplete,b},extractAdInfo:function(a){return uvpjs.adUtil.extractAdInfo(a,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(a){this.adTrackingHandle&&a!=b.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:a,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||this.isLiveStream||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var a,b,c,d=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying();d&&(b=this.facade.getCurrentTime(),this.checkForAdBlocker(b,!1),a=this.streamManager.contentTimeForStreamTime(b),!this.contentStartOpen&&(a>0||this.isLiveStream)&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(a),c=this.createVideoProgressPayload(a,b),this.dispatchVideoProgress(c))},createVideoProgressPayload:function(a,b){var c=this.getVideoProgressPayload();return c.currentTime=a,c.absoluteStreamTime=b,c.duration=this.contentDuration||-1,c},checkBuffering:function(a){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(a,b){var c=a-this.lastAdBlockCheckTime>this.adBlockCheckInterval,d=b||c,e=d&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return d&&(this.lastAdBlockCheckTime=a),e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!e},assembleResourceDefinition:function(){var a=this.rco.getAdTagParameters(),b=this.rco.getVideoId(),c=this.rco.getContentSourceId(),d=this.rco.getAssetKey();return d&&a||a&&b&&c?{adTagParameters:a,videoId:b||null,contentSourceId:c||null,assetKey:d||null}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(a){for(var e,f="add"===a?"addEventListener":"removeEventListener",g="addEventListener"===f,h=b.StreamEvent.Type,i=c.length;i--;)e=h[c[i]],g&&(this.hMap[e]=d[i]),!g&&delete this.hMap[e],this.streamManager[f](e,this.hStreamEvent)},createAdClickElement:function(a){var b,c,d,e,f="uvpjsDaiContainer",g=a.nextSibling;if(g&&g.getAttribute("data-role")===f)return g;b=document.createElement("div"),b.setAttribute("data-role","uvpjsDaiContainer"),c={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},e=b.style;for(d in c)e[d]=c[d];return a.insertAdjacentElement("afterend",b),b},onPauseVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onPlayVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onChangeVideoVolume:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.vol,e=uvpjs.util.inRange(d,0,1),f=this.cviModel.isMuted;b===this.vidContId&&e&&!f&&this._hasFacade()&&(this.facade.setVolume(d),this.isAdPlaying()&&this.trackAdEvent(a.type))},onMuteVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onUnMuteVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},facadeId3Data:function(a){if(this.streamManager){var b=function(a){this.streamManager.processMetadata("ID3",a.data,a.pts)}.bind(this);a&&a.forEach(b)}},facadeProgress:function(a){},facadeTimeUpdate:function(a){},facadeDurationChanged:function(a){this.contentDuration=this.streamManager.contentTimeForStreamTime(a.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(a){this.adClickElement&&(this.adClickElement.style.display=!1!==a?"block":"none")},log:function(a,b,c){var d=c||"log";uvpjs[d](this.DEBUG_ID,a,b||"")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};a.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(a,b,c){this._super(a,b,c),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+c),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(a){a()},loadVideoAndBeginPlayback:function(a){var b,c=this.rco,d=this.cviModel;if(this.suppressFacadePlayOnLoad=!0===a,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),d.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),d.setContentVideoStateItems(c),d.mergeCDOData(),this.killDataProxy(),this.contentDuration=d.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),!(b=this.assembleAssetUrl(c)))return void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=b,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(c.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()},assembleAssetUrl:function(a){var b,c,d=a.assetURL,e=uvpjs.util;return e.isEmpty(d)?null:d.indexOf("?")>-1?d:(c=a.getAdTagParameters(),b=c?e.queryStrFromObj(c):null,e.isEmpty(b)?d:d+"?"+b)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(a){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(a),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(a,b){this.eventsMgr.dispatchEvent(a,b,this.vidContId)},dispatchContentDataLoaded:function(){var a=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:a})},dispatchAdPodStart:function(a){var b=this.getPrerollPod(a);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:b})},dispatchAdPodEnd:function(){var a=this.getPrerollPod();a.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:a})},dispatchAdStart:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:a})},dispatchAdEnd:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:a})},dispatchAdQuartile:function(a){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:a})},dispatchVideoProgress:function(a){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,a)},dispatchError:function(a,b,c,d){this.dispatch(a,{errorInfo:new uvpjs.ErrorInfo({eventType:a,errorCode:c,message:b,isFatal:!0===d,adInfo:null})})},getPrerollPod:function(a){return this.adPod||(this.adPod={startTime:a,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var a=this.cviModel;a.resetAdPlaybackState(),a.resetAdVideoState(),a.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var a=uvpjs.adUtil.getAdStateBlank();a.adServerName="dai_ssb",a.duration=this.getPrerollAdDuration(),a.adClipID="pre_0",a.adPosition=1,a.adType="pre",this.cviModel.setAdVideoState(a)},getPrerollAdDuration:function(){var a=this.getAbsoluteDuration();return a>0&&this.contentDuration>0?a-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var a,b,c=this.getVideoProgressPayload(),d=this.facade.getCurrentTime(),e=this.getPrerollAdDuration(),f=Math.floor(d/e*100);switch(f){case 25:a=this.quartiles[25],b=25;break;case 50:a=this.quartiles[50],b=50;break;case 75:a=this.quartiles[75],b=75}return b&&!a&&this.dispatchAdQuartile(b),b&&(this.quartiles[String(b)]=1),c.isAd=!0,c.duration=e,c.currentTime=d,c.absoluteStreamTime=this.facade.getCurrentTime(),c.lastSecondCompleted=Math.floor(d),c.lastPercentageCompleted=f,c},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var a,b=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,c=this.isAdPlaying(),d=this.contentStartOpen,e=b&&this.facade.getCurrentTime();b&&(a=c?this.createAdProgressPayload():d?this.createVideoProgressPayload():null,e>1&&!d&&!c&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+e),this.contentStartTime=e,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(e),a&&this.dispatchVideoProgress(a))},createVideoProgressPayload:function(){var a=this.getVideoProgressPayload(),b=this.facade.getCurrentTime(),c=b-this.contentStartTime;return a.currentTime=c,a.absoluteStreamTime=b,a.duration=this.contentDuration||-1,a},checkBuffering:function(a){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.seekTime,e=this.facade,f=this._hasFacade(),g=f&&(this.absoluteDuration||e.getDuration()),h=this.getPrerollAdDuration(),i=this.facade.getCurrentTime();if("number"==typeof d&&b===this.vidContId&&g){if((d+=h>0?h:0)<0||d>g)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+d));this._seekFromTime=this._seekFromTime||i,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:d,seekFromTime:this._seekFromTime},null,2)),f&&e.seekTo(d)}},facadeProgress:function(a){},facadeTimeUpdate:function(a){},facadeDurationChanged:function(a){!this.absoluteDuration&&(this.absoluteDuration=a.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.hCueChange=this.hCueChange.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){var a=this.vidEl.textTracks;a.removeEventListener("addtrack",this.hAddTextTrack,!1);for(var b=0,c=a.length;b<c;b++)a[b].removeEventListener("cuechange",this.hCueChange,!1)},hAddTextTrack:function(a){a.track&&"metadata"===a.track.kind&&(a.track.addEventListener("cuechange",this.hCueChange,!1),a.track.mode="hidden")},hCueChange:function(a){a.target&&a.target.activeCues&&1==a.target.activeCues.length&&this.handleId3Cue(a.target.activeCues[0])},handleId3Cue:function(a){var c,d,e=a.value,f=e.key;"TXXX"===f&&(c=""!==e.info?e.info:e.data,(d=b[c])&&this[d](a.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(a,b,c){var d=c||"log";uvpjs[d](this.DEBUG_ID,a,b||"")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b=2e3;a.P2pClient=uvpjs.Class.subClass({init:function(a){this.clientName=a.clientName||null,this.requiredParams=a.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var a=uvpjs.P2pClient.clientMap[this.clientName];return a&&a.getHlsjsLoader&&(a.getHlsjsLoader()||null)}}),a.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,a.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(a,c){var d;this.getHlsjsLoader()?a():c.apiKey?(d=this.loadHlsLoader.bind(this,a),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+c.apiKey,d,b)):a(!0)},loadHlsLoader:function(a,c){if(c)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",c),void a(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,a,b)}}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.MultiCdnClient=uvpjs.Class.subClass({init:function(a){this.clientName=a.clientName||null,this.requiredParams=a.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(a){var b;this.inFlight||(this.inFlight=!0,this.decisionCallback=a,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),b=new uvpjs.CodeLoader,b.loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(a){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(a.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),a.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(a){return a&&a.customerId&&a.appId?this.decisionUrl.replace("{customerId}",a.customerId).replace("{appId}",a.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(a){a()}}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(a,b){var c=uvpjs.VideoDeliveryPluginService.clientType;this.model=b,this.callback=a,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(c.P2P),this.multiCdnClientOptions=this.getClientOptions(c.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var a=null,b=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(a=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(b=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(a,b))},handleMcdnReady:function(a){var b=this.multiCdnClientOptions;!a&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,b.clientName)||(b.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+b.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var a=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,a.clientName,this.handleMcdnReady.bind(this),a.requiredParams)},handleP2pReady:function(a,b){var c=this.p2pClientOptions;!b&&this.validateScriptLoad(this.staticSvc.clientType.P2P,c.clientName)||(c.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+c.clientName)),a?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var a=this.p2pClientOptions,b=this.multiCdnClientOptions,c=b.canUse;a.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,a.clientName,this.handleP2pReady.bind(this,c),a.requiredParams):c?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(a,b,c,d){var e=this.getClientObject(a,b);e||c(!0),e.loadScripts(c,d)},validateScriptLoad:function(a,b){var c=this.getClientObject(a,b);return c&&c.validateScriptLoad()||!1},createClient:function(a,b){return new a(b)},getClientOptions:function(a){var b,c,d,e,f,g,h,i,j,k=this.model,l=this.getSupportedClients(a),m={canUse:!1,clientName:null};if(a===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return m;for(b in l)if(c=b,d=l[c],(i=d&&d.uvpcModuleName)&&k.isModuleEnabled(i)){for(e=d.requiredParams,f=e&&e.length||0,h={},j=!0;f--;){if(g=k.getModuleParam(i,e[f]),uvpjs.util.isEmpty(g)){j=!1;break}h[e[f]]=g}return{canUse:j,clientName:c,requiredParams:h}}return m},getSupportedClients:function(a){var b,c,d={},e=a.clientMap;if(!e)return d;for(b in e)c=e[b],d[b]={uvpcModuleName:c.uvpcModuleName,requiredParams:c.requires};return d},getClientObject:function(a,b){return a.clientMap[b]||null}});var b=a.VideoDeliveryPluginService;b.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},b.load=function(a,b,c){(new uvpjs.CodeLoader).loadScript(a,b,c)}}(uvpjs.register("uvpjs")),function(a){var b="loadedmetadata";a.FullscreenManager=uvpjs.Class.subClass({init:function(a){var b=uvpjs.util,c=a||{},d=uvpjs.mediaCapabilities;if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,!c.videoElement||!c.container)return void uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.");this.videoEl=c.videoElement,this.container=c.container,this.fullscreenChangeCallback=b.isFunction(c.fullscreenChangeCallback)&&c.fullscreenChangeCallback,this.readyCallback=b.isFunction(c.readyCallback)&&c.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=d.getEnterFullscreenMethodName(),this.exitMethod=d.getExitFullscreenMethodName(),this.fsElementName=d.getFullScreenElementName(),this.isFullscreenProperty=d.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(a){var b=this.isFullscreen();a.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(b)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener(b,this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var a=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return a&&uvpjs.util.isFunction(a[this.exitMethod])?a:null},validateEntryAndExitMethods:function(){var a=this.fsElement&&this.fsElement[this.enterMethod],b=this.exitScope&&this.exitScope[this.exitMethod],c=uvpjs.util;this.hasValidEntryMethod=c.isFunction(a),this.hasValidExitMethod=c.isFunction(b)},initialize:function(){var a,c,d,e,f=uvpjs.mediaCapabilities;if(this.hasFsApiSupport=f.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(e=f.getFullscreenEventName(),a=f.isFirefox()||f.isIE()?document:this.container,a.addEventListener(e,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,c=f.getFullscreenEnterEventName(),d=f.getFullscreenExitEventName(),this.fsElement.addEventListener(c,this.hFullScreenEvent,!1),this.fsElement.addEventListener(d,this.hFullScreenEvent,!1),this.enterEvt=c,this.exitEvt=d),this.validateEntryAndExitMethods(),!this.hasValidEntryMethod)return void(this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo()));this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener(b,this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())}}),a.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c,d,e,f=a._;a.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"lib/css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=a.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=a.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._ccEnabledByUser=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this.isAndroidOnHlsjs=this.mc.canPlayHlsjsAndriod(this.vci.CVI_Mgr.cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(a.skinConfig)},destroy:function(){var a=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=a,this._replayCB=a,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(a){var b=uvpjs.util,c=uvpjs.Configuration.hostname+uvpjs.Configuration.path,d=this._containerId,e=a.customCSS;this._namespace="."+d+".skin",this._autoPlay=a.isMutedAutoplay||a.isUnmutedAutoplay,this._isMutedAutoplay=a.isMutedAutoplay,this._previewImage=a.previewImage,this._enableReplay=a.enableReplay,this._themeName=a.themeName,this._controls=a.controls,this._template=a.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=b.isDefinedString(e)&&e||c+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(a)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(a){this._playbackState=a,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",a),f.includes(this._disabledButtons,a)||this._disabledButtons.push(a),this._disableButton(a)},enableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",a),f.pull(this._disabledButtons,a),this._enableButton(a)},_handleFullscreenMgrReady:function(a){a&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(a){var b=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),a?(this.vci.fullscreen(!0),b&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),b&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(a){var b=this._queryByElementName(a);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",a),this._disable(a),b&&b.setAttribute("disabled","disabled")},_enableButton:function(a){var b=this._queryByElementName(a);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",a),f.includes(this._disabledButtons,a)||(this._enable(a),b&&b.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var a=this.vci,b=this._namespace,c=uvpjs.EventType;a.addEventListener(c.AD_START+b,this._onAdStart.bind(this)),a.addEventListener(c.AD_END+b,this._onAdEnd.bind(this)),!this._isIOS&&a.addEventListener(c.CAPTIONS_READY+b,this._onCaptionsReady.bind(this)),a.addEventListener(c.CONTENT_START+b,this._onContentStart.bind(this)),a.addEventListener(c.CONTENT_END+b,this._onContentEnd.bind(this)),a.addEventListener(c.VIDEO_PROGRESS+b,this._onVideoProgress.bind(this)),a.addEventListener(c.VIDEO_STATE_CHANGE+b,this._onVideoStateChange.bind(this)),a.addEventListener(c.VIDEO_LOADING+b,this._onVideoLoading.bind(this)),a.addEventListener(c.CONTROL_MUTE+b,this._onControlMuteUnmute.bind(this)),a.addEventListener(c.CONTROL_UNMUTE+b,this._onControlMuteUnmute.bind(this)),a.addEventListener(c.RESOURCE_START+b,this._onResourceStart.bind(this)),a.addEventListener(c.RESOURCE_END+b,this._onResourceEnd.bind(this)),a.addEventListener(c.CONTAINER_RESIZE+b,this._onUVPJSResize.bind(this)),a.addEventListener(c.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+b,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var a=this.vci,b=this._namespace,c=uvpjs.EventType;a&&a instanceof uvpjs.VideoControlInterface&&(a.removeEventListener(c.AD_START+b),a.removeEventListener(c.AD_END+b),!this._isIOS&&a.removeEventListener(c.CAPTIONS_READY+b),a.removeEventListener(c.CONTENT_START+b),a.removeEventListener(c.CONTENT_END+b),a.removeEventListener(c.VIDEO_PROGRESS+b),a.removeEventListener(c.VIDEO_STATE_CHANGE+b),a.removeEventListener(c.VIDEO_LOADING+b),a.removeEventListener(c.CONTROL_MUTE+b),a.removeEventListener(c.CONTROL_UNMUTE+b),a.removeEventListener(c.RESOURCE_END+b),a.removeEventListener(c.CONTAINER_RESIZE+b))},_addUIEventListeners:function(){for(var a=this.mc.isIE()?"change":"input",b=this._containerEl,c=this.css,d=this.shouldTrapTaps(),e=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],f=e.length;f--;)"_onClosedCaptionBtnClick"===e[f]&&this._isIOS||(this[e[f]]=this[e[f]].bind(this));var g=this._onUVPJSGestureEvent,h=this._hNonTap,i=this._onProgressSliderEvent,j=this._onVolumeSliderEvent,k=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",h),b.addEventListener("mouseenter",g,!0),b.addEventListener("mouseleave",g,!0),b.addEventListener("mousemove",g,!0),b.addEventListener("mousedown",g,!1),b.addEventListener("mouseup",g,!1),b.addEventListener("click",g,!1),b.addEventListener("touchstart",g,!0),b.addEventListener("touchend",g,!0),this._previewBtn=this._queryByElementName(c.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",h),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(c.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(c.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(c.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(c.PROGRESS_SLIDER),this._progressSlider.addEventListener(a,i,!1),this._progressSlider.addEventListener("mousedown",i,!1),this._progressSlider.addEventListener("mouseup",i,!1),this._progressSlider.addEventListener("touchstart",i,!0),this._progressSlider.addEventListener("touchend",i,!0),this._volumeSlider=this._queryByElementName(c.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(a,j,!1),this._volumeSlider.addEventListener("mouseover",j,!1),this._volumeSlider.addEventListener("mouseout",j,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(c.LARGE_PLAY_BTN),!d&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(c.PLAYSTATE_BTN),!d&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(c.VOLUME_BTN),!d&&this._volumeBtn.addEventListener("click",k,!1),this._volumeBtn.addEventListener("mouseover",k,!1),this._volumeBtn.addEventListener("mouseout",k,!1),this._isIOS||(this._ccBtn=this._queryByElementName(c.CLOSED_CAPTION_BTN),!d&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(c.SETTINGS_BTN),!d&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,c.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(c.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var a=this.mc.isIE()?"change":"input",b=this._containerEl,c=this._hNonTap,d=this._onUVPJSGestureEvent,e=this._onProgressSliderEvent,f=this._onVolumeSliderEvent,g=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",c,!1),b.removeEventListener("mouseenter",d,!0),b.removeEventListener("mouseleave",d,!0),b.removeEventListener("mousemove",d,!0),b.removeEventListener("mousedown",d,!1),b.removeEventListener("mouseup",d,!1),b.removeEventListener("click",d,!1),b.removeEventListener("touchstart",d,!0),b.removeEventListener("touchend",d,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",c,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(a,e,!1),this._progressSlider.removeEventListener("mousedown",e,!1),this._progressSlider.removeEventListener("mouseup",e,!1),this._progressSlider.removeEventListener("touchstart",e,!0),this._progressSlider.removeEventListener("touchend",e,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(a,f,!1),this._volumeSlider.removeEventListener("mouseover",f,!1),this._volumeSlider.removeEventListener("mouseout",f,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",g,!1),this._volumeBtn.removeEventListener("mouseover",g,!1),this._volumeBtn.removeEventListener("mouseout",g,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var a=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(a,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var a=!0;for(var b in this._controlList)this._checkControlOnDOM(this._controlList[b])||(a=!1);return a},_waitForControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls.");setTimeout(function(){if(!(++this._waitCount>100))return this._haveControlsLoaded()?void a.call(this):void this._waitForControls(a)}.bind(this),50)},_clearMouseMoveInterval:function(a){var b=this._getClassName(a,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[b]&&(clearInterval(this._intervals[b]),this._intervals[b]=-1)},_clearIntervals:function(){var a,b=this._intervals;for(a in b)-1!==b[a]&&(clearInterval(b[a]),b[a]=-1)},_setupDom:function(){var a=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),b(this._containerEl,this.PRIMARY_BLOCK),b(this._contentEl,this._getClassName(a.CONTENT)),b(this._controlsEl,this._getClassName(a.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&b(this._adEl,this._getClassName(a.AD)),this._hide(a.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(a.BUFFERING_FRAME),this._hide(a.LARGE_PLAY_BTN),this._hide(a.CONTROL_BAR),this._hide(a.PROGRESS),this._hide(a.VOLUME_SLIDER),this._show(a.CONTROLS),this._hide(a.BUFFERING_FRAME),this._hide(a.SETTINGS_MENU),this._hide(a.PREVIEW_BTN),this._hide(a.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(a){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+a]=a},_setupControlsContainer:function(){var a=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(a),this._isIOS&&(this._controlsEl.querySelector(".uvpjs__btn-volume").style.right="45px",this._controlsEl.querySelector(".uvpjs__time").style.right="83px")},_generateSettingsMenu:function(a,b){function c(a){var b=a.value,c=a.property,d=c&&q[c];return!((d&&d.toLowerCase())!==(b&&b.toLowerCase()))}function d(a,b){var d={};if(!1!==a.enabled)return void 0===a.value?(d.el="SETTINGS_MENU_ITEM",d.type="button",d.label=a.label,d.target=b):(d.el="SETTINGS_MENU_INPUT",d.type="menu",d.label=a.label||a.value,d.value=a.value,d.property=b&&f.last(b.split(":")),d.selected=c(d)),d}var e,g,h,i,j,k,l,m,n,o=this._queryByElementName(this.css.SETTINGS_MENU),p=this._getClassName(this.css.SETTINGS_MENU_ITEM),q=f.assign({},this._menuSelections,this._getCaptionsStyle()),r=document.createRange(),s=uvpjs.util,t=[],u=this.shouldTrapTaps();for(n=a&&a.length,m=0;m<n;m++)k=a[m],j=k.name,i=b,j&&(i=s.isDefinedString(b)&&[b,j].join(":")||j),t.push(d(k,i));for(b&&(h=this._findMenuItem(b),i=b.split(":").slice(0,-1).join(":"),l=d(h,i),l.cls=p+"--back",t.unshift(l)),r.selectNodeContents(o),r.deleteContents(),o.insertAdjacentHTML("beforeend",this._templateToHTML(t)),e=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),g=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),m=e&&e.length;m--;)!u&&e[m].addEventListener("click",this._onSettingsMenuBtnClick);for(m=g&&g.length;m--;)!u&&g[m].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var a,b=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),c=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(a=b&&b.length;a--;)b[a].removeEventListener("click",this._onSettingsMenuBtnClick);for(a=c&&c.length;a--;)c[a].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(a){var b={items:this.settingsMenu};if(f.isEmpty(a))return b;var c=this,d=a.split(":");return f(d).each(function(a){c.debug&&uvpjs.log(c.DEBUG_ID,"_findMenuItem key",a),b=f.find(b.items,function(b){return b.name===a})}),b},_createAdLearnMoreButton:function(){},_setupPreview:function(){var a=uvpjs.util,b=this.css.PREVIEW_BTN,c=this._previewImage,d=this._queryByElementName(b);uvpjs.log(this.DEBUG_ID,"_setupPreview",c),a.isDefinedString(c)&&(d.style.backgroundImage="url('"+c+"')"),this._show(b)},_setupReplay:function(){var a=uvpjs.util,b=this.css,c=b.REPLAY_BTN,d=this._previewImage,e=this._queryByElementName(c);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),a.isDefinedString(d)&&(e.style.backgroundImage="url('"+d+"')"),this._hide(b.LARGE_PLAY_BTN),this._hide(b.PREVIEW_BTN),this._hide(b.BUFFERING_FRAME),this._show(b.CONTROLS),this._hide(b.CONTROL_BAR),this._hide(b.PROGRESS),this._show(c),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var a=this._getClassName(this.css.BUFFERING_FRAME),b={lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:a,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};new Spinner(b).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(a){var b=this.css;this._containerId===a.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(a.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(b.VOLUME_BTN),this._disableButton(b.SETTINGS_BTN),this._disableButton(b.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(b.PROGRESS),this._hasActive(b.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),a.payload.adData.isCustomClickTrackingUsed||this._disable(b.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(a){return this.vci.getContentVideoData().isLive&&!!a},_onAdEnd:function(a){this._containerId===a.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,a.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(a){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",a),this._captionsLoaded=!0,this._enableCaptions(),this.isAndroidOnHlsjs||this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",a),this._isIOS||this._disableCaptions()},_onContentStart:function(a){var b=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",a),this._containerId===a.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(b.VOLUME_BTN),this._captionsLoaded&&this._enableButton(b.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(b.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(b.PROGRESS)):this._isStreaming()&&(this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(b.PROGRESS)),!this._isIOS&&this._hasActive(b.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===a.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(a){var b="controlMute"===a.type;this._containerId===a.target&&this._updateVolumeUI(this._volumeSlider.value,b)},_onDiagCloseButton:function(a){this._containerId===a.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",a),this._menuSelections.debug=null)},_onResourceStart:function(a){(a&&a.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",a),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(a){var b=a.target,c=a.payload,d=0===c.playlistLength;this._containerId===b&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",a),this._hide(this.css.CONTROLS),this._enableReplay&&d&&this._setupReplay(),this._captionsLoaded&&(this._captionsLoaded=!1,this._disableCaptions()),this._resetProgressSlider())},_onVideoProgress:function(a){var b,c,d=a.payload,e=d.playbackState,f=this.vci.getVolume(),g=this.css.TIME_DURATION,h=this.css.TIME_CURRENT,i=!1;this._containerId===a.target&&(f!==Number(this._volumeSlider.value)&&this._updateVolumeUI(f),e!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(d),e!==this.mc.PLAYING||this._isSliding||d.duration!==1/0&&(b=this._queryByElementName(g),c=this._queryByElementName(h),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&d.duration>=3600&&(this.durationChecked=i=!0):(this.durationChecked=!0,d.duration>=3600&&(i=!0)),i&&(c.parentNode.style.width="100px"),b.innerHTML=this._formatTimestampByType(g,d.duration),c.innerHTML=this._formatTimestampByType(h,d.currentTime),this._updateProgressUI(d)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(a){f.has(a,"target")&&this._containerId===a.target&&f.isObject(a)&&f.has(a,"payload.data")&&this._updateProgressLoad(a.payload.data)},_onVideoStateChange:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",a),f.isObject(a)&&this._containerId===a.target&&f.isObject(a.payload)&&f.isNumber(parseInt(a.payload.newState))&&(!this.ignoreVideoStateChange||b===this.mc.PAUSED||b===this.mc.PLAYING)){var b=a.payload.newState;b!==this._playbackState&&(this._playbackState=b,this._updatePlaybackStateUI(this._playbackState)),b===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(a,b,c){null!==a&&(this.isMonitoringMuting=a),b&&clearInterval(this.muteMonitorIntervalId),c&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var a=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&a!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=a,a?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(a){var b=!1;switch(a.type){case"mouseenter":this._onUVPJSMouseEnter(a);break;case"mouseleave":this._onUVPJSMouseLeave(a);break;case"mousemove":this._onUVPJSMouseMove(a);break;case"mousedown":this._onUVPJSMouseDown(a);break;case"mouseup":this._onUVPJSMouseUp(a);break;case"click":this._showControlBar(a),b=!0;break;case"touchstart":this._onUVPJSTouchStart(a);break;case"touchend":this._onUVPJSTouchEnd(a),b=!0}!this._hasFirstTouch&&b&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(a)))},_getTargetInfo:function(a){var b=a.target;return{isVolumeButton:-1!==b.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==b.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(a){switch(a.type){case"input":case"change":this._onProgressSliderChange(a);break;case"touchstart":case"mousedown":this._onProgressSliderStart(a);break;case"touchend":case"mouseup":this._onProgressSliderEnd(a)}},_onVolumeSliderEvent:function(a){switch(a.type){case"input":case"change":this._onVolumeSliderChange(a);break;case"mouseover":this._showVolumeSlider(a);break;case"mouseout":this._hideVolumeSlider(a)}},_onVolumeBtnEvent:function(a){switch(a.type){case"click":case"touchend":this._onVolumeBtnClick(a);break;case"mouseover":this._showVolumeSlider(a);break;case"mouseout":this._hideVolumeSlider(a)}},_onUVPJSMouseEnter:function(a){a.stopPropagation(),this._containerEl===a.target&&(this._hasPaused()||this._showControlBar(a))},_onUVPJSMouseDown:function(a){a.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(a){var b,c=this.vci.getCurrentPlaybackState().playbackState;return this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),a.target.getAttribute("disabled")?(a.stopPropagation(),void a.preventDefault()):(this._touchStartTime=a.timeStamp,this._previewCallbackDone?void(this._hasDisabled(this.css.CONTROLS)||c!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),a.target===this._progressSlider&&(b=1-(a.target.clientWidth-a.layerX)/a.target.clientWidth,this._onProgressSliderChange(a,b)))):void(this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet.")))},_onUVPJSTouchEnd:function(a){function b(){this._hasPaused()||(c=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}var c,d,e,f,g=this.css,h=this._isTap(a.timeStamp),i=[g.CLOSED_CAPTION_BTN,g.VOLUME_BTN,g.PLAYSTATE_BTN,g.SETTINGS_BTN,g.SETTINGS_MENU,g.SETTINGS_MENU_ITEM,g.SETTINGS_MENU_INPUT,g.LARGE_PLAY_BTN,g.FULLSCREEN_BTN],j=i.length,k=a.target.className;if(a.target.getAttribute("disabled"))return a.stopPropagation(),void a.preventDefault();if(!this._hasDisabled(g.CONTROLS)){for(;j--&&!(d=d||k.indexOf(i[j])>-1););if(this.shouldTrapTaps()&&d&&j<i.length-1)return a.stopPropagation(),a.preventDefault(),void this.handleTap(i[j],a);e=!(d||this._isTouchActive&&h),e&&a.preventDefault(),e&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),f=c||e?this.HIDE_DELAY:0,c&&clearTimeout(c),c=setTimeout(b.bind(this),f)}},handleTap:function(a,b){var c=this.css;if(!this._queryByElementName(a).hasAttribute("disabled"))switch(a){case c.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(b);break;case c.VOLUME_BTN:this._onVolumeBtnEvent(b);break;case c.PLAYSTATE_BTN:case c.LARGE_PLAY_BTN:this._onPlayToggle(b);break;case c.SETTINGS_BTN:this._onSettingsBtnClick(b);break;case c.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(b);break;case c.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(b)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(a){a.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(a){var b=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[b]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[b]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(a){this._isMouseActive||(this._clearMouseMoveInterval(a),this._removeModifier(a,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(a){a.stopPropagation(),this._containerEl===a.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(a){a.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(a){a.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(a){a.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var a=this._containerEl.offsetWidth;a>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),a>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),a>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),a>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),a<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),a<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),a<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),a<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(a){var b=this.vci,c=b.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(c?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(a){var b=parseFloat(a.target.value),c=this.vci.getPlayerMuted();c&&b>0&&this.vci.unMute(),this.vci.setVolume(b),this._updateVolumeUI(b,c)},_onFullscreenBtnClick:function(a){a.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),a.stopPropagation(),a.preventDefault(),this.ignoreVideoStateChange&&this._isLive())return void(this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo()));var b=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",b),b===this.mc.PAUSED||b===this.mc.EMPTY||b===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();b!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())},_onPreviewBtn:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),this._isTouch&&!this._isTap(a.timeStamp))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback."));a.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),a.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),a.stopPropagation();var b=this.css.CLOSED_CAPTION_BTN,c=this._hasActive(b);if(this._ccEnabledByUser=!c,c)return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),a.stopPropagation();var b=this.css.SETTINGS_MENU,c=this._hasHidden(b);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",c),c)return this._addModifier(b,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(b);this._removeModifier(b,this.ACTIVE_MODIFIER),this._hide(b)},_onSettingsMenuBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",a);var b=a.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",b),a.target.parentNode.setAttribute("data-target",b);var c=this._findMenuItem(b);this._generateSettingsMenu(c.items,b)},_onSettingsMenuInputClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",a);var b=a.target,c=b.parentNode,d=c.getAttribute("data-target");switch(d&&d.split(":")[0]){case"cc":this._onSettingsCaptionsChange(a);break;case"controls":this._onSettingsControlsChange(a);break;case"debug":this._onSettingsDiagWindowChange(a)}},_onSettingsCaptionsChange:function(a){var b=a.target,c=b.parentNode,d=b.getAttribute("data-property"),e=b.getAttribute("data-value").toLowerCase();if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",d,e),f(c.children).each(function(a){a.setAttribute("data-selected","false")}.bind(this)),b.setAttribute("data-selected","true"),"text-position"===d)return void this._setCCPosition(e);this.vci.setCaptionsStyleProperty(d,e)},_onSettingsControlsChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",a);var b=a.target,c=b.getAttribute("data-property"),d=b.getAttribute("data-value").toLowerCase(),e="#"+this._containerId+" ";if("background-opacity"===c){c="background-color";var f=this._queryByElementName(this.css.CONTROL_BAR),g=getComputedStyle(f).getPropertyValue(c);if(-1===g.indexOf("rgba"))return;d=g.split(",").slice(0,-1).join(",")+", "+d+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",d),e+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(e,c,d)},_onSettingsDiagWindowChange:function(a){var b=a.target,c=b.getAttribute("data-property"),d=b.getAttribute("data-value"),e="true"===b.getAttribute("data-selected"),f=!e;this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",a),this._menuSelections[c]=d,b.setAttribute("data-selected",f),f?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(a){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",a),this.vci.setCaptionsStyle(a))},_setCaptionsStyleProperty:function(a,b){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",a,b),this.vci.setCaptionsStyleProperty(a,b))},_setCueProperty:function(a,b){if(!this._isIOS&&this._captionsLoaded){this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",a,b),this.vci.setCaptionsCueProperty(a,b))}},_setCCPosition:function(a){var b="text-position";!this._isIOS&&this._captionsLoaded&&(a=a||this._getCaptionsStyle()[b],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",b,a),this.vci.setCaptionsStyleProperty(b,a))},_showControlBar:function(a){var b=this.vci.getCurrentPlaybackState().playbackState,c=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&b!==this.mc.EMPTY&&(f.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[c.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(c.CONTROL_BAR),this.controlsVisible=!0,this._show(c.PROGRESS))},_hideMenu:function(a){this._hasHidden(this.css.SETTINGS_MENU)||a.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(a){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=f.debounce(function(){if(this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch)return void this._hideControlBar.hide.cancel();this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS)},a||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(a){var b,c=this.css;this._hasDisabled(c.VOLUME_BTN)||this._hasDisabled(c.CONTROLS)||(this._hasActive(c.SETTINGS_MENU)&&this._hide(c.SETTINGS_MENU),this._setDataAttribute(this._containerEl,c.VOLUME_SLIDER,!0),this._addModifier(c.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(c.VOLUME_SLIDER),(this.mc.isFirefox()||this.mc.isEdge())&&(b=this._controlsEl.querySelector(".uvpjs__volume-slider"))&&b.setAttribute("style","bottom: 62px"))},_hideVolumeSlider:function(a){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._ccEnabledByUser&&(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions()))},_disableCaptions:function(){this._isIOS||(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._disableButton(this.css.SETTINGS_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),f.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(a,b){var c,d=uvpjs.util,e=this._containerEl,f=this.vci.getPlayerMuted();!0===f?c="mute":a>.85?c="full":d.inRange(a,.5,.85)?c="high":d.inRange(a,.15,.5)?c="medium":d.inRange(a,0,.15)&&(c="low"),this._volumeSlider.value=a||this._videoEl.volume,this._setDataAttribute(e,"volume-level",c),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,a)},_onProgressSliderChange:function(a,b){var c,d,e=this.vci.getContentVideoData(),f=this.vci.getCurrentPlaybackState(),g=this.css.TIME_CURRENT,h=this._queryByElementName(g),i=b||this._progressSlider.value;i=i>1?1:i<0?0:i,c=Math.ceil(i*e.duration*1e4)/1e4,d=Math.abs((f.currentTime-c)/c),this._updateProgressSlider(i),h.innerHTML=this._formatTimestampByType(g,c),this._hasActive(this.css.PROGRESS_SLIDER)||d<=.02||this.vci.seekTo(c)},_onProgressMouseOver:function(a){a.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(a){a.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(a){var b=this.css;if(this._hasAd()||this._hasDisabled(b.PROGRESS))return a.stopPropagation(),void a.preventDefault();this._addModifier(b.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(a){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return a.stopPropagation(),void a.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(a)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(a){var b,c;this._isLive()||(b=Math.ceil(a.bufferLength/a.duration*1e4)/1e4,f.isNaN(b)||b===1/0||b<=0||(this._downloaded=b,this._hasAd()||(c=this._queryByElementName(this.css.PROGRESS_LOADED),c.value=this._downloaded)))},_updatePlaybackStateUI:function(a){var b=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",a),a){case this.mc.PLAYING:this._show(b.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(b.LARGE_PLAY_BTN),this._hide(b.PREVIEW_BTN),this._hide(b.REPLAY_BTN),this._hide(b.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(b.PROGRESS);break;case this.mc.PAUSED:this._show(b.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(b.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(b.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(b.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(b.CONTROLS),this._hide(b.PREVIEW_BTN),this._hide(b.REPLAY_BTN),this._hide(b.LARGE_PLAY_BTN),this._show(b.BUFFERING_FRAME)}},_updateProgressUI:function(a){var b=Math.ceil(a.currentTime/a.duration*1e4)/1e4;this._updateProgressSlider(b)},_updateSliderUI:function(a,b,c){var d=this,e={};if(!f.isUndefined(this._vendorPrefix)&&!f.isUndefined(a)){if(e.id="#"+this._containerId,e.cls=d._getClass(b),e.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[d._vendorPrefix],this._isMSEdge&&(e.pseudo=""),e.add=function(a,b,c){if(!f.isUndefined(this.pseudo)){var e=this.id+(b||"")+" "+this.cls+(c||"")+this.pseudo;d._addCSSRule(e,"background-size",100*a+"% 100%")}},e.before=function(a,b){var c=d._getClass(d.PRIMARY_BLOCK);b&&(c+=d._getClass(d.PRIMARY_BLOCK,b)),this.add(a,c,null)},e.after=function(a,b){this.add(a,null,b)},b===d.css.VOLUME_SLIDER)return void e.add(c);var g=c*a.offsetWidth,h=(.5-c)*a.offsetHeight,i=g/a.offsetWidth,j=(g+h)/a.offsetWidth;a.value=c;var k=d._hasAd();e.before(i,k?d.AD_MODIFIER:null),this._isTouch&&e.before(j,d.TOUCH_MODIFIER)}},_checkControlOnDOM:function(a){var b=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+a;return!!this._controlCache[b]},_getClassName:function(a,b){var c=this.PRIMARY_BLOCK;return a!==this.PRIMARY_BLOCK&&(c+=this.BLOCK_ELEMENT_DELIMITER+a),b&&(c+=this.ELEMENT_MODIFIER_DELIMITER+b),c},_getClass:function(a,b){return this.CLASS_SELECTOR_PREFIX+this._getClassName(a,b)},_queryByClassName:function(a){var b,c;if(this._containerId)return b=this.ID_SELECTOR_PREFIX+this._containerId,a!==this.PRIMARY_BLOCK&&(b+=" "+this.CLASS_SELECTOR_PREFIX+a),c=this._controlCache[b]||document.querySelector(b),c&&(this._controlCache[b]=c),c},_queryAllByClassName:function(a){var b=this.ID_SELECTOR_PREFIX+this._containerId;return a!==this.PRIMARY_BLOCK&&(b+=" "+this.CLASS_SELECTOR_PREFIX+a),document.querySelectorAll(b)},_queryByElementName:function(a){return this._queryByClassName(this._getClassName(a))},_queryAllByElementName:function(a){return this._queryAllByClassName(this._getClassName(a))},_show:function(a){if(a===this.css.PROGRESS&&!this._isLive()){var b=this._queryByElementName(a),c=b.querySelector("input"),d=b.querySelector("progress");b&&(b.style.display="block"),c&&(c.style.display="block"),d&&(d.style.display="block")}this._removeModifier(a,this.HIDDEN_MODIFIER)},_hide:function(a){if(a===this.css.PROGRESS){var b=this._queryByElementName(a),c=b.querySelector("input"),d=b.querySelector("progress");b&&(b.style.display="none"),c&&(c.style.display="none"),d&&(d.style.display="none")}this._addModifier(a,this.HIDDEN_MODIFIER)},_enable:function(a){this._removeModifier(a,this.DISABLED_MODIFIER)},_disable:function(a){this._addModifier(a,this.DISABLED_MODIFIER)},_enableMenuItem:function(a){var b;a&&(b=this._findMenuItem(a))&&(b.enabled=!0)},_hasHidden:function(a){return this._hasModifier(a,this.HIDDEN_MODIFIER)},_hasActive:function(a){return this._hasModifier(a,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(a){return this._hasModifier(a,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var a=this.vci.getContentVideoData();return a.deliveryType&&a.deliveryType===this.mc.PLAYING},_isStreaming:function(){var a=this.vci.getContentVideoData();return a.deliveryType&&a.deliveryType===this.mc.STREAMING},_hasModifier:function(a,b){f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER));var d=this._getClassName(a,b),e=this._queryByElementName(a);return!!e&&c(e,d)},_addModifier:function(a,c){f.isArray(c)&&(c=c.join(this.MODIFIER_DELIMETER));var d=this._getClassName(a,c),e=this._queryByElementName(a);e&&b(e,d)},_removeModifier:function(a,b){var c,e=this._queryByElementName(a);f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER)),c=this._getClassName(a,b),e&&d(e,c)},_toggleModifier:function(a,b){f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER));var c=this._getClassName(a,b),d=this._queryByElementName(a);d&&e(d,c)},_setDataAttribute:function(a,b,c){a.setAttribute("data-"+b,c)},_removeDataAttribute:function(a,b){a.removeAttribute("data-"+b)},_formatTimestamp:function(a){var b,c;return uvpjs.util.isEmpty(a)||a===1/0?this.NULL_TIME:(isNaN(a)&&(a=0),b=new Date(null),b.setSeconds(Math.round(a)),c=b.toISOString(),a>=3600?c.substr(11,8):c.substr(14,5))},_formatTimestampByType:function(a,b){if(void 0===b||b<0){if(a===this.css.TIME_DURATION)return this.NULL_TIME;if(a===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(b)},_addCSSRule:function(a,b,c){var d=this._styleEl.sheet,e=d.cssRules.length,g=this._cssRules[a];if(!f.isUndefined(g)){var h=d.rules||d.cssRules;if(h.length>0&&h[g])return void(h[g].style[b]=c)}this._cssRules[a]=e,uvpjs.util.addCSSRule(this._styleEl,a,b,c)},_setStyleSheet:function(a){var b=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(c){this._styleEl=c,b||"function"!=typeof a||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),b=!0,a())}.bind(this))},_templateToHTML:function(a){function b(a){var g="";return f(a).each(function(a){a&&("CLOSED_CAPTION_BTN"!==a.el&&"SETTINGS_BTN"!==a.el||!e)&&(a.cls=f.isUndefined(a.cls)?c(a.el):[a.cls,c(a.el)].join(" "),a.children&&(a.children=b(a.children)),g+=f.template(d[a.type],{variable:"o"})(a))}),g}if(f.isArray(a)&&!f.isEmpty(a)){var c=function(a){return this._getClassName(this.css[a]||a)}.bind(this),d=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},e=this._isIOS;return b(a)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(a){return!!this._touchStartTime&&a-this._touchStartTime<this.TAP_THRESHOLD}}),c=function(a,b){return!f.isNull(a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)")))},b=function(a,b){c(a,b)||(a.className=(a.className+=" "+b).trim())},d=function(a,b){a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," ").trim()},e=function(a,e){if(c(a,e))return void d(a,e);b(a,e)}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(a,c,d,e){if(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",a),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",c),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",d)),!b.isArray(c))return void(this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN"));this.vidContId=a,this._generateAdPods(c,d,e)},_generateAdPods:function(a,b,c){var d,e,f,g=b.length,h=function(a,b,c){return{hasBeenChecked:!1,startTime:c||0,hasPlayed:!1,adPodId:a,adCount:0,podDuration:0,adCallURL:b}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",a),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",b)),this.adPods={},g>0&&(b.indexOf(0)>-1&&(this.adPods[this.PRE]=h(this.PRE+"_0",c)),b.indexOf(-1)>-1&&(this.adPods[this.POST]=h(this.POST+"_0",c))),d=0;d<g;d++)e=0===b[0]?d:d+1,f=b[d],isNaN(f)||0===f||-1===f||(this.adPods[this.MID_+e]=h(this.MID_+e,c,f));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",a),b.isString(a)){var c=this.adPods[a];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",c),c}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var a=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",a),a},getMidRollPods:function(){var a,b=[];if(!this.midRollPods){b=[];for(a in this.adPods)a.indexOf(this.MID)>=0&&b.push(this.adPods[a]);this.midRollPods=b}return this.midRollPods},isPreRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.MID)>-1},isPostRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var a in this.adPods)if(a.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(a){var b,c,d,e=null,f="No eligible ad pod found.";for(d in this.adPods)this.adPods.hasOwnProperty(d)&&(b=this.adPods[d],this.isPreRoll(b)||this.isPostRoll(b)||b.startTime<=a&&(e?a-b.startTime<a-e.startTime&&(e=b):e=b));return e&&(c=e.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",f="Found Ad pod; adPodId = "+e.adPodId+"; "+c),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+a+";  "+f),e}})}(uvpjs.register("uvpjs")),function(a){var b,c=a._;a.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",DATAZOOM_MODULE_NAME:"Datazoom",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},_hasAgentInit:!1,init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this.resourceStartTime=0,this.contextMetadata={},this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,a&&this.initialize(a.vidContId,a.cviMgr)},destroy:function(){for(var a,b=this.agents.length;b--;)this.agents[b]&&"function"==typeof this.agents[b].destroy&&this.agents[b].destroy(),this.agents.splice(b,1);for(a in this.eventCBs)this.eventsMgr.removeEventListener(a+this.internalNS+".agent"),delete this.eventsMgr[a];for(a in this.progressEvents)delete this.progressEvents[a];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this.contextMetadata=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),c.isString(a)&&c.isObject(b)&&(this.vidContId=a,this.eventsMgr=b.getEventsMgr(),this.cviModel=b.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._addTrackingEventListeners())},hasTrackingConfigOverrides:function(a){return null!==a&&a.hasOwnProperty("trackingConfigOverrides")&&null!==a.trackingConfigOverrides},getAgentConfig:function(a,b){for(var c=null,d=a.length;d-- >0;){var e=a[d];if(e.name===b){c=e;break}}return c},_overrideUvpc:function(){var a=this.cviModel;if(!this.hasTrackingConfigOverrides(a))return void(this.agentConfigs=a.getModules().slice(0));for(var b=a.getModules().slice(0),c=b.length;c-- >0;){var d=b[c],e=this.getAgentConfig(a.trackingConfigOverrides,d.name);null!==e&&(b[c]=e)}this.agentConfigs=b},isTrackingAgentEnabled:function(a){var b,c=this.getAgentConfig(this.agentConfigs,a),d=this.mc.systemInfo.trackingAvailability,e=!1;for(b in uvpjs.tracking)if(uvpjs.tracking[b]===a&&d[b]){e=!0;break}return this.debug&&c&&c.enabled&&!e&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",c,d),null!==c&&c.enabled&&e},_createAgentsArray:function(a){var b,c,d,e,f,g,h;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),c=a||this.cviModel,this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),e=c.isModuleEnabled.bind(c),f=c.isModuleSet.bind(c),h=this.getPlayerName(),d={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr,playerName:h,playerVersion:this.PLAYER_VERSION_ONLY},this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),d.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,b=new uvpjs.AdobeHeartbeatAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),d.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,b=new uvpjs.AkamaiAnalyticsAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),d.moduleName=this.COMSCORE_SS_MODULE_NAME,d.playerName=this.getPlayerName("|","_"),b=new uvpjs.ComScoreAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),d.moduleName=this.CONVIVA_MODULE_NAME,b=new uvpjs.ConvivaAgent(d),this.agents.push(b)),g=e(this.DW_MODULE_NAME),(g||e(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),d.moduleName=g?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,d.playerName=this.getPlayerName(";"),b=new uvpjs.DWAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),d.moduleName=this.NIELSEN_MODULE_NAME,b=new uvpjs.NielsenAgent(d),this.agents.push(b)),f(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var i=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);d.moduleName=this.MUX_MODULE_NAME,d.playerName=this.PLAYER_NAME_ONLY,d.playerVersion=this.PLAYER_VERSION_ONLY,d.useDefaultProperty=!i("propertyKey"),b=new uvpjs.MuxAgent(d),this.agents.push(b)}var j=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(j&&j.params&&j.params.length>0)for(var k=j.params.length;k-- >0;)this.beaconEndPoint[j.params[k].name]=j.params[k].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(d.moduleName=this.OZTAM_MODULE_NAME,b=new uvpjs.OzTamAgent(d),this.agents.push(b));var l=this.getAgentConfig(this.agentConfigs,this.DATAZOOM_MODULE_NAME);l&&l.enabled&&(d.moduleName=this.DATAZOOM_MODULE_NAME,b=new uvpjs.DatazoomAgent(d),this.agents.push(b))},_addTrackingEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS;a.addEventListener(b.CONTEXT_METADATA+c,this._onContextMetadata.bind(this)),a.addEventListener(b.VIDEO_STATE_CHANGE+c,this._onVideoStateChange.bind(this)),a.addEventListener(b.VIDEO_PROGRESS+c,this._onVideoProgress.bind(this)),a.addEventListener(b.RESOURCE_START+c,this._onResourceStart.bind(this)),a.addEventListener(b.PLAYBACK_DURATION_RESUME+c,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS;a.removeEventListener(b.VIDEO_PROGRESS+c),a.removeEventListener(b.AD_QUARTILE+c),a.removeEventListener(b.RESOURCE_START+c)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),c.isEmpty(this.agents))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled."));for(var a=this.agents.length;a--;)this.agents[a].initialize();this._addAgentEventListeners()},fireTrackingPixel:function(a){var b=document.createElement("img");b.setAttribute("src",a),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("border","0"),b.style.position="absolute",b.style.bottom="0",b.style.right="0",this._beaconElement.appendChild(b)},registerEventCallbacks:function(a){if(c.isPlainObject(a)&&!c.isEmpty(a))for(var b in a)this.eventCBs[b]=this.eventCBs[b]||[],this.eventCBs[b].push(a[b])},registerProgressEvents:function(a){if(c.isPlainObject(a)&&!c.isEmpty(a))for(var b in a)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",b),this.progressEvents[b]=this.progressEvents[b]||[],this.progressEvents[b].push(a[b])},getContentPlayhead:function(){var a=this.cviModel.contentPlaybackState.currentTime;return parseInt(a)},getPlayerName:function(a,b){var d=this.PLAYER_NAME;return c.isEmpty(d)?"UVPJS":(a&&(d=d.replace("_",a)),b&&(d=d.replace(/\./g,b)),d)},getAdLength:function(){return this._adLength=b(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=b(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var a in this.eventCBs)this.eventsMgr.addEventListener(a+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(a){if(a.target===this.vidContId){var b,d=this.eventCBs[a.type];if(!c.isEmpty(d)){b=d.length;for(var e=0;e<b;e++)d[e](a)}}},_onContextMetadata:function(a){this.contextMetadata=a.payload.contextMetadata},_onVideoStateChange:function(a){if(a.payload.newState===this.mc.LOADING&&!this._hasAgentInit){var b,c=this.cviModel.cviMgr.RPM.currRP,d=this.cviModel.cviMgr.RPM.rscProviders;c&&c.rco&&c.rco.uvpc?b=c.rco.uvpc:d&&d.length>0&&(b=d[0].rco.uvpc),b&&b.modules&&this.cviModel.copyModules(b.modules),this._overrideUvpc(),this._createAgentsArray(),this._initializeAgents(),this._hasAgentInit=!0}},_onResourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",a),this.resourceStartTime=new Date,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(a){var b,d=this.progressEvents[a];if(!c.isEmpty(d))for(b=d.length,i=0;i<b;i++)d[i]()},_onPlaybackDurationResume:function(b){var c=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),d=this.cviModel.getContentVideoState(),e={ts:Math.floor(Date.now()/1e3),contentid:d.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:c("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:d.isPaidContent,affiliate:d.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},f=(new a.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(e).devMode(this.debug).buildUrl();this.fireTrackingPixel(f)},_onVideoProgress:function(a){var b,d=a.payload,e=Math.floor(d.currentTime),f=d.duration;if(e&&f&&!d.isAd&&!(this._lastContentSecondCompleted>=e)){if(this._lastContentSecondCompleted=e,e%15==0&&e<=60||e%60==0){if(this._contentTimeFired[e])return;this._contentTimeFired[e]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",e),this._onProgressEvent(this.progressEvents.TIMED)}d.isPlayingLive||f<=10||(b=Math.floor(e/f*100),b!==this.percentDone&&(this.percentDone=b),c.inRange(b,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),c.inRange(b,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),b>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),b=function(a,b){var c=1e3,d=b>0?Math.floor(b*c):0;return uvpjs.util.inRange(a,d-c,d+c)?a:d}}(uvpjs.register("uvpjs")),function(a){a.TrackingAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,vo:null,sdkEvent:null,hasSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,isSeekDone:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(a){this.options=a,this.initTime=new Date,this.contextMetadata=a.trackingMgr.contextMetadata||{}},initialize:function(){var a=this.options.eventsMgr.eventTypes,b={};b[a.RESOURCE_START]=this.onResourceStart.bind(this),b[a.CONTENT_START]=this.onContentStart.bind(this),b[a.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),b[a.CONTROL_SEEK]=this.onSeekStart.bind(this),b[a.SEEK_DONE]=this.onSeekDone.bind(this),b[a.RESOURCE_END]=this.onResourceEnd.bind(this),b[a.CONTEXT_METADATA]=this.onContextMetadata.bind(this),b[a.CDN_UPDATED]=this.onCdnUpdated.bind(this),b[a.AD_POD_START]=this.onAdPodStart.bind(this),b[a.AD_POD_END]=this.onAdPodEnd.bind(this),b[a.AD_START]=this.onAdStart.bind(this),b[a.AD_CLICK]=this.onAdClick.bind(this),b[a.AD_END]=this.onAdEnd.bind(this),b[a.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),b[a.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),b[a.USER_GESTURE]=this.onUserGesture.bind(this),b[a.FORCE_TRACK_SESSION_END]=this.onForceTrackSessionEnd.bind(this),this.options.trackingMgr.registerEventCallbacks(b),a=this.options.trackingMgr.progressEvents,b={},b[a.FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.FIRST_QUARTILE),b[a.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.MID_QUARTILE),b[a.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(b)},onResourceStart:function(a){this.hasResourceStart||(this.sendTrackEvent(this.sdkEvent.SESSION_START,this.vo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(a){this.trackContentStartEvent=!0,this.hasContentStart&&this.isPaused&&(this.sendTrackEvent(this.sdkEvent.PLAY_RESUME),this.isPaused=!1)},onQuartileProgress:function(a){this.sendTrackEvent(a,this.vo.getQuartileInfo())},onVideoStateChange:function(a){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(a.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.sdkEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.sdkEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.sdkEvent.BUFFER_COMPLETE),this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))}},onSeekStart:function(a){this.sendTrackEvent(this.sdkEvent.SEEK_START,this.vo.getSeekInfo())},onSeekDone:function(a){this.sendTrackEvent(this.sdkEvent.SEEK_COMPLETE,this.vo.getSeekInfo()),this.isSeekDone=!0},onResourceEnd:function(a){this.hasContentStart&&this.vo.isCompletedMarker()&&(this.sendTrackEvent(this.sdkEvent.CONTENT_COMPLETE,this.vo.getContentCompleteInfo()),this.sendTrackEvent(this.sdkEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(a){this.contextMetadata=a.payload.contextMetadata},onCdnUpdated:function(a){this.sendTrackEvent(this.sdkEvent.CDN_UPDATED,{cdn:a.payload.cdn})},onAdPodStart:function(a){this.sendTrackEvent(this.sdkEvent.AD_BREAK_START,this.vo.getAdBreakInfo())},onAdPodEnd:function(a){this.sendTrackEvent(this.sdkEvent.AD_BREAK_COMPLETE)},onAdStart:function(a){this.sendTrackEvent(this.sdkEvent.AD_START,this.vo.getAdItemInfo())},onAdClick:function(a){this.sendTrackEvent(this.sdkEvent.AD_CLICK)},onAdEnd:function(a){this.sendTrackEvent(this.sdkEvent.AD_COMPLETE)},onVideoTransition:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"bitrate",a.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(a){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.sdkEvent.QOS,this.vo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.hasContentStart||(this.sendTrackEvent(this.sdkEvent.CONTENT_START,this.vo.getContentStartInfo()),this.hasContentStart=!0)),this.isSeekDone&&(this.isSeekDone=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))},onUserGesture:function(a){a.payload.startTime>0&&(this.options.resumeTime=a.payload.startTime)},onForceTrackSessionEnd:function(a){this.onResourceEnd(a)},destroy:function(){this.vo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.vo=null,this.contextMetadata=null}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c,d,e,f,g;g=a._,a.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",SEGMENT_OWNER_PARAM_NAME:"id3SegmentOwner",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",LIVE_CONTENT_LENGTH:86400,init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this._segmentOwner=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata=this.trackingMgr.contextMetadata||{},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._startUpTime=0,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._segmentOwner=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),g.isUndefined(this._visitorData.marketingCloudOrgId))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."));this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a,b){var c;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),!g.isFunction(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!"));c=b?b.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),this._usesTealium=c.usesTealium;var d=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),d=g.without(d,this.scriptPaths.APP_MEASUREMENT)),e()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(d,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var a=this._qosObject;return b.createQoSObject(a.bitrate,a.startupTime,a.fps,a.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var a=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),b=a(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),c=a(this.TRACKING_SERVER_PARAM_NAME);this._segmentOwner=a(this.SEGMENT_OWNER_PARAM_NAME),this.mc.isSecure()&&(g.isString(c)&&0!==c.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(c=this.TRACKING_SERVER_SSL_PREFIX+c),g.isString(b)&&(b=b.replace("heartbeats.omtrdc.net","newimagitasinc.hb.omtrdc.net"))),this._appMeasurementData={account:a(this.ACCOUNT_PARAM_NAME),charSet:a(this.CHAR_SET_PARAM_NAME),trackingServer:c},this._heartbeatData={publisher:a(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:b},this._visitorData={marketingCloudOrgId:a(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:c},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var a=this.cviModel.sessionOptions;this._usesTealium=a.usesTealium;var b={ftag:"ftag",netwk:"Network"};g.each(b,function(b,c){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",b,c);var d=a[c];g.isNull(d)||g.isUndefined(d)||g.isEmpty(d)||(this._sessionMetadata[b]=d)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.AD_POD_START]=this._onAdPodStart.bind(this),b[a.AD_POD_END]=this._onAdPodEnd.bind(this),b[a.AD_CLICK]=this._onAdClick.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.CONTROL_SEEK]=this._onControlSeek.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),b[a.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),b[a.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),b[a.PLAYER_LOADED]=this._updateVideoInfo.bind(this),b[a.RESOURCE_START]=this._updateVideoInfo.bind(this),b[a.VIDEO_RESUME]=this._updateVideoInfo.bind(this),b[a.VIDEO_DONE]=this._updateVideoInfo.bind(this),b[a.VIDEO_CUEPOINT]=this._onVideoCuePoint.bind(this),this._contextMetadataCBSetup||(b[a.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(b)},_setupContextMetadataEventCallback:function(){var a={};a[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(a),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function a(a){this._agent=a}var h,i,j,k;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded."));if(this._mediaHeartbeat)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used."));if(b=ADB.va.MediaHeartbeat,c=ADB.va.MediaHeartbeatConfig,d=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!f(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)i=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(h=this._appMeasurementData.account,g.isString(h)&&g.isEmpty(h))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));try{try{this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent new Visitor"),k=new Visitor(this._visitorData.marketingCloudOrgId)}catch(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Visitor.getInstance",k),k=Visitor.getInstance(this._visitorData.marketingCloudOrgId)}}catch(a){this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed.")}k.trackingServer=this._visitorData.trackingServer,k.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),i=new AppMeasurement(h),i.visitor=k,i.account=h,i.trackingServer=this._appMeasurementData.trackingServer,i.pageName=this._appMeasurementData.pageName,i.charSet=this._appMeasurementData.charSet,i.visitorID=this._appMeasurementData.visitorID}if(g.isNull(i))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."));j=new c,j.trackingServer=this._heartbeatData.trackingServer,j.playerName=this._playerName,j.channel=this._heartbeatData.channel,j.debugLogging=this._heartbeatDebug,j.appVersion=this.SDK_VERSION,j.ssl=this.mc.isSecure(),j.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",j),g.extend(a.prototype,d.prototype),a.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},a.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new b(new a(this),j,i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad()},_getTealium:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),f(this._s)||this._waitForTealium?void(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),g.has(window,"s")&&f(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(a,c){if(g.isNull(this._mediaHeartbeat))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined"));switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",a),a){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(b.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(b.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(b.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(b.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(b.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(b.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(c)}},_getContentVideoMetadata:function(){var a,b,c=this.cviModel.getContentVideoState(),d=this._contextMetadata,e=this._sessionMetadata,f={};for(a in d)d.hasOwnProperty(a)&&(f[a]=d[a]);for(a in e)e.hasOwnProperty(a)&&(f[a]=e[a]);if(c.contextMetadata){b=c.contextMetadata;for(a in b)b.hasOwnProperty(a)&&(f[a]=b[a])}return f.tl=c.videoTitle,f.mediaAutoPlay=this.cviModel.isAutoplay.toString(),f.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),f.mediaIsPaidContent=c.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",f),f},_onContextMetadata:function(a){var b,c=a.payload.contextMetadata;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",a),!g.isEmpty(c)&&(this._contextMetadata=c,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),g.isEmpty(c[this.PAGE_REPORT_SUITE_ID_KEY]),b=c[this.PAGE_SITE_ACCOUNT_KEY],!g.isEmpty(b))){var d=g.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=b,d&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+b),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat,this._startUpTime),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:this._startUpTime,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(a){var c,d,e,f,g,h=a.chapterStartTimes,i=h&&h.length||0,j=parseInt(a.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",a),isNaN(j)&&(j=1),c=j<0?0:j-1,d=c<=0?0:h[c],e=c+1>i?a.duration:h[c+1],g=e-d,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",e,d),f={},f.name="",f.length=isNaN(g)?0:g,f.position=j,f.startTime=h[c],this._chapterObject=b.createChapterObject(f.name,f.position,f.length,f.startTime),this._chapterInfo=f,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(a){var c,d,e,f,h,i;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",a),i=a.payload.adData,h=i.adClipID.split("_"),f=h[0],"pre"===f?e=1:"mid"===f?e=parseInt(h[1])+1:"post"===f&&(e=this.cviModel.getNumberOfAdPods()),d={},d.name=g.isEmpty(i.adVideoTitle)?"na":i.adVideoTitle,d.position=e,d.playerName=this._playerName,d.startTime=this.getCurrentPlaybackTime(),c={},c.id=g.isEmpty(i.adVideoId)?g.isEmpty(i.adVatId)?"na":i.adVatId:i.adVideoId,c.name=d.name,c.length=i.duration,c.position=i.adPosition,this._adObject=b.createAdObject(c.name,c.id,c.position,c.length),this._adBreakObject=b.createAdBreakObject(d.name,d.position,d.startTime),this._adInfo=c,this._adBreakInfo=d,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(a){var b=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(b)},_onAdClick:function(a){var b=!0===a.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),b&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(a){var b=a.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",b),this._contentStarted=!0,this._startUpTime=Math.abs(new Date-this.trackingMgr.resourceStartTime)/1e3,this._sendInitialPlay(),b.chapterStartTimes.length>0&&(this._setChapterInfo(b),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(a){var b=a.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",b),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&b.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(a){var b=this._videoInfo,c=this._contentStarted&&b&&Math.ceil(b.playhead)>=.95*b.length,d=this.cviModel.getContentVideoState().isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",c),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,!d&&c&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(a){var b=a.payload.newState,c=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",b),this._videoLoaded&&(this._isBuffering||b!==this.mc.BUFFERING?this._isBuffering&&b!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),b===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),c&&b===this.mc.PAUSED&&this._onControlPause(a))},_updateVideoInfo:function(){var a,c=this.cviModel.getCurrentPlaybackState(),d=this.cviModel.getContentVideoState(),e=b.StreamType,f=d.duration,h=d.isLive,i=d.episodeFlag,j={};g.isEmpty(d.cmsRefGuid)?g.isEmpty(d.mediaId)?g.isEmpty(d.pid)?g.isEmpty(d.assetURL)?j.id="na":j.id=d.assetURL:j.id=d.pid:j.id=d.mediaId:j.id=d.cmsRefGuid,j.name=d.videoTitle,j.playerName=this._playerName,j.length=h?this.LIVE_CONTENT_LENGTH:isNaN(f)?0:f,j.playhead=c.currentTime,h?a=e.LIVE:(a=e.VOD,a+=":"+(i?this.FULL_EPISODES:this.CLIPS)),j.streamType=a,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",b),this._mediaObject=b.createMediaObject(j.name,j.id,j.length,j.streamType),this._videoInfo=j,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(a){var b=a&&a.facadeState,c=this._qosObject;b&&c&&(c.bitrate=b.currentBitrate||0,c.droppedFrames=b.droppedFrames||0,c.fps=b.playbackFramerate||0)},_updatePlayhead:function(a){var b=a.payload;this._videoInfo&&b&&(b.isAd||(this._updateQosObj(b),this._videoInfo.playhead=b.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)},_onVideoCuePoint:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoCuePoint",a),this._isSegmentOwner(a.payload)){var b=a.payload.data;b=b.split("|"),b.length>0&&this._segmentStart({segmentId:b[0],segmentTitle:b[1]})}},_segmentStart:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _segmentStart",a),a.segmentId){this._mediaHeartbeat.trackComplete(),this._mediaHeartbeat.trackSessionEnd(),this._mediaObject.data["a.videoId"]=a.segmentId,this._mediaObject.data["a.name"]=a.segmentTitle;var b=this._getContentVideoMetadata();b.tl=a.segmentTitle,this._mediaHeartbeat.trackSessionStart(this._mediaObject,b),this._mediaHeartbeat.trackPlay()}},_isSegmentOwner:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _isOwner",this._segmentOwner),a.data&&a.data.indexOf("|")>-1&&a.name===this._segmentOwner}}),e=function(){return"undefined"==typeof ADB||"undefined"===g.get(ADB,"va.Heartbeat")},f=function(a){return g.isObject(a)&&!g.isEmpty(a)&&g.isFunction(a.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(a){var b,c=a._,d=function(a){return(a>0&&a<10?"0":"")+a.toString()},e="*null",f={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};a.ComScoreAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var a=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:a("c2")||"3005086",ns_st_pu:a("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.RESOURCE_START]=this._onResourceStart.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),b[a.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){if(b())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."));this._setupEventCallbacks()},_createStreamingTag:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",a),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(a)},_getContentMetadata:function(){var a,b,c=this.cviModel.getContentVideoState(),g=(this.cviModel.getContentPlaybackState(),uvpjs.util),h=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),i=this.cviModel.getContentVideoState().isLive,j=parseInt(c.episodeNumber),k=parseInt(c.seasonNumber),l=(c.seriesTitle,c.videoTitle),m=l&&l.split("-")[1],n=!isNaN(j),o=!isNaN(k),p=null!==c.contextMetadata&&c.contextMetadata.comscore_c4,q=l;n&&o&&(a=d(j),b=d(k),q+="--"+b+a);var r={ns_st_ci:g.getDefinedString(c.cmsRefGuid,c.mediaId,"0"),ns_st_cl:i?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[f.publisherBrand],ns_st_pr:g.getDefinedString(c.seriesTitle,c.videoTitle),ns_st_ep:m,ns_st_sn:o&&b||e,ns_st_en:n&&a||e,ns_st_ge:c.category||e,ns_st_ia:i?1:0,ns_st_ddt:e,ns_st_tdt:e,ns_st_st:h("c4")||e,ns_st_ce:c.episodeFlag?1:0,c3:h("c3")||this._playerName,c4:p||h("c4")||e,c6:h("c6")||q};return["ns_st_ge","ns_st_st","ns_st_pu","ns_ap_an","ns_st_ddt","ns_st_tdt"].forEach(function(a){var b=h(a);b&&(r[a]=b)}),r},_onAdStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",a),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",a),this._isAd=!1,this._trackStop()},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",a);var b=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?b.Live:b.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",a),this._trackStop()},_onControlPlay:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",a),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",a),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",a),this.streamingTag=null},_onLiveSegmentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",a),this._isLiveEvent(a)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=a.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",a),this._trackStop()},_onVideoProgress:function(a){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",a);var b=a.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(b===this._mc.PAUSED?this._onControlPause(a):b===this._mc.PLAYING&&this._onControlPlay(a))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=a.util.copyObjectWithKeyMap(f).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(a){return this.cviModel.getContentVideoState().isLive&&a.payload&&a.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof a.payload.liveSegmentData},_isSameLiveStation:function(a){return a.stationTitle===this._contentMetadata[f.stationTitle]},_getAdType:function(){var a,b=ns_.ReducedRequirementsStreamingAnalytics.AdType,c=this.cviModel.getAdVideoState().adClipID.split("_")[0];return a="pre"===c?b.LinearOnDemandPreRoll:"mid"===c?b.LinearOnDemandMidRoll:b.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(a=b.LinearLive),a}}),b=function(){return"undefined"==typeof ns_||c.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(a){"use strict";a.ConvivaAgent=uvpjs.Class.subClass({init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",a),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventTypes=a.eventsMgr&&a.eventsMgr.eventTypes||null,this.moduleName=a.moduleName,this.playerName=a.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null,this.contextMetadata=this.trackingMgr.contextMetadata||{}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.contextMetadata=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0===window.Conviva)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded."));var a=this.eventTypes,b=this.adEventHandlerMap={};b[a.AD_POD_START]=this.hPodStart.bind(this),b[a.AD_POD_END]=this.hPodEnd.bind(this),b[a.AD_LOADED]=this.hAdLoaded.bind(this),b[a.AD_START]=this.hAdStart.bind(this),b[a.AD_END]=this.hAdEnd.bind(this),b[a.AD_ERROR]=this.hAdError.bind(this),b[a.AD_BUFFERING]=this.hAdBuffering.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))},_getAdType:function(a){var b="string"==typeof a?a.toLowerCase():null,c=Conviva.Client.AdPosition,d=uvpjs.ConvivaAgent.adPositions;return b?b.indexOf(d.PRE)>=0?c.PREROLL:b.indexOf(d.MID)>=0?c.MIDROLL:b.indexOf(d.POST)>=0?c.POSTROLL:void 0:c.PREROLL},_getArgsForStartAd:function(a){var b=Conviva.Client.AdStream,c=Conviva.Client.AdPlayer,d="ima"==a.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(a.adType),stream:d?b.SEPARATE:b.CONTENT,player:d?c.SEPARATE:c.CONTENT}},_onAdEvent:function(a){var b=a.type;this.startEvents.content=0,this.hasConvivaSession||b===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[b](a.payload,a)},hPodStart:function(a,b){this.podCount++,this._onContentPaused(b),this.currAdPodInfo=this._buildAdPodInfo(a.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var c=this._getArgsForStartAd(a);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(c.key,c.stream,c.player,c.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",c),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(a,b){var c=this._buildAdInfo(a);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,c),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(a,b){this.adPodInProgress&&this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(a,b){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(a,b){var c=this.currAdPodInfo||{},d=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(d)||d===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",c),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(a,b){var c=a.errorInfo;this.hasConvivaAdSession?(this._sendError(c.errorCode,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",c)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",c)},hAdBuffering:function(a,b){this.hasConvivaAdSession?(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_BUFFERING")):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad buffering - no session key")},_onContentEvent:function(a){var b=!1;this.startEvents.ad=0,a.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),b=!0):a.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,b=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),b&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(a){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(a){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(a){!this.isSeekPending&&this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(a){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",a),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*a.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(a){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",a),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(a){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",a),this._onContentPlaying(a),this.isSeekDone=!1)},_onVideoEvent:function(a){var b=this.eventTypes;switch(a.type){case b.VIDEO_STATE_CHANGE:var c=a.payload.newState,d=this._getMediaCapabilities();this.hasConvivaAdSession?c===d.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(a):c===d.PAUSED&&this._onAdPaused(a):this.hasConvivaSession&&(c===d.PLAYING?this._onContentPlaying(a):c===d.PAUSED?this._onContentPaused(a):c===d.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(a));break;case b.VIDEO_TRANSITION_COMPLETE:case b.VIDEO_DONE:this._onVideoTransition(a);break;case b.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(a){var b=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,c=new Conviva.ContentMetadata;c.defaultResource=this._validateStr(a.payload.cdn,""),this.convivaClient.updateContentMetadata(b,c)},_onError:function(a){var b=a.payload.errorInfo;b.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(b.errorCode,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(b.errorCode,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(a){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",a),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(a){var b=a.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(b>0&&(b*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",b),this.convivaPlayerStateManager.setBitrateKbps(b))},_onContextMetadata:function(a){this.contextMetadata=a.payload.contextMetadata||{}},_createConvivaSession:function(){if(this.convivaClient){var a=this.cviModel,b=(this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,{userId:a.getSessionOption("userId"),userPPID:a.getSessionOption("userPPID"),userStatus:a.getSessionOption("userStatus")}),c=new Conviva.ContentMetadata;this._setContentMetadata(c,b),this.convivaSessionKey=this.convivaClient.createSession(c),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(a,b){var c=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",a,b),this.convivaClient&&this.convivaClient.sendCustomEvent(c,a,b)},_sendError:function(a,b,c){if(this.hasConvivaSession){var d="";a=uvpjs.mapErrorCode(a).toString(),!0===c?(d=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,a,b)):this.convivaPlayerStateManager.sendError(a,b),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+d+" ERROR: "+a)}},_setConvivaPlayerState:function(a){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",a),this.convivaPlayerStateManager.setPlayerState(a))},_setContentMetadata:function(a,b){var c=this.cviModel,d=Conviva.ContentMetadata.StreamType,e=c.contentVideoState,f=e.defaultBitrate;a.applicationName=this.playerName,a.assetName=this._validateStr(e.videoTitle,"N/A"),a.defaultBitrateKbps=f&&f>0?f:700,a.defaultResource=this._validateStr(e.cdn,""),a.duration=e.duration,a.streamType=e.isLive?d.LIVE:d.VOD,a.streamUrl=this._validateStr(e.assetURL,"N/A"),a.viewerId=this._validateStr(b.userId,"N/A"),a.custom={accessType:this._validateStr(b.userStatus,"anon"),contentId:this._validateStr(e.cmsRefGuid,"N/A"),contentType:e.isLive?"Live":"VOD",isEpisode:e.episodeFlag?"true":"false",Partner_ID:this._validateStr(c.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(e.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._getEpisodeTitle(e),appRegion:this._validateStr(c.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:e.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(e.drm),showId:this.contextMetadata.showId&&this._validateStr(this.contextMetadata.showId.toString(),""),connectionType:this._validateStr(c.sessionOptions.userConnectionType,"unknown")}},_getEpisodeTitle:function(a){if(a.isLive)return a.videoTitle||a.episodeTitle;var b=this._validateStr(a.episodeTitle,a.videoTitle);return b.search(/\w+.*-.*\w+/)>-1&&(b=b.split("-")[1]),b.replace(/^\s+|\s+$/g,"")},_getWinDimension:function(){var a=this.cviModel.contentVideoState.sourceWidth,b=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(a=window.screen.width),window.screen.height&&(b=window.screen.height)),a+"x"+b},_createConvivaClient:function(){var a=this._getConvivaClientSettings();return a?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(a,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var a,b=this.moduleParams;return this._isValidStr(b.customerKey)&&this._isValidStr(b.serviceUrl)?(a=new Conviva.ClientSettings(b.customerKey),a.heartbeatInterval=b.heartbeatInterval||this.defaultHeartbeatInterval,a.gatewayUrl=b.serviceUrl,a):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(a){var b="development"===uvpjs.Configuration.env,c=Conviva.SystemSettings.LogLevel;a.allowUncaughtExceptions=b,a.logLevel=b?c.WARNING:c.NONE},_createConvivaSystemFactory:function(){var a=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),b=new Conviva.SystemSettings;return this._setConvivaSystemProps(b),new Conviva.SystemFactory(a,b)},_buildAdPodInfo:function(a){var b,c,d,e,f={};uvpjs.ConvivaAgent.adPositions;return a?(void 0!==a.podDuration&&(f.podDuration=String(a.podDuration)),a.adPodId?(b=a.adPodId.split("_"),c=b[0].toLowerCase(),d=c.charAt(0).toUpperCase()+c.slice(1),e=String(a.imaPodIndex+1),f.podPosition=d+"-roll",f.podIndex=this.podCount,f.absoluteIndex=e,f):f):null},_buildAdInfo:function(a){var b=new Conviva.ContentMetadata,c=a.adData,d=a.imaAdData||{},e=this.cviModel.getSessionOption("partner");if(!a)return null;b.adTitle="("+c.adVideoId+")"+c.adVideoTitle,b.assetName=b.adTitle,b.adClipId=this._validateStr(c.adClipID,"N/A"),b.Partner_ID=this._validateStr(e,"N/A"),b.adServerName=this._validateStr(c.adServerName,"N/A"),b.streamUrl=this._validateStr(c.adAssetUrl,"N/A"),b.duration=c.duration,b.streamType=Conviva.ContentMetadata.StreamType.VOD;var f=c.adType;return b.custom={"c3.ad.technology":"Client Side","c3.ad.id":d.adId||c.adVideoId,"c3.ad.system":d.adSystem||c.adServerName,"c3.ad.position":f.charAt(0).toUpperCase()+f.substr(1)+"roll","c3.ad.mediaFileApiFramework":d.apiFramework,"c3.ad.sequence":d.adPodInfo?d.adPodInfo.adPosition:c.adPosition,"c3.ad.creativeId":d.creativeId||c.creativeId,"c3.ad.advertiser":d.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",b),b},_isValidStr:function(a){return uvpjs.util.isDefinedString(a)},_validateStr:function(a,b){return this._isValidStr(a)?a:b},_isDynamicStreaming:function(a){var b=a.split("?");return"mp4"===b[0].substr(b[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var a,b=this.cviModel,c=b.getModule(this.moduleName),d=c.params,e=d.length,f={};e--;)a=d[e],f[a.name]=a.value;this.moduleParams=f},_setupEventCallbacks:function(){var a=this.eventTypes,b={},c=this._onAdEvent.bind(this),d=this._onContentEvent.bind(this),e=this._onVideoEvent.bind(this),f=this._onError.bind(this);b[a.AD_POD_START]=c,b[a.AD_LOADED]=c,b[a.AD_START]=c,b[a.AD_END]=c,b[a.AD_POD_END]=c,b[a.AD_ERROR]=c,b[a.AD_BUFFERING]=c,b[a.CONTENT_DATA_LOADED]=d,b[a.CONTENT_START]=d,b[a.CONTENT_END]=d,b[a.VIDEO_STATE_CHANGE]=e,b[a.VIDEO_TRANSITION_COMPLETE]=e,b[a.VIDEO_DONE]=e,b[a.RESOURCE_END]=e,b[a.PLAYER_START_ERROR]=f,b[a.VIDEO_START_ERROR]=f,b[a.VIDEO_PLAYBACK_ERROR]=f,b[a.CDN_UPDATED]=this._onCdnUpdated.bind(this),b[a.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),b[a.CONTROL_SEEK]=this._onControlSeek.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),b[a.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(b),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),a.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(a){"use strict";a.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},adType:{LINEAR:"1",DYNAMIC:"2"},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",a),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var a,b,c,d=this.cviModel,e=this._metadata,f=d.sessionOptions.partner,g=d.getModule(this._moduleName),h=g.params,i=h.length,j={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");i--;)a=h[i],""!==a.value&&(j[a.name]=a.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:j[this.NIELSEN_SFCODE_PARAM_NAME],apid:j[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:j[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},f){case"chow":b="us-700144",c="c06";break;case"tvcom":b="us-200330",c="c03";break;case"cbs":case"can":b="us-700144",c="c01";break;case"cbssports":case"cbssports_test":b="us-201669",c="c02";break;case"news":b="us-700144",c="c03";break;case"gamespot":b="us-200330",c="c13";break;case"cnettv":b="us-200330",c="c05";break;default:b="us-700144",c="c01"}e.ci=j.clientid||b,e.c6=j.vcid||c,e.iag_sid=j.iag_sid,e.iag_tfid=j.iag_tfid,e.channelName=j.channelName,e.segB=j.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",j,e)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_POD_START]=this._onAdPodStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),b[a.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){if(b())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."));window.NOLBUNDLE&&"function"==typeof window.NOLBUNDLE.nlsQ?this._gg=window.NOLBUNDLE.nlsQ(this._nolggGlobalParams.apid,"_gg"+(new Date).getTime()):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams)),this._setupEventCallbacks()},_notifySDK:function(a,b){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",a,b),this._gg.ggPM(a,b))},_onContentDataLoaded:function(a){var b,c,d,e,f,g,h,i,j=uvpjs.mediaCapabilities.isMobile(),k=this._metadata,l=a.payload;l&&(b=a.payload.vidState,d=b.chapterStartTimes.length>0?"lf":"sf",f=b.episodeNumber,g=b.seasonNumber,h=b.seriesTitle,i=b.videoTitle,c=b.duration,e=[i,g,f,d].join("|"),""===g&&(g="0"),""===f&&(f="0"),b.isAffiliateFeed&&(k.tv="true"),(b.isLive||-1===c)&&(c=this.NIELSEN_LIVE_VIDEO_DURATION),k.pc=k.ci+k.c6+k.cmsRefGuid,k.c10="plt,"+(j?"MBL":"DSK"),k.sd=c,k.dur=c,k.cg=h,k.tl=e,k.videotype="content",k.guid=b.cmsRefGuid,k.seriestitle=h,k.episodetitle=i,k.isfullepisode=b.episodeFlag?"y":"n",k.crossId1=b.mediaId,k.iag_pgm=i,k.iag_epi=e,k.iag_pd=location.hostname,k.iag_fp=d,k.iag_cte="na",k.iag_oad="na",k.iag_seg=1,this._metadata.adloadtype=b.isLive?this.adType.LINEAR:this.adType.DYNAMIC,this._isRcoTypeDai()&&(this._metadata.adloadtype=this.adType.DYNAMIC),this._metadata.adModel=this._metadata.adloadtype,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",k))},_onAdStart:function(a){var b,c,d,e,f,g,h,i,j,k,l=this.cviModel.getContentVideoState(),m=a.payload;m&&(this._metadata.hasAds=1,this._adDisplayed=!0,k=uvpjs._.clone(this._metadata),b=m.adData,c=b.adClipID.split("_"),e=c[0],i=this.cviModel.getNumberOfAdPods(),j="post"===e?i:++c[1],d=["dav0",l.videoTitle,l.seasonNumber,l.episodeNumber].join("-"),h=[i,j,this._numAdsInPod,c[2]].join("_"),f=b.adVatId,g=b.adVideoUrl,""!==f&&(g+="|"+f),k.videotype=e+"roll",k.iag_cte=g,k.iag_pod=h,k.iag_apt="na",k.tl=d,k.c3="st,a","pre"===e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",k),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,k))},_onAdPodStart:function(a){var b=a.payload;b&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",b.adPod.adCount),this._numAdsInPod=b.adPod.adCount)},_onAdEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(a){var b,c=a.payload;if(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),c){if(this._metadata.iag_seg&&this._metadata.iag_seg++,b=a.payload.contentData,b.duration>0&&Math.abs(b.duration-this._lastContentSecond)<=5)return void this._notifySDK(this.events.END,this._lastContentSecond);this._notifySDK(this.events.STOP,this._lastContentSecond)}},_onControlPlay:function(a){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(a){var b,c=a.payload;if(c&&!((b=Math.floor(c.currentTime))<0)){if(c.isAd){if(this._lastAdSecond===b)return;this._lastAdSecond=b}else{if(this._lastContentSecond===b)return;this._lastContentSecond=b}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,b)}},_onVideoCuepoint:function(a){var b=a.payload,c=b.data;b.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&c&&"string"==typeof c&&this._notifySDK(this.events.SEND_ID3,c)},_hasAds:function(){var a=this.cviModel.getNumberOfAdPods();return-1===a?2:0===a?0:1},_isDisabled:function(){var a=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===a||!0===a},_isRcoTypeDai:function(){var b=this.cviModel.cviMgr.RPM.currRP;return!(void 0===b||null===b)&&b.rco.type===a.mediaCapabilities.RP_DAI}});var b=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),function(a){var b,c,d,e=a._;a.DWAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"",RESUME_BEACON_URL:"",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var a=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),a.componentid=this.trackingMgr.componentid,a.device=this._getDevice(),a.mapp=this._playerName,a.part=this.cviModel.getSessionOption("partner"),a.playertime=0,a.siteid=this.trackingMgr.DEFAULT_SITEID,a.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var a=this.cviModel,b=a.getSessionOption("cms"),c=a.getContentVideoState(),d=a.getCurrentPlaybackState(),e=uvpjs.mediaCapabilities,f=this._tags.content,g=this._tags.ad,h=this.trackingMgr;g.adastid=b===h.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(f.medastid)||0===f.medastid||"0"===f.medastid)&&(c.isLive?c.isAffiliateFeed?f.medastid="cbsnews"===a.getSessionOption("playerId")?"601":"600":d.isHDStreamLive||e.isChromecast()?f.medastid="601":f.medastid="0":f.medastid=b===h.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",f.medastid,g.adastid))},_loadConfigParams:function(){for(var a,b,c,d=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),f=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],g=f.length;g--;)b=f[g],a=this._getTagType(b),c=d(b),e.isUndefined(a)||e.isEmpty(c)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",b,c),this._tags[a][b]=c);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var a,b,c,d=window.DW&&window.DW.pageParams||{};this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams");for(a in d)d.hasOwnProperty(a)&&(c=d[a],e.isEmpty(c)||(this._pageParams[a]=c,b=this._getTagType(a),e.isUndefined(b)||(this._tags[b][a]=c)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.AD_BLOCKED]=this._onAdBlocked.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.AD_QUARTILE]=this._onAdQuartile.bind(this),b[a.AD_ERROR]=this._onAdError.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.USER_GESTURE]=this._onUserGesture.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(b),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var a=this.trackingMgr.progressEvents,b={};b[a.FIRST_QUARTILE]=this._onProgressEvent.bind(this,a.FIRST_QUARTILE),b[a.MID_QUARTILE]=this._onProgressEvent.bind(this,a.MID_QUARTILE),b[a.THIRD_QUARTILE]=this._onProgressEvent.bind(this,a.THIRD_QUARTILE),b[a.TIMED]=this._onProgressEvent.bind(this,a.TIMED),this.trackingMgr.registerProgressEvents(b)},_sendDWEvent:function(a){var b=this._tags.content,e=b.event,f=e===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),b.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:d(this._gestval),e!==this.events.INIT&&(b.playertime=this._getPlayerTime()),b.ts=+new Date,f+=c(b),a&&(f+="&"+c(this._tags.ad)),this.trackingMgr.fireTrackingPixel(f),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",f),this._gestval={},b.gestval="",b.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var a=window.location,b=uvpjs.mediaCapabilities,c=b.isMobile()?"mobile%20web":"desktop%20web",d=this.cviModel.getSessionOption("userStatus"),f=this.cviModel.getSessionOption("userId"),g=this._tags.content,h=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,g.event=this.events.INIT,g.mso=this.trackingMgr.mso,g.pageurl=a.href,g.srchost=a.host,g.ursuid=f,g.v16=h.viewguid,g.v17=h.topic,g.v18=h.topicbrcrm,g.v19=h.pagetype,g.v20=h.assetguid,g.v21=b.isChromecast()?"chromecast":c,g.v23=h.rsid,g.v25=e.isEmpty(d)?"anon":d,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(a){var b=this.trackingMgr.progressEvents,c=this._tags.content,d=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",a),a)switch(a){case b.FIRST_QUARTILE:d.pct=25;break;case b.MID_QUARTILE:d.pct=50;break;case b.THIRD_QUARTILE:d.pct=75}c.event=this.events.PLAY,this._sendDWEvent(),delete d.pct}},_onAdBlocked:function(a){this._tags.ad;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",a),this._setCMSDependentValues(),this._setStartTags(a),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(a){var b=this._tags.ad,c=a.payload.adData,d=c.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",a),this._setCMSDependentValues(),this._setStartTags(a),this._updateTimeTags(),b.adid=e.isEmpty(c.adVideoId)?"999":c.adVideoId,b.adnum=this.cviModel.adNum,b.adtime=0,b.adtitle=c.adVideoTitle,b.adtype=c.isLinear?1:2,b.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),b.adbreak="",b.adpos=d[0],b.adpod=d[1],b.adpodpos=d[2],this._sendDWEvent(!0)},_onAdQuartile:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",a),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(a){var b=a.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",a),this._tags.content.event=this.events.END,this._tags.ad.adtime=b.duration,this._sendDWEvent(!0)},_onAdError:function(a){var b=a.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",a),b===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(a){var b=this.cviModel,c=b.getContentVideoState(),d=this._tags.content,f=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",a),d.event=this.events.START,d.codec=c.fileType,d.distntwrk=b.getSessionOption("netwk"),d.playersz=this._getPlayerSize(),d.sdlvrytype=this._getStreamType(),d.v22=c.cmsRefGuid,d.medid=c.mediaId,d.medlength=this.trackingMgr.getContentLength()/1e3,d.mednum=b.medNum,d.medrls=c.pid,d.medtitle=c.videoTitle,d.contsessid=c.previousSessionId,e.isEmpty(c.contPlayState)||(f.autoplay=c.contPlayState),f.paywall=c.isPaidContent?"1":"0",f.caption_available=c.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",a),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(a),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var a=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(a.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),a.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(a){var b=a&&a.payload,c=b&&b.seekFromTime,d=b&&b.seekToTime,e=d-c,f=this._tags.content;f.eventdur=Math.floor(Math.abs(e)),f.event=e>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:c,seekToTime:d,seekDuration:e,event:f.event,eventdur:f.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(a){var b,c,d,f,g,h,i,j=this._tags.content,k=this._gestval,l=a.payload.gestureInfo,m=this.cviModel.contentVideoState,n=m.elapsedTime,o="",p=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",a),"string"==typeof l&&-1===l.indexOf("event="))return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.");if(e.isArray(l)){if(l.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");o=l[0]}if(m=this.cviModel.contentVideoState,"string"==typeof l)f=/event=([^&]*)(?:&gestval=(.*))?/,g=f.exec(l),h=g[1],i=g[2],j.event=h,j.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===i?"":i;else if(o===p.GLOBAL_RESUME||o===p.LOCAL_RESUME)k.prevcomponentid=m.previousSessionId,k.eventdur=n>0?Math.round(n/1e3):0,k.paywall=m.isPaidContent?"1":"0",j.event=this.events.RESUME,j.medtime=m.resumeContentTime;else if(o===p.CONT_CANCEL)k.action=this.events.PROMPT;else switch(j.medtime=this.cviModel.contentPlaybackState.currentTime,o){case p.RELATED_OVERLAY:j.event=p.RELATED_OVERLAY;break;case p.RELATED_CLICK_GESTURE:l.length>=2&&(k.related_pid=l[1]),j.event=p.RELATED_CLICK_GESTURE;break;case p.SHARE_OVERLAY:j.event=p.SHARE_OVERLAY;break;case p.SHARE_NETWORK_GESTURE:l.length>=2&&(k.network=l[1]),j.event=p.SHARE_NETWORK_GESTURE;break;case p.SEND_GESTURE:l.length>=2&&(b=l[1].split(","),c=b.shift(),d=b.join(","),k.sender=c,k.recipient=d),j.event=p.SEND_GESTURE;break;case p.EMBED_GESTURE:j.event=p.EMBED_GESTURE;break;case p.LINK_GESTURE:j.event=p.LINK_GESTURE;break;case p.REPLAY_GESTURE:j.event=p.REPLAY_GESTURE;break;case p.END_CARD_OVERLAY:j.event=p.END_CARD_OVERLAY;break;case p.ERROR_OVERLAY:j.event=p.ERROR_OVERLAY;break;case p.RECOMMEND_NOW:l.length>=3?(k.mediaid=l[1],k.pid=l[2]):(k.mediaid="",k.pid=""),j.event=p.RECOMMEND_NOW;break;case p.RECOMMEND_NEXT:l.length>=3?(k.mediaid=l[1],k.pid=l[2]):(k.mediaid="",k.pid=""),j.event=p.RECOMMEND_NEXT;break;case p.RECOMMEND_CLOSE:j.event=p.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",o)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",j),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",k)),this._sendDWEvent()},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(a){return e.has(this._tags.ad,a)?"ad":e.has(this._tags.content,a)?"content":void 0},_getStreamType:function(){var a=this.cviModel.getContentVideoState(),b=uvpjs.mediaCapabilities,c=a.deliveryType,d=a.isLive;return c===b.STREAMING?d?5:4:c===b.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var a=this._agentStartTime,b=e.isDate(a)&&parseInt((new Date-a)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",b),b},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var a=uvpjs.mediaCapabilities,b=window.screen,c={type:(a.getDevice()||"").toLowerCase(),os:(a.getOS()||"").toLowerCase(),ver:a.getOSVersion(),screensz:[b.width,b.height].join("x")};return d(c)},_getPlayerSize:function(){var a=this.cviModel.getContentVideoState();return[a.sourceWidth,a.sourceHeight].join("x")}}),b=function(a,b,c){var d,f,g=[];for(d in a)a.hasOwnProperty(d)&&(f=e.isUndefined(a[d])?"":encodeURIComponent(a[d]),g.push([d,f].join(b)));return g.join(c)},c=function(a){return b(a,"=","&")},d=function(a){return b(a,":",";")}}(uvpjs.register("uvpjs")),function(a){var b;a._,a.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var a=this.eventsMgr.eventTypes,b={};b[a.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.AD_QUARTILE]=this._onAdQuartile.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){var a={};if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),b())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."));a.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,a.streamHeadPosition=this.getStreamHeadPosition.bind(this),a.streamLength=this.getStreamLength.bind(this),a.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(a),this._setupEventCallbacks()},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var a=this.cviModel.adVideoState,b={};b.adTitle=a.adVideoTitle,b.adDuration=a.duration,b.id=a.adVideoId,b.adPartnerId=this.cviModel.sessionOptions.partner,b.adServer=a.adServerName,this.akamaiPlugin.handleAdLoaded(b)},setContentMetaData:function(){var a=this.cviModel,b=a.sessionOptions,c=this.akamaiPlugin,d=a.getContentVideoState(),e=a.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),c.setData("viewerId",a.getModuleParam(this._moduleName,"viewerID")),c.setData("partnerId",b.partner),c.setData("playerId",this.trackingMgr.getPlayerName("|")),c.setData("Host",b.host),c.setData("Referrer",b.referrer),c.setData("title",d.title),c.setData("category",d.category),c.setData("subCategory",d.sourceOwner),c.setData("show",d.title),c.setData("contentLength",1e3*e.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",a),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",a.payload),this.akamaiPlugin&&a.payload)switch(a.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",a),this.akamaiPlugin){var b=a.payload.newState;b!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),b===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",a),this.akamaiPlugin){this.akamaiPlugin.handlePlayEnd("Play.End.Detected")}},_onQosMetadata:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",a);var b,c;if(this.akamaiPlugin&&-1!==a.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI)){c=a.payload.paramsObj;for(b in c)this.akamaiPlugin.setData(b,c[b])}}}),b=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(a){this.cviModel=a.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",a),this.trackingMgr=a.trackingMgr,this.eventTypes=a.eventsMgr&&a.eventsMgr.eventTypes||null,this.moduleName=a.moduleName,this.playerName=a.playerName,this.playerVersion=a.playerVersion,this.useDefaultProperty=a.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var a=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!a&&!0===a[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){if(console.log("[MUX] _initializePlugin"),void 0===window.mux)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded."));this.cviModel&&this._setupEventCallbacks()},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var a=this.cviModel,c=this.moduleParams,d=b.assign({page_type:"",viewer_user_id:a.getSessionOption("userId"),experiment_name:c&&!uvpjs.util.isEmpty(c.experimentName)?c.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(c.subPropertyId)?a.getSessionOption("partner"):c.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:a.initTime},this._getMuxVideoData());return this.useDefaultProperty?d.property_key=this.MUX_DEFAULT_PROPERTY_KEY:d.property_key=c.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:d}),this.videoElement.mux},_getMuxVideoData:function(){var a=this.cviModel.contentVideoState;return{video_id:this._validateStr(a.cmsRefGuid,""),video_title:this._validateStr(a.videoTitle,""),video_series:this._validateStr(a.seriesTitle,""),video_producer:"",video_content_type:a.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:a.duration,video_stream_type:a.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(a.cdn,""),video_source_url:this._validateStr(a.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(a){return uvpjs.util.isDefinedString(a)},_validateStr:function(a,b){return this._isValidStr(a)?a:b},_onContentEvent:function(a){a.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(a){if(this.muxMonitor)switch(a.payload.facadeType){case this.mc.HLSJS:this.muxHLSJSMonitoring||(this.muxHLSJSMonitoring=!0,this.muxMonitor.addHLSJS({hlsjs:a.payload.player,Hls:window.Hls}));break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:a.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(a){var b=a.payload.errorInfo;b&&b.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:b.errorCode,player_error_message:b.message}))},_gatherModuleParams:function(a){var b,c=this.cviModel,d=c.getModule(a),e=d.params,f={};if(!e)return null;for(var g=e.length;g--;)b=e[g],f[b.name]=b.value;return f},_setupEventCallbacks:function(){var a=this.eventTypes,b={},c=this._onContentEvent.bind(this),d=this._onPlaybackLibraryLoaded.bind(this),e=this._onError.bind(this),f=this._onAdEvent.bind(this);b[a.CONTENT_DATA_LOADED]=c,b[a.PLAYBACK_LIBRARY_LOADED]=d,b[a.PLAYER_START_ERROR]=e,b[a.VIDEO_START_ERROR]=e,b[a.VIDEO_PLAYBACK_ERROR]=e,b[a.AD_ERROR]=e,b[a.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=f,b[a.AD_PLUGIN_CONTENT_RESUME_REQUEST]=f,b[a.AD_LOADED]=f,b[a.AD_START]=f,b[a.VIDEO_STATE_CHANGE]=f,b[a.AD_SKIPPED]=f,b[a.AD_END]=f,b[a.AD_ERROR]=f,b[a.AD_REQUEST]=f,b[a.AD_RESPONSE]=f,b[a.AD_QUARTILE]=f,this.trackingMgr.registerEventCallbacks(b)},_getMuxAdData:function(a){var b=a.payload.adData?a.payload.adData.adAssetUrl:a.payload.adAssetUrl;return{ad_tag_url:a.payload.adCallUrl,ad_asset_url:b}},_dispatchMuxAdEvent:function(a,b){a&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),b||(b={ad_tag_url:"",ad_asset_url:""}),b.ad_tag_url||(b.ad_tag_url=""),b.ad_asset_url||(b.ad_asset_url=""),window.mux.emit(this.videoElement,a,b))},_dispatchMuxEvent:function(a){window.mux.emit(this.videoElement,a)},_onAdEvent:function(a){var b=this.eventTypes,c=this.MUX_AD_EVENTS,d=this.MUX_EVENTS;switch(a.type){case b.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(d.PAUSE),this._dispatchMuxAdEvent(c.AD_BREAK_START);break;case b.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(c.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(d.PLAY),this._dispatchMuxEvent(d.PLAYING));break;case b.AD_LOADED:this._dispatchMuxAdEvent(c.AD_PLAY,this._getMuxAdData(a));break;case b.AD_START:this._dispatchMuxAdEvent(c.AD_PLAYING,this._getMuxAdData(a));break;case b.VIDEO_STATE_CHANGE:if(!a.payload.isAd)return;var e=a.payload.newState,f=a.payload.currentState;e===this.mc.PAUSED?this._dispatchMuxAdEvent(c.AD_PAUSE,this._getMuxAdData(a)):f==this.mc.PAUSED&&e===this.mc.PLAYING&&(this._dispatchMuxAdEvent(c.AD_PLAY,this._getMuxAdData(a)),this._dispatchMuxAdEvent(c.AD_PLAYING,this._getMuxAdData(a)));break;case b.AD_SKIPPED:case b.AD_END:this._dispatchMuxAdEvent(c.AD_ENDED,this._getMuxAdData(a));break;case b.AD_ERROR:this._dispatchMuxAdEvent(c.AD_ERROR,this._getMuxAdData(a));break;case b.AD_REQUEST:this._dispatchMuxAdEvent(c.AD_REQUEST,this._getMuxAdData(a));break;case b.AD_RESPONSE:this._dispatchMuxAdEvent(c.AD_RESPONSE,this._getMuxAdData(a));break;case b.AD_QUARTILE:switch(a.payload.percent){case 25:this._dispatchMuxAdEvent(c.AD_FIRST_QUARTILE,this._getMuxAdData(a));break;case 50:this._dispatchMuxAdEvent(c.AD_MIDPOINT,this._getMuxAdData(a));break;case 75:this._dispatchMuxAdEvent(c.AD_THIRD_QUARTILE,this._getMuxAdData(a))}}}})}(uvpjs.register("uvpjs")),function(a){a.OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isStopped:!1,resumeTime:-1,init:function(a){this.options=a,this.ozTamVo=new uvpjs.OzTamVo(this);var b=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(b.publisherId,b.vendorVersion,b.productionMode,b.verboseLogging,b.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",b,this.ozTamService)},initialize:function(){var a=this.options.eventsMgr.eventTypes,b=this.onVideoEvent.bind(this),c={};c[a.RESOURCE_START]=b,c[a.CONTENT_START]=b,c[a.CONTROL_SEEK]=b,c[a.SEEK_DONE]=b,c[a.CONTENT_END]=b,c[a.VIDEO_STATE_CHANGE]=b,c[a.VIDEO_PROGRESS]=b,c[a.USER_GESTURE]=b,this.options.trackingMgr.registerEventCallbacks(c)},onVideoEvent:function(a){var b=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out"));switch(a.type){case b.RESOURCE_START:this.onResourceStart(a);break;case b.CONTENT_START:this.onContentStart(a);break;case b.CONTROL_SEEK:this.onSeekStart(a);break;case b.SEEK_DONE:this.onSeekDone(a);break;case b.CONTENT_END:this.onContentEnd(a);break;case b.VIDEO_STATE_CHANGE:this.onVideoStateChange(a);break;case b.VIDEO_PROGRESS:this.onVideoProgress(a);break;case b.USER_GESTURE:this.onUserGesture(a)}},onResourceStart:function(a){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(a){this.ozTamService.seekBegin()},onSeekDone:function(a){this.ozTamService.seekComplete(),this.isStopped=!0},onContentEnd:function(a){this.ozTamService.complete()},onVideoStateChange:function(a){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(a.payload.newState){case uvpjs.mediaCapabilities.PAUSED:case uvpjs.mediaCapabilities.BUFFERING:this.isStopped||(this.isStopped=!0,this.ozTamService.haltProgress())}},onVideoProgress:function(a){this.isStopped&&(this.isStopped=!1,this.ozTamService.resumeProgress())},onUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"startTime",a.payload.startTime),a.payload.startTime>0&&(this.resumeTime=a.payload.startTime)},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}})}(uvpjs.register("uvpjs")),function(a){a.DatazoomAgent=uvpjs.TrackingAgent.subClass({metadata:{},init:function(a){this._super(a),this.vo=new uvpjs.DatazoomVo(this),this.sdkEvent=this.vo.Event,this.metadata={},(new uvpjs.CodeLoader).loadScript(this.vo.sdkUrl,this.onSdkReady.bind(this))},onSdkReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent SDK Ready"),this.hasSdk="function"==typeof window.setDatazoomMetadata},sendTrackEvent:function(a,b){if(this.hasSdk){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent "+a),b=b||{};for(var c in b)this.metadata[c]=b[c];switch(a){case"content_start":window.setDatazoomMetadata(this.format(this.metadata));break;case"cdn_updated":window.generateDatazoomEvent("CDNChange",this.format(b));break;case"content_complete":this.metadata={}}}},format:function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)&&a[c]&&"object"!=typeof a[c]){var d={};d[c]=a[c],b.push(d)}return this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent",b),b}})}(uvpjs.register("uvpjs")),function(a){a.DataModelVo=uvpjs.Class.subClass({agent:null,channelName:null,apiKey:null,contentInfo:{},getApiKey:function(){return this.apiKey},getPersistentData:function(a){var b=this.agent.options.cviModel,c=b&&b.getContentVideoState(),d=this.agent.contextMetadata,a=a||{};a.sessionId=b&&b.sessionId,a.contentAssetId=c&&(c.cmsRefGuid||c.mediaId)||"",a.playheadTime=a.playheadTime||this.getPlayhead(),a.playerTime=this.getPlayerElapsedTime();for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e]);return a},getSessionStartInfo:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=b.duration,d=a.contentPlaybackState.facadeState,e=b.isLive?-1:isNaN(c)?0:c,f=this.getDrmInfo(b.drm);return this.getPersistentData({adAssetId:a.adVideoState.adClipID,adPodId:a.adVideoState.adVideoId||a.adVideoState.adVatId,adType:a.adVideoState.adType,allowConcurrentPlayback:a.sessionOptions.allowConcurrentPlayback,bitrate:d.currentBitrate,channel:this.channelName,cdn:b.cdn,cms:a.sessionOptions.cms,currentIndex:1,"drm.dash.playreadyURL":f.playreadyURL,"drm.dash.widevineURL":f.widevineURL,"drm.enabled":f.enabled,"drm.fairplay.appCertURL":f.appCertURL,"drm.ticket":f.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(b.drm),enableMutedAutoplay:a.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:a.sessionOptions.enableNativeMobileAutoplay,enableReplay:a.sessionOptions.enableReplay,enableUnmutedAutoplay:a.sessionOptions.enableUnmutedAutoplay,framerate:d.playbackFramerate,fullScreen:a.isFullscreen,isAutoplay:a.isAutoplay,isMultiCDN:a.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:a.isMuteAtPlayStart,isMuted:b.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:e,livestream:b.isLive,liveSyncDurationCount:a.sessionOptions.liveSyncDurationCount,maxBitrate:a.maxBitrate,method:"",minBitrate:a.minBitrate,pageProvidesTealium:a.sessionOptions.usesTealium,pagetype:a.dwPageParams.pagetype,partner:a.sessionOptions.partner,pguid:a.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sound:a.volume,startTime:b.startTime,streamType:b.isLive?"Live":"VOD",title:b.videoTitle,totalLength:e,usesIMA:a.sessionOptions.usesIMA,userConnectionType:a.sessionOptions.userConnectionType,userCountry:a.sessionOptions.userCountry,userIsp:a.sessionOptions.userISP,userPpid:a.sessionOptions.userPPID,userStatus:a.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName})},getContentStartInfo:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=b.duration,d=a.contentPlaybackState.facadeState,e=b.isLive?-1:isNaN(c)?0:c;return this.contentInfo={assetUrl:b.assetURL,assetId:b.cmsRefGuid||b.mediaId,category:b.category,channel:this.channelName,chapterStartTimes:b.chapterStartTimes.join(","),closedCaptionPath:b.closedCaptionPath,cms:a.sessionOptions.cms,cmsRefGuid:b.cmsRefGuid,dfpMediaId:b.dfpMediaId,duration:e,episodeAbstract:b.episodeAbstract,episodeFlag:b.episodeFlag,episode:b.episodeNumber,excludeNielsenTracking:b.excludeNielsenTracking,fileType:b.fileType,genre:b.category,indexPosition:a.contentPlaybackState.currentContentSegment,is360:b.is360,isAffiliateFeed:b.isAffiliateFeed,isEmbedable:b.isEmbedable,isPaidContent:b.isPaidContent,mediaId:b.mediaId,overrideAssetURL:b.overrideAssetURL,program:b.videoTitle.split("-")[0],pguid:a.dwPageParams.pguid,playbackBitrate:d.currentBitrate,playheadTime:this.getContentStartPlayhead(),season:b.seasonNumber,seriesTitle:b.seriesTitle,showPreroll:b.showPreroll,startTime:b.startTime,useWatermark:b.useWatermark,title:b.videoTitle,totalLength:e},this.getPersistentData(this.contentInfo)},getContentCompleteInfo:function(){var a=this.agent.options.cviModel;return this.contentInfo.playbackBitrate=a.contentPlaybackState.facadeState.currentBitrate,this.getPersistentData(this.contentInfo)},getQuartileInfo:function(){var a=this.agent.options.cviModel;a.getContentVideoState();return this.getPersistentData()},getQosInfo:function(){var a=this.agent.options.cviModel,b=a.contentPlaybackState,c=a.contentPlaybackState.facadeState;return this.getPersistentData({averageDroppedFPS:b.averageDroppedFPS,bufferLength:b.bufferLength,currentContentSegment:b.currentContentSegment,currentMaxBandwidth:b.currentMaxBandwidth,currentTime:this.getPlayhead(),currentBitrate:c.currentBitrate,droppedFPS:c.droppedFPS,droppedFrames:c.droppedFrames,playbackFramerate:c.playbackFramerate})},getAdBreakInfo:function(){var a=this.agent.options.cviModel,b=a.adVideoState,c=b.adClipID.split("_"),d=1;return"post"===b.adType?d=a.getNumberOfAdPods():"mid"===b.adType&&(d=parseInt(c[1])+1),this.getPersistentData({indexPosition:d,startTime:this.getPlayhead(),title:b.adVideoTitle})},getAdItemInfo:function(){var a=this.agent.options.cviModel.adVideoState;return this.getPersistentData({adCallUrl:a.assetURL||a.adAssetUrl||a.adVideoUrl,adParams:a.adParameters,assetId:a.adVideoId||a.adVatId,indexPosition:a.adPosition,isCustomClickTrackingUsed:a.isCustomClickTrackingUsed,title:a.adVideoTitle,totalLength:a.duration})},getSeekInfo:function(){return this.getPersistentData({seekPosition:this.getPlayhead()})},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getContentStartPlayhead:function(){var a=this.getPlayhead();return this.agent.options.resumeTime&&this.agent.options.resumeTime>0&&(a=this.agent.options.resumeTime,this.agent.options.resumeTime=-1),a},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},getDrmInfo:function(a){return{playreadyURL:a.dash&&a.dash.playreadyURL?a.dash.playreadyURL:"",widevineURL:a.dash&&a.dash.widevineURL?a.dash.widevineURL:"",appCertURL:a.fairplay&&a.fairplay.appCertURL?a.fairplay.appCertURL:"",enabled:a.enabled||!1,ticket:a.ticket||""}},isCompletedMarker:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState();return!b.isLive&&this.getPlayhead()>=.95*b.duration},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}})}(uvpjs.register("uvpjs")),function(a){a.DatazoomVo=uvpjs.DataModelVo.subClass({Event:{SESSION_START:"session_start",CONTENT_START:"content_start",CONTENT_COMPLETE:"content_complete",CDN_UPDATED:"cdn_updated",PAUSE:"pause",STOP:"stop",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",PLAY_RESUME:"resume",SESSION_END:"session_end",AD_BREAK_START:"ad_break_start",AD_BREAK_COMPLETE:"ad_break_end",AD_START:"ad_start",AD_COMPLETE:"ad_end",AD_CLICK:"ad_click",QOS:"qos",FIRST_QUARTILE:"first_quartile",MID_QUARTILE:"mid_quartile",THIRD_QUARTILE:"third_quartile"},sdkUrl:"//platform.datazoom.io/beacon/v1/config?configuration_id=",init:function(a){this.agent=a;var b=this.agent.options;this.getModuleParam=b.cviModel.getModuleParam.bind(b.cviModel,b.trackingMgr.DATAZOOM_MODULE_NAME),this.sdkUrl+=this.getModuleParam("configId")}})}(uvpjs.register("uvpjs")),function(a){a.OzTamVo=uvpjs.Class.subClass({agent:null,init:function(a){this.agent=a;var b=this.agent.options;this.getModuleParam=b.cviModel.getModuleParam.bind(b.cviModel,b.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.getVendorVersion(),productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:top.location.href.search(/^https/)>-1}},getVendorVersion:function(){return[this.getModuleParam("platform"),uvpjs.mediaCapabilities.isMobile()?"Mobile-Web":"Desktop-Web",this.agent.options.playerVersion].join("_")},getMediaInfo:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=b.duration,d=function(){var b=a.getCurrentPlaybackState().currentTime;return this.agent.resumeTime>0&&(b=this.agent.resumeTime,this.agent.resumeTime=-1),b}.bind(this);return{mediaId:b.ozTamMediaId||b.cmsRefGuid||b.mediaId,url:b.assetURL,mediaDuration:b.isLive?-1:isNaN(c)?0:c,mediaType:b.isLive?"live":"vod",mediaPositionFunction:function(){return d()}}},getPropertyDictionary:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=a.getSessionOption("userId"),d=this.agent.ozTamService,e={};return b.ozTamMediaId&&(e[d.PROP_ALT_MEDIA_ID]=b.cmsRefGuid||b.mediaId),c&&(e[d.PROP_DEMO1]=c),e},isOzTamOptOut:function(){var a=this.agent.options.cviModel.getContentVideoState();return a.hasOwnProperty("ozTamOptOut")&&a.ozTamOptOut},getValue:function(a){return a.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}})}(uvpjs.register("uvpjs")),function(a){var b={concurrencyBeacon:{prodUrl:"",stageUrl:"",path:""}},c=!1,d=null,e=null,f=function(a){return a=a.replace(/\s/g,""),a.search(/^\/\//)>-1?a:"//"+a};a.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(a){return e=b.concurrencyBeacon,a&&a.prodUrl&&a.stageUrl&&(e.prodUrl=f(a.prodUrl),e.stageUrl=f(a.stageUrl)),this},queryParams:function(b){return d=a.util.queryStrFromObj(b,!1),this},devMode:function(a){return c=a,this},buildUrl:function(){return null===e?"Unable to build url.":(c?e.stageUrl:e.prodUrl)+e.path+(null===d?"":"?"+d)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(a){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=a.drm,this.videoTagRef=a.videoTagRef,this.eventTypes=a.eventTypes,this.errorCallback=a.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var a=this.getLicenseServerUrl(this.initData),b=this.getId(a);if(this.drmVendor=this.getDRMVendor(a),!b)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null);if(!this.videoTagRef.webkitKeys){var c=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(c,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(c))}if(!this.videoTagRef.webkitKeys)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null);var d=this.concatInitDataIdAndCertificate(this.initData,b,this.appCertData),e=this.videoTagRef.webkitKeys.createSession("video/mp4",d);if(!e)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null);e.contentId=b,e.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,a),!1),e.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),e.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)},loadAppCert:function(){b.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",a),this.appCertData=new Uint8Array(a.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(a){this.webKitNeedKeyCalled=!0,this.initData=a.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(a,b,c){"string"==typeof b&&(b=this.stringToArray(b));var d=0,e=new ArrayBuffer(a.byteLength+4+b.byteLength+4+c.byteLength),f=new DataView(e);new Uint8Array(e,d,a.byteLength).set(a),d+=a.byteLength,f.setUint32(d,b.byteLength,!0),d+=4;var g=new Uint8Array(e,d,b.byteLength);return g.set(b),d+=g.byteLength,f.setUint32(d,c.byteLength,!0),d+=4,new Uint8Array(e,d,c.byteLength).set(c),new Uint8Array(e,0,e.byteLength)},onLicenseRequestReady:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+a,b);var c=new XMLHttpRequest;c.session=b.target,c.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),c.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),c.open("POST",a,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?c.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(c.responseType="text");var d=encodeURIComponent(this.base64EncodeUint8Array(b.message)),e="spc="+d+"&"+c.session.contentId;c=this.setRequestHeaders(c),c.send(e)},onLicenseRequestLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",a);var c=a.target,d=c.session,e=null;b.inRange(c.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,a),this.drmVendor===this.DRM_VENDORS.DRMTODAY?e=this.base64DecodeUint8Array(c.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(e=new Uint8Array(c.response)),d.update(e)},onError:function(a,b){this.debug&&uvpjs.error(this.DEBUG_ID,a,b),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,a)},onKeyAdded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",a)},getLicenseServerUrl:function(a){var c=null;if(b.isEmpty(this.drm.fairplay.licenseURL)){c="https://"+String.fromCharCode.apply(null,new Uint16Array(a.buffer)).split("://")[1]}else c=this.drm.fairplay.licenseURL;return this.appendDRMQueryParams(c)},appendDRMQueryParams:function(a){var b=-1===a.indexOf("?")?"?":"&";return this.drm.sessionId&&(a+=b+"SessionId="+this.drm.sessionId),this.drm.ticket&&(a+="&Ticket="+this.drm.ticket),a},getDRMVendor:function(a){var b=null;return-1!==a.indexOf(this.DRM_VENDORS.DRMTODAY)?b=this.DRM_VENDORS.DRMTODAY:-1!==a.indexOf(this.DRM_VENDORS.IRDETO)&&(b=this.DRM_VENDORS.IRDETO),b},setRequestHeaders:function(a){if(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!b.isEmpty(this.drm.fairplay.header)){var c=this.drm.fairplay.header;for(var d in c)a.setRequestHeader(d,c[d])}return a},getId:function(a){var b=uvpjs.util.objFromQueryStr(a);return b.ContentId||b.contentId||b.assetId||null},base64EncodeUint8Array:function(a){var b=String.fromCharCode.apply(null,a);return btoa(b)},base64DecodeUint8Array:function(a){var b=window.atob(a),c=b.length,d=new Uint8Array(new ArrayBuffer(c));for(i=0;i<c;i++)d[i]=b.charCodeAt(i);return d},stringToArray:function(a){for(var b=new ArrayBuffer(2*a.length),c=new Uint16Array(b),d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return c}})}(uvpjs.register("uvpjs"))}();
})();