define(["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","managers/guid","utils/hash-functions","version!fly/components/base"],function(e,t,a,r,i,n){t=t.init("newsletterAjax"),e.widget("cnet.newsletterAjax",e.fly.base,{correlationId:null,options:{messageThankYou:"Thank you!",errorMessages:{"cnet.notsent":"There was an error attempting to send your e-mail.  Please try again.","cnet.nousername":"You must have a valid username to use this form.","cnet.notloggedin":"You must be logged in to use this form.","cnet.newsletter.optin":"Please check your email to confirm your subscription.","cnet.newsletter.invalid_email":"Please enter a valid e-mail address.","cnet.newsletter.error":"There was a problem submitting your request. Please try again later.","cnet_recaptcha.missing-input-secret":"The secret parameter is missing.","cnet_recaptcha.invalid-input-secret":"The secret parameter is invalid or malformed.","cnet_recaptcha.missing-input-response":"Please verify to help prevent automated abuse of this feature.","cnet_recaptcha.invalid-input-response":"The response parameter is invalid or malformed."},tracking:null,selector:{submitButton:'button[data-submit="subscribe"]'}},_create:function(){this._super(),this._setupEvents()},_setupEvents:function(){var t=this,a=this.$element,r=e(".newsletter-subscribe-form p.description"),n=e('[data-component="recaptcha"]',a),s=e('[data-email-var="error"]',a),o=e("input[type=checkbox][data-required]",a),l=e(t.options.selector.submitButton,a);o&&o.on("click",function(){this.checked?l.removeAttr("disabled"):l.attr("disabled",!0)}),this.correlationId=i.generateGuid(),this._trackFormView(),a.formValidate({success:function(i){i.preventDefault(),t._trackSubmit(),e.ajax({dataType:"json",url:a.attr("action"),data:a.serialize(),type:"POST"}).done(function(e){var i="string"==typeof e?JSON.parse(e):e;"success"===i.status?(t._trackSubmitSuccess(),r.hide(),a.html(t.options.messageThankYou)):(i.errors?s.text(i.errors[0]):s.text(t.options.errorMessages[i.message]),n.length&&n.recaptcha("reload"))})}})},_trackFormView:function(){a.trackCustomEvent("trackUserNewsletter",{cohesionData:{"@type":"redventures.usertracking.v3.FormViewed",formContext:{formBrand:"CNET",formId:n.sha256(this.$element.attr("data-newsletter")),formName:this.$element.attr("data-newsletter")+"- Signup",formType:"EmailCapture",formVersion:"1"},captureContext:{captureType:"Custom Form",capturePlacement:"signup"===r.tracking.data.slug?"Full Screen":"inline",valueProp:"Newsletter",identityRequested:!0}}})},_trackSubmit:function(){var e=[{autofilled:!1,fieldId:"67fa74d5-b000-48b2-9f5b-365d42c11518",fieldLabel:"1",fieldName:this.$element.attr("data-newsletter"),fieldType:"Email",fieldValue:n.sha256(this.$element.find("#newsletter_subscribe_email")[0].value)}],t=this.$element.find("#newsletter_subscribe_checkboxOptionalSignup")[0];t&&e.push({autofilled:!0,fieldId:"b4ac3dfb-593e-47e5-b607-51175e327ab6",fieldLabel:"2",fieldName:"1362879",fieldType:"Boolean",fieldValue:t.checked+""}),a.trackCustomEvent("trackUserNewsletter",{cohesionData:{"@type":"redventures.usertracking.v3.FormSubmitted",correlationId:this.correlationId,field:e,formContext:{formBrand:"CNET",formId:n.sha256(this.$element.attr("data-newsletter")),formName:this.$element.attr("data-newsletter")+"- Signup",formType:"EmailCapture",formVersion:"1"},outboundUrl:window.location.href,captureContext:{captureType:"Custom Form",capturePlacement:"signup"===r.tracking.data.slug?"Full Screen":"inline",valueProp:"Newsletter",identityRequested:!0}}}),a.trackCustomEvent("trackUserNewsletter",{cohesionData:{"@type":"core.Identify.v1",correlationId:this.correlationId,traits:{email:n.sha256(this.$element.find("#newsletter_subscribe_email")[0].value)}}})},_trackSubmitSuccess:function(){var e=r.tracking.data,t={"@type":"core.SignUpCaptured.v2",formId:n.sha256(this.$element.attr("data-newsletter")),signUpType:"Newsletter",subscriptionPreference:"Subscribed",customerId:r.tracking.data.userId||"none",acquisitionCorrelationId:this.correlationId,hashedEmail:n.sha256(this.$element.find("#newsletter_subscribe_email")[0].value),email:this.$element.find("#newsletter_subscribe_email")[0].value,campaignSignedUp:this.$element.find("#newsletter_subscribe_grp")[0].value,captureContext:{captureType:"Custom Form",capturePlacement:"signup"===r.tracking.data.slug?"Full Screen":"inline",valueProp:"Newsletter",identityRequested:!0}};a.trackCustomEvent("trackPageEvent",{articleId:e.articleId,articleTitle:e.articleTitle,articleType:e.articleType,clickGenericText:this.options.tracking,collectionId:e.collectionId,pageTitle:e.photoGalleryTitle,pageType:e.pageType,pageViewGuid:e.pageViewGuid,siteEdition:e.siteEdition,siteHier:e.siteHier,siteSection:e.siteSection,topicId:e.topicId,_dwAnonId:e._dwAnonId,brand:e.brand,cohesionData:t},"trackClick");var i=this.$element.find("#newsletter_subscribe_checkboxOptionalSignup")[0];i&&i.checked&&(t.campaignSignedUp="1362879",a.trackCustomEvent("trackUserNewsletter",{cohesionData:t}))}})});